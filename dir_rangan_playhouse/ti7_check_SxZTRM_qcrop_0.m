% designed to check dump from ti7_check_SxZTRM_4.f ;
% trying out qcrop functions. ;
clear;
addpath('/data/rangan/dir_cryoem/dir_rangan_playpen');
setup();
dir_base = '/data/rangan/dir_cryoem/dir_rangan_playhouse/dir_tmp';

%%%%%%%%;
fname_mda = sprintf('%s/svd_d_max.mda',dir_base);
svd_d_max = MDA_read_r8(fname_mda);
fname_mda = sprintf('%s/n_svd_d.mda',dir_base);
n_svd_d = MDA_read_i4(fname_mda);
fname_mda = sprintf('%s/svd_r_max.mda',dir_base);
svd_r_max = MDA_read_r8(fname_mda);
fname_mda = sprintf('%s/n_svd_r.mda',dir_base);
n_svd_r = MDA_read_i4(fname_mda);
fname_mda = sprintf('%s/n_svd_l.mda',dir_base);
n_svd_l = MDA_read_i4(fname_mda);
fname_mda = sprintf('%s/svd_l_.mda',dir_base);
svd_l_ = MDA_read_i4(fname_mda);
fname_mda = sprintf('%s/svd_d_.mda',dir_base);
svd_d_ = MDA_read_r8(fname_mda);
fname_mda = sprintf('%s/svd_r_.mda',dir_base);
svd_r_ = MDA_read_r8(fname_mda);
fname_mda = sprintf('%s/svd_U_d_.mda',dir_base);
svd_U_d_ = MDA_read_r8(fname_mda);
fname_mda = sprintf('%s/svd_s_.mda',dir_base);
svd_s_ = MDA_read_r8(fname_mda);
fname_mda = sprintf('%s/svd_V_r_.mda',dir_base);
svd_V_r_ = MDA_read_r8(fname_mda);
%%%%%%%%;
fname_mda = sprintf('%s/n_delta_v.mda',dir_base);
n_delta_v = MDA_read_i4(fname_mda);
fname_mda = sprintf('%s/n_gamma_z.mda',dir_base);
n_gamma_z = MDA_read_i4(fname_mda);
fname_mda = sprintf('%s/n_r.mda',dir_base);
n_r = MDA_read_i4(fname_mda);
fname_mda = sprintf('%s/n_w_.mda',dir_base);
n_w_ = MDA_read_i4(fname_mda);
fname_mda = sprintf('%s/n_A.mda',dir_base);
n_A = MDA_read_i4(fname_mda);
%%%%%%%%;
fname_mda = sprintf('%s/n_S.mda',dir_base);
n_S = MDA_read_i4(fname_mda);
fname_mda = sprintf('%s/I_S_sample_.mda',dir_base);
I_S_sample_ = MDA_read_i4(fname_mda);
fname_mda = sprintf('%s/ld_S.mda',dir_base);
ld_S = MDA_read_i4(fname_mda);
fname_mda = sprintf('%s/n_M.mda',dir_base);
n_M = MDA_read_i4(fname_mda);
fname_mda = sprintf('%s/I_M_sample_.mda',dir_base);
I_M_sample_ = MDA_read_i4(fname_mda);
fname_mda = sprintf('%s/ld_M.mda',dir_base);
ld_M = MDA_read_i4(fname_mda);
fname_mda = sprintf('%s/n_CTF.mda',dir_base);
n_CTF = MDA_read_i4(fname_mda);
fname_mda = sprintf('%s/ld_CTF.mda',dir_base);
ld_CTF = MDA_read_i4(fname_mda);
%%%%%%%%;
fname_mda = sprintf('%s/delta_x_.mda',dir_base);
delta_x_ = MDA_read_r8(fname_mda);
fname_mda = sprintf('%s/delta_y_.mda',dir_base);
delta_y_ = MDA_read_r8(fname_mda);
fname_mda = sprintf('%s/gamma_z_.mda',dir_base);
gamma_z_ = MDA_read_r8(fname_mda);
fname_mda = sprintf('%s/delta_x_est_.mda',dir_base);
delta_x_est_ = MDA_read_r8(fname_mda);
fname_mda = sprintf('%s/delta_y_est_.mda',dir_base);
delta_y_est_ = MDA_read_r8(fname_mda);
fname_mda = sprintf('%s/gamma_z_est_.mda',dir_base);
gamma_z_est_ = MDA_read_r8(fname_mda);
fname_mda = sprintf('%s/ctf_ind_est_.mda',dir_base);
ctf_ind_est_ = MDA_read_r8(fname_mda);
%%%%%%%%;
fname_mda = sprintf('%s/grid_p_.mda',dir_base);
grid_p_ = MDA_read_r8(fname_mda);
%%%%%%%%;
fname_mda = sprintf('%s/S_p__.mda',dir_base);
S_p__ = MDA_read_c16(fname_mda);
fname_mda = sprintf('%s/M_p__.mda',dir_base);
M_p__ = MDA_read_c16(fname_mda);
fname_mda = sprintf('%s/CTF_p__.mda',dir_base);
CTF_p__ = MDA_read_c16(fname_mda);
%%%%%%%%;
fname_mda = sprintf('%s/S_Z_T_R_CTF_M_q__.mda',dir_base);
S_Z_T_R_CTF_M_q__ = MDA_read_c16(fname_mda);
fname_mda = sprintf('%s/S_T_T_R_CTF_M_q__.mda',dir_base);
S_T_T_R_CTF_M_q__ = MDA_read_c16(fname_mda);
%%%%%%%%;
fname_mda = sprintf('%s/Z_S_svdd_.mda',dir_base);
Z_S_svdd_ = MDA_read_c16(fname_mda);
fname_mda = sprintf('%s/Z_M_svdd_.mda',dir_base);
Z_M_svdd_ = MDA_read_c16(fname_mda);
%%%%%%%%;
fname_mda = sprintf('%s/delta_x_est.mda',dir_base);
delta_x_est = MDA_read_r8(fname_mda);
fname_mda = sprintf('%s/delta_y_est.mda',dir_base);
delta_y_est = MDA_read_r8(fname_mda);
fname_mda = sprintf('%s/gamma_z_est.mda',dir_base);
gamma_z_est = MDA_read_r8(fname_mda);
%%%%%%%%;
fname_mda = sprintf('%s/CTF_R_S_use_.mda',dir_base);
CTF_R_S_use_ = MDA_read_c16(fname_mda);
fname_mda = sprintf('%s/S_p_.mda',dir_base);
S_p_ = MDA_read_c16(fname_mda);
fname_mda = sprintf('%s/S_q_.mda',dir_base);
S_q_ = MDA_read_c16(fname_mda);
fname_mda = sprintf('%s/M_p_.mda',dir_base);
M_p_ = MDA_read_c16(fname_mda);
fname_mda = sprintf('%s/M_p_1_.mda',dir_base);
M_p_1_ = MDA_read_c16(fname_mda);
fname_mda = sprintf('%s/M_p_2_.mda',dir_base);
M_p_2_ = MDA_read_c16(fname_mda);
fname_mda = sprintf('%s/M_p_3_.mda',dir_base);
M_p_3_ = MDA_read_c16(fname_mda);
fname_mda = sprintf('%s/M_q_.mda',dir_base);
M_q_ = MDA_read_c16(fname_mda);
fname_mda = sprintf('%s/Z_S_svdr_0_.mda',dir_base);
Z_S_svdr_0_ = MDA_read_c16(fname_mda);
fname_mda = sprintf('%s/Z_S_svdr_.mda',dir_base);
Z_S_svdr_ = MDA_read_c16(fname_mda);
fname_mda = sprintf('%s/Z_M_svdr_0_.mda',dir_base);
Z_M_svdr_0_ = MDA_read_c16(fname_mda);
fname_mda = sprintf('%s/Z_M_svdr_.mda',dir_base);
Z_M_svdr_ = MDA_read_c16(fname_mda);
fname_mda = sprintf('%s/C_S_q_.mda',dir_base);
C_S_q_ = MDA_read_c16(fname_mda);
fname_mda = sprintf('%s/C_M_q_.mda',dir_base);
C_M_q_ = MDA_read_c16(fname_mda);
fname_mda = sprintf('%s/S_R_T_x_T_R_CTF_M_q__.mda',dir_base);
S_R_T_x_T_R_CTF_M_q__ = MDA_read_c16(fname_mda);
fname_mda = sprintf('%s/S_T_R_x_T_R_CTF_M_q__.mda',dir_base);
S_T_R_x_T_R_CTF_M_q__ = MDA_read_c16(fname_mda);
%%%%%%%%;
fname_mda = sprintf('%s/ns_dump.mda',dir_base);
ns_dump = MDA_read_i4(fname_mda);
fname_mda = sprintf('%s/nm_dump.mda',dir_base);
nm_dump = MDA_read_i4(fname_mda);
fname_mda = sprintf('%s/ndelta_dump.mda',dir_base);
ndelta_dump = MDA_read_i4(fname_mda);
fname_mda = sprintf('%s/ngamma_dump.mda',dir_base);
ngamma_dump = MDA_read_i4(fname_mda);

[tmp_Z_S_svdd_,U_d__] = innerproduct_q_k_svdd_3(1,svd_d_max,n_svd_d,svd_d_,n_svd_l,svd_l_,svd_U_d_,n_delta_v,delta_x_,delta_y_);
disp(sprintf(' %% Z_S_svdd_ error: %0.16f/%0.16f = %0.16f',norm(tmp_Z_S_svdd_-Z_S_svdd_),norm(Z_S_svdd_),norm(tmp_Z_S_svdd_-Z_S_svdd_)/norm(Z_S_svdd_)));
[tmp_Z_M_svdd_,U_d__] = innerproduct_q_k_svdd_3(0,svd_d_max,n_svd_d,svd_d_,n_svd_l,svd_l_,svd_U_d_,n_delta_v,delta_x_,delta_y_);
disp(sprintf(' %% Z_M_svdd_ error: %0.16f/%0.16f = %0.16f',norm(tmp_Z_M_svdd_-Z_M_svdd_),norm(Z_M_svdd_),norm(tmp_Z_M_svdd_-Z_M_svdd_)/norm(Z_M_svdd_)));

nctf = round(ctf_ind_est_(1+nm_dump));
tmp_S_p_ = S_p__(1+I_S_sample_(1+ns_dump)*ld_S + (0:n_A-1));
disp(sprintf(' %% S_p_ error: %0.16f/%0.16f = %0.16f',norm(tmp_S_p_-S_p_),norm(S_p_),norm(tmp_S_p_-S_p_)/norm(S_p_)));
tmp_M_p_ = M_p__(1+I_M_sample_(1+nm_dump)*ld_M + (0:n_A-1));
disp(sprintf(' %% M_p_ error: %0.16f/%0.16f = %0.16f',norm(tmp_M_p_-M_p_),norm(M_p_),norm(tmp_M_p_-M_p_)/norm(M_p_)));
tmp_S_q_ = interp_p_to_q(n_r,n_w_,n_A,S_p_);
disp(sprintf(' %% S_q_ error: %0.16f/%0.16f = %0.16f',norm(tmp_S_q_-S_q_),norm(S_q_),norm(tmp_S_q_-S_q_)/norm(S_q_)));
tmp_M_p_1_ = xc1_c16(n_A,M_p_,CTF_p__(1+nctf*ld_CTF + (0:n_A-1)));
disp(sprintf(' %% M_p_1_ error: %0.16f/%0.16f = %0.16f',norm(tmp_M_p_1_-M_p_1_),norm(M_p_1_),norm(tmp_M_p_1_-M_p_1_)/norm(M_p_1_)));
tmp_M_p_2_ = rotate_p2p_fx(n_r,n_w_,n_A,tmp_M_p_1_,-gamma_z_est);
disp(sprintf(' %% M_p_2_ error: %0.16f/%0.16f = %0.16f',norm(tmp_M_p_2_-M_p_2_),norm(M_p_2_),norm(tmp_M_p_2_-M_p_2_)/norm(M_p_2_)));
tmp_M_p_3_ = transf_p_to_p(n_r,grid_p_,n_w_,n_A,tmp_M_p_2_,-delta_x_est,-delta_y_est);
disp(sprintf(' %% M_p_3_ error: %0.16f/%0.16f = %0.16f',norm(tmp_M_p_3_-M_p_3_),norm(M_p_3_),norm(tmp_M_p_3_-M_p_3_)/norm(M_p_3_)));
tmp_M_q_ = interp_p_to_q(n_r,n_w_,n_A,tmp_M_p_3_);
disp(sprintf(' %% M_q_ error: %0.16f/%0.16f = %0.16f',norm(tmp_M_q_-M_q_),norm(M_q_),norm(tmp_M_q_-M_q_)/norm(M_q_)));

%{
% demonstrate rotate_p2p_fx. ;
figure;clf;
subplot(1,2,1); cla;
polarpatch_adaptive(grid_p_,n_w_,real(M_p_),colormap(colormap_beach(64)),[-1,+1]);
axis square;
tmp_M_p_ = M_p_;
gamma_z = gamma_z_est;
for ni=1:16;
subplot(1,2,2); cla;
polarpatch_adaptive(grid_p_,n_w_,real(tmp_M_p_),colormap(colormap_beach(64)),[-1,+1]);
axis square;
title(sprintf(' gamma_z %0.2f',gamma_z));
set(gcf,'Position',1+[0,0,1024,512]);
drawnow(); pause();
tmp_M_p_ = rotate_p2p_fx(n_r,n_w_,n_A,tmp_M_p_,-gamma_z_est);
gamma_z = gamma_z + gamma_z_est;
end;%for ni=1:16;
 %}

n_w_max = max(n_w_);
%%%%%%%%;
[tmp_Z_S_svdr_0_,V_r__] = innerproduct_q_k_svdr_5(1,svd_r_max,n_svd_r,svd_r_,n_svd_l,svd_l_,svd_s_,svd_V_r_,n_r,grid_p_,n_w_,n_A,S_q_,M_q_);
disp(sprintf(' %% Z_S_svdr_0_ error: %0.16f/%0.16f = %0.16f',norm(tmp_Z_S_svdr_0_-Z_S_svdr_0_),norm(Z_S_svdr_0_),norm(tmp_Z_S_svdr_0_-Z_S_svdr_0_)/norm(Z_S_svdr_0_)));
tmp_Z_S_svdr_ = zeros(size(tmp_Z_S_svdr_0_));
for nsvd_l=0:n_svd_l-1;
tmp_ij_ = nsvd_l + [0:n_w_max-1]*n_svd_l;
tmp_Z_S_svdr_(1+tmp_ij_) = ifft(tmp_Z_S_svdr_0_(1+tmp_ij_))*n_w_max;
end;%for nsvd_l=0:n_svd_l-1;
disp(sprintf(' %% Z_S_svdr_ error: %0.16f/%0.16f = %0.16f',norm(tmp_Z_S_svdr_-Z_S_svdr_),norm(Z_S_svdr_),norm(tmp_Z_S_svdr_-Z_S_svdr_)/norm(Z_S_svdr_)));
%%%%%%%%;
[tmp_Z_M_svdr_0_,V_r__] = innerproduct_q_k_svdr_5(0,svd_r_max,n_svd_r,svd_r_,n_svd_l,svd_l_,svd_s_,svd_V_r_,n_r,grid_p_,n_w_,n_A,S_q_,M_q_);
disp(sprintf(' %% Z_M_svdr_0_ error: %0.16f/%0.16f = %0.16f',norm(tmp_Z_M_svdr_0_-Z_M_svdr_0_),norm(Z_M_svdr_0_),norm(tmp_Z_M_svdr_0_-Z_M_svdr_0_)/norm(Z_M_svdr_0_)));
tmp_Z_M_svdr_ = zeros(size(tmp_Z_M_svdr_0_));
for nsvd_l=0:n_svd_l-1;
tmp_ij_ = nsvd_l + [0:n_w_max-1]*n_svd_l;
tmp_Z_M_svdr_(1+tmp_ij_) = ifft(tmp_Z_M_svdr_0_(1+tmp_ij_))*n_w_max;
end;%for nsvd_l=0:n_svd_l-1;
disp(sprintf(' %% Z_M_svdr_ error: %0.16f/%0.16f = %0.16f',norm(tmp_Z_M_svdr_-Z_M_svdr_),norm(Z_M_svdr_),norm(tmp_Z_M_svdr_-Z_M_svdr_)/norm(Z_M_svdr_)));
%%%%%%%%;
[tmp_Z_S_qcrop_svdr_0_,V_r__] = innerproduct_q_k_qcrop_svdr_0(1,svd_r_max,n_svd_r,svd_r_,n_svd_l,svd_l_,svd_s_,svd_V_r_,n_r,grid_p_,n_w_,n_A,S_q_,M_q_);
disp(sprintf(' %% Z_S_qcrop_svdr_0_ vs Z_S_svdr_0_ error: %0.16f/%0.16f = %0.16f',norm(tmp_Z_S_qcrop_svdr_0_-Z_S_svdr_0_),norm(Z_S_svdr_0_),norm(tmp_Z_S_qcrop_svdr_0_-Z_S_svdr_0_)/norm(Z_S_svdr_0_)));
tmp_Z_S_qcrop_svdr_ = zeros(size(tmp_Z_S_qcrop_svdr_0_));
for nsvd_l=0:n_svd_l-1;
tmp_ij_ = nsvd_l + [0:n_w_max-1]*n_svd_l;
tmp_Z_S_qcrop_svdr_(1+tmp_ij_) = ifft(tmp_Z_S_qcrop_svdr_0_(1+tmp_ij_))*n_w_max;
end;%for nsvd_l=0:n_svd_l-1;
disp(sprintf(' %% Z_S_qcrop_svdr_ vs Z_S_svdr_ error: %0.16f/%0.16f = %0.16f',norm(tmp_Z_S_qcrop_svdr_-Z_S_svdr_),norm(Z_S_svdr_),norm(tmp_Z_S_qcrop_svdr_-Z_S_svdr_)/norm(Z_S_svdr_)));
%%%%%%%%;
[tmp_Z_M_qcrop_svdr_0_,V_r__] = innerproduct_q_k_qcrop_svdr_0(0,svd_r_max,n_svd_r,svd_r_,n_svd_l,svd_l_,svd_s_,svd_V_r_,n_r,grid_p_,n_w_,n_A,S_q_,M_q_);
disp(sprintf(' %% Z_M_qcrop_svdr_0_ vs Z_M_svdr_0_ error: %0.16f/%0.16f = %0.16f',norm(tmp_Z_M_qcrop_svdr_0_-Z_M_svdr_0_),norm(Z_M_svdr_0_),norm(tmp_Z_M_qcrop_svdr_0_-Z_M_svdr_0_)/norm(Z_M_svdr_0_)));
tmp_Z_M_qcrop_svdr_ = zeros(size(tmp_Z_M_qcrop_svdr_0_));
for nsvd_l=0:n_svd_l-1;
tmp_ij_ = nsvd_l + [0:n_w_max-1]*n_svd_l;
tmp_Z_M_qcrop_svdr_(1+tmp_ij_) = ifft(tmp_Z_M_qcrop_svdr_0_(1+tmp_ij_))*n_w_max;
end;%for nsvd_l=0:n_svd_l-1;
disp(sprintf(' %% Z_M_qcrop_svdr_ vs Z_M_svdr_ error: %0.16f/%0.16f = %0.16f',norm(tmp_Z_M_qcrop_svdr_-Z_M_svdr_),norm(Z_M_svdr_),norm(tmp_Z_M_qcrop_svdr_-Z_M_svdr_)/norm(Z_M_svdr_)));

K_max = 1; N_pixel = 4.0; eps_target = 0.00001; l_max = 48; a_K = 35; b_K = 36;
[tmp_n_svd_r,tmp_svd_r_,tmp_svd_r_m,tmp_svd_r_c,tmp_svd_r_w_,tmp_svd_r_Jv_,tmp_n_svd_d,tmp_svd_d_,tmp_svd_d_m,tmp_svd_d_c,tmp_svd_d_w_,tmp_svd_d_Jv_,tmp_n_svd_l,tmp_svd_l_,tmp_svd_U_d_,tmp_svd_s_,tmp_svd_V_r_] = gen_Jsvd_5b(K_max,N_pixel,eps_target,l_max,a_K,b_K);
disp(sprintf(' %% svd_r_ error: %0.16f/%0.16f = %0.16f',norm(tmp_svd_r_(:)-svd_r_(:)),norm(svd_r_(:)),norm(tmp_svd_r_(:)-svd_r_(:))/norm(svd_r_(:))));
disp(sprintf(' %% svd_d_ error: %0.16f/%0.16f = %0.16f',norm(tmp_svd_d_(:)-svd_d_(:)),norm(svd_d_(:)),norm(tmp_svd_d_(:)-svd_d_(:))/norm(svd_d_(:))));

%{

  %%%%%%%%;
  % reconstruct besselj. ;
  %%%%%%%%;
  l_max = max(svd_l_);
  J__ = zeros(n_delta_v,n_r,1+l_max);
  tmp_J__ = zeros(n_delta_v,n_r,1+l_max);
  for nl=0:l_max;
  for ndv = 0:n_delta_v-1;
  delta_x = delta_x_(1+ndv);
  delta_y = delta_y_(1+ndv);
  delta_d = sqrt(delta_x^2 + delta_y^2);
  for nr=0:n_r-1;
  J__(1+ndv,1+nr,1+nl) = besselj(nl,2*pi*grid_p_(1+nr)*delta_d);
  tmp_J = 0;
  tmp_ij_= find(svd_l_==nl);
  for nl2=1:length(tmp_ij_);
  nl3 = tmp_ij_(nl2);
  I_l = svd_l_(nl3);
  tmp_J = tmp_J + U_d__(nl3+ndv*n_svd_l)*svd_s_(nl3)*V_r__(nl3+nr*n_svd_l);
  end;%for nl2=1:length(tmp_ij_);
  tmp_J__(1+ndv,1+nr,1+nl) = tmp_J;
  end;%for nr=0:n_r-1;
  end;%for ndv = 0:n_delta_v-1;
  end;%for nl=0:l_max;
  %nl=0;
  %subplot(1,2,1);imagesc(squeeze(J__(:,:,1+nl))); title('J');
  %subplot(1,2,2);imagesc(squeeze(G__(:,:,1+nl))); title('G');
  disp(sprintf(' %% J__ error: %0.16f/%0.16f = %0.16f',norm(tmp_J__(:)-J__(:)),norm(J__(:)),norm(tmp_J__(:)-J__(:))/norm(J__(:))));

  %%%%%%%%;
  % reconstruct plane wave. ;
  %%%%%%%%;
  F__ = zeros(n_delta_v,n_r);
  tmp_F__ = zeros(n_delta_v,n_r);
  for ndv = 0:n_delta_v-1;
  delta_x = delta_x_(1+ndv);
  delta_y = delta_y_(1+ndv);
  delta_d = sqrt(delta_x^2 + delta_y^2);
  for nr=0:n_r-1;
  F__(1+ndv+nr*n_delta_v) = exp(+i*2*pi*grid_p_(1+nr)*delta_d);
  tmp_F = 0;
  for nl=0:n_svd_l-1;
  I_l = svd_l_(1+nl);
  tmp_F = tmp_F + exp(+i*pi/2*I_l)*U_d__(1+nl+ndv*n_svd_l)*svd_s_(1+nl)*V_r__(1+nl+nr*n_svd_l);
  end;%for nl=0:n_svd_l-1;
  tmp_F__(1+ndv+nr*n_delta_v) = tmp_F;
  end;%for nr=0:n_r-1;
  end;%for ndv = 0:n_delta_v-1;
  disp(sprintf(' %% F__ error: %0.16f/%0.16f = %0.16f',norm(tmp_F__(:)-F__(:)),norm(F__(:)),norm(tmp_F__(:)-F__(:))/norm(F__(:))));

  %}

tmp_C_S_q_ = zeros(n_w_max*n_delta_v,1);
tmp_C_M_q_ = zeros(n_w_max*n_delta_v,1);
tmp_C_S_q_qcrop_ = zeros(n_w_max*n_delta_v,1);
tmp_C_M_q_qcrop_ = zeros(n_w_max*n_delta_v,1);
nC1 = 0 ;
for ndv=0:n_delta_v-1;
for nw=0:n_w_max-1;
%  nC1 = nw + ndv*n_w_max ;
tmp_C_S_q_(1+nC1) = 0;
tmp_C_M_q_(1+nC1) = 0;
tmp_C_S_q_qcrop_(1+nC1) = 0;
tmp_C_M_q_qcrop_(1+nC1) = 0;
nC2 = ndv*n_svd_l;
nC3 = nw*n_svd_l;
for nsvd_l=0:n_svd_l-1;
tmp_C_S_q_(1+nC1) = tmp_C_S_q_(1+nC1) + Z_S_svdd_(1+nC2)*Z_S_svdr_(1+nC3);
tmp_C_M_q_(1+nC1) = tmp_C_M_q_(1+nC1) + Z_M_svdd_(1+nC2)*Z_M_svdr_(1+nC3);
tmp_C_S_q_qcrop_(1+nC1) = tmp_C_S_q_qcrop_(1+nC1) + Z_S_svdd_(1+nC2)*tmp_Z_S_qcrop_svdr_(1+nC3);
tmp_C_M_q_qcrop_(1+nC1) = tmp_C_M_q_qcrop_(1+nC1) + Z_M_svdd_(1+nC2)*tmp_Z_M_qcrop_svdr_(1+nC3);
nC2 = nC2 + 1;
nC3 = nC3 + 1;
end;%for nsvd_l=0:n_svd_l-1;
nC1 = nC1 + 1;
end;%for nw=0:n_w_max-1;
end;%for ndv=0:n_delta_v-1;
disp(sprintf(' %% tmp_C_S_q_ vs C_S_q_ error: %0.16f/%0.16f = %0.16f',norm(tmp_C_S_q_-C_S_q_),norm(C_S_q_),norm(tmp_C_S_q_-C_S_q_)/norm(C_S_q_)));
disp(sprintf(' %% tmp_C_M_q_ vs C_M_q_ error: %0.16f/%0.16f = %0.16f',norm(tmp_C_M_q_-C_M_q_),norm(C_M_q_),norm(tmp_C_M_q_-C_M_q_)/norm(C_M_q_)));
disp(sprintf(' %% tmp_C_S_q_qcrop_ vs C_S_q_ error: %0.16f/%0.16f = %0.16f',norm(tmp_C_S_q_qcrop_-C_S_q_),norm(C_S_q_),norm(tmp_C_S_q_qcrop_-C_S_q_)/norm(C_S_q_)));
disp(sprintf(' %% tmp_C_M_q_qcrop_ vs C_M_q_ error: %0.16f/%0.16f = %0.16f',norm(tmp_C_M_q_qcrop_-C_M_q_),norm(C_M_q_),norm(tmp_C_M_q_qcrop_-C_M_q_)/norm(C_M_q_)));
Z_X_tmp = 0;
for ndv=0:n_delta_v-1;
delta_x = delta_x_(1+ndv);
delta_y = delta_y_(1+ndv);
for nw=0:n_w_max-1;
gamma_z = (2.0d0*pi*nw)/(1.0d0*n_w_max);
nC4 = nw + n_w_max*ndv;
nx2 = ndv + n_delta_v*(ns_dump + n_S*nm_dump);
nx3 = nw*n_delta_v*n_S*n_M;
Z_X_tmp = Z_X_tmp + abs(C_M_q_(1+nC4) - S_T_T_R_CTF_M_q__(1+nx2+nx3))^2;
end;%for nw=0:n_w_max-1;
end;%for ndv=0:n_delta_v-1;
Z_X_tmp = sqrt(Z_X_tmp);
disp(sprintf(' %% C_M_q_ vs S_T_T_R_CTF_M_q__ %0.16f/%0.16f = %0.16f',Z_X_tmp,norm(C_M_q_),Z_X_tmp/norm(C_M_q_)));

ndv = ndelta_dump;
delta_x = delta_x_(1+ndv); delta_y = delta_y_(1+ndv);
tmp_S_R_T_x_T_R_CTF_M_q__ = zeros(n_w_max,1); tmp_S_T_R_x_T_R_CTF_M_q__ = zeros(n_w_max,1);
tmp_S_R_T_x_T_R_CTF_M_q_qcrop__ = zeros(n_w_max,1); tmp_S_T_R_x_T_R_CTF_M_q_qcrop__ = zeros(n_w_max,1);
%%%%%%%%;
for nw=0:n_w_max-1;%for nw=[0,25];%for nw=0:n_w_max-1;%for nw=25;
%%;
gamma_z = (2.0d0*pi*nw)/(1.0d0*n_w_max);
%%;
%%%%%%%%;
T_q_ = S_q_;
T_q_ = transf_svd_q_to_q_5(svd_r_max,n_svd_r,svd_r_,svd_d_max,n_svd_d,svd_d_,n_svd_l,svd_l_,svd_U_d_,svd_s_,svd_V_r_,n_r,grid_p_,n_w_,n_A,T_q_,delta_x,delta_y);
T_q_ = rotate_q_to_q_0(n_r,n_w_,n_A,T_q_,gamma_z);
tmp_S_T_R_x_T_R_CTF_M_q__(1+nw) = innerproduct_p(n_r,grid_p_,n_w_,n_A,T_q_,M_q_);
%%%%%%%%;
T_q_ = S_q_;
T_q_ = rotate_q_to_q_0(n_r,n_w_,n_A,T_q_,gamma_z);
T_q_ = transf_svd_q_to_q_5(svd_r_max,n_svd_r,svd_r_,svd_d_max,n_svd_d,svd_d_,n_svd_l,svd_l_,svd_U_d_,svd_s_,svd_V_r_,n_r,grid_p_,n_w_,n_A,T_q_,delta_x,delta_y);
tmp_S_R_T_x_T_R_CTF_M_q__(1+nw) = innerproduct_p(n_r,grid_p_,n_w_,n_A,T_q_,M_q_);
%%%%%%%%;
%%;
%%%%%%%%;
T_q_ = S_q_;
T_q_ = transf_qcrop_svd_q_to_q_0(svd_r_max,n_svd_r,svd_r_,svd_d_max,n_svd_d,svd_d_,n_svd_l,svd_l_,svd_U_d_,svd_s_,svd_V_r_,n_r,grid_p_,n_w_,n_A,T_q_,delta_x,delta_y);
T_q_ = rotate_q_to_q_0(n_r,n_w_,n_A,T_q_,gamma_z);
tmp_S_T_R_x_T_R_CTF_M_q_qcrop__(1+nw) = innerproduct_p(n_r,grid_p_,n_w_,n_A,T_q_,M_q_);
%%%%%%%%;
T_q_ = S_q_;
T_q_ = rotate_q_to_q_0(n_r,n_w_,n_A,T_q_,gamma_z);
T_q_ = transf_qcrop_svd_q_to_q_0(svd_r_max,n_svd_r,svd_r_,svd_d_max,n_svd_d,svd_d_,n_svd_l,svd_l_,svd_U_d_,svd_s_,svd_V_r_,n_r,grid_p_,n_w_,n_A,T_q_,delta_x,delta_y);
tmp_S_R_T_x_T_R_CTF_M_q_qcrop__(1+nw) = innerproduct_p(n_r,grid_p_,n_w_,n_A,T_q_,M_q_);
%%%%%%%%;
%%;
disp(sprintf(' %% nw %d, gamma_z %0.6f',nw,gamma_z));
disp(sprintf(' %% C_S_q_(1+ndv*n_w_max + nw)        = %0.16f + i*%0.16f',real(C_S_q_(1+ndv*n_w_max + nw)),imag(C_S_q_(1+ndv*n_w_max + nw))));
disp(sprintf(' %% tmp_C_S_q_qcrop_(1+ndv*n_w_max + nw)  = %0.16f + i*%0.16f',real(tmp_C_S_q_qcrop_(1+ndv*n_w_max + nw)),imag(tmp_C_S_q_qcrop_(1+ndv*n_w_max + nw))));
disp(sprintf(' %% tmp_S_T_R_x_T_R_CTF_M_q__(1+nw)   = %0.16f + i*%0.16f',real(tmp_S_T_R_x_T_R_CTF_M_q__(1+nw)),imag(tmp_S_T_R_x_T_R_CTF_M_q__(1+nw))));
disp(sprintf(' %% tmp_S_T_R_x_T_R_CTF_M_q_qcrop__(1+nw) = %0.16f + i*%0.16f',real(tmp_S_T_R_x_T_R_CTF_M_q_qcrop__(1+nw)),imag(tmp_S_T_R_x_T_R_CTF_M_q_qcrop__(1+nw))));
disp(sprintf(' %% C_M_q_(1+ndv*n_w_max + nw)        = %0.16f + i*%0.16f',real(C_M_q_(1+ndv*n_w_max + nw)),imag(C_M_q_(1+ndv*n_w_max + nw))));
disp(sprintf(' %% tmp_C_M_q_qcrop_(1+ndv*n_w_max + nw)  = %0.16f + i*%0.16f',real(tmp_C_M_q_qcrop_(1+ndv*n_w_max + nw)),imag(tmp_C_M_q_qcrop_(1+ndv*n_w_max + nw))));
disp(sprintf(' %% tmp_S_R_T_x_T_R_CTF_M_q__(1+nw)   = %0.16f + i*%0.16f',real(tmp_S_R_T_x_T_R_CTF_M_q__(1+nw)),imag(tmp_S_R_T_x_T_R_CTF_M_q__(1+nw))));
disp(sprintf(' %% tmp_S_R_T_x_T_R_CTF_M_q_qcrop__(1+nw) = %0.16f + i*%0.16f',real(tmp_S_R_T_x_T_R_CTF_M_q_qcrop__(1+nw)),imag(tmp_S_R_T_x_T_R_CTF_M_q_qcrop__(1+nw))));
end;%for nw=0:n_w_max-1;
%%%%%%%%;

disp(sprintf(' %% S_R_T_x_T_R_CTF_M_q__ error: %0.16f/%0.16f = %0.16f',norm(tmp_S_R_T_x_T_R_CTF_M_q__-S_R_T_x_T_R_CTF_M_q__),norm(S_R_T_x_T_R_CTF_M_q__),norm(tmp_S_R_T_x_T_R_CTF_M_q__-S_R_T_x_T_R_CTF_M_q__)/norm(S_R_T_x_T_R_CTF_M_q__)));
disp(sprintf(' %% S_T_R_x_T_R_CTF_M_q__ error: %0.16f/%0.16f = %0.16f',norm(tmp_S_T_R_x_T_R_CTF_M_q__-S_T_R_x_T_R_CTF_M_q__),norm(S_T_R_x_T_R_CTF_M_q__),norm(tmp_S_T_R_x_T_R_CTF_M_q__-S_T_R_x_T_R_CTF_M_q__)/norm(S_T_R_x_T_R_CTF_M_q__)));

tmp_C_S_q_ = C_S_q_(1+ndv*n_w_max + (0:n_w_max-1));
disp(sprintf(' %% C_S_q_ vs S_T_R_x_T_R_CTF_M_q__ %0.16f/%0.16f = %0.16f',norm(tmp_C_S_q_ - S_T_R_x_T_R_CTF_M_q__),norm(tmp_C_S_q_),norm(tmp_C_S_q_ - S_T_R_x_T_R_CTF_M_q__)/norm(tmp_C_S_q_)));
tmp_C_M_q_ = C_M_q_(1+ndv*n_w_max + (0:n_w_max-1));
disp(sprintf(' %% C_M_q_ vs S_R_T_x_T_R_CTF_M_q__ %0.16f/%0.16f = %0.16f',norm(tmp_C_M_q_ - S_R_T_x_T_R_CTF_M_q__),norm(tmp_C_M_q_),norm(tmp_C_M_q_ - S_R_T_x_T_R_CTF_M_q__)/norm(tmp_C_M_q_)));

tmp_C_S_q_ = C_S_q_(1+ndv*n_w_max + (0:n_w_max-1));
disp(sprintf(' %% C_S_q_ vs tmp_S_T_R_x_T_R_CTF_M_q_0__ %0.16f/%0.16f = %0.16f',norm(tmp_C_S_q_ - tmp_S_T_R_x_T_R_CTF_M_q_0__),norm(tmp_C_S_q_),norm(tmp_C_S_q_ - tmp_S_T_R_x_T_R_CTF_M_q_0__)/norm(tmp_C_S_q_)));
tmp_C_M_q_ = C_M_q_(1+ndv*n_w_max + (0:n_w_max-1));
disp(sprintf(' %% C_M_q_ vs tmp_S_R_T_x_T_R_CTF_M_q_0__ %0.16f/%0.16f = %0.16f',norm(tmp_C_M_q_ - tmp_S_R_T_x_T_R_CTF_M_q_0__),norm(tmp_C_M_q_),norm(tmp_C_M_q_ - tmp_S_R_T_x_T_R_CTF_M_q_0__)/norm(tmp_C_M_q_)));

disp(sprintf(' %% tmp_S_T_R_x_T_R_CTF_M_q__ vs tmp_S_T_R_x_T_R_CTF_M_q_0__ %0.16f/%0.16f = %0.16f',norm(tmp_S_T_R_x_T_R_CTF_M_q__ - tmp_S_T_R_x_T_R_CTF_M_q_0__),norm(tmp_S_T_R_x_T_R_CTF_M_q__),norm(tmp_S_T_R_x_T_R_CTF_M_q__ - tmp_S_T_R_x_T_R_CTF_M_q_0__)/norm(tmp_S_T_R_x_T_R_CTF_M_q__)));
disp(sprintf(' %% tmp_S_R_T_x_T_R_CTF_M_q__ vs tmp_S_R_T_x_T_R_CTF_M_q_0__ %0.16f/%0.16f = %0.16f',norm(tmp_S_R_T_x_T_R_CTF_M_q__ - tmp_S_R_T_x_T_R_CTF_M_q_0__),norm(tmp_S_R_T_x_T_R_CTF_M_q__),norm(tmp_S_R_T_x_T_R_CTF_M_q__ - tmp_S_R_T_x_T_R_CTF_M_q_0__)/norm(tmp_S_R_T_x_T_R_CTF_M_q__)));

tmp_C_S_q_ = C_S_q_(1+ndv*n_w_max + (0:n_w_max-1));
disp(sprintf(' %% C_S_q_ vs tmp_S_T_R_x_T_R_CTF_M_q_1__ %0.16f/%0.16f = %0.16f',norm(tmp_C_S_q_ - tmp_S_T_R_x_T_R_CTF_M_q_1__),norm(tmp_C_S_q_),norm(tmp_C_S_q_ - tmp_S_T_R_x_T_R_CTF_M_q_1__)/norm(tmp_C_S_q_)));
tmp_C_M_q_ = C_M_q_(1+ndv*n_w_max + (0:n_w_max-1));
disp(sprintf(' %% C_M_q_ vs tmp_S_R_T_x_T_R_CTF_M_q_1__ %0.16f/%0.16f = %0.16f',norm(tmp_C_M_q_ - tmp_S_R_T_x_T_R_CTF_M_q_1__),norm(tmp_C_M_q_),norm(tmp_C_M_q_ - tmp_S_R_T_x_T_R_CTF_M_q_1__)/norm(tmp_C_M_q_)));

disp(sprintf(' %% tmp_S_T_R_x_T_R_CTF_M_q__ vs tmp_S_T_R_x_T_R_CTF_M_q_1__ %0.16f/%0.16f = %0.16f',norm(tmp_S_T_R_x_T_R_CTF_M_q__ - tmp_S_T_R_x_T_R_CTF_M_q_1__),norm(tmp_S_T_R_x_T_R_CTF_M_q__),norm(tmp_S_T_R_x_T_R_CTF_M_q__ - tmp_S_T_R_x_T_R_CTF_M_q_1__)/norm(tmp_S_T_R_x_T_R_CTF_M_q__)));
disp(sprintf(' %% tmp_S_R_T_x_T_R_CTF_M_q__ vs tmp_S_R_T_x_T_R_CTF_M_q_1__ %0.16f/%0.16f = %0.16f',norm(tmp_S_R_T_x_T_R_CTF_M_q__ - tmp_S_R_T_x_T_R_CTF_M_q_1__),norm(tmp_S_R_T_x_T_R_CTF_M_q__),norm(tmp_S_R_T_x_T_R_CTF_M_q__ - tmp_S_R_T_x_T_R_CTF_M_q_1__)/norm(tmp_S_R_T_x_T_R_CTF_M_q__)));

%%%%%%%%;

tm2_C_S_q_qcrop_ = tmp_C_S_q_qcrop_(1+ndv*n_w_max + (0:n_w_max-1));
disp(sprintf(' %% C_S_q_qcrop_ vs S_T_R_x_T_R_CTF_M_q__ %0.16f/%0.16f = %0.16f',norm(tm2_C_S_q_qcrop_ - S_T_R_x_T_R_CTF_M_q__),norm(tm2_C_S_q_qcrop_),norm(tm2_C_S_q_qcrop_ - S_T_R_x_T_R_CTF_M_q__)/norm(tm2_C_S_q_qcrop_)));
tm2_C_M_q_qcrop_ = tmp_C_M_q_qcrop_(1+ndv*n_w_max + (0:n_w_max-1));
disp(sprintf(' %% C_M_q_qcrop_ vs S_R_T_x_T_R_CTF_M_q__ %0.16f/%0.16f = %0.16f',norm(tm2_C_M_q_qcrop_ - S_R_T_x_T_R_CTF_M_q__),norm(tm2_C_M_q_qcrop_),norm(tm2_C_M_q_qcrop_ - S_R_T_x_T_R_CTF_M_q__)/norm(tm2_C_M_q_qcrop_)));

tm2_C_S_q_qcrop_ = tmp_C_S_q_qcrop_(1+ndv*n_w_max + (0:n_w_max-1));
disp(sprintf(' %% C_S_q_qcrop_ vs tmp_S_T_R_x_T_R_CTF_M_q_0__ %0.16f/%0.16f = %0.16f',norm(tm2_C_S_q_qcrop_ - tmp_S_T_R_x_T_R_CTF_M_q_0__),norm(tm2_C_S_q_qcrop_),norm(tm2_C_S_q_qcrop_ - tmp_S_T_R_x_T_R_CTF_M_q_0__)/norm(tm2_C_S_q_qcrop_)));
tm2_C_M_q_qcrop_ = tmp_C_M_q_qcrop_(1+ndv*n_w_max + (0:n_w_max-1));
disp(sprintf(' %% C_M_q_qcrop_ vs tmp_S_R_T_x_T_R_CTF_M_q_0__ %0.16f/%0.16f = %0.16f',norm(tm2_C_M_q_qcrop_ - tmp_S_R_T_x_T_R_CTF_M_q_0__),norm(tm2_C_M_q_qcrop_),norm(tm2_C_M_q_qcrop_ - tmp_S_R_T_x_T_R_CTF_M_q_0__)/norm(tm2_C_M_q_qcrop_)));

disp(sprintf(' %% tmp_S_T_R_x_T_R_CTF_M_q__ vs tmp_S_T_R_x_T_R_CTF_M_q_0__ %0.16f/%0.16f = %0.16f',norm(tmp_S_T_R_x_T_R_CTF_M_q__ - tmp_S_T_R_x_T_R_CTF_M_q_0__),norm(tmp_S_T_R_x_T_R_CTF_M_q__),norm(tmp_S_T_R_x_T_R_CTF_M_q__ - tmp_S_T_R_x_T_R_CTF_M_q_0__)/norm(tmp_S_T_R_x_T_R_CTF_M_q__)));
disp(sprintf(' %% tmp_S_R_T_x_T_R_CTF_M_q__ vs tmp_S_R_T_x_T_R_CTF_M_q_0__ %0.16f/%0.16f = %0.16f',norm(tmp_S_R_T_x_T_R_CTF_M_q__ - tmp_S_R_T_x_T_R_CTF_M_q_0__),norm(tmp_S_R_T_x_T_R_CTF_M_q__),norm(tmp_S_R_T_x_T_R_CTF_M_q__ - tmp_S_R_T_x_T_R_CTF_M_q_0__)/norm(tmp_S_R_T_x_T_R_CTF_M_q__)));

tm2_C_S_q_qcrop_ = tmp_C_S_q_qcrop_(1+ndv*n_w_max + (0:n_w_max-1));
disp(sprintf(' %% C_S_q_qcrop_ vs tmp_S_T_R_x_T_R_CTF_M_q_1__ %0.16f/%0.16f = %0.16f',norm(tm2_C_S_q_qcrop_ - tmp_S_T_R_x_T_R_CTF_M_q_1__),norm(tm2_C_S_q_qcrop_),norm(tm2_C_S_q_qcrop_ - tmp_S_T_R_x_T_R_CTF_M_q_1__)/norm(tm2_C_S_q_qcrop_)));
tm2_C_M_q_qcrop_ = tmp_C_M_q_qcrop_(1+ndv*n_w_max + (0:n_w_max-1));
disp(sprintf(' %% C_M_q_qcrop_ vs tmp_S_R_T_x_T_R_CTF_M_q_1__ %0.16f/%0.16f = %0.16f',norm(tm2_C_M_q_qcrop_ - tmp_S_R_T_x_T_R_CTF_M_q_1__),norm(tm2_C_M_q_qcrop_),norm(tm2_C_M_q_qcrop_ - tmp_S_R_T_x_T_R_CTF_M_q_1__)/norm(tm2_C_M_q_qcrop_)));

disp(sprintf(' %% tmp_S_T_R_x_T_R_CTF_M_q__ vs tmp_S_T_R_x_T_R_CTF_M_q_1__ %0.16f/%0.16f = %0.16f',norm(tmp_S_T_R_x_T_R_CTF_M_q__ - tmp_S_T_R_x_T_R_CTF_M_q_1__),norm(tmp_S_T_R_x_T_R_CTF_M_q__),norm(tmp_S_T_R_x_T_R_CTF_M_q__ - tmp_S_T_R_x_T_R_CTF_M_q_1__)/norm(tmp_S_T_R_x_T_R_CTF_M_q__)));
disp(sprintf(' %% tmp_S_R_T_x_T_R_CTF_M_q__ vs tmp_S_R_T_x_T_R_CTF_M_q_1__ %0.16f/%0.16f = %0.16f',norm(tmp_S_R_T_x_T_R_CTF_M_q__ - tmp_S_R_T_x_T_R_CTF_M_q_1__),norm(tmp_S_R_T_x_T_R_CTF_M_q__),norm(tmp_S_R_T_x_T_R_CTF_M_q__ - tmp_S_R_T_x_T_R_CTF_M_q_1__)/norm(tmp_S_R_T_x_T_R_CTF_M_q__)));

tm2_C_S_q_qcrop_ = tmp_C_S_q_qcrop_(1+ndv*n_w_max + (0:n_w_max-1));
disp(sprintf(' %% C_S_q_qcrop_ vs S_T_R_x_T_R_CTF_M_q__ %0.16f/%0.16f = %0.16f',norm(tm2_C_S_q_qcrop_ - S_T_R_x_T_R_CTF_M_q__),norm(tm2_C_S_q_qcrop_),norm(tm2_C_S_q_qcrop_ - S_T_R_x_T_R_CTF_M_q__)/norm(tm2_C_S_q_qcrop_)));
tm2_C_M_q_qcrop_ = tmp_C_M_q_qcrop_(1+ndv*n_w_max + (0:n_w_max-1));
disp(sprintf(' %% C_M_q_qcrop_ vs S_R_T_x_T_R_CTF_M_q__ %0.16f/%0.16f = %0.16f',norm(tm2_C_M_q_qcrop_ - S_R_T_x_T_R_CTF_M_q__),norm(tm2_C_M_q_qcrop_),norm(tm2_C_M_q_qcrop_ - S_R_T_x_T_R_CTF_M_q__)/norm(tm2_C_M_q_qcrop_)));

tm2_C_S_q_qcrop_ = tmp_C_S_q_qcrop_(1+ndv*n_w_max + (0:n_w_max-1));
disp(sprintf(' %% C_S_q_qcrop_ vs tmp_S_T_R_x_T_R_CTF_M_q_0__ %0.16f/%0.16f = %0.16f',norm(tm2_C_S_q_qcrop_ - tmp_S_T_R_x_T_R_CTF_M_q_0__),norm(tm2_C_S_q_qcrop_),norm(tm2_C_S_q_qcrop_ - tmp_S_T_R_x_T_R_CTF_M_q_0__)/norm(tm2_C_S_q_qcrop_)));
tm2_C_M_q_qcrop_ = tmp_C_M_q_qcrop_(1+ndv*n_w_max + (0:n_w_max-1));
disp(sprintf(' %% C_M_q_qcrop_ vs tmp_S_R_T_x_T_R_CTF_M_q_0__ %0.16f/%0.16f = %0.16f',norm(tm2_C_M_q_qcrop_ - tmp_S_R_T_x_T_R_CTF_M_q_0__),norm(tm2_C_M_q_qcrop_),norm(tm2_C_M_q_qcrop_ - tmp_S_R_T_x_T_R_CTF_M_q_0__)/norm(tm2_C_M_q_qcrop_)));

disp(sprintf(' %% tmp_S_T_R_x_T_R_CTF_M_q__ vs tmp_S_T_R_x_T_R_CTF_M_q_0__ %0.16f/%0.16f = %0.16f',norm(tmp_S_T_R_x_T_R_CTF_M_q__ - tmp_S_T_R_x_T_R_CTF_M_q_0__),norm(tmp_S_T_R_x_T_R_CTF_M_q__),norm(tmp_S_T_R_x_T_R_CTF_M_q__ - tmp_S_T_R_x_T_R_CTF_M_q_0__)/norm(tmp_S_T_R_x_T_R_CTF_M_q__)));
disp(sprintf(' %% tmp_S_R_T_x_T_R_CTF_M_q__ vs tmp_S_R_T_x_T_R_CTF_M_q_0__ %0.16f/%0.16f = %0.16f',norm(tmp_S_R_T_x_T_R_CTF_M_q__ - tmp_S_R_T_x_T_R_CTF_M_q_0__),norm(tmp_S_R_T_x_T_R_CTF_M_q__),norm(tmp_S_R_T_x_T_R_CTF_M_q__ - tmp_S_R_T_x_T_R_CTF_M_q_0__)/norm(tmp_S_R_T_x_T_R_CTF_M_q__)));

tm2_C_S_q_qcrop_ = tmp_C_S_q_qcrop_(1+ndv*n_w_max + (0:n_w_max-1));
disp(sprintf(' %% C_S_q_qcrop_ vs tmp_S_T_R_x_T_R_CTF_M_q_1__ %0.16f/%0.16f = %0.16f',norm(tm2_C_S_q_qcrop_ - tmp_S_T_R_x_T_R_CTF_M_q_1__),norm(tm2_C_S_q_qcrop_),norm(tm2_C_S_q_qcrop_ - tmp_S_T_R_x_T_R_CTF_M_q_1__)/norm(tm2_C_S_q_qcrop_)));
tm2_C_M_q_qcrop_ = tmp_C_M_q_qcrop_(1+ndv*n_w_max + (0:n_w_max-1));
disp(sprintf(' %% C_M_q_qcrop_ vs tmp_S_R_T_x_T_R_CTF_M_q_1__ %0.16f/%0.16f = %0.16f',norm(tm2_C_M_q_qcrop_ - tmp_S_R_T_x_T_R_CTF_M_q_1__),norm(tm2_C_M_q_qcrop_),norm(tm2_C_M_q_qcrop_ - tmp_S_R_T_x_T_R_CTF_M_q_1__)/norm(tm2_C_M_q_qcrop_)));

disp(sprintf(' %% tmp_S_T_R_x_T_R_CTF_M_q__ vs tmp_S_T_R_x_T_R_CTF_M_q_1__ %0.16f/%0.16f = %0.16f',norm(tmp_S_T_R_x_T_R_CTF_M_q__ - tmp_S_T_R_x_T_R_CTF_M_q_1__),norm(tmp_S_T_R_x_T_R_CTF_M_q__),norm(tmp_S_T_R_x_T_R_CTF_M_q__ - tmp_S_T_R_x_T_R_CTF_M_q_1__)/norm(tmp_S_T_R_x_T_R_CTF_M_q__)));
disp(sprintf(' %% tmp_S_R_T_x_T_R_CTF_M_q__ vs tmp_S_R_T_x_T_R_CTF_M_q_1__ %0.16f/%0.16f = %0.16f',norm(tmp_S_R_T_x_T_R_CTF_M_q__ - tmp_S_R_T_x_T_R_CTF_M_q_1__),norm(tmp_S_R_T_x_T_R_CTF_M_q__),norm(tmp_S_R_T_x_T_R_CTF_M_q__ - tmp_S_R_T_x_T_R_CTF_M_q_1__)/norm(tmp_S_R_T_x_T_R_CTF_M_q__)));



