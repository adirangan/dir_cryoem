% Generates a pair of arcs, as well as their innerproducts. ;
% Also (first) generates a few blob images, as well as their innerproducts, etc. ;

%clear; startup; rng(1); flag_plot = 1;
clear; flag_plot = 1;
dir_fig = './dir_fig'; if (~exist(dir_fig,'dir')); disp(sprintf(' %% creating %s',dir_fig)); mkdir(dir_fig); end;
n_figure = 1;


flag_skip=0;
if ~flag_skip;
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%;
% Generate blob images. ;
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%;

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% ;
% generate image/template F ;
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% ;
tic;
n_x = 256; max_x_c = 1; max_k_c = n_x/max_x_c; max_k_p = max_k_c/2;
% realspace carte grid ; 
grid_x_c_ = linspace(0,max_x_c,n_x+1); grid_x_c_ = grid_x_c_(1:end-1); d_x_c = mean(diff(grid_x_c_));
% freqspace carte grid ; 
grid_k_c_ = (0:n_x-1)/max_x_c; d_k_c = mean(diff(grid_k_c_));
% xxxxspace qring grid ;
grid_k_q_ = (0:n_x-1) ; max_q = n_x; qlim = [-2,+2]; grid_k_q2_ = grid_k_q_; grid_k_q2_(n_x/2:end) = grid_k_q2_(n_x/2:end)-n_x;
% realspace carte meshgrid ;
[X_x_c_,Y_x_c_] = meshgrid(grid_x_c_,grid_x_c_); X_x_c_(:,n_x/2+1:end) = X_x_c_(:,n_x/2+1:end)-max_x_c; Y_x_c_(n_x/2+1:end,:) = Y_x_c_(n_x/2+1:end,:)-max_x_c;
R_x_c_ = sqrt(X_x_c_.^2 + Y_x_c_.^2); W_x_c_ = atan2(Y_x_c_,X_x_c_);
% freqspace carte meshgrid ;
[X_k_c_,Y_k_c_] = meshgrid(grid_k_c_,grid_k_c_); X_k_c_(:,n_x/2+1:end) = X_k_c_(:,n_x/2+1:end)-max_k_c; Y_k_c_(n_x/2+1:end,:) = Y_k_c_(n_x/2+1:end,:)-max_k_c;
R_k_c_ = sqrt(X_k_c_.^2 + Y_k_c_.^2); W_k_c_ = atan2(Y_k_c_,X_k_c_);
% realspace polar meshgrid ;
grid_x_r_ = linspace(0,max_x_c/2,n_x+1); grid_x_r_ = grid_x_r_(1:end-1); grid_x_w_ = linspace(0,2*pi,n_x+1); grid_x_w_ = grid_x_w_(1:end-1); 
[R_x_p_,W_x_p_] = meshgrid(grid_x_r_,grid_x_w_);
% freqspace polar meshgrid ;
grid_k_r_ = linspace(0,max_k_p,n_x+1); grid_k_r_ = grid_k_r_(1:end-1); d_k_r = mean(diff(grid_k_r_));
grid_k_w_ = linspace(0,2*pi,n_x+1); grid_k_w_ = grid_k_w_(1:end-1); d_k_w = mean(diff(grid_k_w_));
[R_k_p_,W_k_p_] = meshgrid(grid_k_r_,grid_k_w_);
X_k_p_ = R_k_p_.*cos(W_k_p_); Y_k_p_ = R_k_p_.*sin(W_k_p_);
% set up image/template on realspace carte meshgrid ;
n_F = 32;
F_x_c_ = zeros(n_x,n_x);
G_x_c_ = zeros(n_x,n_x);
for nF=1:n_F;
tmp_t = 1.5 + (nF-1)/(n_F-1);
tmp_x_c = 0*max_x_c/2 -0.1 + 0.0625*(tmp_t-1).^2.25 + 0.125*tmp_t*cos(+13.0*2*pi*tmp_t); 
tmp_y_c = 0*max_x_c/2 + 0.125*tmp_t*sin(+14.0*2*pi*tmp_t); 
tmp_s = 1/32; tmp_s = (1/64) * (1.50 + (2-tmp_t)*sin(+5.0*2*pi*tmp_t));
tmp_X_x_c_ = X_x_c_ - (tmp_x_c); tmp_Y_x_c_ = Y_x_c_ - (tmp_y_c);
tmp_R_x_c_ = sqrt(tmp_X_x_c_.^2 + tmp_Y_x_c_.^2); tmp_W_x_c_ = atan2(tmp_Y_x_c_,tmp_X_x_c_);
F_x_c_ = F_x_c_ + 1/sqrt(2*pi)/tmp_s * exp(-tmp_R_x_c_.^2/2/tmp_s.^2); 
%tmp_x_c = 0*max_x_c/2 + 0.125*tmp_t*cos(-10.5*2*pi*tmp_t); tmp_y_c = 0*max_x_c/2 -0.2 + 0.125*(tmp_t-1).^2 + 0.125*tmp_t*sin(+12.5*2*pi*tmp_t); tmp_s = 1/32; tmp_s = (1/64) * (1.50 + (2-tmp_t)*sin(+3.0*2*pi*tmp_t));
tmp_x_c = 0*max_x_c/2 -0.1 + 0.0625*(tmp_t-1).^2.25 + 0.125*tmp_t*cos(+13.0*2*pi*tmp_t) + 0.01*tmp_t*sin(+16.0*2*pi*tmp_t);
tmp_y_c = 0*max_x_c/2 + 0.125*tmp_t*sin(+14.0*2*pi*tmp_t) + 0.01*tmp_t*cos(+3.0*2*pi*tmp_t); 
tmp_s = 1/32; tmp_s = (1/64) * (1.50 + (2-tmp_t)*sin(+5.0*2*pi*tmp_t));
tmp_X_x_c_ = X_x_c_ - (tmp_x_c); tmp_Y_x_c_ = Y_x_c_ - (tmp_y_c);
tmp_R_x_c_ = sqrt(tmp_X_x_c_.^2 + tmp_Y_x_c_.^2); tmp_W_x_c_ = atan2(tmp_Y_x_c_,tmp_X_x_c_);
G_x_c_ = G_x_c_ + 1/sqrt(2*pi)/tmp_s * exp(-tmp_R_x_c_.^2/2/tmp_s.^2); 
end;%for nF=1:n_F;
n_E = 128;
for nE=1:n_E;
tmp_t = (nF-1)/(n_F-1);
tmp_x_c = 0*max_x_c/2 + 0.25*(tmp_t-1) + 0.125*tmp_t*cos(+2.7*2*pi*tmp_t); 
tmp_y_c = 0*max_x_c/2 + 0.25*(tmp_t-1) + 0.125*tmp_t*sin(+3.2*2*pi*tmp_t); 
tmp_s = 1/64;
tmp_X_x_c_ = X_x_c_ - (tmp_x_c); tmp_Y_x_c_ = Y_x_c_ - (tmp_y_c);
tmp_R_x_c_ = sqrt(tmp_X_x_c_.^2 + tmp_Y_x_c_.^2); tmp_W_x_c_ = atan2(tmp_Y_x_c_,tmp_X_x_c_);
F_x_c_ = F_x_c_ + 0.125 * 1/sqrt(2*pi)/tmp_s * exp(-tmp_R_x_c_.^2/2/tmp_s.^2); 
tmp_x_c = 0*max_x_c/2 + 0.25*(tmp_t-1) + 0.125*tmp_t*cos(+1.4*2*pi*tmp_t); 
tmp_y_c = 0*max_x_c/2 + 0.25*(tmp_t-1) + 0.125*tmp_t*sin(+2.9*2*pi*tmp_t); 
tmp_s = 1/64;
tmp_X_x_c_ = X_x_c_ - (tmp_x_c); tmp_Y_x_c_ = Y_x_c_ - (tmp_y_c);
tmp_R_x_c_ = sqrt(tmp_X_x_c_.^2 + tmp_Y_x_c_.^2); tmp_W_x_c_ = atan2(tmp_Y_x_c_,tmp_X_x_c_);
G_x_c_ = G_x_c_ + 0.125 * 1/sqrt(2*pi)/tmp_s * exp(-tmp_R_x_c_.^2/2/tmp_s.^2); 
end;%for nE=1:n_E;
F_x_c_ = F_x_c_ - mean(F_x_c_(:));
G_x_c_ = G_x_c_ - mean(G_x_c_(:));
Flim_x = max(0,mean(F_x_c_(:)) + 1.0*std(F_x_c_(:))*[-1,+1]);
Glim_x = max(0,mean(G_x_c_(:)) + 1.0*std(G_x_c_(:))*[-1,+1]);
disp(sprintf(' %% calculating F_x_c_ G_x_c_: time %f',toc));

flag_disp=0;
if flag_disp;
figure(n_figure); clf; n_figure = n_figure + 1;
colormap(1-colormap('gray'));
subplot(1,2,1);imagesc(recenter2(real(F_x_c_)),Flim_x);title('A1','interpreter','none'); set(gca,'Ydir','normal'); xlim([1,n_x]); ylim([1,n_x]); axis square;
set(gca,'XTick',[1,n_x/2+1,n_x],'XTickLabel',[grid_x_c_(1),grid_x_c_(end/2+1),floor(10*grid_x_c_(end))/10]-max_x_c/2);set(gca,'YTick',[1,n_x/2+1,n_x],'YTickLabel',[grid_x_c_(1),grid_x_c_(end/2+1),floor(10*grid_x_c_(end))/10]-max_x_c/2);
subplot(1,2,2);imagesc(recenter2(real(G_x_c_)),Glim_x);title('A2','interpreter','none'); set(gca,'Ydir','normal'); xlim([1,n_x]); ylim([1,n_x]); axis square;
set(gca,'XTick',[1,n_x/2+1,n_x],'XTickLabel',[grid_x_c_(1),grid_x_c_(end/2+1),floor(10*grid_x_c_(end))/10]-max_x_c/2);set(gca,'YTick',[1,n_x/2+1,n_x],'YTickLabel',[grid_x_c_(1),grid_x_c_(end/2+1),floor(10*grid_x_c_(end))/10]-max_x_c/2);
set(gcf,'Position',1+[0,0,512*2,512]);
fname_fig = sprintf('%s/blob_FIGA_0',dir_fig);
if flag_plot; print('-djpeg',sprintf('%s.jpg',fname_fig)); end;
if flag_plot; print('-depsc',sprintf('%s.eps',fname_fig)); end;
%disp('return');return;
end;% if flag_disp;

tic;
grid_x_p_ = grid_x_r_;
n_x_r = length(grid_x_p_);
n_x_w_ = max(6,ceil(2*pi*grid_x_p_*n_x_r)); n_x_A = sum(n_x_w_); n_x_w_max = max(n_x_w_);
F_x_p_ = interp_c_to_p(n_x,max_x_c,n_x,max_x_c,F_x_c_,n_x_r,grid_x_p_,n_x_w_,n_x_A);
G_x_p_ = interp_c_to_p(n_x,max_x_c,n_x,max_x_c,G_x_c_,n_x_r,grid_x_p_,n_x_w_,n_x_A);
disp(sprintf(' %% calculating F_x_p_ G_x_p_: time %s',toc));
flag_disp=0;
if flag_disp;
subplot(2,2,1);imagesc_p(n_x_r,grid_x_p_,n_x_w_,n_x_A,real(F_x_p_),Flim_x,colormap(colormap_beach(64)));
subplot(2,2,2);imagesc_p(n_x_r,grid_x_p_,n_x_w_,n_x_A,real(G_x_p_),Glim_x,colormap(colormap_beach(64)));
subplot(2,2,3);imagesc_p(n_x_r,grid_x_p_,n_x_w_,n_x_A,imag(F_x_p_),Flim_x,colormap(colormap_beach(64)));
subplot(2,2,4);imagesc_p(n_x_r,grid_x_p_,n_x_w_,n_x_A,imag(G_x_p_),Glim_x,colormap(colormap_beach(64)));
return;
end;%if flag_disp;

tic;
l2_F_x_c = sum(abs(F_x_c_(:)).^2)*d_x_c*d_x_c;
% calculate image/template values on freqspace carte meshgrid ;
F_k_c_ = fft2(F_x_c_) * d_x_c*d_x_c; Flim_k  = mean(abs(F_k_c_(:))) + 1.0*std(abs(F_k_c_(:)))*[-1,+1];
l2_F_k_c = sum(abs(F_k_c_(:)).^2)*d_k_c*d_k_c;
F_tmp = ifft2(F_k_c_)./d_x_c./d_x_c; l2_F_tmp = sum(abs(F_tmp(:)).^2)*d_x_c*d_x_c;
disp(sprintf(' %% l2_F_x_c %f l2_F_k_c %f',l2_F_x_c,l2_F_k_c));
Flim_x = max(0,mean(abs(F_x_c_(:))) + 1.0*std(abs(F_x_c_(:)))*[-1,+1]);
l2_G_x_c = sum(abs(G_x_c_(:)).^2)*d_x_c*d_x_c;
% calculate image/template values on freqspace carte meshgrid ;
G_k_c_ = fft2(G_x_c_) * d_x_c*d_x_c; Glim_k  = mean(abs(G_k_c_(:))) + 1.0*std(abs(G_k_c_(:)))*[-1,+1];
l2_G_k_c = sum(abs(G_k_c_(:)).^2)*d_k_c*d_k_c;
G_tmp = ifft2(G_k_c_)./d_x_c./d_x_c; l2_G_tmp = sum(abs(G_tmp(:)).^2)*d_x_c*d_x_c;
disp(sprintf(' %% l2_G_x_c %f l2_G_k_c %f',l2_G_x_c,l2_G_k_c));
Glim_x = max(0,mean(abs(G_x_c_(:))) + 1.0*std(abs(G_x_c_(:)))*[-1,+1]);
disp(sprintf(' %% calculating F_k_c_ G_k_c_: time %f',toc));

Llim_k = [-8,0];
flag_disp=0;
if flag_disp;
figure(n_figure); clf; n_figure = n_figure + 1;
colormap(colormap_beach());
subplot(2,3,1);imagesc(recenter2(real(F_k_c_)),Flim_k);title('real(A1(k))','interpreter','none'); set(gca,'Ydir','normal'); xlim(n_x/2 + n_x/2*0.5*[-1,+1]); ylim(n_x/2 + n_x/2*0.5*[-1,+1]); axis square;
set(gca,'XTick',[],'YTick',[]);
%set(gca,'XTick',[1,n_x/2+1,n_x],'XTickLabel',[grid_k_c_(1),grid_k_c_(end/2+1),floor(10*grid_k_c_(end))/10]-max_k_c/2);set(gca,'YTick',[1,n_x/2+1,n_x],'YTickLabel',[grid_k_c_(1),grid_k_c_(end/2+1),floor(10*grid_k_c_(end))/10]-max_k_c/2);
subplot(2,3,2);imagesc(recenter2(imag(F_k_c_)),Flim_k);title('imag(A1(k))','interpreter','none'); set(gca,'Ydir','normal'); xlim(n_x/2 + n_x/2*0.5*[-1,+1]); ylim(n_x/2 + n_x/2*0.5*[-1,+1]); axis square;
set(gca,'XTick',[],'YTick',[]);
%set(gca,'XTick',[1,n_x/2+1,n_x],'XTickLabel',[grid_k_c_(1),grid_k_c_(end/2+1),floor(10*grid_k_c_(end))/10]-max_k_c/2);set(gca,'YTick',[1,n_x/2+1,n_x],'YTickLabel',[grid_k_c_(1),grid_k_c_(end/2+1),floor(10*grid_k_c_(end))/10]-max_k_c/2);
subplot(2,3,3);imagesc(recenter2(log(abs(F_k_c_))),Llim_k);title('log(abs(A1(k)))','interpreter','none'); set(gca,'Ydir','normal'); xlim(n_x/2 + n_x/2*0.5*[-1,+1]); ylim(n_x/2 + n_x/2*0.5*[-1,+1]); axis square;
set(gca,'XTick',[],'YTick',[]);
%set(gca,'XTick',[1,n_x/2+1,n_x],'XTickLabel',[grid_k_c_(1),grid_k_c_(end/2+1),floor(10*grid_k_c_(end))/10]-max_k_c/2);set(gca,'YTick',[1,n_x/2+1,n_x],'YTickLabel',[grid_k_c_(1),grid_k_c_(end/2+1),floor(10*grid_k_c_(end))/10]-max_k_c/2);
subplot(2,3,4);imagesc(recenter2(real(G_k_c_)),Glim_k);title('real(A2(k))','interpreter','none'); set(gca,'Ydir','normal'); xlim(n_x/2 + n_x/2*0.5*[-1,+1]); ylim(n_x/2 + n_x/2*0.5*[-1,+1]); axis square;
set(gca,'XTick',[],'YTick',[]);
%set(gca,'XTick',[1,n_x/2+1,n_x],'XTickLabel',[grid_k_c_(1),grid_k_c_(end/2+1),floor(10*grid_k_c_(end))/10]-max_k_c/2);set(gca,'YTick',[1,n_x/2+1,n_x],'YTickLabel',[grid_k_c_(1),grid_k_c_(end/2+1),floor(10*grid_k_c_(end))/10]-max_k_c/2);
subplot(2,3,5);imagesc(recenter2(imag(G_k_c_)),Glim_k);title('imag(A2(k))','interpreter','none'); set(gca,'Ydir','normal'); xlim(n_x/2 + n_x/2*0.5*[-1,+1]); ylim(n_x/2 + n_x/2*0.5*[-1,+1]); axis square;
set(gca,'XTick',[],'YTick',[]);
%set(gca,'XTick',[1,n_x/2+1,n_x],'XTickLabel',[grid_k_c_(1),grid_k_c_(end/2+1),floor(10*grid_k_c_(end))/10]-max_k_c/2);set(gca,'YTick',[1,n_x/2+1,n_x],'YTickLabel',[grid_k_c_(1),grid_k_c_(end/2+1),floor(10*grid_k_c_(end))/10]-max_k_c/2);
subplot(2,3,6);imagesc(recenter2(log(abs(G_k_c_))),Llim_k);title('log(abs(A2(k)))','interpreter','none'); set(gca,'Ydir','normal'); xlim(n_x/2 + n_x/2*0.5*[-1,+1]); ylim(n_x/2 + n_x/2*0.5*[-1,+1]); axis square;
set(gca,'XTick',[],'YTick',[]);
%set(gca,'XTick',[1,n_x/2+1,n_x],'XTickLabel',[grid_k_c_(1),grid_k_c_(end/2+1),floor(10*grid_k_c_(end))/10]-max_k_c/2);set(gca,'YTick',[1,n_x/2+1,n_x],'YTickLabel',[grid_k_c_(1),grid_k_c_(end/2+1),floor(10*grid_k_c_(end))/10]-max_k_c/2);
set(gcf,'Position',1+[0,0,512*3,512*2]);
fname_fig = sprintf('%s/blob_FIGB_0',dir_fig);
if flag_plot; print('-djpeg',sprintf('%s.jpg',fname_fig)); end;
if flag_plot; print('-depsc',sprintf('%s.eps',fname_fig)); end;
%disp('return');return;
end;% if flag_disp;

X_delta_ = real(ifft2(conj(F_k_c_).*G_k_c_));
%Xlim_ = [0,1.5*max(X_delta_(:))];
%Xlim_ = [1.0*min(X_delta_(:)),1.0*max(X_delta_(:))];
%Xlim_ = [max(Xlim_) - 1.0*diff(Xlim_) , max(Xlim_)];
Xlim_ = mean(X_delta_(:)) + std(X_delta_(:))*2.5*[-1,+1];
%%%%%%%%;
flag_disp=0;
if flag_disp;
figure(n_figure); clf; n_figure = n_figure + 1;
colormap(colormap_beach());
subplot(1,2,1);
imagesc(recenter2(X_delta_),Xlim_); xlim([1,n_x]); ylim([1,n_x]); axis square; title('X(delta)');
set(gca,'XTick',[1,n_x/2+1,n_x],'XTickLabel',[grid_x_c_(1),grid_x_c_(end/2+1),floor(10*grid_x_c_(end))/10]-max_x_c/2);set(gca,'YTick',[1,n_x/2+1,n_x],'YTickLabel',[grid_x_c_(1),grid_x_c_(end/2+1),floor(10*grid_x_c_(end))/10]-max_x_c/2);
subplot(1,2,2);
[C,h] = contourf(recenter2(X_delta_),linspace(min(Xlim_),max(Xlim_),32)); set(h,'LineWidth',0.25); xlim([1,n_x]); ylim([1,n_x]); axis square; set(gca,'Ydir','reverse'); title('contours of X(delta)');
set(gca,'XTick',[1,n_x/2+1,n_x],'XTickLabel',[grid_x_c_(1),grid_x_c_(end/2+1),floor(10*grid_x_c_(end))/10]-max_x_c/2);set(gca,'YTick',[1,n_x/2+1,n_x],'YTickLabel',[grid_x_c_(1),grid_x_c_(end/2+1),floor(10*grid_x_c_(end))/10]-max_x_c/2); 
set(gcf,'Position',1+[0,0,512*2,512]);
fname_fig = sprintf('%s/blob_FIGC_0',dir_fig);
if flag_plot; print('-djpeg',sprintf('%s.jpg',fname_fig)); end;
if flag_plot; print('-depsc',sprintf('%s.eps',fname_fig)); end;
disp('return');return;
end;%if flag_disp;
%%%%%%%%;
flag_disp=1;
if flag_disp;
figure(n_figure); clf; n_figure = n_figure + 1;
colormap(colormap_beach());
subplot(1,3,1);imagesc(recenter2(real(F_x_c_)),Flim_x);title('A1','interpreter','none'); set(gca,'Ydir','normal'); xlim([1,n_x]); ylim([1,n_x]); axis square;
set(gca,'XTick',[1,n_x/2+1,n_x],'XTickLabel',[grid_x_c_(1),grid_x_c_(end/2+1),floor(10*grid_x_c_(end))/10]-max_x_c/2);set(gca,'YTick',[1,n_x/2+1,n_x],'YTickLabel',[grid_x_c_(1),grid_x_c_(end/2+1),floor(10*grid_x_c_(end))/10]-max_x_c/2);
subplot(1,3,2);imagesc(recenter2(real(G_x_c_)),Glim_x);title('A2','interpreter','none'); set(gca,'Ydir','normal'); xlim([1,n_x]); ylim([1,n_x]); axis square;
set(gca,'XTick',[1,n_x/2+1,n_x],'XTickLabel',[grid_x_c_(1),grid_x_c_(end/2+1),floor(10*grid_x_c_(end))/10]-max_x_c/2);set(gca,'YTick',[1,n_x/2+1,n_x],'YTickLabel',[grid_x_c_(1),grid_x_c_(end/2+1),floor(10*grid_x_c_(end))/10]-max_x_c/2);
subplot(1,3,3);
imagesc(recenter2(X_delta_),Xlim_); xlim([1,n_x]); ylim([1,n_x]); axis square; title('X(delta)');
set(gca,'XTick',[1,n_x/2+1,n_x],'XTickLabel',[grid_x_c_(1),grid_x_c_(end/2+1),floor(10*grid_x_c_(end))/10]-max_x_c/2);set(gca,'YTick',[1,n_x/2+1,n_x],'YTickLabel',[grid_x_c_(1),grid_x_c_(end/2+1),floor(10*grid_x_c_(end))/10]-max_x_c/2);
set(gcf,'Position',1+[0,0,512*3,512]);
fname_fig = sprintf('%s/blob_FIGC_0',dir_fig);
if flag_plot; print('-djpeg',sprintf('%s.jpg',fname_fig)); end;
if flag_plot; print('-depsc',sprintf('%s.eps',fname_fig)); end;
disp('return');return;
end;%if flag_disp;

tic;
grid_k_p_ = grid_k_r_;
n_k_r = length(grid_k_p_);
n_k_w_ = max(6,ceil(2*pi*grid_k_p_)); n_k_A = sum(n_k_w_); n_k_w_max = max(n_k_w_);
F_k_p_ = interp_c_to_p(n_x,max_k_c,n_x,max_k_c,F_k_c_,n_k_r,grid_k_p_,n_k_w_,n_k_A);
G_k_p_ = interp_c_to_p(n_x,max_k_c,n_x,max_k_c,G_k_c_,n_k_r,grid_k_p_,n_k_w_,n_k_A);
disp(sprintf(' %% calculating F_k_p_ G_k_p_: time %f',toc));
flag_disp=0;
if flag_disp;
subplot(2,2,1);imagesc_p(n_k_r,grid_k_p_,n_k_w_,n_k_A,real(F_k_p_),Flim_k,colormap(colormap_beach(64)));
subplot(2,2,2);imagesc_p(n_k_r,grid_k_p_,n_k_w_,n_k_A,real(G_k_p_),Glim_k,colormap(colormap_beach(64)));
subplot(2,2,3);imagesc_p(n_k_r,grid_k_p_,n_k_w_,n_k_A,imag(F_k_p_),Flim_k,colormap(colormap_beach(64)));
subplot(2,2,4);imagesc_p(n_k_r,grid_k_p_,n_k_w_,n_k_A,imag(G_k_p_),Glim_k,colormap(colormap_beach(64)));
return;
end;%if flag_disp;

tic;
F_k_q_ = interp_p_to_q(n_k_r,n_k_w_,n_k_A,F_k_p_);
G_k_q_ = interp_p_to_q(n_k_r,n_k_w_,n_k_A,G_k_p_);
C_q_ = innerproduct_q_k_only(n_k_r,grid_k_p_,n_k_w_,n_k_A,F_k_q_,G_k_q_)*n_k_r*2*pi;
disp(sprintf(' %% calculating C_q_: time %f',toc));
C_p_ = real(ifft(C_q_));
gamma_ = linspace(-pi,+pi,n_k_w_(end)+1); gamma_ = gamma_(1:end-1);
flag_disp=1;
if flag_disp;
figure(n_figure); clf; n_figure = n_figure + 1;
plot(gamma_,recenter1(C_p_)); xlabel('gamma'); ylabel('X(gamma)');
xlim([-pi,+pi]);
set(gca,'YTick',[]);
set(gcf,'Position',1+[0,0,512*1,512]);
fname_fig = sprintf('%s/blob_FIGD_0',dir_fig);
if flag_plot; print('-djpeg',sprintf('%s.jpg',fname_fig)); end;
if flag_plot; print('-depsc',sprintf('%s.eps',fname_fig)); end;
disp('return');return;
end;%if flag_disp;

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% ;
% Calculating C_F__(gamma_z,delta_x,delta_y) = < R_{gamma_z}(T_{delta_x,delta_y}(F)) , G >
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% ;
tic;
N_pixels = 32.0; N_pixels_in = N_pixels; K_max = max_k_p; eps_target = 0.0001; l_max = 36;
[n_svd_r,svd_r_,n_svd_d,svd_d_,n_svd_l,svd_l_,svd_U_d_,svd_s_,svd_V_r_] = gen_Jsvd_2(K_max,N_pixels,eps_target,l_max);
half_diameter_x_c = max_x_c/2; 
n_delta_x = 65; n_delta_y = 65;
[delta_x_,delta_y_] = get_delta_0(N_pixels_in,n_x_r,half_diameter_x_c,n_delta_x,n_delta_y);
Z_F_svdd_ = innerproduct_q_k_svdd_1(1,n_svd_d,svd_d_,n_svd_l,svd_l_,svd_U_d_,n_delta_x,delta_x_,n_delta_y,delta_y_,l_max);
G_k_q_ = interp_p_to_q(n_k_r,n_k_w_,n_k_A,G_k_p_);
disp(sprintf(' %% precomputation for C_q__: time %f',toc));
tic;
Z_F_svds_ = innerproduct_q_k_svds_1(1,n_svd_r,svd_r_,n_svd_l,svd_l_,svd_s_,svd_V_r_,n_k_r,grid_k_p_,n_k_w_,n_k_A,F_k_q_,G_k_q_);
disp(sprintf(' %% evaluating integrals associated with Z_F_svds_: time %f',toc));
tic;
for nl=0:n_svd_l-1;
Z_F_svds_(1+nl,:) = ifft(Z_F_svds_(1+nl,:))*n_k_r*2*pi;
end;%for nl=0:n_svd_l-1;
disp(sprintf(' %% performing fft associated with Z_F_svds_: time %f',toc));
n_gamma_z = max(n_k_w_);
gamma_z_ = get_gamma_0(n_gamma_z);
C_q__ = transpose(Z_F_svdd_)*Z_F_svds_;
disp(sprintf(' %% performing matrix-matrix product to produce C_q__: time %f',toc));
tic;
C_F__ = zeros(n_gamma_z,n_delta_x,n_delta_y);
for ndx=0:n_delta_x-1; delta_x = delta_x_(1+ndx);
for ndy=0:n_delta_y-1; delta_y = delta_y_(1+ndy);
T_q_ = C_q__(1 + ndx + ndy*n_delta_x,:);
for ngz=0:n_gamma_z-1; gamma_z = gamma_z_(1+ngz);
C_F__(1+ngz,1+ndx,1+ndy) = interp1_0(n_k_w_max,0,2*pi,T_q_,gamma_z);
end;%for ngz=0:n_gamma_z-1; gamma_z = gamma_z_(1+ngz);
end;%for ndy=0:n_delta_y-1; delta_y = delta_y_(1+ndy);
end;%for ndx=0:n_delta_x-1; delta_x = delta_x_(1+ndx);
disp(sprintf(' %% interpolating C_q__ to calculate C_F__: time %f',toc));

flag_disp=1;
if flag_disp;
figure(n_figure); clf; n_figure = n_figure + 1;
gamma_ = linspace(0,+2*pi,n_k_w_(end)+1); gamma_ = gamma_(1:end-1);
n_gamma = length(gamma_);
prows = 7; pcols = 11; xgap = 1+floor(n_delta_x/8); ygap = 1+floor(n_delta_y/8);
gamma_sample_ = linspace(-pi,+pi,prows*pcols);
Clim_ = [min(real(C_F__(:))),1.25*max(real(C_F__(:)))]; Clim_(1) = Clim_(1) - diff(Clim_)/64;
%Clim_ = [0,max(max(real(C_F__(1,:,:))))]; Clim_(1) = Clim_(1) - diff(Clim_)/64;
C_F_ = zeros(xgap + prows*(n_delta_x+xgap),ygap + pcols*(n_delta_y+ygap)) + Clim_(1);
n_gamma_sample_ = zeros(prows*pcols,1);
for ngamma_sample=1:length(gamma_sample_);
tmp_ = periodize_(gamma_ - gamma_sample_(ngamma_sample),-pi,+pi);
[~,n_gamma_sample_(ngamma_sample)] = min(abs(tmp_));
end;%for ngamma_sample=1:length(gamma_sample_);
prow = 0; pcol = 0;
for ngamma_sample=1:length(gamma_sample_);
n_gamma_sample = n_gamma_sample_(ngamma_sample);
C_F_(xgap + prow*(n_delta_x+xgap) + (1:n_delta_x),ygap + pcol*(n_delta_y+ygap) + (1:n_delta_y)) = real(squeeze(C_F__(n_gamma_sample,:,:)));
pcol = pcol + 1;
if pcol==pcols; pcol=0; prow = prow+1; end;
end;%for ngamma_sample=1:length(gamma_sample_);
%c_ = colormap('jet'); 
c_ = colormap_beach(64); 
c_(1,:) = [1,1,1];
imagesc(C_F_,Clim_); set(gca,'XTick',[],'YTick',[]);
colormap(c_);
set(gcf,'Position',1 + 2*[0,0,size(C_F_,2),size(C_F_,1)]);
fname_fig = sprintf('%s/blob_FIGE_3',dir_fig);
if flag_plot; print('-djpeg',sprintf('%s.jpg',fname_fig)); end;
if flag_plot; print('-depsc',sprintf('%s.eps',fname_fig)); end;
disp('return');return;
end;%if flag_disp;

flag_disp=1;
if flag_disp;
figure(n_figure); clf; n_figure = n_figure + 1;
gamma_ = linspace(0,+2*pi,n_k_w_(end)+1); gamma_ = gamma_(1:end-1);
n_gamma = length(gamma_);
prows = 7; pcols = 11; xgap = 1+floor(n_delta_x/8); ygap = 1+floor(n_delta_y/8);
gamma_sample_ = linspace(0,pi/12,prows*pcols);
Clim_ = [min(real(C_F__(:))),1.0*max(real(C_F__(:)))]; 
C_F_alpha_ = zeros(xgap + prows*(n_delta_x+xgap),ygap + pcols*(n_delta_y+ygap)) + Clim_(1) - diff(Clim_)/32;
n_gamma_sample_ = zeros(prows*pcols,1);
for ngamma_sample=1:length(gamma_sample_);
tmp_ = periodize_(gamma_ - gamma_sample_(ngamma_sample),-pi,+pi);
[~,n_gamma_sample_(ngamma_sample)] = min(abs(tmp_));
end;%for ngamma_sample=1:length(gamma_sample_);
prow = 0; pcol = 0; alpha = 4.0;
for ngamma_sample=1:length(gamma_sample_);
n_gamma_sample = n_gamma_sample_(ngamma_sample);
tmp_alpha_ = real(squeeze(C_F__(n_gamma_sample,:,:)));
tmp_alpha_ = min(Clim_) + (diff(Clim_)) * (max(0,(tmp_alpha_-min(Clim_))/(diff(Clim_)))).^alpha ;
C_F_alpha_(xgap + prow*(n_delta_x+xgap) + (1:n_delta_x),ygap + pcol*(n_delta_y+ygap) + (1:n_delta_y)) = tmp_alpha_;
pcol = pcol + 1;
if pcol==pcols; pcol=0; prow = prow+1; end;
end;%for ngamma_sample=1:length(gamma_sample_);
%c_ = colormap('jet'); 
c_ = colormap_beach(64); 
c_(1,:) = [1,1,1];
imagesc(C_F_alpha_,[Clim_(1)-diff(Clim_)/32,Clim_(2)]); set(gca,'XTick',[],'YTick',[]);
colormap(c_);
set(gcf,'Position',1 + 2*[0,0,size(C_F_,2),size(C_F_,1)]);
fname_fig = sprintf('%s/blob_FIGF_0',dir_fig);
if flag_plot; print('-djpeg',sprintf('%s.jpg',fname_fig)); end;
if flag_plot; print('-depsc',sprintf('%s.eps',fname_fig)); end;
end;%if flag_disp;

end;%if ~flag_skip;
flag_skip=1;
if ~flag_skip;
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%;
% Generate arcs. ;
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%;

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% ;
% generate image/template F ;
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% ;
tic;
n_x = 256; max_x_c = 1; max_k_c = n_x/max_x_c; max_k_p = max_k_c/2;
% realspace carte grid ; 
grid_x_c_ = linspace(0,max_x_c,n_x+1); grid_x_c_ = grid_x_c_(1:end-1); d_x_c = mean(diff(grid_x_c_));
% freqspace carte grid ; 
grid_k_c_ = (0:n_x-1)/max_x_c; d_k_c = mean(diff(grid_k_c_));
% xxxxspace qring grid ;
grid_k_q_ = (0:n_x-1) ; max_q = n_x; qlim = [-2,+2]; grid_k_q2_ = grid_k_q_; grid_k_q2_(n_x/2:end) = grid_k_q2_(n_x/2:end)-n_x;
% realspace carte meshgrid ;
[X_x_c_,Y_x_c_] = meshgrid(grid_x_c_,grid_x_c_); X_x_c_(:,n_x/2+1:end) = X_x_c_(:,n_x/2+1:end)-max_x_c; Y_x_c_(n_x/2+1:end,:) = Y_x_c_(n_x/2+1:end,:)-max_x_c;
R_x_c_ = sqrt(X_x_c_.^2 + Y_x_c_.^2); W_x_c_ = atan2(Y_x_c_,X_x_c_);
% freqspace carte meshgrid ;
[X_k_c_,Y_k_c_] = meshgrid(grid_k_c_,grid_k_c_); X_k_c_(:,n_x/2+1:end) = X_k_c_(:,n_x/2+1:end)-max_k_c; Y_k_c_(n_x/2+1:end,:) = Y_k_c_(n_x/2+1:end,:)-max_k_c;
R_k_c_ = sqrt(X_k_c_.^2 + Y_k_c_.^2); W_k_c_ = atan2(Y_k_c_,X_k_c_);
% realspace polar meshgrid ;
grid_x_r_ = linspace(0,max_x_c/2,n_x+1); grid_x_r_ = grid_x_r_(1:end-1); grid_x_w_ = linspace(0,2*pi,n_x+1); grid_x_w_ = grid_x_w_(1:end-1); 
[R_x_p_,W_x_p_] = meshgrid(grid_x_r_,grid_x_w_);
% freqspace polar meshgrid ;
grid_k_r_ = linspace(0,max_k_p,n_x+1); grid_k_r_ = grid_k_r_(1:end-1); d_k_r = mean(diff(grid_k_r_));
grid_k_w_ = linspace(0,2*pi,n_x+1); grid_k_w_ = grid_k_w_(1:end-1); d_k_w = mean(diff(grid_k_w_));
[R_k_p_,W_k_p_] = meshgrid(grid_k_r_,grid_k_w_);
X_k_p_ = R_k_p_.*cos(W_k_p_); Y_k_p_ = R_k_p_.*sin(W_k_p_);
% set up image/template on realspace carte meshgrid ;
n_F = 16; tmp_R_ = linspace(0.125,0.25,n_F); tmp_W_min = pi/4; tmp_W_max = 3*pi/4; tmp_dW = -1*pi/4;
F_x_c_ = zeros(n_x,n_x);
G_x_c_ = zeros(n_x,n_x);
for nF=1:4:n_F;
F_x_c_ = F_x_c_ + ( (R_x_c_>tmp_R_(nF+0)) & (R_x_c_<tmp_R_(nF+1)) & (W_x_c_>tmp_W_min) & (W_x_c_<tmp_W_max) );
G_x_c_ = G_x_c_ + ( (R_x_c_>tmp_R_(nF+0)) & (R_x_c_<tmp_R_(nF+1)) & (W_x_c_>tmp_W_min + tmp_dW) & (W_x_c_<tmp_W_max + tmp_dW) );
end;%for nF=1:n_F;
% Now translate F and G by the center of F ;
%tmp_delta_ = [0,0];
tmp_delta_ = [0,-2*pi*mean(tmp_R_)];
F_x_c_ = real(ifft2(fft2(F_x_c_).*exp(-i*(X_k_c_*tmp_delta_(1) + Y_k_c_*tmp_delta_(2)))));
G_x_c_ = real(ifft2(fft2(G_x_c_).*exp(-i*(X_k_c_*tmp_delta_(1) + Y_k_c_*tmp_delta_(2)))));
% Now center intensity (remove mean) ;
F_x_c_ = F_x_c_ - mean(F_x_c_(:));
G_x_c_ = G_x_c_ - mean(G_x_c_(:));
Flim_x = max(0,mean(F_x_c_(:)) + 1.0*std(F_x_c_(:))*[-1,+1]);
Glim_x = max(0,mean(G_x_c_(:)) + 1.0*std(G_x_c_(:))*[-1,+1]);
disp(sprintf(' %% calculating F_x_c_ G_x_c_: time %f',toc));

flag_disp=1;
if flag_disp;
figure(n_figure); clf; n_figure = n_figure + 1;
colormap(1-colormap('gray'));
subplot(1,3,1);imagesc(recenter2(real(F_x_c_)),Flim_x);title('real(F_x_c_)','interpreter','none'); set(gca,'Ydir','normal'); xlim([1,n_x]); ylim([1,n_x]); axis square;
set(gca,'XTick',[1,n_x/2+1,n_x],'XTickLabel',[grid_x_c_(1),grid_x_c_(end/2+1),floor(10*grid_x_c_(end))/10]-max_x_c/2);set(gca,'YTick',[1,n_x/2+1,n_x],'YTickLabel',[grid_x_c_(1),grid_x_c_(end/2+1),floor(10*grid_x_c_(end))/10]-max_x_c/2);
subplot(1,3,2);imagesc(recenter2(real(G_x_c_)),Glim_x);title('real(G_x_c_)','interpreter','none'); set(gca,'Ydir','normal'); xlim([1,n_x]); ylim([1,n_x]); axis square;
set(gca,'XTick',[1,n_x/2+1,n_x],'XTickLabel',[grid_x_c_(1),grid_x_c_(end/2+1),floor(10*grid_x_c_(end))/10]-max_x_c/2);set(gca,'YTick',[1,n_x/2+1,n_x],'YTickLabel',[grid_x_c_(1),grid_x_c_(end/2+1),floor(10*grid_x_c_(end))/10]-max_x_c/2);
subplot(1,3,3);imagesc(recenter2(real(G_x_c_ + F_x_c_)),Glim_x+Flim_x);title('real(G_x_c_+F_x_c_)','interpreter','none'); set(gca,'Ydir','normal'); xlim([1,n_x]); ylim([1,n_x]); axis square;
set(gca,'XTick',[1,n_x/2+1,n_x],'XTickLabel',[grid_x_c_(1),grid_x_c_(end/2+1),floor(10*grid_x_c_(end))/10]-max_x_c/2);set(gca,'YTick',[1,n_x/2+1,n_x],'YTickLabel',[grid_x_c_(1),grid_x_c_(end/2+1),floor(10*grid_x_c_(end))/10]-max_x_c/2);
set(gcf,'Position',1+[0,0,512*3,512]);
fname_fig = sprintf('%s/arc_FIGA_0',dir_fig);
if flag_plot; print('-djpeg',sprintf('%s.jpg',fname_fig)); end;
if flag_plot; print('-depsc',sprintf('%s.eps',fname_fig)); end;
end;% if flag_disp;

tic;
grid_x_p_ = grid_x_r_;
n_x_r = length(grid_x_p_);
n_x_w_ = max(6,ceil(2*pi*grid_x_p_*n_x_r)); n_x_A = sum(n_x_w_); n_x_w_max = max(n_x_w_);
F_x_p_ = interp_c_to_p(n_x,max_x_c,n_x,max_x_c,F_x_c_,n_x_r,grid_x_p_,n_x_w_,n_x_A);
G_x_p_ = interp_c_to_p(n_x,max_x_c,n_x,max_x_c,G_x_c_,n_x_r,grid_x_p_,n_x_w_,n_x_A);
disp(sprintf(' %% calculating F_x_p_ G_x_p_: time %s',toc));
flag_disp=0;
if flag_disp;
subplot(2,2,1);imagesc_p(n_x_r,grid_x_p_,n_x_w_,n_x_A,real(F_x_p_),Flim_x,colormap(colormap_beach(64)));
subplot(2,2,2);imagesc_p(n_x_r,grid_x_p_,n_x_w_,n_x_A,real(G_x_p_),Glim_x,colormap(colormap_beach(64)));
subplot(2,2,3);imagesc_p(n_x_r,grid_x_p_,n_x_w_,n_x_A,imag(F_x_p_),Flim_x,colormap(colormap_beach(64)));
subplot(2,2,4);imagesc_p(n_x_r,grid_x_p_,n_x_w_,n_x_A,imag(G_x_p_),Glim_x,colormap(colormap_beach(64)));
return;
end;%if flag_disp;

tic;
l2_F_x_c = sum(abs(F_x_c_(:)).^2)*d_x_c*d_x_c;
% calculate image/template values on freqspace carte meshgrid ;
F_k_c_ = fft2(F_x_c_) * d_x_c*d_x_c; Flim_k  = mean(abs(F_k_c_(:))) + 1.0*std(abs(F_k_c_(:)))*[-1,+1];
l2_F_k_c = sum(abs(F_k_c_(:)).^2)*d_k_c*d_k_c;
F_tmp = ifft2(F_k_c_)./d_x_c./d_x_c; l2_F_tmp = sum(abs(F_tmp(:)).^2)*d_x_c*d_x_c;
disp(sprintf(' %% l2_F_x_c %f l2_F_k_c %f',l2_F_x_c,l2_F_k_c));
Flim_x = max(0,mean(abs(F_x_c_(:))) + 1.0*std(abs(F_x_c_(:)))*[-1,+1]);
l2_G_x_c = sum(abs(G_x_c_(:)).^2)*d_x_c*d_x_c;
% calculate image/template values on freqspace carte meshgrid ;
G_k_c_ = fft2(G_x_c_) * d_x_c*d_x_c; Glim_k  = mean(abs(G_k_c_(:))) + 1.0*std(abs(G_k_c_(:)))*[-1,+1];
l2_G_k_c = sum(abs(G_k_c_(:)).^2)*d_k_c*d_k_c;
G_tmp = ifft2(G_k_c_)./d_x_c./d_x_c; l2_G_tmp = sum(abs(G_tmp(:)).^2)*d_x_c*d_x_c;
disp(sprintf(' %% l2_G_x_c %f l2_G_k_c %f',l2_G_x_c,l2_G_k_c));
Glim_x = max(0,mean(abs(G_x_c_(:))) + 1.0*std(abs(G_x_c_(:)))*[-1,+1]);
disp(sprintf(' %% calculating F_k_c_ G_k_c_: time %f',toc));

X_delta_ = real(ifft2(conj(F_k_c_).*G_k_c_));
Xlim_ = [0,1.5*max(X_delta_(:))];
flag_disp=1;
if flag_disp;
figure(n_figure); clf; n_figure = n_figure + 1;
colormap(colormap_beach());
imagesc(recenter2(X_delta_),Xlim_); xlim([1,n_x]); ylim([1,n_x]); axis square; 
set(gca,'XTick',[1,n_x/2+1,n_x],'XTickLabel',[grid_x_c_(1),grid_x_c_(end/2+1),floor(10*grid_x_c_(end))/10]-max_x_c/2);set(gca,'YTick',[1,n_x/2+1,n_x],'YTickLabel',[grid_x_c_(1),grid_x_c_(end/2+1),floor(10*grid_x_c_(end))/10]-max_x_c/2);
set(gcf,'Position',1+[0,0,512*1,512]);
fname_fig = sprintf('%s/arc_FIGC_0',dir_fig);
if flag_plot; print('-djpeg',sprintf('%s.jpg',fname_fig)); end;
if flag_plot; print('-depsc',sprintf('%s.eps',fname_fig)); end;
end;%if flag_disp;

tic;
grid_k_p_ = grid_k_r_;
n_k_r = length(grid_k_p_);
n_k_w_ = max(6,ceil(2*pi*grid_k_p_)); n_k_A = sum(n_k_w_); n_k_w_max = max(n_k_w_);
F_k_p_ = interp_c_to_p(n_x,max_k_c,n_x,max_k_c,F_k_c_,n_k_r,grid_k_p_,n_k_w_,n_k_A);
G_k_p_ = interp_c_to_p(n_x,max_k_c,n_x,max_k_c,G_k_c_,n_k_r,grid_k_p_,n_k_w_,n_k_A);
disp(sprintf(' %% calculating F_k_p_ G_k_p_: time %f',toc));
flag_disp=0;
if flag_disp;
subplot(2,2,1);imagesc_p(n_k_r,grid_k_p_,n_k_w_,n_k_A,real(F_k_p_),Flim_k,colormap(colormap_beach(64)));
subplot(2,2,2);imagesc_p(n_k_r,grid_k_p_,n_k_w_,n_k_A,real(G_k_p_),Glim_k,colormap(colormap_beach(64)));
subplot(2,2,3);imagesc_p(n_k_r,grid_k_p_,n_k_w_,n_k_A,imag(F_k_p_),Flim_k,colormap(colormap_beach(64)));
subplot(2,2,4);imagesc_p(n_k_r,grid_k_p_,n_k_w_,n_k_A,imag(G_k_p_),Glim_k,colormap(colormap_beach(64)));
return;
end;%if flag_disp;

tic;
F_k_q_ = interp_p_to_q(n_k_r,n_k_w_,n_k_A,F_k_p_);
G_k_q_ = interp_p_to_q(n_k_r,n_k_w_,n_k_A,G_k_p_);
C_q_ = innerproduct_q_k_only(n_k_r,grid_k_p_,n_k_w_,n_k_A,F_k_q_,G_k_q_)*n_k_r*2*pi;
disp(sprintf(' %% calculating C_q_: time %f',toc));
C_p_ = real(ifft(C_q_));
gamma_ = linspace(-pi,+pi,n_k_w_(end)+1); gamma_ = gamma_(1:end-1);
flag_disp=1;
if flag_disp;
figure(n_figure); clf; n_figure = n_figure + 1;
plot(gamma_,recenter1(C_p_)); xlabel('gamma'); ylabel('X(gamma)');
xlim([-pi,+pi]);
set(gca,'YTick',[]);
set(gcf,'Position',1+[0,0,512*1,512]);
fname_fig = sprintf('%s/arc_FIGC_0',dir_fig);
if flag_plot; print('-djpeg',sprintf('%s.jpg',fname_fig)); end;
if flag_plot; print('-depsc',sprintf('%s.eps',fname_fig)); end;
end;%if flag_disp;

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% ;
% Calculating C_F__(gamma_z,delta_x,delta_y) = < R_{gamma_z}(T_{delta_x,delta_y}(F)) , G >
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% ;
tic;
N_pixels = 15.0; N_pixels_in = N_pixels; K_max = max_k_p; eps_target = 0.00001; l_max = 35;
[n_svd_r,svd_r_,n_svd_d,svd_d_,n_svd_l,svd_l_,svd_U_d_,svd_s_,svd_V_r_] = gen_Jsvd_2(K_max,N_pixels,eps_target,l_max);
half_diameter_x_c = max_x_c/2; 
n_delta_x = 65; n_delta_y = 65;
[delta_x_,delta_y_] = get_delta_0(N_pixels_in,n_x_r,half_diameter_x_c,n_delta_x,n_delta_y);
Z_F_svdd_ = innerproduct_q_k_svdd_1(1,n_svd_d,svd_d_,n_svd_l,svd_l_,svd_U_d_,n_delta_x,delta_x_,n_delta_y,delta_y_,l_max);
G_k_q_ = interp_p_to_q(n_k_r,n_k_w_,n_k_A,G_k_p_);
disp(sprintf(' %% precomputation for C_q__: time %f',toc));
tic;
Z_F_svds_ = innerproduct_q_k_svds_1(1,n_svd_r,svd_r_,n_svd_l,svd_l_,svd_s_,svd_V_r_,n_k_r,grid_k_p_,n_k_w_,n_k_A,F_k_q_,G_k_q_);
disp(sprintf(' %% evaluating integrals associated with Z_F_svds_: time %f',toc));
tic;
for nl=0:n_svd_l-1;
Z_F_svds_(1+nl,:) = ifft(Z_F_svds_(1+nl,:))*n_k_r*2*pi;
end;%for nl=0:n_svd_l-1;
disp(sprintf(' %% performing fft associated with Z_F_svds_: time %f',toc));
n_gamma_z = max(n_k_w_);
gamma_z_ = get_gamma_0(n_gamma_z);
C_q__ = transpose(Z_F_svdd_)*Z_F_svds_;
disp(sprintf(' %% performing matrix-matrix product to produce C_q__: time %f',toc));
tic;
C_F__ = zeros(n_gamma_z,n_delta_x,n_delta_y);
for ndx=0:n_delta_x-1; delta_x = delta_x_(1+ndx);
for ndy=0:n_delta_y-1; delta_y = delta_y_(1+ndy);
T_q_ = C_q__(1 + ndx + ndy*n_delta_x,:);
for ngz=0:n_gamma_z-1; gamma_z = gamma_z_(1+ngz);
C_F__(1+ngz,1+ndx,1+ndy) = interp1_0(n_k_w_max,0,2*pi,T_q_,gamma_z);
end;%for ngz=0:n_gamma_z-1; gamma_z = gamma_z_(1+ngz);
end;%for ndy=0:n_delta_y-1; delta_y = delta_y_(1+ndy);
end;%for ndx=0:n_delta_x-1; delta_x = delta_x_(1+ndx);
disp(sprintf(' %% interpolating C_q__ to calculate C_F__: time %f',toc));

flag_disp=1;
if flag_disp;
figure(n_figure); clf; n_figure = n_figure + 1;
gamma_ = linspace(0,+2*pi,n_k_w_(end)+1); gamma_ = gamma_(1:end-1);
n_gamma = length(gamma_);
prows = 7; pcols = 11; xgap = 1+floor(n_delta_x/8); ygap = 1+floor(n_delta_y/8);
gamma_sample_ = linspace(-pi,+pi,prows*pcols);
Clim_ = [min(real(C_F__(:))),1.35*max(real(C_F__(:)))]; Clim_(1) = Clim_(1) - diff(Clim_)/64;
%Clim_ = [0,max(max(real(C_F__(1,:,:))))]; Clim_(1) = Clim_(1) - diff(Clim_)/64;
C_F_ = zeros(xgap + prows*(n_delta_x+xgap),ygap + pcols*(n_delta_y+ygap)) + Clim_(1);
n_gamma_sample_ = zeros(prows*pcols,1);
for ngamma_sample=1:length(gamma_sample_);
tmp_ = periodize_(gamma_ - gamma_sample_(ngamma_sample),-pi,+pi);
[~,n_gamma_sample_(ngamma_sample)] = min(abs(tmp_));
end;%for ngamma_sample=1:length(gamma_sample_);
prow = 0; pcol = 0;
for ngamma_sample=1:length(gamma_sample_);
n_gamma_sample = n_gamma_sample_(ngamma_sample);
C_F_(xgap + prow*(n_delta_x+xgap) + (1:n_delta_x),ygap + pcol*(n_delta_y+ygap) + (1:n_delta_y)) = real(squeeze(C_F__(n_gamma_sample,:,:)));
pcol = pcol + 1;
if pcol==pcols; pcol=0; prow = prow+1; end;
end;%for ngamma_sample=1:length(gamma_sample_);
%c_ = colormap('jet'); 
c_ = colormap_beach(64); 
c_(1,:) = [1,1,1];
imagesc(C_F_,Clim_); set(gca,'XTick',[],'YTick',[]);
colormap(c_);
set(gcf,'Position',1 + 2*[0,0,size(C_F_,2),size(C_F_,1)]);
fname_fig = sprintf('%s/arc_FIGD_3',dir_fig);
if flag_plot; print('-djpeg',sprintf('%s.jpg',fname_fig)); end; 
if flag_plot; print('-depsc',sprintf('%s.eps',fname_fig)); end;
end;%if flag_disp;

flag_disp=1;
if flag_disp;
figure(n_figure); clf; n_figure = n_figure + 1;
gamma_ = linspace(0,+2*pi,n_k_w_(end)+1); gamma_ = gamma_(1:end-1);
n_gamma = length(gamma_);
prows = 7; pcols = 11; xgap = 1+floor(n_delta_x/8); ygap = 1+floor(n_delta_y/8);
gamma_sample_ = linspace(0,pi/12,prows*pcols);
Clim_ = [min(real(C_F__(:))),1.0*max(real(C_F__(:)))]; 
C_F_alpha_ = zeros(xgap + prows*(n_delta_x+xgap),ygap + pcols*(n_delta_y+ygap)) + Clim_(1) - diff(Clim_)/32;
n_gamma_sample_ = zeros(prows*pcols,1);
for ngamma_sample=1:length(gamma_sample_);
tmp_ = periodize_(gamma_ - gamma_sample_(ngamma_sample),-pi,+pi);
[~,n_gamma_sample_(ngamma_sample)] = min(abs(tmp_));
end;%for ngamma_sample=1:length(gamma_sample_);
prow = 0; pcol = 0; alpha = 4.0;
for ngamma_sample=1:length(gamma_sample_);
n_gamma_sample = n_gamma_sample_(ngamma_sample);
tmp_alpha_ = real(squeeze(C_F__(n_gamma_sample,:,:)));
tmp_alpha_ = min(Clim_) + (diff(Clim_)) * (max(0,(tmp_alpha_-min(Clim_))/(diff(Clim_)))).^alpha ;
C_F_alpha_(xgap + prow*(n_delta_x+xgap) + (1:n_delta_x),ygap + pcol*(n_delta_y+ygap) + (1:n_delta_y)) = tmp_alpha_;
pcol = pcol + 1;
if pcol==pcols; pcol=0; prow = prow+1; end;
end;%for ngamma_sample=1:length(gamma_sample_);
%c_ = colormap('jet'); 
c_ = colormap_beach(64); 
c_(1,:) = [1,1,1];
imagesc(C_F_alpha_,[Clim_(1)-diff(Clim_)/32,Clim_(2)]); set(gca,'XTick',[],'YTick',[]);
colormap(c_);
set(gcf,'Position',1 + 2*[0,0,size(C_F_,2),size(C_F_,1)]);
fname_fig = sprintf('%s/arc_FIGE_0',dir_fig);
if flag_plot; print('-djpeg',sprintf('%s.jpg',fname_fig)); end;
if flag_plot; print('-depsc',sprintf('%s.eps',fname_fig)); end;
end;%if flag_disp;

end;%if ~flag_skip;
flag_skip=1;
if ~flag_skip;
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%;
% Generate ring images. ;
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%;

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% ;
% generate image/template F ;
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% ;
tic;
n_x = 256; max_x_c = 1; max_k_c = n_x/max_x_c; max_k_p = max_k_c/2;
% realspace carte grid ; 
grid_x_c_ = linspace(0,max_x_c,n_x+1); grid_x_c_ = grid_x_c_(1:end-1); d_x_c = mean(diff(grid_x_c_));
% freqspace carte grid ; 
grid_k_c_ = (0:n_x-1)/max_x_c; d_k_c = mean(diff(grid_k_c_));
% xxxxspace qring grid ;
grid_k_q_ = (0:n_x-1) ; max_q = n_x; qlim = [-2,+2]; grid_k_q2_ = grid_k_q_; grid_k_q2_(n_x/2:end) = grid_k_q2_(n_x/2:end)-n_x;
% realspace carte meshgrid ;
[X_x_c_,Y_x_c_] = meshgrid(grid_x_c_,grid_x_c_); X_x_c_(:,n_x/2+1:end) = X_x_c_(:,n_x/2+1:end)-max_x_c; Y_x_c_(n_x/2+1:end,:) = Y_x_c_(n_x/2+1:end,:)-max_x_c;
R_x_c_ = sqrt(X_x_c_.^2 + Y_x_c_.^2); W_x_c_ = atan2(Y_x_c_,X_x_c_);
% freqspace carte meshgrid ;
[X_k_c_,Y_k_c_] = meshgrid(grid_k_c_,grid_k_c_); X_k_c_(:,n_x/2+1:end) = X_k_c_(:,n_x/2+1:end)-max_k_c; Y_k_c_(n_x/2+1:end,:) = Y_k_c_(n_x/2+1:end,:)-max_k_c;
R_k_c_ = sqrt(X_k_c_.^2 + Y_k_c_.^2); W_k_c_ = atan2(Y_k_c_,X_k_c_);
% realspace polar meshgrid ;
grid_x_r_ = linspace(0,max_x_c/2,n_x+1); grid_x_r_ = grid_x_r_(1:end-1); grid_x_w_ = linspace(0,2*pi,n_x+1); grid_x_w_ = grid_x_w_(1:end-1); 
[R_x_p_,W_x_p_] = meshgrid(grid_x_r_,grid_x_w_);
% freqspace polar meshgrid ;
grid_k_r_ = linspace(0,max_k_p,n_x+1); grid_k_r_ = grid_k_r_(1:end-1); d_k_r = mean(diff(grid_k_r_));
grid_k_w_ = linspace(0,2*pi,n_x+1); grid_k_w_ = grid_k_w_(1:end-1); d_k_w = mean(diff(grid_k_w_));
[R_k_p_,W_k_p_] = meshgrid(grid_k_r_,grid_k_w_);
X_k_p_ = R_k_p_.*cos(W_k_p_); Y_k_p_ = R_k_p_.*sin(W_k_p_);
% set up image/template on realspace carte meshgrid ;
F_x_c_ = zeros(n_x,n_x);
G_x_c_ = zeros(n_x,n_x);
n_F = 1;
for nF=1:n_F;
tmp_t = 1.5 + (nF-1)/(n_F-1);
F_x_c_ = F_x_c_ + (R_x_c_>0.45/2 & R_x_c_<0.55/2).*exp(i*3*W_x_c_);%.*exp(i*(2+randn())*(W_x_c_+2*pi*rand()));
G_x_c_ = G_x_c_ + (R_x_c_>0.45/2 & R_x_c_<0.55/2).*exp(i*7*W_x_c_);%.*exp(i*(2+randn())*(W_x_c_+2*pi*rand()));
end;%for nF=1:n_F;
% Now center intensity (remove mean) ;
F_x_c_ = F_x_c_ - mean(F_x_c_(:));
G_x_c_ = G_x_c_ - mean(G_x_c_(:));
%%%%%%%%;
%F_x_c_ = real(F_x_c_);
%G_x_c_ = real(G_x_c_);
%%%%%%%%;
Flim_x = max(0,mean(real(F_x_c_(:))) + 1.0*std(real(F_x_c_(:)))*[-1,+1]);
Glim_x = max(0,mean(real(G_x_c_(:))) + 1.0*std(real(G_x_c_(:)))*[-1,+1]);
disp(sprintf(' %% calculating F_x_c_ G_x_c_: time %f',toc));

flag_disp=1;
if flag_disp;
figure(n_figure); clf; n_figure = n_figure + 1;
colormap(1-colormap('gray'));
subplot(1,2,1);imagesc(recenter2(real(F_x_c_)),Flim_x);%title('A1','interpreter','none'); 
set(gca,'Ydir','normal'); xlim([1,n_x]); ylim([1,n_x]); axis square;
set(gca,'XTick',[],'YTick',[]);
%set(gca,'XTick',[1,n_x/2+1,n_x],'XTickLabel',[grid_x_c_(1),grid_x_c_(end/2+1),floor(10*grid_x_c_(end))/10]-max_x_c/2);set(gca,'YTick',[1,n_x/2+1,n_x],'YTickLabel',[grid_x_c_(1),grid_x_c_(end/2+1),floor(10*grid_x_c_(end))/10]-max_x_c/2);
subplot(1,2,2);imagesc(recenter2(real(G_x_c_)),Glim_x);%title('A2','interpreter','none'); 
set(gca,'Ydir','normal'); xlim([1,n_x]); ylim([1,n_x]); axis square;
set(gca,'XTick',[],'YTick',[]);
%set(gca,'XTick',[1,n_x/2+1,n_x],'XTickLabel',[grid_x_c_(1),grid_x_c_(end/2+1),floor(10*grid_x_c_(end))/10]-max_x_c/2);set(gca,'YTick',[1,n_x/2+1,n_x],'YTickLabel',[grid_x_c_(1),grid_x_c_(end/2+1),floor(10*grid_x_c_(end))/10]-max_x_c/2);
set(gcf,'Position',1+[0,0,512*2,512]);
fname_fig = sprintf('%s/ring_FIGA_0',dir_fig);
if flag_plot; print('-djpeg',sprintf('%s.jpg',fname_fig)); end;
if flag_plot; print('-depsc',sprintf('%s.eps',fname_fig)); end;
disp('return');return;
end;% if flag_disp;

tic;
grid_x_p_ = grid_x_r_;
n_x_r = length(grid_x_p_);
n_x_w_ = max(6,ceil(2*pi*grid_x_p_*n_x_r)); n_x_A = sum(n_x_w_); n_x_w_max = max(n_x_w_);
F_x_p_ = interp_c_to_p(n_x,max_x_c,n_x,max_x_c,F_x_c_,n_x_r,grid_x_p_,n_x_w_,n_x_A);
G_x_p_ = interp_c_to_p(n_x,max_x_c,n_x,max_x_c,G_x_c_,n_x_r,grid_x_p_,n_x_w_,n_x_A);
disp(sprintf(' %% calculating F_x_p_ G_x_p_: time %s',toc));
flag_disp=0;
if flag_disp;
subplot(2,2,1);imagesc_p(n_x_r,grid_x_p_,n_x_w_,n_x_A,real(F_x_p_),Flim_x,colormap(colormap_beach(64)));
subplot(2,2,2);imagesc_p(n_x_r,grid_x_p_,n_x_w_,n_x_A,real(G_x_p_),Glim_x,colormap(colormap_beach(64)));
subplot(2,2,3);imagesc_p(n_x_r,grid_x_p_,n_x_w_,n_x_A,imag(F_x_p_),Flim_x,colormap(colormap_beach(64)));
subplot(2,2,4);imagesc_p(n_x_r,grid_x_p_,n_x_w_,n_x_A,imag(G_x_p_),Glim_x,colormap(colormap_beach(64)));
return;
end;%if flag_disp;

tic;
l2_F_x_c = sum(abs(F_x_c_(:)).^2)*d_x_c*d_x_c;
% calculate image/template values on freqspace carte meshgrid ;
F_k_c_ = fft2(F_x_c_) * d_x_c*d_x_c; Flim_k  = mean(abs(F_k_c_(:))) + 1.0*std(abs(F_k_c_(:)))*[-1,+1];
l2_F_k_c = sum(abs(F_k_c_(:)).^2)*d_k_c*d_k_c;
F_tmp = ifft2(F_k_c_)./d_x_c./d_x_c; l2_F_tmp = sum(abs(F_tmp(:)).^2)*d_x_c*d_x_c;
disp(sprintf(' %% l2_F_x_c %f l2_F_k_c %f',l2_F_x_c,l2_F_k_c));
Flim_x = max(0,mean(abs(F_x_c_(:))) + 1.0*std(abs(F_x_c_(:)))*[-1,+1]);
l2_G_x_c = sum(abs(G_x_c_(:)).^2)*d_x_c*d_x_c;
% calculate image/template values on freqspace carte meshgrid ;
G_k_c_ = fft2(G_x_c_) * d_x_c*d_x_c; Glim_k  = mean(abs(G_k_c_(:))) + 1.0*std(abs(G_k_c_(:)))*[-1,+1];
l2_G_k_c = sum(abs(G_k_c_(:)).^2)*d_k_c*d_k_c;
G_tmp = ifft2(G_k_c_)./d_x_c./d_x_c; l2_G_tmp = sum(abs(G_tmp(:)).^2)*d_x_c*d_x_c;
disp(sprintf(' %% l2_G_x_c %f l2_G_k_c %f',l2_G_x_c,l2_G_k_c));
Glim_x = max(0,mean(abs(G_x_c_(:))) + 1.0*std(abs(G_x_c_(:)))*[-1,+1]);
disp(sprintf(' %% calculating F_k_c_ G_k_c_: time %f',toc));

Llim_k = [-8,0];
flag_disp=1;
if flag_disp;
figure(n_figure); clf; n_figure = n_figure + 1;
colormap(colormap_beach());
subplot(2,3,1);imagesc(recenter2(real(F_k_c_)),Flim_k);title('real(A1(k))','interpreter','none'); set(gca,'Ydir','normal'); xlim(n_x/2 + n_x/2*0.5*[-1,+1]); ylim(n_x/2 + n_x/2*0.5*[-1,+1]); axis square;
set(gca,'XTick',[],'YTick',[]);
%set(gca,'XTick',[1,n_x/2+1,n_x],'XTickLabel',[grid_k_c_(1),grid_k_c_(end/2+1),floor(10*grid_k_c_(end))/10]-max_k_c/2);set(gca,'YTick',[1,n_x/2+1,n_x],'YTickLabel',[grid_k_c_(1),grid_k_c_(end/2+1),floor(10*grid_k_c_(end))/10]-max_k_c/2);
subplot(2,3,2);imagesc(recenter2(imag(F_k_c_)),Flim_k);title('imag(A1(k))','interpreter','none'); set(gca,'Ydir','normal'); xlim(n_x/2 + n_x/2*0.5*[-1,+1]); ylim(n_x/2 + n_x/2*0.5*[-1,+1]); axis square;
set(gca,'XTick',[],'YTick',[]);
%set(gca,'XTick',[1,n_x/2+1,n_x],'XTickLabel',[grid_k_c_(1),grid_k_c_(end/2+1),floor(10*grid_k_c_(end))/10]-max_k_c/2);set(gca,'YTick',[1,n_x/2+1,n_x],'YTickLabel',[grid_k_c_(1),grid_k_c_(end/2+1),floor(10*grid_k_c_(end))/10]-max_k_c/2);
subplot(2,3,3);imagesc(recenter2(log(abs(F_k_c_))),Llim_k);title('log(abs(A1(k)))','interpreter','none'); set(gca,'Ydir','normal'); xlim(n_x/2 + n_x/2*0.5*[-1,+1]); ylim(n_x/2 + n_x/2*0.5*[-1,+1]); axis square;
set(gca,'XTick',[],'YTick',[]);
%set(gca,'XTick',[1,n_x/2+1,n_x],'XTickLabel',[grid_k_c_(1),grid_k_c_(end/2+1),floor(10*grid_k_c_(end))/10]-max_k_c/2);set(gca,'YTick',[1,n_x/2+1,n_x],'YTickLabel',[grid_k_c_(1),grid_k_c_(end/2+1),floor(10*grid_k_c_(end))/10]-max_k_c/2);
subplot(2,3,4);imagesc(recenter2(real(G_k_c_)),Glim_k);title('real(A2(k))','interpreter','none'); set(gca,'Ydir','normal'); xlim(n_x/2 + n_x/2*0.5*[-1,+1]); ylim(n_x/2 + n_x/2*0.5*[-1,+1]); axis square;
set(gca,'XTick',[],'YTick',[]);
%set(gca,'XTick',[1,n_x/2+1,n_x],'XTickLabel',[grid_k_c_(1),grid_k_c_(end/2+1),floor(10*grid_k_c_(end))/10]-max_k_c/2);set(gca,'YTick',[1,n_x/2+1,n_x],'YTickLabel',[grid_k_c_(1),grid_k_c_(end/2+1),floor(10*grid_k_c_(end))/10]-max_k_c/2);
subplot(2,3,5);imagesc(recenter2(imag(G_k_c_)),Glim_k);title('imag(A2(k))','interpreter','none'); set(gca,'Ydir','normal'); xlim(n_x/2 + n_x/2*0.5*[-1,+1]); ylim(n_x/2 + n_x/2*0.5*[-1,+1]); axis square;
set(gca,'XTick',[],'YTick',[]);
%set(gca,'XTick',[1,n_x/2+1,n_x],'XTickLabel',[grid_k_c_(1),grid_k_c_(end/2+1),floor(10*grid_k_c_(end))/10]-max_k_c/2);set(gca,'YTick',[1,n_x/2+1,n_x],'YTickLabel',[grid_k_c_(1),grid_k_c_(end/2+1),floor(10*grid_k_c_(end))/10]-max_k_c/2);
subplot(2,3,6);imagesc(recenter2(log(abs(G_k_c_))),Llim_k);title('log(abs(A2(k)))','interpreter','none'); set(gca,'Ydir','normal'); xlim(n_x/2 + n_x/2*0.5*[-1,+1]); ylim(n_x/2 + n_x/2*0.5*[-1,+1]); axis square;
set(gca,'XTick',[],'YTick',[]);
%set(gca,'XTick',[1,n_x/2+1,n_x],'XTickLabel',[grid_k_c_(1),grid_k_c_(end/2+1),floor(10*grid_k_c_(end))/10]-max_k_c/2);set(gca,'YTick',[1,n_x/2+1,n_x],'YTickLabel',[grid_k_c_(1),grid_k_c_(end/2+1),floor(10*grid_k_c_(end))/10]-max_k_c/2);
set(gcf,'Position',1+[0,0,512*3,512*2]);
fname_fig = sprintf('%s/ring_FIGB_0',dir_fig);
if flag_plot; print('-djpeg',sprintf('%s.jpg',fname_fig)); end;
if flag_plot; print('-depsc',sprintf('%s.eps',fname_fig)); end;
disp('return');return;
end;% if flag_disp;

end;%if ~flag_skip;
