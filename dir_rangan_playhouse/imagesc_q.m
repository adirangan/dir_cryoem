function imagesc_q(n_r,grid_p_,n_w_,n_A,S_q_,clim,cra_);
% bessel imagesc;
if (nargin<6); clim = []; end;
if (nargin<7); cra_ = []; end;
if isempty(clim);
clim = mean(S_q_) + std(S_q_)*2.5*[-1,1];
end;%if isempty(clim);
if isempty(cra_); 
cra_ = colormap_beach();
end;%if isempty(clim);
r0_ = zeros(1,n_A); r1_ = zeros(1,n_A);
w0_ = zeros(1,n_A); w1_ = zeros(1,n_A);
q0_ = zeros(1,n_A); q1_ = zeros(1,n_A);
ncra = size(cra_,1);
C_ = zeros(1,n_A,3);
n_w_max = n_w_(1+n_r-1);
ic=0;
for nr=0:n_r-1;
r = grid_p_(1+nr);
if nr==0; r_pre = grid_p_(1); else r_pre = 0.5*(grid_p_(1+nr-1) + grid_p_(1+nr)); end;
if nr==n_r-1; r_pos = grid_p_(end); else r_pos = 0.5*(grid_p_(1+nr+1) + grid_p_(1+nr)); end;
if n_r==1; r_pre = grid_p_(end)/4.0; r_pos = grid_p_(end); end;
n_w = n_w_(1+nr);
dw = 2*pi/n_w;
for nw=0:n_w_(1+nr)-1;
w_pre = nw*dw - 0.5*dw;
w_pos = nw*dw + 0.5*dw;
nq = periodize(nw,-n_w_(1+nr)/2,+n_w_(1+nr)/2);
q_pre = nq-0.5;
q_pos = nq+0.5;
r0_(1+ic) = r_pre; r1_(1+ic) = r_pos;
w0_(1+ic) = w_pre; w1_(1+ic) = w_pos;
q0_(1+ic) = q_pre; q1_(1+ic) = q_pos;
nc = max(1,min(ncra,floor(ncra*(S_q_(1+ic) - min(clim))/diff(clim))));
C_(1,1+ic,1:3) = cra_(nc,:);
ic=ic+1;
end;%for nw=0:n_w_(1+nr)-1;
end;%for nr=0:n_r-1;
X_ = [r0_ ; r0_ ; r1_ ; r1_ ; r0_ ];
Y_ = [q0_ ; q1_ ; q1_ ; q0_ ; q0_ ];
p=patch(X_,Y_,C_); set(p,'EdgeColor','none');
