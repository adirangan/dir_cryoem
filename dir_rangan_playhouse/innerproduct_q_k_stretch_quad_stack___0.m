function M_k_q_rwl___ = innerproduct_q_k_stretch_quad_stack___0(n_k_p_r,n_w_,M_k_q_,l_max);
n_w_sum = sum(n_w_);
M_k_q__ = zeros(n_w_sum,1+2*l_max);
ic=0;
for nk_p_r=0:n_k_p_r-1;
for nw=0:n_w_(1+nk_p_r)-1;
n_w_t = round(1.0d0*n_w_(1+nk_p_r)/2.0d0);
for l_val=-l_max:+l_max;
nwc = nw;
if (nwc>=n_w_t); nwc = nwc - n_w_(1+nk_p_r); end;%if;
flag_ict_overflow = 0;
nwd = nwc + l_val;
if (abs(nwd)<n_w_t); nwt = periodize(nwd,0,n_w_(1+nk_p_r));  else; nwt = 0; flag_ict_overflow = 1; end;%if;
ict = ic-nw+nwt;
if (flag_ict_overflow==0); M_k_q__(1+ic,1+l_max+l_val) = M_k_q_(1+ict); end;%if;
end;%for l_val=-l_max:+l_max;
ic = ic + 1;
end;%for nw=0:n_w_(1+nk_p_r)-1;
end;%for nk_p_r=0:n_k_p_r-1;
M_k_q_rwl___ = innerproduct_q_k_stretch_quad_stack__0(n_k_p_r,n_w_/(2*pi),n_w_,1+2*l_max,M_k_q__);
