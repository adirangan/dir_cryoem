function ...
[ ...
 ssnll ...
,dvol_ssnll ...
,dvol_dvol_ssnll ...
,da_ssnll ...
,db_ssnll ...
,dc_ssnll ...
,da_dvol_ssnll ...
,db_dvol_ssnll ...
,dc_dvol_ssnll ...
,dada_ssnll ...
,dadb_ssnll ...
,dadc_ssnll ...
,dbdb_ssnll ...
,dbdc_ssnll ...
,dcdc_ssnll ...
] = ...
I_xP__plus_xP__vs_xP__0( ...
 K ...
,phi_S ...
,n_source_S ...
,v_source_S_ ...
,delta_S_2S__ ...
,n_source_T ...
,v_source_T_ ...
,delta_T_2T__ ...
,phi_M ...
,n_source_M ...
,v_source_M_ ...
,delta_M_2M__ ...
,da_delta_S_2S__ ...
,db_delta_S_2S__ ...
,dc_delta_S_2S__ ...
,da_delta_T_2T__ ...
,db_delta_T_2T__ ...
,dc_delta_T_2T__ ...
,dada_delta_S_2S__ ...
,dadb_delta_S_2S__ ...
,dadc_delta_S_2S__ ...
,dbdb_delta_S_2S__ ...
,dbdc_delta_S_2S__ ...
,dcdc_delta_S_2S__ ...
,dada_delta_T_2T__ ...
,dadb_delta_T_2T__ ...
,dadc_delta_T_2T__ ...
,dbdb_delta_T_2T__ ...
,dbdc_delta_T_2T__ ...
,dcdc_delta_T_2T__ ...
);
%%%%%%%%;
% calculates the following integral: ;
% 0.5*\int_{k=0}^{K} \int_{psi=0}^{2*pi} conj[CTF*(S+T) - M] * [CTF*(S+T) - M] dpsi * kdk ;
% with T intepreted as a perturbation to S, ;
% and: ;
% CTF = 2*k*cos(psi - phi_S) ;
% S   = \sum_{nsource_S} v_source_S_(1+nsource_S) * exp( +i*2*pi*k*delta_S_(1+nsource_S) * cos(psi - omega_S_(1+nsource_S)) ) ;
% S   = \sum_{nsource_T} v_source_T_(1+nsource_T) * exp( +i*2*pi*k*delta_T_(1+nsource_T) * cos(psi - omega_T_(1+nsource_T)) ) ;
% M   = 2*k*cos(psi - phi_M) * \sum_{nsource_M} v_source_M_(1+nsource_M) * exp( +i*2*pi*k*delta_M_(1+nsource_M) * cos(psi - omega_M_(1+nsource_M)) ) ;
% where: ;
% delta_S_2S__(:,1+nsource_S) = delta_S_(1+nsource_S) * [cos(omega_S_(1+nsource_S));sin(omega_S_(1+nsource_S))] ;
% delta_T_2T__(:,1+nsource_T) = delta_T_(1+nsource_T) * [cos(omega_T_(1+nsource_T));sin(omega_T_(1+nsource_T))] ;
% delta_M_2M__(:,1+nsource_M) = delta_M_(1+nsource_M) * [cos(omega_M_(1+nsource_M));sin(omega_M_(1+nsource_M))] ;
%%%%;
% Derivatives are calculated with respect to perturbations in: ;
% delta_S_2S__(:,1+0) and delta_S_2S__(:,1+1). ;
% delta_T_2T__(:,1+0) and delta_T_2T__(:,1+1). ;
%%%%%%%%;
str_thisfunction = 'I_xP__plus_xP__vs_xP__0';

if nargin<1;
flag_verbose=1; flag_disp=0; nf=0;
if flag_verbose>0; disp(sprintf(' %% testing %s',str_thisfunction)); end;
tolerance_dtau = 1e-5;
tolerance_dvol = 1e-5;
%%%%%%%%;
% Now set up polar-quadrature-weights on disk. ;
%%%%%%%%;
k_int = 48;
k_eq_d_double = 0.25;
n_w_int = 4;
k_p_r_max = k_int/(2*pi); k_eq_d = k_eq_d_double/(2*pi); str_L = 'L';
[ ...
 n_k_p_r ...
,k_p_r_ ...
,weight_3d_k_p_r_ ...
] = ...
get_weight_3d_1( ...
 flag_verbose ...
,k_p_r_max ...
,k_eq_d ...
,str_L ...
);
%%%%;
l_max_upb = round(2*pi*k_p_r_max);
l_max_max = min(l_max_upb,1+ceil(2*pi*k_p_r_(end)));
n_w_max = n_w_int*2*(l_max_max+1); n_w_0in = n_w_max; n_w_0in_ = n_w_max*ones(n_k_p_r,1);
[ ...
 n_w_ ...
,weight_2d_k_p_r_ ...
,weight_2d_wk_ ...
,k_p_r_wk_ ...
,k_p_w_wk_ ...
,k_c_0_wk_ ...
,k_c_1_wk_ ...
] = ...
get_weight_2d_2( ...
 0*flag_verbose ...
,n_k_p_r ...
,k_p_r_ ...
,k_p_r_max ...
,-1 ...
,n_w_0in_ ...
);
n_w_sum = sum(n_w_); n_w_csum_ = cumsum([0;n_w_]);
%%%%%%%%;
% Generate images, template and integral. ;
%%%%%%%%;
rng(2);
K = k_p_r_max;
phi_S = 2*pi*rand();
n_source_S = 4;
v_source_S_ = randn(n_source_S,1);
delta_S_2S__ = 1e-1*2*pi*rand(2,n_source_S);
delta_S_S_ = reshape(sqrt(sum(delta_S_2S__.^2,1)),[n_source_S,1]);
omega_S_S_ = reshape(atan2(delta_S_2S__(1+1,:),delta_S_2S__(1+0,:)),[n_source_S,1]);
n_source_T = 2;
v_source_T_ = randn(n_source_T,1);
delta_T_2T__ = 1e-1*2*pi*rand(2,n_source_T);
delta_T_T_ = reshape(sqrt(sum(delta_T_2T__.^2,1)),[n_source_T,1]);
omega_T_T_ = reshape(atan2(delta_T_2T__(1+1,:),delta_T_2T__(1+0,:)),[n_source_T,1]);
phi_M = 2*pi*rand();
n_source_M = 3;
v_source_M_ = randn(n_source_M,1);
delta_M_2M__ = 1e-1*2*pi*rand(2,n_source_M);
delta_M_M_ = reshape(sqrt(sum(delta_M_2M__.^2,1)),[n_source_M,1]);
omega_M_M_ = reshape(atan2(delta_M_2M__(1+1,:),delta_M_2M__(1+0,:)),[n_source_M,1]);
S_k_p_wk_ = zeros(n_w_sum,1);
for nsource_S=0:n_source_S-1;
v_source_S = v_source_S_(1+nsource_S);
delta_S = delta_S_S_(1+nsource_S); omega_S = omega_S_S_(1+nsource_S);
S_k_p_wk_ = S_k_p_wk_ + v_source_S * exp(2*pi*i*k_p_r_wk_.*delta_S.*cos(k_p_w_wk_ - omega_S));
end;%for nsource_S=0:n_source_S-1;
T_k_p_wk_ = zeros(n_w_sum,1);
for nsource_T=0:n_source_T-1;
v_source_T = v_source_T_(1+nsource_T);
delta_T = delta_T_T_(1+nsource_T); omega_T = omega_T_T_(1+nsource_T);
T_k_p_wk_ = T_k_p_wk_ + v_source_T * exp(2*pi*i*k_p_r_wk_.*delta_T.*cos(k_p_w_wk_ - omega_T));
end;%for nsource_T=0:n_source_T-1;
CTF_k_p_wk_ = 2*k_p_r_wk_.*cos(k_p_w_wk_ - phi_S);
M_k_p_wk_ = zeros(n_w_sum,1);
for nsource_M=0:n_source_M-1;
v_source_M = v_source_M_(1+nsource_M);
delta_M = delta_M_M_(1+nsource_M); omega_M = omega_M_M_(1+nsource_M);
M_k_p_wk_ = M_k_p_wk_ + v_source_M * exp(2*pi*i*k_p_r_wk_.*delta_M.*cos(k_p_w_wk_ - omega_M));
end;%for nsource_M=0:n_source_M-1;
M_k_p_wk_ = 2*k_p_r_wk_.*cos(k_p_w_wk_ - phi_M) .* M_k_p_wk_;
%%%%;
if flag_disp;
figure(1+nf);nf=nf+1;clf;figbig; p_row=2;p_col=3;np=0;
Slim_ = max(abs(S_k_p_wk_),[],'all')*[-1,+1];
Tlim_ = max(abs(T_k_p_wk_),[],'all')*[-1,+1];
Mlim_ = max(abs(M_k_p_wk_),[],'all')*[-1,+1];
subplot_t(p_row,p_col,1+np);np=np+1; imagesc_p(n_k_p_r,k_p_r_,n_w_,n_w_sum,real(S_k_p_wk_),Slim_); axis image; axisnotick; title('real(S_k_p_wk_)','Interpreter','none');
subplot_t(p_row,p_col,1+np);np=np+1; imagesc_p(n_k_p_r,k_p_r_,n_w_,n_w_sum,imag(S_k_p_wk_),Slim_); axis image; axisnotick; title('imag(S_k_p_wk_)','Interpreter','none');
subplot_t(p_row,p_col,1+np);np=np+1; imagesc_p(n_k_p_r,k_p_r_,n_w_,n_w_sum,real(T_k_p_wk_),Tlim_); axis image; axisnotick; title('real(T_k_p_wk_)','Interpreter','none');
subplot_t(p_row,p_col,1+np);np=np+1; imagesc_p(n_k_p_r,k_p_r_,n_w_,n_w_sum,imag(T_k_p_wk_),Tlim_); axis image; axisnotick; title('imag(T_k_p_wk_)','Interpreter','none');
subplot_t(p_row,p_col,1+np);np=np+1; imagesc_p(n_k_p_r,k_p_r_,n_w_,n_w_sum,real(M_k_p_wk_),Mlim_); axis image; axisnotick; title('real(M_k_p_wk_)','Interpreter','none');
subplot_t(p_row,p_col,1+np);np=np+1; imagesc_p(n_k_p_r,k_p_r_,n_w_,n_w_sum,imag(M_k_p_wk_),Mlim_); axis image; axisnotick; title('imag(M_k_p_wk_)','Interpreter','none');
end;%if flag_disp;
%%%%;
ssnll_qua = 0.5*sum(conj(CTF_k_p_wk_.*S_k_p_wk_ - M_k_p_wk_).*(CTF_k_p_wk_.*S_k_p_wk_ - M_k_p_wk_).*weight_2d_wk_,'all')*(2*pi)^2;
%%%%%%%%;
%%%%%%%%%%%%%%%%;
%%%%%%%%;
if flag_verbose>0; disp(sprintf(' %% testing function-evaluation')); end;
%%%%%%%%;
[ ...
 ssnll_mid ...
,dvol_ssnll_mid ...
,dvol_dvol_ssnll_mid ...
] = ...
I_xP__plus_xP__vs_xP__0( ...
 K ...
,phi_S ...
,n_source_S ...
,v_source_S_ ...
,delta_S_2S__ ...
,n_source_T ...
,v_source_T_ ...
,delta_T_2T__ ...
,phi_M ...
,n_source_M ...
,v_source_M_ ...
,delta_M_2M__ ...
);
fnorm_disp(flag_verbose,'ssnll_qua',ssnll_qua,'ssnll_mid',ssnll_mid,' %<-- should be small (e.g., <1e-6 if quadrature resolved)');
%%%%;
%%%%%%%%%%%%%%%%;
%%%%%%%%;
if flag_verbose>0; disp(sprintf(' %% testing first-derivative (directional-derivative only, difference-quotient)')); end;
%%%%%%%%;
dv = 1*1.0*tolerance_dvol;
da = 1*0.6*tolerance_dtau;
db = 1*1.2*tolerance_dtau;
dc = 1*2.4*tolerance_dtau;
da_delta_S_2S__ = rand(2,n_source_S);
db_delta_S_2S__ = rand(2,n_source_S);
dc_delta_S_2S__ = rand(2,n_source_S);
[ ...
 ssnll_mid ...
,dvol_ssnll_mid ...
,dvol_dvol_ssnll_mid ...
,da_ssnll_mid ...
,db_ssnll_mid ...
,dc_ssnll_mid ...
] = ...
I_xP__plus_xP__vs_xP__0( ...
 K ...
,phi_S ...
,n_source_S ...
,v_source_S_ ...
,delta_S_2S__ ...
,n_source_T ...
,v_source_T_ ...
,delta_T_2T__ ...
,phi_M ...
,n_source_M ...
,v_source_M_ ...
,delta_M_2M__ ...
,da_delta_S_2S__ ...
,db_delta_S_2S__ ...
,dc_delta_S_2S__ ...
);
delta_S_pos_2S__ = delta_S_2S__ + da*da_delta_S_2S__ + db*db_delta_S_2S__ + dc*dc_delta_S_2S__ ;
[ ...
 ssnll_pos ...
] = ...
I_xP__plus_xP__vs_xP__0( ...
 K ...
,phi_S ...
,n_source_S ...
,v_source_S_ ...
,delta_S_pos_2S__ ...
,[] ...
,[] ...
,[] ...
,phi_M ...
,n_source_M ...
,v_source_M_ ...
,delta_M_2M__ ...
);
delta_S_neg_2S__ = delta_S_2S__ - da*da_delta_S_2S__ - db*db_delta_S_2S__ - dc*dc_delta_S_2S__ ;
[ ...
 ssnll_neg ...
] = ...
I_xP__plus_xP__vs_xP__0( ...
 K ...
,phi_S ...
,n_source_S ...
,v_source_S_ ...
,delta_S_neg_2S__ ...
,[] ...
,[] ...
,[] ...
,phi_M ...
,n_source_M ...
,v_source_M_ ...
,delta_M_2M__ ...
);
dtau_ssnll_dif = (+ ssnll_pos - ssnll_neg)/max(1e-12,2*fnorm((delta_S_pos_2S__ - delta_S_neg_2S__)/2));
dtau_ssnll_mid = (da*da_ssnll_mid + db*db_ssnll_mid + dc*dc_ssnll_mid)/max(1e-12,fnorm([da*da_delta_S_2S__ + db*db_delta_S_2S__ + dc*dc_delta_S_2S__]));
fnorm_disp(flag_verbose,'dtau_ssnll_dif',dtau_ssnll_dif,'dtau_ssnll_mid',dtau_ssnll_mid);
%%%%%%%%;
n_source_S_pos = n_source_S + n_source_T;
v_source_S_pos_ = cat(1,v_source_S_,+1*dv*v_source_T_);
delta_S_pos_2S__ = cat(2,delta_S_2S__,delta_T_2T__);
[ ...
 ssnll_pos ...
] = ...
I_xP__plus_xP__vs_xP__0( ...
 K ...
,phi_S ...
,n_source_S_pos ...
,v_source_S_pos_ ...
,delta_S_pos_2S__ ...
,[] ...
,[] ...
,[] ...
,phi_M ...
,n_source_M ...
,v_source_M_ ...
,delta_M_2M__ ...
);
n_source_S_neg = n_source_S + n_source_T;
v_source_S_neg_ = cat(1,v_source_S_,-1*dv*v_source_T_);
delta_S_neg_2S__ = cat(2,delta_S_2S__,delta_T_2T__);
[ ...
 ssnll_neg ...
] = ...
I_xP__plus_xP__vs_xP__0( ...
 K ...
,phi_S ...
,n_source_S_neg ...
,v_source_S_neg_ ...
,delta_S_neg_2S__ ...
,[] ...
,[] ...
,[] ...
,phi_M ...
,n_source_M ...
,v_source_M_ ...
,delta_M_2M__ ...
);
dvol_ssnll_dif = (+ ssnll_pos - ssnll_neg)/max(1e-12,2*dv);
fnorm_disp(flag_verbose,'dvol_ssnll_dif',dvol_ssnll_dif,'dvol_ssnll_mid',dvol_ssnll_mid);
dvol_dvol_ssnll_dif = (+ ssnll_pos - 2*ssnll_mid + ssnll_neg)/max(1e-12,dv*dv);
fnorm_disp(flag_verbose,'dvol_dvol_ssnll_dif',dvol_dvol_ssnll_dif,'dvol_dvol_ssnll_mid',dvol_dvol_ssnll_mid);
%%%%%%%%;
%%%%%%%%%%%%%%%%;
%%%%%%%%;
if flag_verbose>0; disp(sprintf(' %% testing first-derivative (directional-derivative only, taylor-series)')); end;
%%%%%%%%;
dv = 1*1.0*tolerance_dvol;
da = 1*0.6*tolerance_dtau;
db = 1*1.2*tolerance_dtau;
dc = 1*2.4*tolerance_dtau;
da_delta_S_2S__ = rand(2,n_source_S);
db_delta_S_2S__ = rand(2,n_source_S);
dc_delta_S_2S__ = rand(2,n_source_S);
[ ...
 ssnll_mid ...
,dvol_ssnll_mid ...
,dvol_dvol_ssnll_mid ...
,da_ssnll_mid ...
,db_ssnll_mid ...
,dc_ssnll_mid ...
] = ...
I_xP__plus_xP__vs_xP__0( ...
 K ...
,phi_S ...
,n_source_S ...
,v_source_S_ ...
,delta_S_2S__ ...
,n_source_T ...
,dv*v_source_T_ ...
,delta_T_2T__ ...
,phi_M ...
,n_source_M ...
,v_source_M_ ...
,delta_M_2M__ ...
,da*da_delta_S_2S__ ...
,db*db_delta_S_2S__ ...
,dc*dc_delta_S_2S__ ...
);
n_source_S_pos = n_source_S + n_source_T;
v_source_S_pos_ = cat(1,v_source_S_,+1*dv*v_source_T_);
delta_S_pos_2S__ = cat(2, delta_S_2S__ + da*da_delta_S_2S__ + db*db_delta_S_2S__ + dc*dc_delta_S_2S__ ,delta_T_2T__);
[ ...
 ssnll_pos ...
] = ...
I_xP__plus_xP__vs_xP__0( ...
 K ...
,phi_S ...
,n_source_S_pos ...
,v_source_S_pos_ ...
,delta_S_pos_2S__ ...
,[] ...
,[] ...
,[] ...
,phi_M ...
,n_source_M ...
,v_source_M_ ...
,delta_M_2M__ ...
);
n_source_S_neg = n_source_S + n_source_T;
v_source_S_neg_ = cat(1,v_source_S_,-1*dv*v_source_T_);
delta_S_neg_2S__ = cat(2, delta_S_2S__ - da*da_delta_S_2S__ - db*db_delta_S_2S__ - dc*dc_delta_S_2S__ ,delta_T_2T__);
[ ...
 ssnll_neg ...
] = ...
I_xP__plus_xP__vs_xP__0( ...
 K ...
,phi_S ...
,n_source_S_neg ...
,v_source_S_neg_ ...
,delta_S_neg_2S__ ...
,[] ...
,[] ...
,[] ...
,phi_M ...
,n_source_M ...
,v_source_M_ ...
,delta_M_2M__ ...
);
ssnll_pos_est = ssnll_mid + da_ssnll_mid + db_ssnll_mid + dc_ssnll_mid + dvol_ssnll_mid;
fnorm_disp(flag_verbose,'ssnll_pos',ssnll_pos,'ssnll_pos_est',ssnll_pos_est);
ssnll_neg_est = ssnll_mid - da_ssnll_mid - db_ssnll_mid - dc_ssnll_mid - dvol_ssnll_mid;
fnorm_disp(flag_verbose,'ssnll_neg',ssnll_neg,'ssnll_neg_est',ssnll_neg_est);
ssnll_dif_est = ssnll_pos_est - ssnll_neg_est;
ssnll_dif_emp = ssnll_pos     - ssnll_neg    ;
fnorm_disp(flag_verbose,'ssnll_dif_emp',ssnll_dif_emp,'ssnll_dif_est',ssnll_dif_est);
%%%%%%%%;
%%%%%%%%%%%%%%%%;
%%%%%%%%;
if flag_verbose>0; disp(sprintf(' %% testing second-derivative (directional-derivative only, mini difference-quotient)')); end;
%%%%%%%%;
dv = 1*1.0*tolerance_dvol;
da = 1*0.6*tolerance_dtau;
db = 1*1.2*tolerance_dtau;
dc = 1*2.4*tolerance_dtau;
da_delta_S_2S__ = rand(2,n_source_S);
db_delta_S_2S__ = rand(2,n_source_S);
dc_delta_S_2S__ = rand(2,n_source_S);
[ ...
 ssnll_mid ...
,dvol_ssnll_mid ...
,dvol_dvol_ssnll_mid ...
,da_ssnll_mid ...
,db_ssnll_mid ...
,dc_ssnll_mid ...
,da_dvol_ssnll_mid ...
,db_dvol_ssnll_mid ...
,dc_dvol_ssnll_mid ...
,dada_ssnll_mid ...
,dadb_ssnll_mid ...
,dadc_ssnll_mid ...
,dbdb_ssnll_mid ...
,dbdc_ssnll_mid ...
,dcdc_ssnll_mid ...
] = ...
I_xP__plus_xP__vs_xP__0( ...
 K ...
,phi_S ...
,n_source_S ...
,v_source_S_ ...
,delta_S_2S__ ...
,n_source_T ...
,v_source_T_ ...
,delta_T_2T__ ...
,phi_M ...
,n_source_M ...
,v_source_M_ ...
,delta_M_2M__ ...
,da_delta_S_2S__ ...
,db_delta_S_2S__ ...
,dc_delta_S_2S__ ...
);
n_source_S_pos = n_source_S + n_source_T;
v_source_S_pos_ = cat(1,v_source_S_,+1*dv*v_source_T_);
delta_S_pos_sub_2S__ = ...
+ delta_S_2S__ ...
+ da*da_delta_S_2S__ ...
+ db*db_delta_S_2S__ ...
+ dc*dc_delta_S_2S__ ...
;
delta_S_pos_2S__ = cat(2,delta_S_pos_sub_2S__,delta_T_2T__);
[ ...
 ssnll_pos ...
] = ...
I_xP__plus_xP__vs_xP__0( ...
 K ...
,phi_S ...
,n_source_S_pos ...
,v_source_S_pos_ ...
,delta_S_pos_2S__ ...
,[] ...
,[] ...
,[] ...
,phi_M ...
,n_source_M ...
,v_source_M_ ...
,delta_M_2M__ ...
);
n_source_S_neg = n_source_S + n_source_T;
v_source_S_neg_ = cat(1,v_source_S_,-1*dv*v_source_T_);
delta_S_neg_sub_2S__ = ...
+ delta_S_2S__ ...
- da*da_delta_S_2S__ ...
- db*db_delta_S_2S__ ...
- dc*dc_delta_S_2S__ ...
;
delta_S_neg_2S__ = cat(2,delta_S_neg_sub_2S__,delta_T_2T__);
[ ...
 ssnll_neg ...
] = ...
I_xP__plus_xP__vs_xP__0( ...
 K ...
,phi_S ...
,n_source_S_neg ...
,v_source_S_neg_ ...
,delta_S_neg_2S__ ...
,[] ...
,[] ...
,[] ...
,phi_M ...
,n_source_M ...
,v_source_M_ ...
,delta_M_2M__ ...
);
dtau_dtau_ssnll_dif = (+ ssnll_pos - 2*ssnll_mid + ssnll_neg)/max(1e-12,dv.^2 + fnorm((delta_S_pos_sub_2S__ - delta_S_neg_sub_2S__)/2).^2);
dtau_dtau_ssnll_mid = ...
+ dv*dvol_dvol_ssnll_mid*dv ...
+ da*da_dvol_ssnll_mid*dv ...
+ db*db_dvol_ssnll_mid*dv ...
+ dc*dc_dvol_ssnll_mid*dv ...
+ da*dada_ssnll_mid*da ...
+ da*dadb_ssnll_mid*db ...
+ da*dadc_ssnll_mid*dc ...
+ db*dadb_ssnll_mid*da ...
+ db*dbdb_ssnll_mid*db ...
+ db*dbdc_ssnll_mid*dc ...
+ dc*dadc_ssnll_mid*da ...
+ dc*dbdc_ssnll_mid*db ...
+ dc*dcdc_ssnll_mid*dc ...
;
dtau_dtau_ssnll_mid = dtau_dtau_ssnll_mid/max(1e-12,dv.^2 + fnorm([da*da_delta_S_2S__ + db*db_delta_S_2S__ + dc*dc_delta_S_2S__]).^2);
fnorm_disp(flag_verbose,'dtau_dtau_ssnll_dif',dtau_dtau_ssnll_dif,'dtau_dtau_ssnll_mid',dtau_dtau_ssnll_mid);
%%%%%%%%;
%%%%%%%%%%%%%%%%;
%%%%%%%%;
if flag_verbose>0; disp(sprintf(' %% testing second-derivative (directional-derivative only, taylor-series)')); end;
%%%%%%%%;
dv = 1*1.0*tolerance_dvol;
da = 1*3.6*tolerance_dtau;
db = 1*1.2*tolerance_dtau;
dc = 1*2.4*tolerance_dtau;
da_delta_S_2S__ = rand(2,n_source_S);
db_delta_S_2S__ = rand(2,n_source_S);
dc_delta_S_2S__ = rand(2,n_source_S);
da_delta_T_2T__ = rand(2,n_source_T);
db_delta_T_2T__ = rand(2,n_source_T);
dc_delta_T_2T__ = rand(2,n_source_T);
dada_delta_S_2S__ = rand(2,n_source_S);
dadb_delta_S_2S__ = rand(2,n_source_S);
dadc_delta_S_2S__ = rand(2,n_source_S);
dbdb_delta_S_2S__ = rand(2,n_source_S);
dbdc_delta_S_2S__ = rand(2,n_source_S);
dcdc_delta_S_2S__ = rand(2,n_source_S);
[ ...
 ssnll_mid ...
,dvol_ssnll_mid ...
,dvol_dvol_ssnll_mid ...
,da_ssnll_mid ...
,db_ssnll_mid ...
,dc_ssnll_mid ...
,da_dvol_ssnll_mid ...
,db_dvol_ssnll_mid ...
,dc_dvol_ssnll_mid ...
,dada_ssnll_mid ...
,dadb_ssnll_mid ...
,dadc_ssnll_mid ...
,dbdb_ssnll_mid ...
,dbdc_ssnll_mid ...
,dcdc_ssnll_mid ...
] = ...
I_xP__plus_xP__vs_xP__0( ...
 K ...
,phi_S ...
,n_source_S ...
,v_source_S_ ...
,delta_S_2S__ ...
,n_source_T ...
,dv*v_source_T_ ...
,delta_T_2T__ ...
,phi_M ...
,n_source_M ...
,v_source_M_ ...
,delta_M_2M__ ...
,da*da_delta_S_2S__ ...
,db*db_delta_S_2S__ ...
,dc*dc_delta_S_2S__ ...
,da*da_delta_T_2T__ ...
,db*db_delta_T_2T__ ...
,dc*dc_delta_T_2T__ ...
,da*dada_delta_S_2S__*da ...
,da*dadb_delta_S_2S__*db ...
,da*dadc_delta_S_2S__*dc ...
,db*dbdb_delta_S_2S__*db ...
,db*dbdc_delta_S_2S__*dc ...
,dc*dcdc_delta_S_2S__*dc ...
);
n_source_S_pos = n_source_S + n_source_T;
v_source_S_pos_ = cat(1,v_source_S_,+1*dv*v_source_T_);
delta_S_pos_sub_2S__ = ...
+ delta_S_2S__ ...
+ da*da_delta_S_2S__ ...
+ db*db_delta_S_2S__ ...
+ dc*dc_delta_S_2S__ ...
+ 1.0*0.5*da*dada_delta_S_2S__*da ...
+ 1.0*0.5*da*dadb_delta_S_2S__*db ...
+ 1.0*0.5*da*dadc_delta_S_2S__*dc ...
+ 1.0*0.5*db*dadb_delta_S_2S__*da ...
+ 1.0*0.5*db*dbdb_delta_S_2S__*db ...
+ 1.0*0.5*db*dbdc_delta_S_2S__*dc ...
+ 1.0*0.5*dc*dadc_delta_S_2S__*da ...
+ 1.0*0.5*dc*dbdc_delta_S_2S__*db ...
+ 1.0*0.5*dc*dcdc_delta_S_2S__*dc ...
;
delta_T_pos_sub_2T__ = ...
+ delta_T_2T__ ...
+ da*da_delta_T_2T__ ...
+ db*db_delta_T_2T__ ...
+ dc*dc_delta_T_2T__ ...
;
delta_S_pos_2S__ = cat(2,delta_S_pos_sub_2S__,delta_T_pos_sub_2T__);
[ ...
 ssnll_pos ...
] = ...
I_xP__plus_xP__vs_xP__0( ...
 K ...
,phi_S ...
,n_source_S_pos ...
,v_source_S_pos_ ...
,delta_S_pos_2S__ ...
,[] ...
,[] ...
,[] ...
,phi_M ...
,n_source_M ...
,v_source_M_ ...
,delta_M_2M__ ...
);
n_source_S_neg = n_source_S + n_source_T;
v_source_S_neg_ = cat(1,v_source_S_,-1*dv*v_source_T_);
delta_S_neg_sub_2S__ = ...
+ delta_S_2S__ ...
- da*da_delta_S_2S__ ...
- db*db_delta_S_2S__ ...
- dc*dc_delta_S_2S__ ...
+ 1.0*0.5*da*dada_delta_S_2S__*da ...
+ 1.0*0.5*da*dadb_delta_S_2S__*db ...
+ 1.0*0.5*da*dadc_delta_S_2S__*dc ...
+ 1.0*0.5*db*dadb_delta_S_2S__*da ...
+ 1.0*0.5*db*dbdb_delta_S_2S__*db ...
+ 1.0*0.5*db*dbdc_delta_S_2S__*dc ...
+ 1.0*0.5*dc*dadc_delta_S_2S__*da ...
+ 1.0*0.5*dc*dbdc_delta_S_2S__*db ...
+ 1.0*0.5*dc*dcdc_delta_S_2S__*dc ...
;
delta_T_neg_sub_2T__ = ...
+ delta_T_2T__ ...
- da*da_delta_T_2T__ ...
- db*db_delta_T_2T__ ...
- dc*dc_delta_T_2T__ ...
;
delta_S_neg_2S__ = cat(2,delta_S_neg_sub_2S__,delta_T_neg_sub_2T__);
[ ...
 ssnll_neg ...
] = ...
I_xP__plus_xP__vs_xP__0( ...
 K ...
,phi_S ...
,n_source_S_neg ...
,v_source_S_neg_ ...
,delta_S_neg_2S__ ...
,[] ...
,[] ...
,[] ...
,phi_M ...
,n_source_M ...
,v_source_M_ ...
,delta_M_2M__ ...
);
ssnll_pos_est = ...
 + ssnll_mid ...
 + dvol_ssnll_mid ...
 + 0.5*dvol_dvol_ssnll_mid ...
 + da_ssnll_mid ...
 + db_ssnll_mid ...
 + dc_ssnll_mid ...
 + da_dvol_ssnll_mid ...
 + db_dvol_ssnll_mid ...
 + dc_dvol_ssnll_mid ...
 + 0.5*dada_ssnll_mid ...
 + 1.0*dadb_ssnll_mid ...
 + 1.0*dadc_ssnll_mid ...
 + 0.5*dbdb_ssnll_mid ...
 + 1.0*dbdc_ssnll_mid ...
 + 0.5*dcdc_ssnll_mid ...
;
fnorm_disp(flag_verbose,'ssnll_pos',ssnll_pos,'ssnll_pos_est',ssnll_pos_est);
ssnll_neg_est = ...
 + ssnll_mid ...
 - dvol_ssnll_mid ...
 + 0.5*dvol_dvol_ssnll_mid ...
 - da_ssnll_mid ...
 - db_ssnll_mid ...
 - dc_ssnll_mid ...
 + da_dvol_ssnll_mid ...
 + db_dvol_ssnll_mid ...
 + dc_dvol_ssnll_mid ...
 + 0.5*dada_ssnll_mid ...
 + 1.0*dadb_ssnll_mid ...
 + 1.0*dadc_ssnll_mid ...
 + 0.5*dbdb_ssnll_mid ...
 + 1.0*dbdc_ssnll_mid ...
 + 0.5*dcdc_ssnll_mid ...
;
fnorm_disp(flag_verbose,'ssnll_neg',ssnll_neg,'ssnll_neg_est',ssnll_neg_est);
ssnll_nabla_est = + ssnll_pos_est - 2*ssnll_mid + ssnll_neg_est;
ssnll_nabla_emp = + ssnll_pos     - 2*ssnll_mid + ssnll_neg    ;
fnorm_disp(flag_verbose,'ssnll_nabla_emp',ssnll_nabla_emp,'ssnll_nabla_est',ssnll_nabla_est);
%%%%%%%%;
%%%%%%%%%%%%%%%%;
%%%%%%%%;
if flag_verbose>0; disp(sprintf(' %% testing second-derivative (directional-derivative only, full difference-quotient)')); end;
%%%%%%%%;
dv = 1*1.0*tolerance_dvol;
da = 1*3.6*tolerance_dtau;
db = 1*1.2*tolerance_dtau;
dc = 1*2.4*tolerance_dtau;
da_delta_S_2S__ = rand(2,n_source_S);
db_delta_S_2S__ = rand(2,n_source_S);
dc_delta_S_2S__ = rand(2,n_source_S);
da_delta_T_2T__ = rand(2,n_source_T);
db_delta_T_2T__ = rand(2,n_source_T);
dc_delta_T_2T__ = rand(2,n_source_T);
dada_delta_S_2S__ = rand(2,n_source_S);
dadb_delta_S_2S__ = rand(2,n_source_S);
dadc_delta_S_2S__ = rand(2,n_source_S);
dbdb_delta_S_2S__ = rand(2,n_source_S);
dbdc_delta_S_2S__ = rand(2,n_source_S);
dcdc_delta_S_2S__ = rand(2,n_source_S);
[ ...
 ssnll_mid ...
,dvol_ssnll_mid ...
,dvol_dvol_ssnll_mid ...
,da_ssnll_mid ...
,db_ssnll_mid ...
,dc_ssnll_mid ...
,da_dvol_ssnll_mid ...
,db_dvol_ssnll_mid ...
,dc_dvol_ssnll_mid ...
,dada_ssnll_mid ...
,dadb_ssnll_mid ...
,dadc_ssnll_mid ...
,dbdb_ssnll_mid ...
,dbdc_ssnll_mid ...
,dcdc_ssnll_mid ...
] = ...
I_xP__plus_xP__vs_xP__0( ...
 K ...
,phi_S ...
,n_source_S ...
,v_source_S_ ...
,delta_S_2S__ ...
,n_source_T ...
,v_source_T_ ...
,delta_T_2T__ ...
,phi_M ...
,n_source_M ...
,v_source_M_ ...
,delta_M_2M__ ...
,da_delta_S_2S__ ...
,db_delta_S_2S__ ...
,dc_delta_S_2S__ ...
,da_delta_T_2T__ ...
,db_delta_T_2T__ ...
,dc_delta_T_2T__ ...
,dada_delta_S_2S__ ...
,dadb_delta_S_2S__ ...
,dadc_delta_S_2S__ ...
,dbdb_delta_S_2S__ ...
,dbdc_delta_S_2S__ ...
,dcdc_delta_S_2S__ ...
);
n_source_S_pos = n_source_S + n_source_T;
v_source_S_pos_ = cat(1,v_source_S_,+1*dv*v_source_T_);
delta_S_pos_sub_2S__ = ...
+ delta_S_2S__ ...
+ da*da_delta_S_2S__ ...
+ db*db_delta_S_2S__ ...
+ dc*dc_delta_S_2S__ ...
+ 1.0*0.5*da*dada_delta_S_2S__*da ...
+ 1.0*0.5*da*dadb_delta_S_2S__*db ...
+ 1.0*0.5*da*dadc_delta_S_2S__*dc ...
+ 1.0*0.5*db*dadb_delta_S_2S__*da ...
+ 1.0*0.5*db*dbdb_delta_S_2S__*db ...
+ 1.0*0.5*db*dbdc_delta_S_2S__*dc ...
+ 1.0*0.5*dc*dadc_delta_S_2S__*da ...
+ 1.0*0.5*dc*dbdc_delta_S_2S__*db ...
+ 1.0*0.5*dc*dcdc_delta_S_2S__*dc ...
;
delta_T_pos_sub_2T__ = ...
+ delta_T_2T__ ...
+ da*da_delta_T_2T__ ...
+ db*db_delta_T_2T__ ...
+ dc*dc_delta_T_2T__ ...
;
delta_S_pos_2S__ = cat(2,delta_S_pos_sub_2S__,delta_T_pos_sub_2T__);
[ ...
 ssnll_pos ...
] = ...
I_xP__plus_xP__vs_xP__0( ...
 K ...
,phi_S ...
,n_source_S_pos ...
,v_source_S_pos_ ...
,delta_S_pos_2S__ ...
,[] ...
,[] ...
,[] ...
,phi_M ...
,n_source_M ...
,v_source_M_ ...
,delta_M_2M__ ...
);
n_source_S_neg = n_source_S + n_source_T;
v_source_S_neg_ = cat(1,v_source_S_,-1*dv*v_source_T_);
delta_S_neg_sub_2S__ = ...
+ delta_S_2S__ ...
- da*da_delta_S_2S__ ...
- db*db_delta_S_2S__ ...
- dc*dc_delta_S_2S__ ...
+ 1.0*0.5*da*dada_delta_S_2S__*da ...
+ 1.0*0.5*da*dadb_delta_S_2S__*db ...
+ 1.0*0.5*da*dadc_delta_S_2S__*dc ...
+ 1.0*0.5*db*dadb_delta_S_2S__*da ...
+ 1.0*0.5*db*dbdb_delta_S_2S__*db ...
+ 1.0*0.5*db*dbdc_delta_S_2S__*dc ...
+ 1.0*0.5*dc*dadc_delta_S_2S__*da ...
+ 1.0*0.5*dc*dbdc_delta_S_2S__*db ...
+ 1.0*0.5*dc*dcdc_delta_S_2S__*dc ...
;
delta_T_neg_sub_2T__ = ...
+ delta_T_2T__ ...
- da*da_delta_T_2T__ ...
- db*db_delta_T_2T__ ...
- dc*dc_delta_T_2T__ ...
;
delta_S_neg_2S__ = cat(2,delta_S_neg_sub_2S__,delta_T_neg_sub_2T__);
[ ...
 ssnll_neg ...
] = ...
I_xP__plus_xP__vs_xP__0( ...
 K ...
,phi_S ...
,n_source_S_neg ...
,v_source_S_neg_ ...
,delta_S_neg_2S__ ...
,[] ...
,[] ...
,[] ...
,phi_M ...
,n_source_M ...
,v_source_M_ ...
,delta_M_2M__ ...
);
dtau_dtau_ssnll_dif = (+ ssnll_pos - 2*ssnll_mid + ssnll_neg)/max(1e-12,dv.^2 + fnorm((delta_S_pos_sub_2S__ - delta_S_neg_sub_2S__)/2).^2);
dtau_dtau_ssnll_mid = ...
+ dv*dvol_dvol_ssnll_mid*dv ...
+ da*da_dvol_ssnll_mid*dv ...
+ db*db_dvol_ssnll_mid*dv ...
+ dc*dc_dvol_ssnll_mid*dv ...
+ da*dada_ssnll_mid*da ...
+ da*dadb_ssnll_mid*db ...
+ da*dadc_ssnll_mid*dc ...
+ db*dadb_ssnll_mid*da ...
+ db*dbdb_ssnll_mid*db ...
+ db*dbdc_ssnll_mid*dc ...
+ dc*dadc_ssnll_mid*da ...
+ dc*dbdc_ssnll_mid*db ...
+ dc*dcdc_ssnll_mid*dc ...
;
dtau_dtau_ssnll_mid = dtau_dtau_ssnll_mid/max(1e-12,dv.^2 + fnorm([da*da_delta_S_2S__ + db*db_delta_S_2S__ + dc*dc_delta_S_2S__]).^2);
fnorm_disp(flag_verbose,'dtau_dtau_ssnll_dif',dtau_dtau_ssnll_dif,'dtau_dtau_ssnll_mid',dtau_dtau_ssnll_mid);
%%%%%%%%;
if flag_verbose>0; disp(sprintf(' %% returning')); end; return;
end;%if nargin<1;

na=0;
if (nargin<1+na); K=[]; end; na=na+1;
if (nargin<1+na); phi_S=[]; end; na=na+1;
if (nargin<1+na); n_source_S=[]; end; na=na+1;
if (nargin<1+na); v_source_S_=[]; end; na=na+1;
if (nargin<1+na); delta_S_2S__=[]; end; na=na+1;
if (nargin<1+na); n_source_T=[]; end; na=na+1;
if (nargin<1+na); v_source_T_=[]; end; na=na+1;
if (nargin<1+na); delta_T_2T__=[]; end; na=na+1;
if (nargin<1+na); phi_M=[]; end; na=na+1;
if (nargin<1+na); n_source_M=[]; end; na=na+1;
if (nargin<1+na); v_source_M_=[]; end; na=na+1;
if (nargin<1+na); delta_M_2M__=[]; end; na=na+1;
if (nargin<1+na); da_delta_S_2S__=[]; end; na=na+1;
if (nargin<1+na); db_delta_S_2S__=[]; end; na=na+1;
if (nargin<1+na); dc_delta_S_2S__=[]; end; na=na+1;
if (nargin<1+na); da_delta_T_2T__=[]; end; na=na+1;
if (nargin<1+na); db_delta_T_2T__=[]; end; na=na+1;
if (nargin<1+na); dc_delta_T_2T__=[]; end; na=na+1;
if (nargin<1+na); dada_delta_S_2S__=[]; end; na=na+1;
if (nargin<1+na); dadb_delta_S_2S__=[]; end; na=na+1;
if (nargin<1+na); dadc_delta_S_2S__=[]; end; na=na+1;
if (nargin<1+na); dbdb_delta_S_2S__=[]; end; na=na+1;
if (nargin<1+na); dbdc_delta_S_2S__=[]; end; na=na+1;
if (nargin<1+na); dcdc_delta_S_2S__=[]; end; na=na+1;
if (nargin<1+na); dada_delta_T_2T__=[]; end; na=na+1;
if (nargin<1+na); dadb_delta_T_2T__=[]; end; na=na+1;
if (nargin<1+na); dadc_delta_T_2T__=[]; end; na=na+1;
if (nargin<1+na); dbdb_delta_T_2T__=[]; end; na=na+1;
if (nargin<1+na); dbdc_delta_T_2T__=[]; end; na=na+1;
if (nargin<1+na); dcdc_delta_T_2T__=[]; end; na=na+1;

if isempty(K); K = 48.0/(2*pi); end;
if isempty(phi_S); phi_S = 0.0*pi; end;
if isempty(n_source_S); n_source_S = 1; end;
if isempty(v_source_S_); v_source_S_ = ones(n_source_S,1); end;
if isempty(delta_S_2S__); delta_S_2S__ = ones(2,n_source_S); end;
if isempty(n_source_T); n_source_T = 0; end;
if isempty(v_source_T_); v_source_T_ = zeros(n_source_T,1); end;
if isempty(delta_T_2T__); delta_T_2T__ = ones(2,n_source_T); end;
if isempty(phi_M); phi_M = 0.5*pi; end;
if isempty(n_source_M); n_source_M = 1; end;
if isempty(v_source_M_); v_source_M_ = ones(n_source_M,1); end;
if isempty(delta_M_2M__); delta_M_2M__ = ones(2,n_source_M); end;
if isempty(da_delta_S_2S__); da_delta_S_2S__ = zeros(2,n_source_S); end;
if isempty(db_delta_S_2S__); db_delta_S_2S__ = zeros(2,n_source_S); end;
if isempty(dc_delta_S_2S__); dc_delta_S_2S__ = zeros(2,n_source_S); end;
if isempty(da_delta_T_2T__); da_delta_T_2T__ = zeros(2,n_source_T); end;
if isempty(db_delta_T_2T__); db_delta_T_2T__ = zeros(2,n_source_T); end;
if isempty(dc_delta_T_2T__); dc_delta_T_2T__ = zeros(2,n_source_T); end;
if isempty(dada_delta_S_2S__); dada_delta_S_2S__ = zeros(2,n_source_S); end;
if isempty(dadb_delta_S_2S__); dadb_delta_S_2S__ = zeros(2,n_source_S); end;
if isempty(dadc_delta_S_2S__); dadc_delta_S_2S__ = zeros(2,n_source_S); end;
if isempty(dbdb_delta_S_2S__); dbdb_delta_S_2S__ = zeros(2,n_source_S); end;
if isempty(dbdc_delta_S_2S__); dbdc_delta_S_2S__ = zeros(2,n_source_S); end;
if isempty(dcdc_delta_S_2S__); dcdc_delta_S_2S__ = zeros(2,n_source_S); end;
if isempty(dada_delta_T_2T__); dada_delta_T_2T__ = zeros(2,n_source_T); end;
if isempty(dadb_delta_T_2T__); dadb_delta_T_2T__ = zeros(2,n_source_T); end;
if isempty(dadc_delta_T_2T__); dadc_delta_T_2T__ = zeros(2,n_source_T); end;
if isempty(dbdb_delta_T_2T__); dbdb_delta_T_2T__ = zeros(2,n_source_T); end;
if isempty(dbdc_delta_T_2T__); dbdc_delta_T_2T__ = zeros(2,n_source_T); end;
if isempty(dcdc_delta_T_2T__); dcdc_delta_T_2T__ = zeros(2,n_source_T); end;

flag_1 = 1;
flag_dvol = nargout>=1+1;
flag_dvol_dvol = nargout>=1+2;
flag_dtau = nargout>=1+3;
flag_dtau_dvol = nargout>=1+6;
flag_dtau_dtau = nargout>=1+9;

ssnll = 0.0;
dvol_ssnll = 0.0;
dvol_dvol_ssnll = 0.0;
da_ssnll = 0.0;
db_ssnll = 0.0;
dc_ssnll = 0.0;
da_dvol_ssnll = 0.0;
db_dvol_ssnll = 0.0;
dc_dvol_ssnll = 0.0;
dada_ssnll = 0.0;
dadb_ssnll = 0.0;
dadc_ssnll = 0.0;
dbdb_ssnll = 0.0;
dbdc_ssnll = 0.0;
dcdc_ssnll = 0.0;

phi_T = phi_S;
%%%%%%%%%%%%%%%%;
for ntype_X=0:3-1; for ntype_Y=0:3-1;
%%%%%%%%%%%%%%%%;
if ntype_X==0; tab_XS = 1; tab_XT = 0; tab_XM = 0; end;
if ntype_X==1; tab_XS = 0; tab_XT = 1; tab_XM = 0; end;
if ntype_X==2; tab_XS = 0; tab_XT = 0; tab_XM = 1; end;
if ntype_Y==0; tab_YS = 1; tab_YT = 0; tab_YM = 0; end;
if ntype_Y==1; tab_YS = 0; tab_YT = 1; tab_YM = 0; end;
if ntype_Y==2; tab_YS = 0; tab_YT = 0; tab_YM = 1; end;
tab_sgn = +1; if xor(tab_XM,tab_YM); tab_sgn = -1; end;
if ~or(tab_XT,tab_YT); tab_ssnll = 1; tab_dvol_ssnll = 0; tab_dvol_dvol_ssnll = 0; end;
if xor(tab_XT,tab_YT); tab_ssnll = 0; tab_dvol_ssnll = 1; tab_dvol_dvol_ssnll = 0; end;
if and(tab_XT,tab_YT); tab_ssnll = 0; tab_dvol_ssnll = 0; tab_dvol_dvol_ssnll = 1; end;
%%%%%%%%%%%%%%%%;
n_source_X = tab_XS*n_source_S + tab_XT*n_source_T + tab_XM*n_source_M;
if tab_XS==1;
phi_X = phi_S;
v_source_X_ = v_source_S_;
delta_X_2X__ = delta_S_2S__;
if flag_dtau;
da_delta_X_2X__ = da_delta_S_2S__;
db_delta_X_2X__ = db_delta_S_2S__;
dc_delta_X_2X__ = dc_delta_S_2S__;
end;%if flag_dtau;
if flag_dtau_dtau;
dada_delta_X_2X__ = dada_delta_S_2S__;
dadb_delta_X_2X__ = dadb_delta_S_2S__;
dadc_delta_X_2X__ = dadc_delta_S_2S__;
dbdb_delta_X_2X__ = dbdb_delta_S_2S__;
dbdc_delta_X_2X__ = dbdc_delta_S_2S__;
dcdc_delta_X_2X__ = dcdc_delta_S_2S__;
end;%if flag_dtau_dtau;
end;%if tab_XS==1;
if tab_XT==1;
phi_X = phi_T;
v_source_X_ = v_source_T_;
delta_X_2X__ = delta_T_2T__;
if flag_dtau;
da_delta_X_2X__ = da_delta_T_2T__;
db_delta_X_2X__ = db_delta_T_2T__;
dc_delta_X_2X__ = dc_delta_T_2T__;
end;%if flag_dtau;
if flag_dtau_dtau;
dada_delta_X_2X__ = dada_delta_T_2T__;
dadb_delta_X_2X__ = dadb_delta_T_2T__;
dadc_delta_X_2X__ = dadc_delta_T_2T__;
dbdb_delta_X_2X__ = dbdb_delta_T_2T__;
dbdc_delta_X_2X__ = dbdc_delta_T_2T__;
dcdc_delta_X_2X__ = dcdc_delta_T_2T__;
end;%if flag_dtau_dtau;
end;%if tab_XS==1;
if tab_XM==1;
phi_X = phi_M;
v_source_X_ = v_source_M_;
delta_X_2X__ = delta_M_2M__;
if flag_dtau;
da_delta_X_2X__ = zeros(2,n_source_X);
db_delta_X_2X__ = zeros(2,n_source_X);
dc_delta_X_2X__ = zeros(2,n_source_X);
end;%if flag_dtau;
if flag_dtau_dtau;
dada_delta_X_2X__ = zeros(2,n_source_X);
dadb_delta_X_2X__ = zeros(2,n_source_X);
dadc_delta_X_2X__ = zeros(2,n_source_X);
dbdb_delta_X_2X__ = zeros(2,n_source_X);
dbdc_delta_X_2X__ = zeros(2,n_source_X);
dcdc_delta_X_2X__ = zeros(2,n_source_X);
end;%if flag_dtau_dtau;
end;%if tab_XM==1;
%%%%%%%%;
n_source_Y = tab_YS*n_source_S + tab_YT*n_source_T + tab_YM*n_source_M;
if tab_YS==1;
phi_Y = phi_S;
v_source_Y_ = v_source_S_;
delta_Y_2Y__ = delta_S_2S__;
if flag_dtau;
da_delta_Y_2Y__ = da_delta_S_2S__;
db_delta_Y_2Y__ = db_delta_S_2S__;
dc_delta_Y_2Y__ = dc_delta_S_2S__;
end;%if flag_dtau;
if flag_dtau_dtau;
dada_delta_Y_2Y__ = dada_delta_S_2S__;
dadb_delta_Y_2Y__ = dadb_delta_S_2S__;
dadc_delta_Y_2Y__ = dadc_delta_S_2S__;
dbdb_delta_Y_2Y__ = dbdb_delta_S_2S__;
dbdc_delta_Y_2Y__ = dbdc_delta_S_2S__;
dcdc_delta_Y_2Y__ = dcdc_delta_S_2S__;
end;%if flag_dtau_dtau;
end;%if tab_YS==1;
if tab_YT==1;
phi_Y = phi_T;
v_source_Y_ = v_source_T_;
delta_Y_2Y__ = delta_T_2T__;
if flag_dtau;
da_delta_Y_2Y__ = da_delta_T_2T__;
db_delta_Y_2Y__ = db_delta_T_2T__;
dc_delta_Y_2Y__ = dc_delta_T_2T__;
end;%if flag_dtau;
if flag_dtau_dtau;
dada_delta_Y_2Y__ = dada_delta_T_2T__;
dadb_delta_Y_2Y__ = dadb_delta_T_2T__;
dadc_delta_Y_2Y__ = dadc_delta_T_2T__;
dbdb_delta_Y_2Y__ = dbdb_delta_T_2T__;
dbdc_delta_Y_2Y__ = dbdc_delta_T_2T__;
dcdc_delta_Y_2Y__ = dcdc_delta_T_2T__;
end;%if flag_dtau_dtau;
end;%if tab_YT==1;
if tab_YM==1;
phi_Y = phi_M;
v_source_Y_ = v_source_M_;
delta_Y_2Y__ = delta_M_2M__;
if flag_dtau;
da_delta_Y_2Y__ = zeros(2,n_source_Y);
db_delta_Y_2Y__ = zeros(2,n_source_Y);
dc_delta_Y_2Y__ = zeros(2,n_source_Y);
end;%if flag_dtau;
if flag_dtau_dtau;
dada_delta_Y_2Y__ = zeros(2,n_source_Y);
dadb_delta_Y_2Y__ = zeros(2,n_source_Y);
dadc_delta_Y_2Y__ = zeros(2,n_source_Y);
dbdb_delta_Y_2Y__ = zeros(2,n_source_Y);
dbdc_delta_Y_2Y__ = zeros(2,n_source_Y);
dcdc_delta_Y_2Y__ = zeros(2,n_source_Y);
end;%if flag_dtau_dtau;
end;%if tab_YM==1;
%%%%%%%%;
%%%%%%%%%%%%%%%%;
%%%%%%%%;
for nsource_X=0:n_source_X-1;
v_source_X = v_source_X_(1+nsource_X);
delta_X_ = delta_X_2X__(:,1+nsource_X);
if flag_dtau;
da_delta_X_ = da_delta_X_2X__(:,1+nsource_X);
db_delta_X_ = db_delta_X_2X__(:,1+nsource_X);
dc_delta_X_ = dc_delta_X_2X__(:,1+nsource_X);
end;%if flag_dtau;
if flag_dtau_dtau;
dada_delta_X_ = dada_delta_X_2X__(:,1+nsource_X);
dadb_delta_X_ = dadb_delta_X_2X__(:,1+nsource_X);
dadc_delta_X_ = dadc_delta_X_2X__(:,1+nsource_X);
dbdb_delta_X_ = dbdb_delta_X_2X__(:,1+nsource_X);
dbdc_delta_X_ = dbdc_delta_X_2X__(:,1+nsource_X);
dcdc_delta_X_ = dcdc_delta_X_2X__(:,1+nsource_X);
end;%if flag_dtau_dtau;
for nsource_Y=0:n_source_Y-1;
v_source_Y = v_source_Y_(1+nsource_Y);
delta_Y_ = delta_Y_2Y__(:,1+nsource_Y);
if flag_dtau;
da_delta_Y_ = da_delta_Y_2Y__(:,1+nsource_Y);
db_delta_Y_ = db_delta_Y_2Y__(:,1+nsource_Y);
dc_delta_Y_ = dc_delta_Y_2Y__(:,1+nsource_Y);
end;%if flag_dtau;
if flag_dtau_dtau;
dada_delta_Y_ = dada_delta_Y_2Y__(:,1+nsource_Y);
dadb_delta_Y_ = dadb_delta_Y_2Y__(:,1+nsource_Y);
dadc_delta_Y_ = dadc_delta_Y_2Y__(:,1+nsource_Y);
dbdb_delta_Y_ = dbdb_delta_Y_2Y__(:,1+nsource_Y);
dbdc_delta_Y_ = dbdc_delta_Y_2Y__(:,1+nsource_Y);
dcdc_delta_Y_ = dcdc_delta_Y_2Y__(:,1+nsource_Y);
end;%if flag_dtau_dtau;
%%%%;
if  flag_1 & ~flag_dtau & ~flag_dtau_dtau;
[ ...
 output ...
] = ...
I_xPPx_0( ...
 K ...
,phi_X ...
,delta_X_ ...
,phi_Y ...
,delta_Y_ ...
);
end;%if  flag_1 & ~flag_dtau & ~flag_dtau_dtau;
%%%%;
if  flag_1 &  flag_dtau & ~flag_dtau_dtau;
[ ...
 output ...
,dX0_output ...
,dX1_output ...
,dY0_output ...
,dY1_output ...
] = ...
I_xPPx_0( ...
 K ...
,phi_X ...
,delta_X_ ...
,phi_Y ...
,delta_Y_ ...
);
end;%if  flag_1 &  flag_dtau & ~flag_dtau_dtau;
%%%%;
if  flag_1 &  flag_dtau &  flag_dtau_dtau;
[ ...
 output ...
,dX0_output ...
,dX1_output ...
,dY0_output ...
,dY1_output ...
,dX0dX0_output ...
,dX0dX1_output ...
,dX1dX0_output ...
,dX1dX1_output ...
,dX0dY0_output ...
,dX0dY1_output ...
,dX1dY0_output ...
,dX1dY1_output ...
,dY0dX0_output ...
,dY0dX1_output ...
,dY1dX0_output ...
,dY1dX1_output ...
,dY0dY0_output ...
,dY0dY1_output ...
,dY1dY0_output ...
,dY1dY1_output ...
] = ...
I_xPPx_0( ...
 K ...
,phi_X ...
,delta_X_ ...
,phi_Y ...
,delta_Y_ ...
);
end;%if  flag_1 &  flag_dtau &  flag_dtau_dtau;
%%%%;
%%%%%%%%;
%%%%;
da_output = 0.0;
db_output = 0.0;
dc_output = 0.0;
dada_output = 0.0;
dadb_output = 0.0;
dadc_output = 0.0;
dbdb_output = 0.0;
dbdc_output = 0.0;
dcdc_output = 0.0;
%%%%;
if tab_ssnll;                     ssnll =           ssnll +     0.5*tab_sgn * v_source_X * v_source_Y * output; end;
if tab_dvol_ssnll;           dvol_ssnll =      dvol_ssnll +     0.5*tab_sgn * v_source_X * v_source_Y * output; end;
if tab_dvol_dvol_ssnll; dvol_dvol_ssnll = dvol_dvol_ssnll + 2.0*0.5*tab_sgn * v_source_X * v_source_Y * output; end;
%%%%;
if flag_dtau;
da_output = da_output ...
 + dX0_output*da_delta_X_(1+0) + dX1_output*da_delta_X_(1+1) ...
 + dY0_output*da_delta_Y_(1+0) + dY1_output*da_delta_Y_(1+1) ...
;
db_output = db_output ...
 + dX0_output*db_delta_X_(1+0) + dX1_output*db_delta_X_(1+1) ...
 + dY0_output*db_delta_Y_(1+0) + dY1_output*db_delta_Y_(1+1) ...
;
dc_output = dc_output ...
 + dX0_output*dc_delta_X_(1+0) + dX1_output*dc_delta_X_(1+1) ...
 + dY0_output*dc_delta_Y_(1+0) + dY1_output*dc_delta_Y_(1+1) ...
;
if tab_ssnll;
da_ssnll = da_ssnll + 0.5*tab_sgn * v_source_X * v_source_Y * da_output;
db_ssnll = db_ssnll + 0.5*tab_sgn * v_source_X * v_source_Y * db_output;
dc_ssnll = dc_ssnll + 0.5*tab_sgn * v_source_X * v_source_Y * dc_output;
end;%if tab_ssnll;
if tab_dvol_ssnll;
da_dvol_ssnll = da_dvol_ssnll + 0.5*tab_sgn * v_source_X * v_source_Y * da_output;
db_dvol_ssnll = db_dvol_ssnll + 0.5*tab_sgn * v_source_X * v_source_Y * db_output;
dc_dvol_ssnll = dc_dvol_ssnll + 0.5*tab_sgn * v_source_X * v_source_Y * dc_output;
end;%if tab_dvol_ssnll;
if tab_dvol_dvol_ssnll;
% do nothing. ;
end;%if tab_dvol_dvol_ssnll;
end;%if flag_dtau;
if flag_dtau_dtau;
%%%%;
dada_output = dada_output ...
 + dX0_output*dada_delta_X_(1+0) ...
 + dX0dX0_output*da_delta_X_(1+0)*da_delta_X_(1+0) ...
 + dX1dX0_output*da_delta_X_(1+1)*da_delta_X_(1+0) ...
 + dY0dX0_output*da_delta_Y_(1+0)*da_delta_X_(1+0) ...
 + dY1dX0_output*da_delta_Y_(1+1)*da_delta_X_(1+0) ...
 + dX1_output*dada_delta_X_(1+1) ...
 + dX0dX1_output*da_delta_X_(1+0)*da_delta_X_(1+1) ...
 + dX1dX1_output*da_delta_X_(1+1)*da_delta_X_(1+1) ...
 + dY0dX1_output*da_delta_Y_(1+0)*da_delta_X_(1+1) ...
 + dY1dX1_output*da_delta_Y_(1+1)*da_delta_X_(1+1) ...
 + dY0_output*dada_delta_Y_(1+0) ...
 + dX0dY0_output*da_delta_X_(1+0)*da_delta_Y_(1+0) ...
 + dX1dY0_output*da_delta_X_(1+1)*da_delta_Y_(1+0) ...
 + dY0dY0_output*da_delta_Y_(1+0)*da_delta_Y_(1+0) ...
 + dY1dY0_output*da_delta_Y_(1+1)*da_delta_Y_(1+0) ...
 + dY1_output*dada_delta_Y_(1+1) ...
 + dX0dY1_output*da_delta_X_(1+0)*da_delta_Y_(1+1) ...
 + dX1dY1_output*da_delta_X_(1+1)*da_delta_Y_(1+1) ...
 + dY0dY1_output*da_delta_Y_(1+0)*da_delta_Y_(1+1) ...
 + dY1dY1_output*da_delta_Y_(1+1)*da_delta_Y_(1+1) ...
;
%%%%;
dadb_output = dadb_output ...
 + dX0_output*dadb_delta_X_(1+0) ...
 + dX0dX0_output*da_delta_X_(1+0)*db_delta_X_(1+0) ...
 + dX1dX0_output*da_delta_X_(1+1)*db_delta_X_(1+0) ...
 + dY0dX0_output*da_delta_Y_(1+0)*db_delta_X_(1+0) ...
 + dY1dX0_output*da_delta_Y_(1+1)*db_delta_X_(1+0) ...
 + dX1_output*dadb_delta_X_(1+1) ...
 + dX0dX1_output*da_delta_X_(1+0)*db_delta_X_(1+1) ...
 + dX1dX1_output*da_delta_X_(1+1)*db_delta_X_(1+1) ...
 + dY0dX1_output*da_delta_Y_(1+0)*db_delta_X_(1+1) ...
 + dY1dX1_output*da_delta_Y_(1+1)*db_delta_X_(1+1) ...
 + dY0_output*dadb_delta_Y_(1+0) ...
 + dX0dY0_output*da_delta_X_(1+0)*db_delta_Y_(1+0) ...
 + dX1dY0_output*da_delta_X_(1+1)*db_delta_Y_(1+0) ...
 + dY0dY0_output*da_delta_Y_(1+0)*db_delta_Y_(1+0) ...
 + dY1dY0_output*da_delta_Y_(1+1)*db_delta_Y_(1+0) ...
 + dY1_output*dadb_delta_Y_(1+1) ...
 + dX0dY1_output*da_delta_X_(1+0)*db_delta_Y_(1+1) ...
 + dX1dY1_output*da_delta_X_(1+1)*db_delta_Y_(1+1) ...
 + dY0dY1_output*da_delta_Y_(1+0)*db_delta_Y_(1+1) ...
 + dY1dY1_output*da_delta_Y_(1+1)*db_delta_Y_(1+1) ...
;
%%%%;
dadc_output = dadc_output ...
 + dX0_output*dadc_delta_X_(1+0) ...
 + dX0dX0_output*da_delta_X_(1+0)*dc_delta_X_(1+0) ...
 + dX1dX0_output*da_delta_X_(1+1)*dc_delta_X_(1+0) ...
 + dY0dX0_output*da_delta_Y_(1+0)*dc_delta_X_(1+0) ...
 + dY1dX0_output*da_delta_Y_(1+1)*dc_delta_X_(1+0) ...
 + dX1_output*dadc_delta_X_(1+1) ...
 + dX0dX1_output*da_delta_X_(1+0)*dc_delta_X_(1+1) ...
 + dX1dX1_output*da_delta_X_(1+1)*dc_delta_X_(1+1) ...
 + dY0dX1_output*da_delta_Y_(1+0)*dc_delta_X_(1+1) ...
 + dY1dX1_output*da_delta_Y_(1+1)*dc_delta_X_(1+1) ...
 + dY0_output*dadc_delta_Y_(1+0) ...
 + dX0dY0_output*da_delta_X_(1+0)*dc_delta_Y_(1+0) ...
 + dX1dY0_output*da_delta_X_(1+1)*dc_delta_Y_(1+0) ...
 + dY0dY0_output*da_delta_Y_(1+0)*dc_delta_Y_(1+0) ...
 + dY1dY0_output*da_delta_Y_(1+1)*dc_delta_Y_(1+0) ...
 + dY1_output*dadc_delta_Y_(1+1) ...
 + dX0dY1_output*da_delta_X_(1+0)*dc_delta_Y_(1+1) ...
 + dX1dY1_output*da_delta_X_(1+1)*dc_delta_Y_(1+1) ...
 + dY0dY1_output*da_delta_Y_(1+0)*dc_delta_Y_(1+1) ...
 + dY1dY1_output*da_delta_Y_(1+1)*dc_delta_Y_(1+1) ...
;
%%%%;
dbdb_output = dbdb_output ...
 + dX0_output*dbdb_delta_X_(1+0) ...
 + dX0dX0_output*db_delta_X_(1+0)*db_delta_X_(1+0) ...
 + dX1dX0_output*db_delta_X_(1+1)*db_delta_X_(1+0) ...
 + dY0dX0_output*db_delta_Y_(1+0)*db_delta_X_(1+0) ...
 + dY1dX0_output*db_delta_Y_(1+1)*db_delta_X_(1+0) ...
 + dX1_output*dbdb_delta_X_(1+1) ...
 + dX0dX1_output*db_delta_X_(1+0)*db_delta_X_(1+1) ...
 + dX1dX1_output*db_delta_X_(1+1)*db_delta_X_(1+1) ...
 + dY0dX1_output*db_delta_Y_(1+0)*db_delta_X_(1+1) ...
 + dY1dX1_output*db_delta_Y_(1+1)*db_delta_X_(1+1) ...
 + dY0_output*dbdb_delta_Y_(1+0) ...
 + dX0dY0_output*db_delta_X_(1+0)*db_delta_Y_(1+0) ...
 + dX1dY0_output*db_delta_X_(1+1)*db_delta_Y_(1+0) ...
 + dY0dY0_output*db_delta_Y_(1+0)*db_delta_Y_(1+0) ...
 + dY1dY0_output*db_delta_Y_(1+1)*db_delta_Y_(1+0) ...
 + dY1_output*dbdb_delta_Y_(1+1) ...
 + dX0dY1_output*db_delta_X_(1+0)*db_delta_Y_(1+1) ...
 + dX1dY1_output*db_delta_X_(1+1)*db_delta_Y_(1+1) ...
 + dY0dY1_output*db_delta_Y_(1+0)*db_delta_Y_(1+1) ...
 + dY1dY1_output*db_delta_Y_(1+1)*db_delta_Y_(1+1) ...
;
%%%%;
dbdc_output = dbdc_output ...
 + dX0_output*dbdc_delta_X_(1+0) ...
 + dX0dX0_output*db_delta_X_(1+0)*dc_delta_X_(1+0) ...
 + dX1dX0_output*db_delta_X_(1+1)*dc_delta_X_(1+0) ...
 + dY0dX0_output*db_delta_Y_(1+0)*dc_delta_X_(1+0) ...
 + dY1dX0_output*db_delta_Y_(1+1)*dc_delta_X_(1+0) ...
 + dX1_output*dbdc_delta_X_(1+1) ...
 + dX0dX1_output*db_delta_X_(1+0)*dc_delta_X_(1+1) ...
 + dX1dX1_output*db_delta_X_(1+1)*dc_delta_X_(1+1) ...
 + dY0dX1_output*db_delta_Y_(1+0)*dc_delta_X_(1+1) ...
 + dY1dX1_output*db_delta_Y_(1+1)*dc_delta_X_(1+1) ...
 + dY0_output*dbdc_delta_Y_(1+0) ...
 + dX0dY0_output*db_delta_X_(1+0)*dc_delta_Y_(1+0) ...
 + dX1dY0_output*db_delta_X_(1+1)*dc_delta_Y_(1+0) ...
 + dY0dY0_output*db_delta_Y_(1+0)*dc_delta_Y_(1+0) ...
 + dY1dY0_output*db_delta_Y_(1+1)*dc_delta_Y_(1+0) ...
 + dY1_output*dbdc_delta_Y_(1+1) ...
 + dX0dY1_output*db_delta_X_(1+0)*dc_delta_Y_(1+1) ...
 + dX1dY1_output*db_delta_X_(1+1)*dc_delta_Y_(1+1) ...
 + dY0dY1_output*db_delta_Y_(1+0)*dc_delta_Y_(1+1) ...
 + dY1dY1_output*db_delta_Y_(1+1)*dc_delta_Y_(1+1) ...
;
%%%%;
dcdc_output = dcdc_output ...
 + dX0_output*dcdc_delta_X_(1+0) ...
 + dX0dX0_output*dc_delta_X_(1+0)*dc_delta_X_(1+0) ...
 + dX1dX0_output*dc_delta_X_(1+1)*dc_delta_X_(1+0) ...
 + dY0dX0_output*dc_delta_Y_(1+0)*dc_delta_X_(1+0) ...
 + dY1dX0_output*dc_delta_Y_(1+1)*dc_delta_X_(1+0) ...
 + dX1_output*dcdc_delta_X_(1+1) ...
 + dX0dX1_output*dc_delta_X_(1+0)*dc_delta_X_(1+1) ...
 + dX1dX1_output*dc_delta_X_(1+1)*dc_delta_X_(1+1) ...
 + dY0dX1_output*dc_delta_Y_(1+0)*dc_delta_X_(1+1) ...
 + dY1dX1_output*dc_delta_Y_(1+1)*dc_delta_X_(1+1) ...
 + dY0_output*dcdc_delta_Y_(1+0) ...
 + dX0dY0_output*dc_delta_X_(1+0)*dc_delta_Y_(1+0) ...
 + dX1dY0_output*dc_delta_X_(1+1)*dc_delta_Y_(1+0) ...
 + dY0dY0_output*dc_delta_Y_(1+0)*dc_delta_Y_(1+0) ...
 + dY1dY0_output*dc_delta_Y_(1+1)*dc_delta_Y_(1+0) ...
 + dY1_output*dcdc_delta_Y_(1+1) ...
 + dX0dY1_output*dc_delta_X_(1+0)*dc_delta_Y_(1+1) ...
 + dX1dY1_output*dc_delta_X_(1+1)*dc_delta_Y_(1+1) ...
 + dY0dY1_output*dc_delta_Y_(1+0)*dc_delta_Y_(1+1) ...
 + dY1dY1_output*dc_delta_Y_(1+1)*dc_delta_Y_(1+1) ...
;
%%%%;
if tab_ssnll;
dada_ssnll = dada_ssnll + 0.5*tab_sgn * v_source_X * v_source_Y * dada_output;
dadb_ssnll = dadb_ssnll + 0.5*tab_sgn * v_source_X * v_source_Y * dadb_output;
dadc_ssnll = dadc_ssnll + 0.5*tab_sgn * v_source_X * v_source_Y * dadc_output;
dbdb_ssnll = dbdb_ssnll + 0.5*tab_sgn * v_source_X * v_source_Y * dbdb_output;
dbdc_ssnll = dbdc_ssnll + 0.5*tab_sgn * v_source_X * v_source_Y * dbdc_output;
dcdc_ssnll = dcdc_ssnll + 0.5*tab_sgn * v_source_X * v_source_Y * dcdc_output;
end;%if tab_ssnll;
if tab_dvol_ssnll;
% do nothing. ;
end;%if tab_dvol_ssnll;
if tab_dvol_dvol_ssnll;
% do nothing. ;
end;%if tab_dvol_dvol_ssnll;
%%%%;
end;%if flag_dtau_dtau;
%%%%%%%%;
%%%%%%%%%%%%%%%%;
%%%%%%%%;
end;%for nsource_Y=0:n_source_Y-1;
end;%for nsource_X=0:n_source_X-1;
%%%%%%%%%%%%%%%%;
end;end;%for ntype_X=0:3-1; for ntype_Y=0:3-1;
%%%%%%%%%%%%%%%%;
