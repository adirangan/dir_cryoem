%%%%%%%%;
% Now try to load the data: ;
%%%%%%%%;
N_pixel_ = 0.125:0.125:5.0;
E_rel__ = cell(length(N_pixel_),1);
n_svd_l__ = cell(length(N_pixel_),1);
F_rel__ = cell(length(N_pixel_),1);
n_node__ = cell(length(N_pixel_),1);
np_sum = 0;
for np=1:length(N_pixel_);
N_pixel = N_pixel_(np);
fname_base = sprintf('EvsF_N%.2d',round(10*N_pixel));
fname_mat = sprintf('./dir_svd/%s.mat',fname_base);
if (~exist(fname_mat,'file'));
disp(sprintf(' %% could not find %s',fname_mat));
test_F_22(N_pixel);
else;%if (~exist(fname_mat,'file'));
%disp(sprintf(' %% loading %s',fname_mat));
load(fname_mat,'n_svd_l_','E_rel_','n_node_','F_rel_','N_pixel');
E_rel__{np} = transpose(E_rel_); F_rel__{np} = transpose(F_rel_);
n_svd_l__{np} = transpose(n_svd_l_); n_node__{np} = (n_node_);
np_sum = np_sum + 1;
end;%if (exist(fname_mat,'file'));
end;%for np=1:length(N_pixel_);
%%%%%%%%;

%%%%%%%%;
% Now plot the data. ;
%%%%%%%%;
E_rel_ = cell2mat(E_rel__); F_rel_ = cell2mat(F_rel__);
n_svd_l_ = cell2mat(n_svd_l__); n_node_ = cell2mat(n_node__);
%%%%%%%%;
E_p0_ = zeros(length(N_pixel_),1); E_p1_ = zeros(length(N_pixel_),1); % linear regression. ;
for np=1:length(N_pixel_);
tmp_x_ = n_svd_l_(np,:);
tmp_y_ = log10(E_rel_(np,:));
tmp_A_ = [dot(tmp_x_,tmp_x_) , sum(tmp_x_) ; sum(tmp_x_) , length(tmp_x_)] \ [dot(tmp_x_,tmp_y_) ; sum(tmp_y_)];
E_p1_(np) = tmp_A_(1); E_p0_(np) = tmp_A_(2);
end;%for np=1:length(N_pixel_);
flag_disp=0;
if flag_disp;
figure; 
hold on;
c_ = colormap(colormap_beach(64)); n_c = size(c_,1);
for np=1:length(N_pixel_);
nb = max(1,min(n_c,floor(n_c*np/length(N_pixel_))));
plot(n_svd_l_(np,:),log10(E_rel_(np,:)),'o','Color',c_(nb,:));
plot(n_svd_l_(np,:),E_p0_(np) + E_p1_(np)*n_svd_l_(np,:),'.-','Color',c_(nb,:));
end;%for np=1:length(N_pixel_);
hold off;
end;%if flag_disp;
%%%%%%%%;
F_p0_ = zeros(length(N_pixel_),1); F_p1_ = zeros(length(N_pixel_),1); % linear regression. ;
for np=1:length(N_pixel_);
tmp_x_ = log10(1+pi*(n_node_(np,:)-1).^2);
tmp_y_ = log10(F_rel_(np,:));
tmp_A_ = [dot(tmp_x_,tmp_x_) , sum(tmp_x_) ; sum(tmp_x_) , length(tmp_x_)] \ [dot(tmp_x_,tmp_y_) ; sum(tmp_y_)];
F_p1_(np) = tmp_A_(1); F_p0_(np) = tmp_A_(2);
end;%for np=1:length(N_pixel_);
flag_disp=0;
if flag_disp;
figure; 
hold on;
c_ = colormap(colormap_beach(64)); n_c = size(c_,1);
for np=1:length(N_pixel_);
nb = max(1,min(n_c,floor(n_c*np/length(N_pixel_))));
tmp_x = log10(1+pi*(n_node_(np,:)-1).^2);
plot(tmp_x,log10(F_rel_(np,:)),'o','Color',c_(nb,:));
plot(tmp_x,F_p0_(np) + F_p1_(np)*tmp_x,'.-','Color',c_(nb,:));
end;%for np=1:length(N_pixel_);
hold off;
end;%if flag_disp;
%%%%%%%%;
l10E_ = -(0:0.25:6);
E_nterms_ = zeros(length(l10E_),length(N_pixel_));
for ne=1:length(l10E_);
l10E = l10E_(ne);
for np=1:length(N_pixel_);
N_pixel = N_pixel_(np);
E_nterms_(ne,np) = max(1,ceil((l10E - E_p0_(np))/E_p1_(np)));
end;%for np=1:length(N_pixel_);
end;%for ne=1:length(l10E_);
%%%%%%%%;
l10F_ = -(0:0.25:6);
F_nterms_ = zeros(length(l10F_),length(N_pixel_));
for ne=1:length(l10F_);
l10F = l10F_(ne);
for np=1:length(N_pixel_);
N_pixel = N_pixel_(np);
F_nterms_(ne,np) = max(1,ceil(10.^((l10F - F_p0_(np))/F_p1_(np))));
end;%for np=1:length(N_pixel_);
end;%for ne=1:length(l10F_);

%%%%%%%%;
% Now plot the data. ;
%%%%%%%%;
flag_disp=1;
if flag_disp;
colormap('hot');%colormap(colormap_beach(65));
%%%%%%%%;
subplot(3,1,1);
imagesc(log10(E_nterms_),[0,8]); 
title(sprintf('SVD-expansion'));
tmp_ij_ = 4:4:length(N_pixel_); tmp_label = num2str(transpose(N_pixel_(tmp_ij_)),'%0.1f');
set(gca,'XTick',tmp_ij_,'XTickLabel',tmp_label); xtickangle(gca,90); 
xlabel('N Pixel');
tmp_ij_ = 1:4:length(l10E_); tmp_label = num2str(transpose(l10E_(tmp_ij_)),'%d');
set(gca,'YTick',tmp_ij_,'YTickLabel',tmp_label); 
ylabel('log10(E)');
set(gca,'TickLength',[0 0])
c = colorbar; c.Label.String = 'log10(Nterms)';
%%%%%%%%;
subplot(3,1,2);
imagesc(log10(F_nterms_),[0,8]); 
title(sprintf('Linear-Interpolation'));
tmp_ij_ = 4:4:length(N_pixel_); tmp_label = num2str(transpose(N_pixel_(tmp_ij_)),'%0.1f');
set(gca,'XTick',tmp_ij_,'XTickLabel',tmp_label); xtickangle(gca,90); 
xlabel('N Pixel');
tmp_ij_ = 1:4:length(l10E_); tmp_label = num2str(transpose(l10E_(tmp_ij_)),'%d');
set(gca,'YTick',tmp_ij_,'YTickLabel',tmp_label); 
ylabel('log10(E)');
set(gca,'TickLength',[0 0])
c = colorbar; c.Label.String = 'log10(Nterms)';
%%%%%%%%;
subplot(3,1,3);
imagesc(log10(F_nterms_./E_nterms_),[0,5]); 
title(sprintf('Ratio'));
tmp_ij_ = 4:4:length(N_pixel_); tmp_label = num2str(transpose(N_pixel_(tmp_ij_)),'%0.1f');
set(gca,'XTick',tmp_ij_,'XTickLabel',tmp_label); xtickangle(gca,90); 
xlabel('N Pixel');
tmp_ij_ = 1:4:length(l10E_); tmp_label = num2str(transpose(l10E_(tmp_ij_)),'%d');
set(gca,'YTick',tmp_ij_,'YTickLabel',tmp_label); 
ylabel('log10(E)');
set(gca,'TickLength',[0 0])
c = colorbar; c.Label.String = 'log10(Ratio)';
%%%%%%%%;
set(gcf,'Position',1+[0,0,768,1024]);
%%%%%%%%;
fname_fig = sprintf('./dir_svd/EvsF_FigA',fname_base);
print('-depsc',sprintf('%s.eps',fname_fig));
print('-djpeg',sprintf('%s.jpg',fname_fig));
end;%if flag_disp;

%%%%%%%%;
% Sanity check;
%%%%%%%%;
flag_disp=0;
if flag_disp;
np = find(N_pixel_==0.5);subplot(2,2,1);plot(log10(n_svd_l_(np,:)),log10(E_rel_(np,:)),'ro-',log10(1+pi*(n_node_(np,:)-1).^2),log10(F_rel_(np,:)),'bo-'); title(sprintf('N_pixel %f',N_pixel_(np)));
np = find(N_pixel_==1.5);subplot(2,2,2);plot(log10(n_svd_l_(np,:)),log10(E_rel_(np,:)),'ro-',log10(1+pi*(n_node_(np,:)-1).^2),log10(F_rel_(np,:)),'bo-'); title(sprintf('N_pixel %f',N_pixel_(np)));
np = find(N_pixel_==2.5);subplot(2,2,3);plot(log10(n_svd_l_(np,:)),log10(E_rel_(np,:)),'ro-',log10(1+pi*(n_node_(np,:)-1).^2),log10(F_rel_(np,:)),'bo-'); title(sprintf('N_pixel %f',N_pixel_(np)));
np = find(N_pixel_==3.5);subplot(2,2,4);plot(log10(n_svd_l_(np,:)),log10(E_rel_(np,:)),'ro-',log10(1+pi*(n_node_(np,:)-1).^2),log10(F_rel_(np,:)),'bo-'); title(sprintf('N_pixel %f',N_pixel_(np)));
end;%if flag_disp;
