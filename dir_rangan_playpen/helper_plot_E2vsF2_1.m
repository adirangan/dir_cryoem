%%%%%%%%;
% Now try to load the data: ;
%%%%%%%%;
N_pixel_ = [0.125:0.125:5.0]*sqrt(2);
E2_rel__ = cell(length(N_pixel_),1);
n_svd_l__ = cell(length(N_pixel_),1);
F2_rel__ = cell(length(N_pixel_),1);
n_node__ = cell(length(N_pixel_),1);
np_sum = 0;
for np=1:length(N_pixel_);
N_pixel = N_pixel_(np);
fname_base = sprintf('E2vsF2_N%.2d',round(10*N_pixel));
fname_mat = sprintf('./dir_svd/%s.mat',fname_base);
if (~exist(fname_mat,'file'));
disp(sprintf(' %% could not find %s',fname_mat));
test_F_23d(N_pixel);
else;%if (~exist(fname_mat,'file'));
%disp(sprintf(' %% loading %s',fname_mat));
load(fname_mat,'n_svd_l_','E2_rel_','n_node_','F2_rel_','N_pixel');
E2_rel__{np} = transpose(sqrt(E2_rel_)); F2_rel__{np} = transpose(sqrt(F2_rel_));
n_svd_l__{np} = transpose(n_svd_l_); n_node__{np} = (n_node_);
np_sum = np_sum + 1;
end;%if (exist(fname_mat,'file'));
end;%for np=1:length(N_pixel_);
%%%%%%%%;

%%%%%%%%;
% Now plot the data. ;
%%%%%%%%;
E2_rel_ = cell2mat(E2_rel__); F2_rel_ = cell2mat(F2_rel__);
n_svd_l_ = cell2mat(n_svd_l__); n_node_ = cell2mat(n_node__);
%%%%%%%%;
E2_p0_ = zeros(length(N_pixel_),1); E2_p1_ = zeros(length(N_pixel_),1); % linear regression. ;
for np=1:length(N_pixel_);
tmp_x_ = n_svd_l_(np,:);
tmp_y_ = log10(E2_rel_(np,:));
tmp_A_ = [dot(tmp_x_,tmp_x_) , sum(tmp_x_) ; sum(tmp_x_) , length(tmp_x_)] \ [dot(tmp_x_,tmp_y_) ; sum(tmp_y_)];
E2_p1_(np) = tmp_A_(1); E2_p0_(np) = tmp_A_(2);
end;%for np=1:length(N_pixel_);
flag_disp=0;
if flag_disp;
figure; 
hold on;
c_ = colormap(colormap_beach(64)); n_c = size(c_,1);
for np=1:length(N_pixel_);
nb = max(1,min(n_c,floor(n_c*np/length(N_pixel_))));
plot(n_svd_l_(np,:),log10(E2_rel_(np,:)),'o','Color',c_(nb,:));
plot(n_svd_l_(np,:),E2_p0_(np) + E2_p1_(np)*n_svd_l_(np,:),'.-','Color',c_(nb,:));
end;%for np=1:length(N_pixel_);
hold off;
disp('returning');return;
end;%if flag_disp;
%%%%%%%%;
F2_p0_ = zeros(length(N_pixel_),1); F2_p1_ = zeros(length(N_pixel_),1); % linear regression. ;
for np=1:length(N_pixel_);
tmp_ij_ = 16:96;
tmp_x_ = log10(1+pi*(n_node_(np,tmp_ij_)-1).^2);
tmp_y_ = log10(F2_rel_(np,tmp_ij_));
tmp_A_ = [dot(tmp_x_,tmp_x_) , sum(tmp_x_) ; sum(tmp_x_) , length(tmp_x_)] \ [dot(tmp_x_,tmp_y_) ; sum(tmp_y_)];
F2_p1_(np) = tmp_A_(1); F2_p0_(np) = tmp_A_(2);
end;%for np=1:length(N_pixel_);
flag_disp=0;
if flag_disp;
figure; 
hold on;
c_ = colormap(colormap_beach(64)); n_c = size(c_,1);
for np=1:length(N_pixel_);
nb = max(1,min(n_c,floor(n_c*np/length(N_pixel_))));
tmp_x = log10(1+pi*(n_node_(np,:)-1).^2);
plot(tmp_x,log10(F2_rel_(np,:)),'o','Color',c_(nb,:));
plot(tmp_x,F2_p0_(np) + F2_p1_(np)*tmp_x,'.-','Color',c_(nb,:));
end;%for np=1:length(N_pixel_);
hold off;
disp('returning');return;
end;%if flag_disp;
%%%%%%%%;
l10E2_ = -(0:0.25:6);
E2_nterms_ = zeros(length(l10E2_),length(N_pixel_));
for ne=1:length(l10E2_);
l10E2 = l10E2_(ne);
for np=1:length(N_pixel_);
N_pixel = N_pixel_(np);
E2_nterms_(ne,np) = max(1,ceil((l10E2 - E2_p0_(np))/E2_p1_(np)));
end;%for np=1:length(N_pixel_);
end;%for ne=1:length(l10E2_);
%%%%%%%%;
l10F2_ = -(0:0.25:6);
F2_nterms_ = zeros(length(l10F2_),length(N_pixel_));
for ne=1:length(l10F2_);
l10F2 = l10F2_(ne);
for np=1:length(N_pixel_);
N_pixel = N_pixel_(np);
F2_nterms_(ne,np) = max(1,ceil(10.^((l10F2 - F2_p0_(np))/F2_p1_(np))));
end;%for np=1:length(N_pixel_);
end;%for ne=1:length(l10F2_);

%%%%%%%%;
% Now plot the data. ;
%%%%%%%%;
flag_disp=1;
if flag_disp;
c_=colormap('cool'); n_c = size(c_,1);
subplot(1,1,1); hold on;
tmp_ij_ = 4:4:40;
for nij=1:length(tmp_ij_);
np=tmp_ij_(nij); N_pixel=N_pixel_(np);
nc=max(1,min(n_c,floor(n_c*np/length(N_pixel_))));
plot(1.5 + nij*1.5/7 , 0.25 , 'o','Color',c_(nc,:),'MarkerSize',8,'MarkerFaceColor',c_(nc,:));
plot(1.5 + nij*1.5/7 , 0.35 , 's','Color',c_(nc,:),'MarkerSize',8,'MarkerFaceColor',c_(nc,:));
plot(-l10E2_,log10(E2_nterms_(:,np)),'-','Color',c_(nc,:),'LineWidth',3);
plot(-log10(E2_rel_(np,:)),log10(n_svd_l_(np,:)),'o','Color',c_(nc,:),'MarkerSize',8,'MarkerFaceColor',c_(nc,:));
plot(-l10F2_,log10(F2_nterms_(:,np)),'-','Color',c_(nc,:),'LineWidth',3);
tmp_nn_ = 8:8:96;
plot(-log10(F2_rel_(np,tmp_nn_)),log10(1 + pi*(n_node_(np,tmp_nn_)-1).^2),'s','Color',c_(nc,:),'MarkerSize',8,'MarkerFaceColor',c_(nc,:));
end;%for nij=1:length(tmp_ij_);
xlim([0.98,4.02]); ylim([0,4]);
xlabel('log_{10}(\epsilon^{-1})'); ylabel('log_{10}(H)');
set(gcf,'Position',1+[0,0,512,768]);
%%%%%%%%;
fname_fig = sprintf('./dir_svd/E2vsF2_FigA3');
print('-depsc',sprintf('%s.eps',fname_fig));
print('-djpeg',sprintf('%s.jpg',fname_fig));
disp('returning');return;
end;%if flag_disp;

%%%%%%%%;
% Now plot the data. ;
%%%%%%%%;
flag_disp=1;
if flag_disp;
colormap('hot');%colormap(colormap_beach(65));
%%%%%%%%;
subplot(3,1,1);
imagesc(log10(E2_nterms_),[0,8]); 
title(sprintf('SVD-expansion'));
tmp_ij_ = 4:4:length(N_pixel_); tmp_label = num2str(transpose((N_pixel_(tmp_ij_))/sqrt(2)),'%0.1f');
set(gca,'XTick',tmp_ij_,'XTickLabel',tmp_label); xtickangle(gca,90); 
xlabel('W');
tmp_ij_ = 1:4:length(l10E2_); tmp_label = num2str(transpose(l10E2_(tmp_ij_)),'%d');
set(gca,'YTick',tmp_ij_,'YTickLabel',tmp_label); 
ylabel('log10(E)');
set(gca,'TickLength',[0 0])
c = colorbar; c.Label.String = 'log10(Nterms)';
%%%%%%%%;
subplot(3,1,2);
imagesc(log10(F2_nterms_),[0,8]); 
title(sprintf('Linear-Interpolation'));
tmp_ij_ = 4:4:length(N_pixel_); tmp_label = num2str(transpose((N_pixel_(tmp_ij_))/sqrt(2)),'%0.1f');
set(gca,'XTick',tmp_ij_,'XTickLabel',tmp_label); xtickangle(gca,90); 
xlabel('W');
tmp_ij_ = 1:4:length(l10E2_); tmp_label = num2str(transpose(l10E2_(tmp_ij_)),'%d');
set(gca,'YTick',tmp_ij_,'YTickLabel',tmp_label); 
ylabel('log10(E)');
set(gca,'TickLength',[0 0])
c = colorbar; c.Label.String = 'log10(H)';
%%%%%%%%;
subplot(3,1,3);
imagesc(log10(F2_nterms_./E2_nterms_),[0,5]); 
title(sprintf('Ratio'));
tmp_ij_ = 4:4:length(N_pixel_); tmp_label = num2str(transpose((N_pixel_(tmp_ij_))/sqrt(2)),'%0.1f');
set(gca,'XTick',tmp_ij_,'XTickLabel',tmp_label); xtickangle(gca,90); 
xlabel('W');
tmp_ij_ = 1:4:length(l10E2_); tmp_label = num2str(transpose(l10E2_(tmp_ij_)),'%d');
set(gca,'YTick',tmp_ij_,'YTickLabel',tmp_label); 
ylabel('log10(E)');
set(gca,'TickLength',[0 0])
c = colorbar; c.Label.String = 'log10(Ratio)';
%%%%%%%%;
set(gcf,'Position',1+[0,0,768,1024]);
%%%%%%%%;
fname_fig = sprintf('./dir_svd/E2vsF2_FigA2');
print('-depsc',sprintf('%s.eps',fname_fig));
print('-djpeg',sprintf('%s.jpg',fname_fig));
disp('returning');return;
end;%if flag_disp;

