% test 2d-fourier transform ; 
% The tmplt S is perfectly centered ;
% The image M is slightly rotated and shifted ;

verbose=1;

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% ;
% generate tmplt S ;
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% ;
ng = 128; max_x_c = 1; max_k_c = ng/max_x_c; max_k_p = max_k_c/2;
% realspace carte grid ; 
grid_x_c = linspace(0,max_x_c,ng+1); grid_x_c = grid_x_c(1:end-1); d_x_c = mean(diff(grid_x_c));
% freqspace carte grid ; 
grid_k_c = (0:ng-1)/max_x_c; d_k_c = mean(diff(grid_k_c));
% xxxxspace qring grid ;
grid_q = (0:ng-1) ; max_q = ng; qlim = [-2,+2]; grid_q2 = grid_q; grid_q2(ng/2:end) = grid_q2(ng/2:end)-ng;
% realspace carte meshgrid ;
[X_x_c,Y_x_c] = meshgrid(grid_x_c,grid_x_c); X_x_c(:,ng/2+1:end) = X_x_c(:,ng/2+1:end)-max_x_c; Y_x_c(ng/2+1:end,:) = Y_x_c(ng/2+1:end,:)-max_x_c;
R_x_c = sqrt(X_x_c.^2 + Y_x_c.^2); W_x_c = atan2(Y_x_c,X_x_c);
% freqspace carte meshgrid ;
[X_k_c,Y_k_c] = meshgrid(grid_k_c,grid_k_c); X_k_c(:,ng/2+1:end) = X_k_c(:,ng/2+1:end)-max_k_c; Y_k_c(ng/2+1:end,:) = Y_k_c(ng/2+1:end,:)-max_k_c;
R_k_c = sqrt(X_k_c.^2 + Y_k_c.^2); W_k_c = atan2(Y_k_c,X_k_c);
% realspace polar meshgrid ;
grid_x_r = linspace(0,max_x_c/2,ng+1); grid_x_r = grid_x_r(1:end-1); grid_x_w = linspace(0,2*pi,ng+1); grid_x_w = grid_x_w(1:end-1); 
[R_x_p,W_x_p] = meshgrid(grid_x_r,grid_x_w);
% freqspace polar meshgrid ;
grid_k_r = linspace(0,max_k_p,ng+1); grid_k_r = grid_k_r(1:end-1); d_k_r = mean(diff(grid_k_r));
grid_k_w = linspace(0,2*pi,ng+1); grid_k_w = grid_k_w(1:end-1); d_k_w = mean(diff(grid_k_w));
[R_k_p,W_k_p] = meshgrid(grid_k_r,grid_k_w);
X_k_p = R_k_p.*cos(W_k_p); Y_k_p = R_k_p.*sin(W_k_p);
% set up tmplt on realspace carte meshgrid ;
%rng(1); 
rand("state",1);
tmp_h = 0.*X_x_c + 0.*Y_x_c;
for ni=1:16;
sx=0.05 + 0.05*rand();mx=rand()-0.5;sy=0.05 + 0.05*rand();my=rand()-0.5;
tmp_h = tmp_h + (1/16)*1/(2*pi*max_x_c*sx*max_x_c*sy)*exp(-(X_x_c - max_x_c*mx).^2/2/(max_x_c*sx).^2).*exp(-(Y_x_c - max_x_c*my).^2/2/(max_x_c*sy).^2);
end;%for ni=1:16;
tmp_crop = 0.5*(1+erf(-16.0*(R_x_c-0.25*(1 + 0.5*cos(5*W_x_c)))));
%tmp_crop = R_x_c<0.25*(1 + 0.5*cos(5*W_x_c));
S_x_c = tmp_crop.*tmp_h; Slim_x = max(0,mean(S_x_c(:)) + 1.0*std(S_x_c(:))*[-1,+1]);
L_S_x_c = sum(abs(S_x_c(:)).^2)*d_x_c*d_x_c;
% calculate tmplt values on realspace polar meshgrid ;
S_x_p = interp2(recenter(X_x_c),recenter(Y_x_c),recenter(S_x_c),R_x_p.*cos(W_x_p),R_x_p.*sin(W_x_p));
S_x_p(find(~isfinite(S_x_p)))=0;
% calculate tmplt values on realspace qring meshgrid ;
S_x_q = fft(S_x_p)/sqrt(ng);
% calculate tmplt values on freqspace carte meshgrid ;
S_k_c = fft2(S_x_c) * d_x_c*d_x_c; Slim_k  = mean(abs(S_k_c(:))) + 1.0*std(abs(S_k_c(:)))*[-1,+1];
L_S_k_c = sum(abs(S_k_c(:)).^2)*d_k_c*d_k_c;
S_tmp = ifft2(S_k_c)./d_x_c./d_x_c; L_S_tmp = sum(abs(S_tmp(:)).^2)*d_x_c*d_x_c;
% calculate tmplt falues on freqspace polar meshgrid ;
S_k_p = interp2(recenter(X_k_c),recenter(Y_k_c),recenter(S_k_c),X_k_p,Y_k_p);
S_k_p(find(~isfinite(S_k_p)))=0;
L_S_k_p = sum(sum(abs(S_k_p).^2 * diag(grid_k_r)))*d_k_r*d_k_w;
% calculate tmplt values on realspace qring meshgrid ;
S_k_q = fft(S_k_p)/sqrt(ng);
L_S_k_q = sum(sum(abs(S_k_q).^2 * diag(grid_k_r)))*d_k_r*d_k_w;
disp(sprintf(' %% L_S_x_c %f L_S_k_c %f L_S_k_p %f L_S_k_q %f',L_S_x_c,L_S_k_c,L_S_k_p,L_S_k_q));

disp_flag=0;
if disp_flag;
figure;
% plot tmplt in realspace ;
subplot(3,3,1);imagesc(recenter(real(S_x_c)),Slim_x);title('real(S_x_c)'); colorbar; set(gca,'Ydir','normal');
set(gca,'XTick',[1,ng/2+1,ng],'XTickLabel',[grid_x_c(1),grid_x_c(end/2+1),floor(10*grid_x_c(end))/10]-max_x_c/2);set(gca,'YTick',[1,ng/2+1,ng],'YTickLabel',[grid_x_c(1),grid_x_c(end/2+1),floor(10*grid_x_c(end))/10]-max_x_c/2);
subplot(3,3,4);polarpatch(R_x_p,W_x_p,S_x_p,Slim_x);title('real(S_x_p)'); c = colorbar; %set(c,'Ticks',0.025 + 0.95*linspace(0,1,4),'TickLabels',linspace(Slim_x(1),Slim_x(2),4));set(gca,'XTick',[],'Ytick',[]);
subplot(3,3,7);imagesc(abs(S_x_q([ng/2:ng,1:ng/2-1],:))); title('abs(S_x_q)'); colorbar; set(gca,'Ydir','normal'); set(gca,'XTick',[1,ng/2+1,ng],'XTickLabel',[0,grid_x_r(end/2+1),grid_x_r(end)]); set(gca,'YTick',[1,ng/2+1,ng],'YTickLabel',[grid_q(1),grid_q(end/2+1),grid_q(end)]-max_q/2);
% plot tmplt in freqspace ;
subplot(3,3,2);imagesc(recenter(real(S_k_c)),Slim_k);title('real(S_k_c)'); colorbar; set(gca,'Ydir','normal');
set(gca,'XTick',[1,ng/2+1,ng],'XTickLabel',[grid_k_c(1),grid_k_c(end/2+1),grid_k_c(end)]-ng/2);set(gca,'YTick',[1,ng/2+1,ng],'YTickLabel',[grid_k_c(1),grid_k_c(end/2+1),grid_k_c(end)]-ng/2);
subplot(3,3,3);imagesc(recenter(imag(S_k_c)),Slim_k);title('imag(S_k_c)'); colorbar; set(gca,'Ydir','normal');
set(gca,'XTick',[1,ng/2+1,ng],'XTickLabel',[grid_k_c(1),grid_k_c(end/2+1),grid_k_c(end)]-ng/2);set(gca,'YTick',[1,ng/2+1,ng],'YTickLabel',[grid_k_c(1),grid_k_c(end/2+1),grid_k_c(end)]-ng/2);
subplot(3,3,5);polarpatch(R_k_p,W_k_p,real(S_k_p),Slim_k);title('real(S_k_p)'); c = colorbar; %set(c,'Ticks',0.025 + 0.95*linspace(0,1,4),'TickLabels',linspace(Slim_k(1),Slim_k(2),4));set(gca,'XTick',[],'Ytick',[]);
subplot(3,3,6);polarpatch(R_k_p,W_k_p,imag(S_k_p),Slim_k);title('imag(S_k_p)'); c = colorbar; %set(c,'Ticks',0.025 + 0.95*linspace(0,1,4),'TickLabels',linspace(Slim_k(1),Slim_k(2),4));set(gca,'XTick',[],'Ytick',[]);
subplot(3,3,8);imagesc(real(S_k_q([ng/2:ng,1:ng/2-1],:)),qlim); title('real(S_k_q)'); colorbar; set(gca,'Ydir','normal'); set(gca,'XTick',[1,ng/2+1,ng],'XTickLabel',[0,grid_k_r(end/2+1),grid_k_r(end)]); set(gca,'YTick',[1,ng/2+1,ng],'YTickLabel',[grid_q(1),grid_q(end/2+1),grid_q(end)]-max_q/2);
subplot(3,3,9);imagesc(imag(S_k_q([ng/2:ng,1:ng/2-1],:)),qlim); title('imag(S_k_q)'); colorbar; set(gca,'Ydir','normal'); set(gca,'XTick',[1,ng/2+1,ng],'XTickLabel',[0,grid_k_r(end/2+1),grid_k_r(end)]); set(gca,'YTick',[1,ng/2+1,ng],'YTickLabel',[grid_q(1),grid_q(end/2+1),grid_q(end)]-max_q/2);
return;
end;%if disp_flag;

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% ;
% generate image M ;
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% ;
M_x_c = S_x_c; Mlim_x = max(0,mean(M_x_c(:)) + 1.0*std(M_x_c(:))*[-1,+1]);
gamma_true = -3*2*pi/10; M_x_c = recenter(interp2(recenter(X_x_c),recenter(Y_x_c),recenter(M_x_c),recenter(X_x_c)*cos(gamma_true) - recenter(Y_x_c)*sin(gamma_true),recenter(X_x_c)*sin(gamma_true) + recenter(Y_x_c)*cos(gamma_true),'nearest',0));
delta_x_true = 3.5*max_x_c/64; delta_y_true = 1.5*max_x_c/64; M_x_c = recenter(interp2(recenter(X_x_c),recenter(Y_x_c),recenter(M_x_c),recenter(X_x_c)-delta_x_true,recenter(Y_x_c)-delta_y_true,'nearest',0));
L_M_x_c = sum(abs(M_x_c(:)).^2)*d_x_c*d_x_c;
% calculate image values on realspace polar meshgrid ;
M_x_p = interp2(recenter(X_x_c),recenter(Y_x_c),recenter(M_x_c),R_x_p.*cos(W_x_p),R_x_p.*sin(W_x_p));
% calculate image values on realspace qring meshgrid ;
M_x_q = fft(M_x_p)/sqrt(ng);
% calculate image values on freqspace carte meshgrid ;
M_k_c = fft2(M_x_c) * d_x_c*d_x_c; Mlim_k  = mean(abs(M_k_c(:))) + 1.0*std(abs(M_k_c(:)))*[-1,+1];
L_M_k_c = sum(abs(M_k_c(:)).^2)*d_k_c*d_k_c;
M_tmp = ifft2(M_k_c)./d_x_c./d_x_c; L_M_tmp = sum(abs(M_tmp(:)).^2)*d_x_c*d_x_c;
% calculate image falues on freqspace polar meshgrid ;
M_k_p = interp2(recenter(X_k_c),recenter(Y_k_c),recenter(M_k_c),X_k_p,Y_k_p);
M_k_p(find(~isfinite(M_k_p)))=0;
L_M_k_p = sum(sum(abs(M_k_p).^2 * diag(grid_k_r)))*d_k_r*d_k_w;
% calculate image values on realspace qring meshgrid ;
M_k_q = fft(M_k_p)/sqrt(ng);
L_M_k_q = sum(sum(abs(M_k_q).^2 * diag(grid_k_r)))*d_k_r*d_k_w;
disp(sprintf(' %% L_M_x_c %f L_M_k_c %f L_M_k_p %f L_M_k_q %f',L_M_x_c,L_M_k_c,L_M_k_p,L_M_k_q));

disp_flag=0;
if disp_flag;
figure;
% plot image in realspace ;
subplot(3,3,1);imagesc(recenter(real(M_x_c)),Mlim_x);title('real(M_x_c)'); colorbar; set(gca,'Ydir','normal');
set(gca,'XTick',[1,ng/2+1,ng],'XTickLabel',[grid_x_c(1),grid_x_c(end/2+1),floor(10*grid_x_c(end))/10]-max_x_c/2);set(gca,'YTick',[1,ng/2+1,ng],'YTickLabel',[grid_x_c(1),grid_x_c(end/2+1),floor(10*grid_x_c(end))/10]-max_x_c/2);
subplot(3,3,4);polarpatch(R_x_p,W_x_p,M_x_p,Mlim_x);title('real(M_x_p)'); c = colorbar; %set(c,'Ticks',0.025 + 0.95*linspace(0,1,4),'TickLabels',linspace(Mlim_x(1),Mlim_x(2),4));set(gca,'XTick',[],'Ytick',[]);
subplot(3,3,7);imagesc(abs(M_x_q([ng/2:ng,1:ng/2-1],:))); title('abs(M_x_q)'); colorbar; set(gca,'Ydir','normal'); set(gca,'XTick',[1,ng/2+1,ng],'XTickLabel',[0,grid_x_r(end/2+1),grid_x_r(end)]); set(gca,'YTick',[1,ng/2+1,ng],'YTickLabel',[grid_q(1),grid_q(end/2+1),grid_q(end)]-max_q/2);
% plot image in freqspace ;
subplot(3,3,2);imagesc(recenter(real(M_k_c)),Mlim_k);title('real(M_k_c)'); colorbar; set(gca,'Ydir','normal');
set(gca,'XTick',[1,ng/2+1,ng],'XTickLabel',[grid_k_c(1),grid_k_c(end/2+1),grid_k_c(end)]-ng/2);set(gca,'YTick',[1,ng/2+1,ng],'YTickLabel',[grid_k_c(1),grid_k_c(end/2+1),grid_k_c(end)]-ng/2);
subplot(3,3,3);imagesc(recenter(imag(M_k_c)),Mlim_k);title('imag(M_k_c)'); colorbar; set(gca,'Ydir','normal');
set(gca,'XTick',[1,ng/2+1,ng],'XTickLabel',[grid_k_c(1),grid_k_c(end/2+1),grid_k_c(end)]-ng/2);set(gca,'YTick',[1,ng/2+1,ng],'YTickLabel',[grid_k_c(1),grid_k_c(end/2+1),grid_k_c(end)]-ng/2);
subplot(3,3,5);polarpatch(R_k_p,W_k_p,real(M_k_p),Mlim_k);title('real(M_k_p)'); c = colorbar; %set(c,'Ticks',0.025 + 0.95*linspace(0,1,4),'TickLabels',linspace(Mlim_k(1),Mlim_k(2),4));set(gca,'XTick',[],'Ytick',[]);
subplot(3,3,6);polarpatch(R_k_p,W_k_p,imag(M_k_p),Mlim_k);title('imag(M_k_p)'); c = colorbar; %set(c,'Ticks',0.025 + 0.95*linspace(0,1,4),'TickLabels',linspace(Mlim_k(1),Mlim_k(2),4));set(gca,'XTick',[],'Ytick',[]);
subplot(3,3,8);imagesc(real(M_k_q([ng/2:ng,1:ng/2-1],:)),qlim); title('real(M_k_q)'); colorbar; set(gca,'Ydir','normal'); set(gca,'XTick',[1,ng/2+1,ng],'XTickLabel',[0,grid_k_r(end/2+1),grid_k_r(end)]); set(gca,'YTick',[1,ng/2+1,ng],'YTickLabel',[grid_q(1),grid_q(end/2+1),grid_q(end)]-max_q/2);
subplot(3,3,9);imagesc(imag(M_k_q([ng/2:ng,1:ng/2-1],:)),qlim); title('imag(M_k_q)'); colorbar; set(gca,'Ydir','normal'); set(gca,'XTick',[1,ng/2+1,ng],'XTickLabel',[0,grid_k_r(end/2+1),grid_k_r(end)]); set(gca,'YTick',[1,ng/2+1,ng],'YTickLabel',[grid_q(1),grid_q(end/2+1),grid_q(end)]-max_q/2);
return;
end;%if disp_flag;

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% ;
% Determine svd expansion ;
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% ;
l_max = 16;
eps_target = 0.1;
N_pixels = 1.5;
K_max = max_k_p;
R_target = ceil(2*pi*K_max) ;
R_preget = ceil(2*pi*max(1,(K_max-1))) ;
z_target = N_pixels*pi*sqrt(2)*R_target/R_preget ;
D_target = z_target/R_target;
n_r = 128 ; n_d = 128 ;
r_tmp_ = linspace(0,R_target,n_r);
d_tmp_ = linspace(0,D_target,n_d);
clear S_l_ S_u_ S_s_ S_v_ ;
[R_TMP_,D_TMP_] = meshgrid(r_tmp_,d_tmp_); Z_TMP_ = R_TMP_.*D_TMP_;
l = 0; n_S = 0; continue_flag=1;
while (continue_flag);
if (l==0); l_ = [0]; else l_ = [-l,+l] ; end;
for l_tmp = l_;
J_tmp = besselj(l_tmp,Z_TMP_);
[U,S,V] = svds(J_tmp,l_max); S = diag(S); [S_ret] = find(S>eps_target) ;
if ~isempty(S_ret);
if (verbose>1); disp(sprintf(' %% l %+.2d, found %d terms [%0.2f,..,%0.2f];',l_tmp,length(S_ret),S(S_ret(1)),S(S_ret(end)))); end;%if
for ij = 1:length(S_ret);
S_l_(1+n_S) = l_tmp;
S_u_(:,1+n_S) = U(:,S_ret(ij));
S_s_(1,1+n_S) = S(S_ret(ij),1);
S_v_(:,1+n_S) = V(:,S_ret(ij));
n_S = n_S + 1;
end;%for ij = 1:length(S_ret);
end;%if ~isempty(S_ret);
end;% for l_tmp = l_;
l=l+1;
if (l>l_max); continue_flag=0; else continue_flag=1; end;
end;%while (continue_flag);
if (verbose>1); disp(sprintf(' %% total of n_S %d terms found;',n_S)); end%if;
n_svd_r = n_r;
svd_r_ = r_tmp_;
n_svd_d = n_d;
svd_d_ = d_tmp_;
n_svd_l = n_S;
svd_l_ = S_l_;
svd_U_d_ = S_u_;
svd_s_ = S_s_;
svd_V_r_ = S_v_;

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% ;
% Set displacement delta_ ;
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% ;
%delta_x = (2*pi/max_k_c)*1.5*0.5; delta_y = (2*pi/max_k_c)*1.5*sqrt(3)/2;
%delta_x = (2*pi/max_k_c)*3*rand()*0.5; delta_y = (2*pi/max_k_c)*3*rand()*sqrt(3)/2;
%delta_x = 1/ng; delta_y = 0;
%delta_d = sqrt(delta_x.^2 + delta_y.^2); delta_w = atan2(delta_y,delta_x);
delta_d = 2*pi/max_k_c*2.0; delta_w = 3*pi/6;
delta_x = delta_d*cos(delta_w); delta_y = delta_d*sin(delta_w);
disp(sprintf(' %% delta_x_c (%f,%f) delta_x_p (%f,%f)',delta_x,delta_y,delta_d,delta_w));

T_k_p = exp(-i*delta_d*R_k_p.*cos(W_k_p-delta_w)); Tlim_k = [-1,+1];
phi_k_p = W_k_p-delta_w;
rd_k_p = delta_d*R_k_p;
J_k_p = 0*T_k_p;
for l=0:l_max;
if (l==0); J_k_p = J_k_p + besselj(0,rd_k_p); end;
if (l>0); J_k_p = J_k_p + exp(+i*l*pi/2).*besselj(-l,rd_k_p).*exp(-i*l*phi_k_p) + exp(-i*l*pi/2).*besselj(+l,rd_k_p).*exp(+i*l*phi_k_p); end;
end;%for l=0:l_max;
Jlim_k = [-1,+1];
disp_flag=0;
if disp_flag;
figure(1);
subplot(2,3,1); clim = polarpatch(R_k_p,W_k_p,real(T_k_p),Tlim_k); colorbar; title('real(T)');
subplot(2,3,4); clim = polarpatch(R_k_p,W_k_p,imag(T_k_p),Tlim_k); colorbar; title('imag(T)');
subplot(2,3,2); clim = polarpatch(R_k_p,W_k_p,real(J_k_p),Jlim_k); colorbar; title('real(J)');
subplot(2,3,5); clim = polarpatch(R_k_p,W_k_p,imag(J_k_p),Jlim_k); colorbar; title('imag(J)');
subplot(2,3,3); clim = polarpatch(R_k_p,W_k_p,real(T_k_p-J_k_p)); colorbar; title('real(J-T)');
subplot(2,3,6); clim = polarpatch(R_k_p,W_k_p,imag(T_k_p-J_k_p)); colorbar; title('imag(J-T)');
end;%if disp_flag;

T_k_c = exp(-i*delta_d*R_k_c.*cos(W_k_c-delta_w)); Tlim_k = [-1,+1];
%T_k_c = exp(-i*(X_k_c*delta_x + Y_k_c*delta_y)); Tlim_k = [-1,+1];
phi_k_c = W_k_c-delta_w;
rd_k_c = delta_d*R_k_c;
J_k_c = 0*T_k_c;
for l=0:l_max;
if (l==0); J_k_c = J_k_c + besselj(0,rd_k_c); end;
if (l>0); J_k_c = J_k_c + exp(+i*l*pi/2).*besselj(-l,rd_k_c).*exp(-i*l*phi_k_c) + exp(-i*l*pi/2).*besselj(+l,rd_k_c).*exp(+i*l*phi_k_c); end;
end;%for l=0:l_max;
%T_k_c = T_k_c.*(R_k_c<max_k_c/2); J_k_c = J_k_c.*(R_k_c<max_k_c/2);
Jlim_k = [-1,+1];
disp_flag=0;
if disp_flag;
figure(2);
subplot(2,3,1); imagesc(real(recenter2(T_k_c.*(R_k_c<max_k_c/2))),Tlim_k); colorbar; title('real(T)');
subplot(2,3,4); imagesc(imag(recenter2(T_k_c.*(R_k_c<max_k_c/2))),Tlim_k); colorbar; title('imag(T)');
subplot(2,3,2); imagesc(real(recenter2(J_k_c.*(R_k_c<max_k_c/2))),Jlim_k); colorbar; title('real(J)');
subplot(2,3,5); imagesc(imag(recenter2(J_k_c.*(R_k_c<max_k_c/2))),Jlim_k); colorbar; title('imag(J)');
subplot(2,3,3); imagesc(real(recenter2((T_k_c-J_k_c).*(R_k_c<max_k_c/2)))); colorbar; title('real(J-T)');
subplot(2,3,6); imagesc(imag(recenter2((T_k_c-J_k_c).*(R_k_c<max_k_c/2)))); colorbar; title('imag(J-T)');
end;%if disp_flag;

T_x_c = ifft2((T_k_c))./d_x_c./d_x_c; J_x_c = ifft2((J_k_c))./d_x_c./d_x_c;
Tlim_x = [-1,+1]; Jlim_x = [-1,+1];
disp_flag=0;
if disp_flag;
figure(3);
subplot(2,3,1); imagesc(real(recenter2(T_x_c)),Tlim_x); colorbar; title('real(T)');
subplot(2,3,4); imagesc(imag(recenter2(T_x_c)),Tlim_x); colorbar; title('imag(T)');
subplot(2,3,2); imagesc(real(recenter2(J_x_c)),Jlim_x); colorbar; title('real(J)');
subplot(2,3,5); imagesc(imag(recenter2(J_x_c)),Jlim_x); colorbar; title('imag(J)');
subplot(2,3,3); imagesc(real(recenter2((T_x_c-J_x_c)))); colorbar; title('real(J-T)');
subplot(2,3,6); imagesc(imag(recenter2((T_x_c-J_x_c)))); colorbar; title('imag(J-T)');
end;%if disp_flag;



