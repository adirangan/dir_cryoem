function [n_svd_r,svd_r_,n_svd_d,svd_d_,n_svd_l,svd_l_,svd_U_d_,svd_s_,svd_V_r_] = gen_Jsvd_2b(K_max,N_pixel,eps_target,l_max);
% Generating svd-expansion of F_ (note that this factorizes by construction) ; 
% the maximum delta is chosen so that the expansion works from ;
% K_max to K_max-1 ;
% Generate svd-expansion ;
verbose=2;
if (nargin<4); l_max = 16; end;
if (verbose>1); disp(sprintf(' %% [entering gen_Jsvd_2b] l_max %d',l_max)); end;%if;

R_target = K_max-0.5;
z_target = N_pixel*pi*sqrt(2);
D_target = z_target/(2*pi*R_target);
n_r = 128 ; n_d = 128 ;
r_tmp_ = linspace(0,2*pi*R_target,n_r);
d_tmp_ = linspace(0,D_target,n_d);
clear S_l_ S_u_ S_s_ S_v_ ;
[R_TMP_,D_TMP_] = meshgrid(r_tmp_,d_tmp_); Z_TMP_ = R_TMP_.*D_TMP_;
l = 0; n_S = 0; continue_flag=1;
while (continue_flag);
if (l==0); l_ = [0]; else l_ = [-l,+l] ; end;
for l_tmp = l_;
J_tmp = besselj(l_tmp,Z_TMP_);
[U,S,V] = svds(J_tmp,l_max); S = diag(S); [S_ret] = find(S>eps_target) ;
if ~isempty(S_ret);
if (verbose>1); disp(sprintf(' %% l %+.2d, found %d terms [%0.2f,..,%0.2f];',l_tmp,length(S_ret),S(S_ret(1)),S(S_ret(end)))); end;%if
for ij = 1:length(S_ret);
S_l_(1+n_S) = l_tmp;
S_u_(:,1+n_S) = U(:,S_ret(ij));
S_s_(1,1+n_S) = S(S_ret(ij),1);
S_v_(:,1+n_S) = V(:,S_ret(ij));
n_S = n_S + 1;
end;%for ij = 1:length(S_ret);
end;%if ~isempty(S_ret);
end;% for l_tmp = l_;
l=l+1;
if (l>l_max); continue_flag=0; else continue_flag=1; end;
end;%while (continue_flag);
if (verbose>1); disp(sprintf(' %% total of n_S %d terms found;',n_S)); end%if;
n_svd_r = n_r;
svd_r_ = r_tmp_;
n_svd_d = n_d;
svd_d_ = d_tmp_;
n_svd_l = n_S;
svd_l_ = S_l_;
svd_U_d_ = S_u_;
svd_s_ = S_s_;
svd_V_r_ = S_v_;
