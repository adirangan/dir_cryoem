function ...
TS_M_ = ...
innerproduct_p_quad_( ...
 n_k_p_r ...
,weight_2d_k_p_r_ ...
,n_w_ ...
,n_M ...
,T_k_p_wkM__ ...
,S_k_p_wkM__ ...
);
%%%%;
n_w_ = reshape(n_w_(1:n_k_p_r),[n_k_p_r,1]);
n_w_max = max(n_w_);
n_w_sum = sum(n_w_);
n_w_csum_ = cumsum([0;n_w_]);
%%%%;
weight_2d_k_p_wk_ = zeros(n_w_sum,1);
for nk_p_r=0:n_k_p_r-1;
n_w = n_w_(1+nk_p_r);
dw = (2*pi)/(max(1,n_w));
n_w_csum = n_w_csum_(1+nk_p_r);
tmp_index_ = n_w_csum + [0:n_w-1];
weight_2d_k_p = weight_2d_k_p_r_(1+nk_p_r);
weight_2d_k_p_wk_(1+tmp_index_) = weight_2d_k_p*dw;
end;%for nk_p_r=0:n_k_p_r-1;
%%%%;
TS_M_ = reshape(sum(bsxfun(@times,conj(T_k_p_wkM__),bsxfun(@times,S_k_p_wkM__,reshape(weight_2d_k_p_wk_,[n_w_sum,1]))),1),[n_M,1]);
