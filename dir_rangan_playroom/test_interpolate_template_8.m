str_thisfunction = 'test_interpolate_template_8';

platform = 'rusty';
if (exist('platform.type','file')); fp=fopen('platform.type'); platform = fscanf(fp,'%s'); fclose(fp); end;
if (strcmp(platform,'access1')); setup_access1; string_root = 'data'; end;
if (strcmp(platform,'OptiPlex')); setup_OptiPlex; string_root = 'home'; end;
if (strcmp(platform,'eval1')); setup_eval1; string_root = 'home'; end;
if (strcmp(platform,'rusty')); setup_rusty; string_root = 'mnt/home'; end;

flag_verbose = 1; %<-- verbosity level. ;
flag_disp=1; nf=0; %<-- display level. ;

k_int = 24; %<-- highest frequency (2*pi*k_p_r_max), watch out for aliasing! ;
k_eq_d_double = 1.0; %<-- prefactor for k_eq_d, determines density of sampling in frequency-space. ;
template_k_eq_d_double = 1.0; %<-- prefactor for template_k_eq_d, determines density of sampling in frequency-space. ;
n_w_int = 1.0; %<-- prefactor for n_w_max, determines the number of distinct angles (i.e., n_gamma_z) used in frequency-space 2d-polar-grid. ;

%%%%%%%%;
% First form a_x_u_xxx_. ;
%%%%%%%%;
rng(0);
n_x_u = 64*2;
x_p_r_max = 1.0;
x_u_0_ = transpose(linspace(-x_p_r_max,+x_p_r_max,n_x_u));
x_u_1_ = transpose(linspace(-x_p_r_max,+x_p_r_max,n_x_u));
x_u_2_ = transpose(linspace(-x_p_r_max,+x_p_r_max,n_x_u));
[x_u_0___,x_u_1___,x_u_2___] = ndgrid(x_u_0_,x_u_1_,x_u_2_); n_xxx_u = n_x_u^3;
xxx_u_weight_ = (2*x_p_r_max/n_x_u)^3;
%%%%;
n_source = 128; n_3 = 3;
delta_3s__ = 0.5*(2*rand(n_3,n_source)-1);
sigma_x = x_p_r_max/16;
g_ = @(x_u_0___,x_u_1___,x_u_2___,delta_3_) 1/sqrt(2*pi)^3 / sigma_x^3 * exp(- ( (x_u_0___ - delta_3_(1+0)).^2 + (x_u_1___ - delta_3_(1+1)).^2 + (x_u_2___ - delta_3_(1+2)).^2 ) / (2*sigma_x^2) ) ;
a_x_u_xxx___ = zeros(n_x_u,n_x_u,n_x_u);
for nsource=0:n_source-1;
a_x_u_xxx___ = a_x_u_xxx___ + g_(x_u_0___,x_u_1___,x_u_2___,delta_3s__(:,1+nsource));
end;%for nsource=0:n_source-1;
a_x_u_xxx_ = reshape(a_x_u_xxx___,[n_xxx_u,1]);
%%%%;
if (flag_disp>1);
figure(1+nf);nf=nf+1;clf;figsml;
isosurface_f_x_u_1([],a_x_u_xxx___);
title('a_x_u_xxx___','Interpreter','none');
end;%if (flag_disp>1);
%%%%%%%%;

%%%%%%%%;
% Now set up quadrature on the sphere. ;
%%%%%%%%;
k_p_r_max = k_int/(2*pi); 
k_eq_d = k_eq_d_double/(2*pi);
flag_uniform_over_n_k_p_r = 1;
flag_uniform_over_polar_a = 0;
str_T_vs_L = 'C2';
[ ...
 n_qk ...
,n_qk_csum_ ...
,k_p_r_qk_ ...
,k_p_azimu_b_qk_ ...
,k_p_polar_a_qk_ ...
,weight_3d_k_p_qk_ ...
,weight_shell_qk_ ...
,n_k_p_r ...
,k_p_r_ ...
,weight_3d_k_p_r_ ...
,k_c_0_qk_ ...
,k_c_1_qk_ ...
,k_c_2_qk_ ...
,~ ...
,~ ...
,~ ...
,~ ...
,n_polar_a_k_ ...
,polar_a_ka__ ...
,n_azimu_b_ka__ ...
] = ...
sample_sphere_7( ...
 0*flag_verbose ...
,k_p_r_max ...
,k_eq_d ...
,str_T_vs_L ...
,flag_uniform_over_n_k_p_r ...
,flag_uniform_over_polar_a ...
) ;
%%%%%%%%;

%%%%%%%%;
% Now form a_k_p_qk_. ;
%%%%%%%%;
eta = pi/x_p_r_max; tmp_t = tic;
a_k_p_qk_ = xxnufft3d3(n_xxx_u,x_u_0___(:)*eta,x_u_1___(:)*eta,x_u_2___(:)*eta,a_x_u_xxx_(:).*xxx_u_weight_(:),-1,1e-12,n_qk,2*pi*k_c_0_qk_/eta,2*pi*k_c_1_qk_/eta,2*pi*k_c_2_qk_/eta)/sqrt(2*pi)/sqrt(2*pi)/sqrt(2*pi);
tmp_t = toc(tmp_t); disp(sprintf(' %% xxnufft3d3: a_k_p_qk_: time %0.6fs',tmp_t));
%%%%;
eta = pi/k_p_r_max; tmp_t = tic;
a_x_u_reco_ = xxnufft3d3(n_qk,2*pi*k_c_0_qk_*eta,2*pi*k_c_1_qk_*eta,2*pi*k_c_2_qk_*eta,a_k_p_qk_.*(2*pi)^3.*weight_3d_k_p_qk_,+1,1e-12,n_xxx_u,x_u_0___(:)/eta,x_u_1___(:)/eta,x_u_2___(:)/eta)/sqrt(2*pi)/sqrt(2*pi)/sqrt(2*pi);
tmp_t = toc(tmp_t); disp(sprintf(' %% xxnufft3d3: a_x_u_reco_: time %0.6fs',tmp_t));
%%%%;
fnorm_disp(flag_verbose,'a_x_u_xxx_',a_x_u_xxx_,'a_x_u_reco_',a_x_u_reco_);
%%%%;
eta = pi/x_p_r_max; tmp_t = tic;
a_k_p_reco_ = xxnufft3d3(n_xxx_u,x_u_0___(:)*eta,x_u_1___(:)*eta,x_u_2___(:)*eta,a_x_u_reco_(:).*xxx_u_weight_(:),-1,1e-12,n_qk,2*pi*k_c_0_qk_/eta,2*pi*k_c_1_qk_/eta,2*pi*k_c_2_qk_/eta)/sqrt(2*pi)/sqrt(2*pi)/sqrt(2*pi);
tmp_t = toc(tmp_t); disp(sprintf(' %% xxnufft3d3: a_k_p_reco_: time %0.6fs',tmp_t));
%%%%;
fnorm_disp(flag_verbose,'a_k_p_qk_',a_k_p_qk_,'a_k_p_reco_',a_k_p_reco_);
%%%%%%%%;

%%%%%%%%;
% Now set up and test polar-quadrature-weights on disk. ;
%%%%%%%%;
l_max_upb = round(2*pi*k_p_r_max);
l_max_max = min(l_max_upb,1+ceil(2*pi*k_p_r_(end)));
n_w_max = n_w_int*2*(l_max_max+1); n_w_0in_ = n_w_max*ones(n_k_p_r,1); n_w_0in = n_w_max;
[ ...
 n_w_ ...
,weight_2d_k_p_r_ ...
,weight_2d_wk_ ...
,k_p_r_wk_ ...
,k_p_w_wk_ ...
,k_c_0_wk_ ...
,k_c_1_wk_ ...
] = ...
get_weight_2d_2( ...
 0*flag_verbose ...
,n_k_p_r ...
,k_p_r_ ...
,k_p_r_max ...
,-1 ...
,n_w_0in_ ...
);
n_w_sum = sum(n_w_); n_w_csum_ = cumsum([0;n_w_]);
%%%%%%%%;
tmp_S_delta_x_c_ = [cos(pi/4);sin(pi/4)]/max(1e-12,k_p_r_max);
tmp_S_phi = +1*pi/5;
tmp_T_delta_x_c_ = [cos(-pi/3);sin(-pi/3)]/max(1e-12,k_p_r_max);
tmp_T_phi = -3*pi/7;
tmp_S_k_p_wk_ = exp(+2*pi*i*(k_c_0_wk_*tmp_S_delta_x_c_(1+0) + k_c_1_wk_*tmp_S_delta_x_c_(1+1)));
tmp_plane_S_k_p_wk_ = 2*k_p_r_wk_.*cos(k_p_w_wk_ - tmp_S_phi);
tmp_T_k_p_wk_ = exp(+2*pi*i*(k_c_0_wk_*tmp_T_delta_x_c_(1+0) + k_c_1_wk_*tmp_T_delta_x_c_(1+1)));
tmp_plane_T_k_p_wk_ = 2*k_p_r_wk_.*cos(k_p_w_wk_ - tmp_T_phi);
I_quad = sum(conj(tmp_plane_S_k_p_wk_.*tmp_S_k_p_wk_).*(tmp_plane_T_k_p_wk_.*tmp_T_k_p_wk_).*weight_2d_wk_)*(2*pi)^2;
I_form = I_xPPx_0(k_p_r_max,tmp_S_phi,tmp_S_delta_x_c_,tmp_T_phi,tmp_T_delta_x_c_);
fnorm_disp(flag_verbose,'I_form',I_form,'I_quad',I_quad,' %%<-- should be <1e-6');
%%%%%%%%;

%%%%%%%%;
% define some viewing-angles. ;
%%%%%%%%;
k_p_r_1 = 1;
viewing_k_eq_d = template_k_eq_d_double/max(1e-12,k_p_r_max);
template_k_eq_d = -1;
[ ...
 n_viewing_S ...
,viewing_azimu_b_S_ ...
,viewing_polar_a_S_ ...
,viewing_weight_S_ ...
,~ ...
,~ ...
,~ ...
,n_viewing_polar_a ...
,viewing_polar_a_ ...
,n_viewing_azimu_b_ ...
] = ...
sample_shell_5( ...
 k_p_r_1 ...
,viewing_k_eq_d ...
,'L' ...
) ; %<-- obtain viewing angles. ;
n_S = n_viewing_S;

%%%%%%%%;
% Define rotation. ;
%%%%%%%%;
Rz = @(azimu_b) ...
[ +cos(azimu_b) -sin(azimu_b) 0 ; ...
  +sin(azimu_b) +cos(azimu_b) 0 ; ...
   0             0            1 ; ...
] ;
%%%%%%%%;
Ry = @(polar_a) ...
[ +cos(polar_a) 0 +sin(polar_a) ; ...
   0            1  0            ; ...
  -sin(polar_a) 0 +cos(polar_a) ; ...
];
%%%%%%%%;
polar_a_use = +1*pi/5;
azimu_b_use = +1*pi/7;
gamma_z_use = +1*pi/3;
euler_use_ = [gamma_z_use,polar_a_use,azimu_b_use];
R_use__ = Rz(azimu_b_use)*Ry(polar_a_use)*Rz(gamma_z_use);
fnorm_disp(flag_verbose,'R_use__',R_use__,'euler_to_R_0(euler_use_)',euler_to_R_0(euler_use_));
fnorm_disp(flag_verbose,'euler_use_',euler_use_,'R_to_euler_0(R_use__)',R_to_euler_0(R_use__));
%%%%%%%%;
% Now rotate the quadrature-grid. ;
%%%%%%%%;
tmp_qk3__ = cat(2,k_c_0_qk_,k_c_1_qk_,k_c_2_qk_)*transpose(R_use__);
R_k_c_0_qk_ = tmp_qk3__(:,1+0); R_k_c_1_qk_ = tmp_qk3__(:,1+1); R_k_c_2_qk_ = tmp_qk3__(:,1+2);
R_k_p_r01_qk_ = sqrt(R_k_c_0_qk_.^2 + R_k_c_1_qk_.^2);
R_k_p_polar_a_qk_ = atan2(R_k_p_r01_qk_,R_k_c_2_qk_);
R_k_p_azimu_b_qk_ = atan2(R_k_c_1_qk_,R_k_c_0_qk_);
%%%%%%%%;
% Now produce a_R_k_p_qk_. ;
%%%%%%%%;
eta = pi/x_p_r_max; tmp_t = tic;
a_R_k_p_qk_ = xxnufft3d3(n_xxx_u,x_u_0___(:)*eta,x_u_1___(:)*eta,x_u_2___(:)*eta,a_x_u_xxx_(:).*xxx_u_weight_(:),-1,1e-12,n_qk,2*pi*R_k_c_0_qk_/eta,2*pi*R_k_c_1_qk_/eta,2*pi*R_k_c_2_qk_/eta)/sqrt(2*pi)/sqrt(2*pi)/sqrt(2*pi);
tmp_t = toc(tmp_t); disp(sprintf(' %% xxnufft3d3: a_R_k_p_qk_: time %0.6fs',tmp_t));
%%%%%%%%;

%%%%%%%%;
% Subselect some templates. ;
% Ensuring that some of the templates have polar_a and azimu_b at multiples of pi. ;
%%%%%%%%;
viewing_gamma_z_S_ = zeros(n_S,1);
n_S_sub = 16;
tmp_r_ = rand(n_S_sub,1); tmp_r_ = 0.5*(cos(2*pi*tmp_r_)+1); %<-- quadratically cluster near poles. ;
nS_sub_ = max(0,min(n_S-1,round(n_S*tmp_r_)));
tmp_index_a_ = efind(abs(periodize(viewing_polar_a_S_,-pi/4,+pi/4))<1e-2);
tmp_index_b_ = efind(abs(periodize(viewing_azimu_b_S_,-pi/4,+pi/4))<1e-2);
tmp_index_ba_ = intersect(tmp_index_a_,tmp_index_b_);
nS_sub_ = union(tmp_index_ba_(:),nS_sub_);
n_S_sub = numel(nS_sub_);
n_viewing_S_sub = n_S_sub;
viewing_azimu_b_S_sub_ = viewing_azimu_b_S_(1+nS_sub_);
viewing_polar_a_S_sub_ = viewing_polar_a_S_(1+nS_sub_);
viewing_weight_S_sub_ = viewing_weight_S_(1+nS_sub_);
viewing_gamma_z_S_sub_ = viewing_gamma_z_S_(1+nS_sub_);
%%%%%%%%;

%%%%%%%%;
% Now form templates from a_k_p_quad_. ;
%%%%%%%%;
n_order = 13;
parameter = struct('type','parameter');
parameter.flag_verbose = 0*flag_verbose;
parameter.flag_check = 0;
parameter.flag_parsimonious = 1;
parameter.tolerance_pinv = 1e-6;
parameter.str_version = '';
if ~exist('wS_sub_from_single_shell_cpu_sba__','var'); wS_sub_from_single_shell_cpu_sba__=[]; end;
if ~exist('dwS_subda_from_single_shell_cpu_sba__','var'); dwS_subda_from_single_shell_cpu_sba__=[]; end;
if ~exist('dwS_subdb_from_single_shell_cpu_sba__','var'); dwS_subdb_from_single_shell_cpu_sba__=[]; end;
if ~exist('ddwS_subdaa_from_single_shell_cpu_sba__','var'); ddwS_subdaa_from_single_shell_cpu_sba__=[]; end;
if ~exist('ddwS_subdab_from_single_shell_cpu_sba__','var'); ddwS_subdab_from_single_shell_cpu_sba__=[]; end;
if ~exist('ddwS_subdbb_from_single_shell_cpu_sba__','var'); ddwS_subdbb_from_single_shell_cpu_sba__=[]; end;
if ~exist('n_R','var'); n_R = []; end;
if ~exist('R_use_R___','var'); R_use_R___ = []; end;
if ~exist('a_R_k_p_cpu_Rqk__','var'); a_R_k_p_cpu_Rqk__=[]; end;
if ~exist('ba_from_single_shell_cpu_Rbaba___','var'); ba_from_single_shell_cpu_Rbaba___=[]; end;
if ~exist('wT_sub_from_R_single_shell_cpu_Rsba___','var'); wT_sub_from_R_single_shell_cpu_Rsba___=[]; end;
if ~exist('dwT_subda_from_R_single_shell_cpu_Rsba___','var'); dwT_subda_from_R_single_shell_cpu_Rsba___=[]; end;
if ~exist('dwT_subdb_from_R_single_shell_cpu_Rsba___','var'); dwT_subdb_from_R_single_shell_cpu_Rsba___=[]; end;
if ~exist('ddwT_subdaa_from_R_single_shell_cpu_Rsba___','var'); ddwT_subdaa_from_R_single_shell_cpu_Rsba___=[]; end;
if ~exist('ddwT_subdab_from_R_single_shell_cpu_Rsba___','var'); ddwT_subdab_from_R_single_shell_cpu_Rsba___=[]; end;
if ~exist('ddwT_subdbb_from_R_single_shell_cpu_Rsba___','var'); ddwT_subdbb_from_R_single_shell_cpu_Rsba___=[]; end;
tmp_t = tic();
[ ...
 parameter ...
,template_cpu_wkS_sub__ ...
,n_w ...
,n_viewing_S_sub ...
,viewing_azimu_b_S_sub_ ...
,viewing_polar_a_S_sub_ ...
,viewing_weight_S_sub_ ...
,n_viewing_polar_a ...
,viewing_polar_a_ ...
,n_viewing_azimu_b_ ...
,viewing_gamma_z_S_sub_ ...
,wS_sub_from_single_shell_cpu_sba__ ...
,n_T_sub ...
,index_nS_sub_from_nT_sub_ ...
,n_R ...
,R_use_R___ ...
,viewing_R_polar_a_mod_T_subR__ ...
,viewing_R_azimu_b_mod_T_subR__ ...
,nR_from_nT_sub_ ...
,a_R_k_p_cpu_Rqk__ ...
,ba_from_single_shell_cpu_Rbaba___ ...
,wT_sub_from_R_single_shell_cpu_Rsba___ ...
,dtemplateda_cpu_wkS_sub__ ...
,dtemplatedb_cpu_wkS_sub__ ...
,dtemplatedc_cpu_wkS_sub__ ...
,dwS_subda_from_single_shell_cpu_sba__ ...
,dwS_subdb_from_single_shell_cpu_sba__ ...
,dwT_subda_from_R_single_shell_cpu_Rsba___ ...
,dwT_subdb_from_R_single_shell_cpu_Rsba___ ...
,ddtemplatedaa_cpu_wkS_sub__ ...
,ddtemplatedab_cpu_wkS_sub__ ...
,ddtemplatedac_cpu_wkS_sub__ ...
,ddtemplatedbb_cpu_wkS_sub__ ...
,ddtemplatedbc_cpu_wkS_sub__ ...
,ddtemplatedcc_cpu_wkS_sub__ ...
,ddwT_subdaa_from_single_shell_cpu_sba__ ...
,ddwT_subdab_from_single_shell_cpu_sba__ ...
,ddwT_subdbb_from_single_shell_cpu_sba__ ...
,ddwT_subdaa_from_R_single_shell_cpu_Rsba___ ...
,ddwT_subdab_from_R_single_shell_cpu_Rsba___ ...
,ddwT_subdbb_from_R_single_shell_cpu_Rsba___ ...
] = ...
interpolate_template_8( ...
 parameter ...
,n_order ...
,n_qk ...
,n_qk_csum_ ...
,k_p_r_qk_ ...
,k_p_azimu_b_qk_ ...
,k_p_polar_a_qk_ ...
,weight_3d_k_p_qk_ ...
,weight_shell_qk_ ...
,n_k_p_r ...
,k_p_r_ ...
,k_p_r_max ...
,weight_3d_k_p_r_ ...
,k_c_0_qk_ ...
,k_c_1_qk_ ...
,k_c_2_qk_ ...
,n_polar_a_k_ ...
,polar_a_ka__ ...
,n_azimu_b_ka__ ...
,a_k_p_qk_ ...
,viewing_k_eq_d ...
,template_k_eq_d ...
,n_w_0in ...
,n_viewing_S_sub ...
,viewing_azimu_b_S_sub_ ...
,viewing_polar_a_S_sub_ ...
,viewing_weight_S_sub_ ...
,n_viewing_polar_a ...
,viewing_polar_a_ ...
,n_viewing_azimu_b_ ...
,viewing_gamma_z_S_sub_ ...
,wS_sub_from_single_shell_cpu_sba__ ...
,dwS_subda_from_single_shell_cpu_sba__ ...
,dwS_subdb_from_single_shell_cpu_sba__ ...
,ddwS_subdaa_from_single_shell_cpu_sba__ ...
,ddwS_subdab_from_single_shell_cpu_sba__ ...
,ddwS_subdbb_from_single_shell_cpu_sba__ ...
,n_R ...
,R_use_R___ ...
,a_R_k_p_cpu_Rqk__ ...
,ba_from_single_shell_cpu_Rbaba___ ...
,wT_sub_from_R_single_shell_cpu_Rsba___ ...
,dwT_subda_from_R_single_shell_cpu_Rsba___ ...
,dwT_subdb_from_R_single_shell_cpu_Rsba___ ...
,ddwT_subdaa_from_R_single_shell_cpu_Rsba___ ...
,ddwT_subdab_from_R_single_shell_cpu_Rsba___ ...
,ddwT_subdbb_from_R_single_shell_cpu_Rsba___ ...
);
tmp_t = toc(tmp_t); if (flag_verbose>0); disp(sprintf(' %% interpolate_template S_sub: time %0.6fs',tmp_t)); end;
%%%%%%%%;
parameter.str_version = 'pagefun';
tmp_t = tic();
[ ...
 parameter ...
,template_cp2_wkS_sub__ ...
,n_w ...
,n_viewing_S_sub ...
,viewing_azimu_b_S_sub_ ...
,viewing_polar_a_S_sub_ ...
,viewing_weight_S_sub_ ...
,n_viewing_polar_a ...
,viewing_polar_a_ ...
,n_viewing_azimu_b_ ...
,viewing_gamma_z_S_sub_ ...
,wS_sub_from_single_shell_cpu_sba__ ...
,n_T_sub ...
,index_nS_sub_from_nT_sub_ ...
,n_R ...
,R_use_R___ ...
,viewing_R_polar_a_mod_T_subR__ ...
,viewing_R_azimu_b_mod_T_subR__ ...
,nR_from_nT_sub_ ...
,a_R_k_p_cpu_Rqk__ ...
,ba_from_single_shell_cpu_Rbaba___ ...
,wT_sub_from_R_single_shell_cpu_Rsba___ ...
,dtemplateda_cp2_wkS_sub__ ...
,dtemplatedb_cp2_wkS_sub__ ...
,dtemplatedc_cp2_wkS_sub__ ...
,dwS_subda_from_single_shell_cpu_sba__ ...
,dwS_subdb_from_single_shell_cpu_sba__ ...
,dwT_subda_from_R_single_shell_cpu_Rsba___ ...
,dwT_subdb_from_R_single_shell_cpu_Rsba___ ...
,ddtemplatedaa_cp2_wkS_sub__ ...
,ddtemplatedab_cp2_wkS_sub__ ...
,ddtemplatedac_cp2_wkS_sub__ ...
,ddtemplatedbb_cp2_wkS_sub__ ...
,ddtemplatedbc_cp2_wkS_sub__ ...
,ddtemplatedcc_cp2_wkS_sub__ ...
,ddwT_subdaa_from_single_shell_cpu_sba__ ...
,ddwT_subdab_from_single_shell_cpu_sba__ ...
,ddwT_subdbb_from_single_shell_cpu_sba__ ...
,ddwT_subdaa_from_R_single_shell_cpu_Rsba___ ...
,ddwT_subdab_from_R_single_shell_cpu_Rsba___ ...
,ddwT_subdbb_from_R_single_shell_cpu_Rsba___ ...
] = ...
interpolate_template_8( ...
 parameter ...
,n_order ...
,n_qk ...
,n_qk_csum_ ...
,k_p_r_qk_ ...
,k_p_azimu_b_qk_ ...
,k_p_polar_a_qk_ ...
,weight_3d_k_p_qk_ ...
,weight_shell_qk_ ...
,n_k_p_r ...
,k_p_r_ ...
,k_p_r_max ...
,weight_3d_k_p_r_ ...
,k_c_0_qk_ ...
,k_c_1_qk_ ...
,k_c_2_qk_ ...
,n_polar_a_k_ ...
,polar_a_ka__ ...
,n_azimu_b_ka__ ...
,a_k_p_qk_ ...
,viewing_k_eq_d ...
,template_k_eq_d ...
,n_w_0in ...
,n_viewing_S_sub ...
,viewing_azimu_b_S_sub_ ...
,viewing_polar_a_S_sub_ ...
,viewing_weight_S_sub_ ...
,n_viewing_polar_a ...
,viewing_polar_a_ ...
,n_viewing_azimu_b_ ...
,viewing_gamma_z_S_sub_ ...
,wS_sub_from_single_shell_cpu_sba__ ...
,dwS_subda_from_single_shell_cpu_sba__ ...
,dwS_subdb_from_single_shell_cpu_sba__ ...
,ddwS_subdaa_from_single_shell_cpu_sba__ ...
,ddwS_subdab_from_single_shell_cpu_sba__ ...
,ddwS_subdbb_from_single_shell_cpu_sba__ ...
,n_R ...
,R_use_R___ ...
,a_R_k_p_cpu_Rqk__ ...
,ba_from_single_shell_cpu_Rbaba___ ...
,wT_sub_from_R_single_shell_cpu_Rsba___ ...
,dwT_subda_from_R_single_shell_cpu_Rsba___ ...
,dwT_subdb_from_R_single_shell_cpu_Rsba___ ...
,ddwT_subdaa_from_R_single_shell_cpu_Rsba___ ...
,ddwT_subdab_from_R_single_shell_cpu_Rsba___ ...
,ddwT_subdbb_from_R_single_shell_cpu_Rsba___ ...
);
tmp_t = toc(tmp_t); if (flag_verbose>0); disp(sprintf(' %% interpolate_template S_sub: time %0.6fs',tmp_t)); end;
%%%%%%%%;

fnorm_disp(flag_verbose,'template_cpu_wkS_sub__',template_cpu_wkS_sub__,'template_cp2_wkS_sub__',template_cp2_wkS_sub__,' %%<-- should be zero');
fnorm_disp(flag_verbose,'dtemplateda_cpu_wkS_sub__',dtemplateda_cpu_wkS_sub__,'dtemplateda_cp2_wkS_sub__',dtemplateda_cp2_wkS_sub__,' %%<-- should be zero');
fnorm_disp(flag_verbose,'dtemplatedb_wkS_sub__',dtemplatedb_cpu_wkS_sub__,'dtemplatedb_cp2_wkS_sub__',dtemplatedb_cp2_wkS_sub__,' %%<-- should be zero');
fnorm_disp(flag_verbose,'dtemplatedc_cpu_wkS_sub__',dtemplatedc_cpu_wkS_sub__,'dtemplatedc_cp2_wkS_sub__',dtemplatedc_cp2_wkS_sub__,' %%<-- should be zero');
fnorm_disp(flag_verbose,'ddtemplatedaa_cpu_wkS_sub__',ddtemplatedaa_cpu_wkS_sub__,'ddtemplatedaa_cp2_wkS_sub__',ddtemplatedaa_cp2_wkS_sub__,' %%<-- should be zero');
fnorm_disp(flag_verbose,'ddtemplatedab_cpu_wkS_sub__',ddtemplatedab_cpu_wkS_sub__,'ddtemplatedab_cp2_wkS_sub__',ddtemplatedab_cp2_wkS_sub__,' %%<-- should be zero');
fnorm_disp(flag_verbose,'ddtemplatedac_cpu_wkS_sub__',ddtemplatedac_cpu_wkS_sub__,'ddtemplatedac_cp2_wkS_sub__',ddtemplatedac_cp2_wkS_sub__,' %%<-- should be zero');
fnorm_disp(flag_verbose,'ddtemplatedbb_cpu_wkS_sub__',ddtemplatedbb_cpu_wkS_sub__,'ddtemplatedbb_cp2_wkS_sub__',ddtemplatedbb_cp2_wkS_sub__,' %%<-- should be zero');
fnorm_disp(flag_verbose,'ddtemplatedbc_cpu_wkS_sub__',ddtemplatedbc_cpu_wkS_sub__,'ddtemplatedbc_cp2_wkS_sub__',ddtemplatedbc_cp2_wkS_sub__,' %%<-- should be zero');
fnorm_disp(flag_verbose,'ddtemplatedcc_cpu_wkS_sub__',ddtemplatedcc_cpu_wkS_sub__,'ddtemplatedcc_cp2_wkS_sub__',ddtemplatedcc_cp2_wkS_sub__,' %%<-- should be zero');

