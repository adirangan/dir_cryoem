function ...
[ ...
 parameter ...
,a_CTF_avg_UX_Y__ ...
,euler_polar_a__ ...
,euler_azimu_b__ ...
,euler_gamma_z__ ...
,image_delta_x_acc__ ...
,image_delta_y_acc__ ...
,image_delta_x_upd__ ...
,image_delta_y_upd__ ...
,flag_image_delta_upd__ ...
,image_I_value__ ...
,image_X_value__ ...
,image_S_index__ ...
] = ...
ampmut_wrap_4( ...
 parameter ...
,n_k_p_r ...
,k_p_r_ ...
,k_p_r_max ...
,n_w_max ...
,pm_n_UX_rank ...
,UX__ ...
,X_weight_r_ ...
,n_M ...
,M_k_p__ ...
,n_CTF_rank ...
,CTF_index_ ...
,CTF_k_p_r__ ...
,euler_polar_a_0in_ ...
,euler_azimu_b_0in_ ...
,euler_gamma_z_0in_ ...
,image_delta_x_acc_0in_ ...
,image_delta_y_acc_0in_ ...
);

verbose=2;
if (verbose); disp(sprintf(' %% [entering ampmut_wrap_4]')); end;

if isempty(parameter);
parameter = struct('type','parameter');
end;%if isempty(parameter);
%%%%%%%%;
if (~isfield(parameter,'rseed')); parameter.rseed = 0; end; %<-- parameter_bookmark. ;
if (~isfield(parameter,'delta_r_max')); parameter.delta_r_max = 0.1; end; %<-- parameter_bookmark. ;
if (~isfield(parameter,'n_iteration')); parameter.n_iteration = 32; end; %<-- parameter_bookmark. ;
if (~isfield(parameter,'flag_alternate_MS_vs_SM')); parameter.flag_alternate_MS_vs_SM = 0; end; %<-- parameter_bookmark. ;
if (~isfield(parameter,'flag_local_exclusion')); parameter.flag_local_exclusion = 0; end; %<-- parameter_bookmark. ;
%%%%%%%%;
rseed = parameter.rseed;
delta_r_max = parameter.delta_r_max;
flag_alternate_MS_vs_SM = parameter.flag_alternate_MS_vs_SM;
flag_local_exclusion = parameter.flag_local_exclusion;

na=14;
if (nargin<na); euler_polar_a_0in_ = []; end; na=na+1;
if (nargin<na); euler_azimu_b_0in_ = []; end; na=na+1;
if (nargin<na); euler_gamma_z_0in_ = []; end; na=na+1;
if (nargin<na); image_delta_x_acc_0in_ = []; end; na=na+1;
if (nargin<na); image_delta_y_acc_0in_ = []; end; na=na+1;

%%%%%%%%;
% Now run either ampmut_4 or ampmleut_4. ;
%%%%%%%%;
FTK = [];
pm_n_UX_rank = pm_n_UX_rank;
M_k_q__ = [];
svd_VUXM_lwnM____ = [];
UX_M_l2_dM__ = [];
VSCTF_Mc__ = [];
rng(rseed);
if (~isempty(euler_polar_a_0in_)); euler_polar_a_ = euler_polar_a_0in_; else euler_polar_a_= 1*pi*rand(n_M,1); end;
if (~isempty(euler_azimu_b_0in_)); euler_azimu_b_ = euler_azimu_b_0in_; else euler_azimu_b_= 2*pi*rand(n_M,1); end;
if (~isempty(euler_gamma_z_0in_)); euler_gamma_z_ = euler_gamma_z_0in_; else euler_gamma_z_= 2*pi*rand(n_M,1); end;
if (~isempty(image_delta_x_acc_0in_)); image_delta_x_acc_ = image_delta_x_acc_0in_; else image_delta_x_acc_= zeros(n_M,1); end;
if (~isempty(image_delta_y_acc_0in_)); image_delta_y_acc_ = image_delta_y_acc_0in_; else image_delta_y_acc_= zeros(n_M,1); end;
image_delta_x_upd_ = [];
image_delta_y_upd_ = [];
flag_image_delta_upd_ = [];
image_I_value_ = [];
%%%%;
if (flag_local_exclusion==0);
tmp_t = tic;
[ ...
 parameter ...
,flag_image_delta_upd_ ...
,FTK ...
,M_k_q__ ...
,svd_VUXM_lwnM____ ...
,UX_M_l2_dM__ ...
,VSCTF_Mc__ ...
,a_CTF_avg_UX_Y__ ...
,euler_polar_a__ ...
,euler_azimu_b__ ...
,euler_gamma_z__ ...
,image_delta_x_acc__ ...
,image_delta_y_acc__ ...
,image_delta_x_upd__ ...
,image_delta_y_upd__ ...
,flag_image_delta_upd__ ...
,image_I_value__ ...
,image_X_value__ ...
,image_S_index__ ...
] = ...
ampmut_4( ...
 parameter ...
,n_k_p_r ...
,k_p_r_ ...
,k_p_r_max ...
,n_w_max ...
,FTK ...
,pm_n_UX_rank ...
,UX__ ...
,X_weight_r_ ...
,n_M ...
,M_k_p__ ...
,M_k_q__ ...
,svd_VUXM_lwnM____ ...
,UX_M_l2_dM__ ...
,n_CTF_rank ...
,CTF_index_ ...
,CTF_k_p_r__ ...
,VSCTF_Mc__ ...
,euler_polar_a_ ...
,euler_azimu_b_ ...
,euler_gamma_z_ ...
,image_delta_x_acc_ ...
,image_delta_y_acc_ ...
,image_delta_x_upd_ ...
,image_delta_y_upd_ ...
,flag_image_delta_upd_ ...
,image_I_value_ ...
);
tmp_t = toc(tmp_t); disp(sprintf(' %% ampmut_4: time %0.2fs',tmp_t));
end;%if (flag_local_exclusion==0);
%%%%;
if (flag_local_exclusion==1);
tmp_t = tic;
[ ...
 parameter ...
,flag_image_delta_upd_ ...
,FTK ...
,M_k_q__ ...
,svd_VUXM_lwnM____ ...
,UX_M_l2_dM__ ...
,VSCTF_Mc__ ...
,a_CTF_avg_UX_Y__ ...
,euler_polar_a__ ...
,euler_azimu_b__ ...
,euler_gamma_z__ ...
,image_delta_x_acc__ ...
,image_delta_y_acc__ ...
,image_delta_x_upd__ ...
,image_delta_y_upd__ ...
,flag_image_delta_upd__ ...
,image_I_value__ ...
,image_X_value__ ...
,image_S_index__ ...
] = ...
ampmleut_4( ...
 parameter ...
,n_k_p_r ...
,k_p_r_ ...
,k_p_r_max ...
,n_w_max ...
,FTK ...
,pm_n_UX_rank ...
,UX__ ...
,X_weight_r_ ...
,n_M ...
,M_k_p__ ...
,M_k_q__ ...
,svd_VUXM_lwnM____ ...
,UX_M_l2_dM__ ...
,n_CTF_rank ...
,CTF_index_ ...
,CTF_k_p_r__ ...
,VSCTF_Mc__ ...
,euler_polar_a_ ...
,euler_azimu_b_ ...
,euler_gamma_z_ ...
,image_delta_x_acc_ ...
,image_delta_y_acc_ ...
,image_delta_x_upd_ ...
,image_delta_y_upd_ ...
,flag_image_delta_upd_ ...
,image_I_value_ ...
);
tmp_t = toc(tmp_t); disp(sprintf(' %% ampmleut_4: time %0.2fs',tmp_t));
end;%if (flag_local_exclusion==1);
%%%%;

if ( isfield(parameter,'fname_pre'));
fname_mat = sprintf('%s.mat',parameter.fname_pre);
disp(sprintf(' %% writing %s',fname_mat));
save(fname_mat ...
,'parameter' ...
,'a_CTF_avg_UX_Y__' ...
,'euler_polar_a__' ...
,'euler_azimu_b__' ...
,'euler_gamma_z__' ...
,'image_delta_x_acc__' ...
,'image_delta_y_acc__' ...
,'image_delta_x_upd__' ...
,'image_delta_y_upd__' ...
,'flag_image_delta_upd__' ...
,'image_I_value__' ...
,'image_X_value__' ...
,'image_S_index__' ...
);
end;%if ( isfield(parameter,'fname_pre'));

if (verbose); disp(sprintf(' %% [finished ampmut_wrap_4]')); end;
