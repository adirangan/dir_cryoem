%%%%%%%%;
% Determine critical dtau. ;
%%%%%%%%;
dtau_dtau_inv_ssnll_q2d_33M___ = zeros(n_3,n_3,n_M);
for nM=0:n_M-1;
dtau_dtau_inv_ssnll_q2d_33M___(:,:,1+nM) = ...
pinv( ...
      sqrt(weight_imagecount_M_(1+nM)) ...
      *squeeze(dtau_dtau_ssnll_q2d_33M___(:,:,1+nM)) ...
      *sqrt(weight_imagecount_M_(1+nM)) ...
      ,tolerance_pinv ...
    ) ...
;
end;%for nM=0:n_M-1;
dtau_firstorder_3M__ = zeros(n_3,n_M);
dtau_firstorder_3M__ = ...
reshape( ...
	 pagemtimes( ...
		     -real(dtau_dtau_inv_ssnll_q2d_33M___) ...
		     ,bsxfun(@plus ...
			     ,reshape( ...
				       real(bsxfun(@times ...
						   ,dtau_dvol_ssnll_q2d_3M__ ...
						   ,transpose(weight_imagecount_M_)) ...
					   ) ...
				       ,[n_3,1,n_M] ...
				     ) ...
			     ,reshape( ...
				       bsxfun(@times ...
					       ,dtau_ssnll_q2d_3M__ ...
					       ,transpose(weight_imagecount_M_) ...
					     ) ...
				       ,[n_3,1,n_M] ...
				     ) ...
			    ) ...
		   ) ...
	 ,[n_3,n_M] ...
       ) ...
;
dtau_firstorder_M3__ = permute(dtau_firstorder_3M__,[2,1]);
%%%%;
