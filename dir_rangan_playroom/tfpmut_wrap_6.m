function ...
[ ...
 parameter ...
,a_k_Y_reco_yki__ ...
,euler_polar_a_Mi__ ...
,euler_azimu_b_Mi__ ...
,euler_gamma_z_Mi__ ...
,image_delta_x_acc_Mi__ ...
,image_delta_y_acc_Mi__ ...
,image_delta_x_upd_Mi__ ...
,image_delta_y_upd_Mi__ ...
,flag_image_delta_upd_Mi__ ...
,image_I_value_Mi__ ...
,image_X_value_Mi__ ...
,image_S_index_Mi__ ...
] = ...
tfpmut_wrap_6( ...
 parameter ...
,n_k_p_r ...
,k_p_r_ ...
,k_p_r_max ...
,weight_3d_k_p_r_ ...
,weight_2d_k_p_r_ ...
,n_w_ ...
,weight_2d_k_p_wk_ ...
,l_max_ ...
,n_CTF ...
,CTF_k_p_wkC__ ...
,index_nCTF_from_nM_ ...
,n_M ...
,M_k_p_wkM__ ...
,ini_euler_polar_a_M_ ...
,ini_euler_azimu_b_M_ ...
,ini_euler_gamma_z_M_ ...
,ini_image_delta_x_acc_M_ ...
,ini_image_delta_y_acc_M_ ...
,a_k_Y_base_yk_ ...
,delta_sigma_base ...
);

str_thisfunction = 'tfpmut_wrap_6';

na=0;
if (nargin<1+na); parameter=[]; end; na=na+1;
if (nargin<1+na); n_k_p_r=[]; end; na=na+1;
if (nargin<1+na); k_p_r_=[]; end; na=na+1;
if (nargin<1+na); k_p_r_max=[]; end; na=na+1;
if (nargin<1+na); weight_3d_k_p_r_=[]; end; na=na+1;
if (nargin<1+na); weight_2d_k_p_r_=[]; end; na=na+1;
if (nargin<1+na); n_w_=[]; end; na=na+1;
if (nargin<1+na); weight_2d_k_p_wk_=[]; end; na=na+1;
if (nargin<1+na); l_max_=[]; end; na=na+1;
if (nargin<1+na); n_CTF=[]; end; na=na+1;
if (nargin<1+na); CTF_k_p_wkC__=[]; end; na=na+1;
if (nargin<1+na); index_nCTF_from_nM_=[]; end; na=na+1;
if (nargin<1+na); n_M=[]; end; na=na+1;
if (nargin<1+na); M_k_p_wkM__=[]; end; na=na+1;
if (nargin<1+na); ini_euler_polar_a_M_=[]; end; na=na+1;
if (nargin<1+na); ini_euler_azimu_b_M_=[]; end; na=na+1;
if (nargin<1+na); ini_euler_gamma_z_M_=[]; end; na=na+1;
if (nargin<1+na); ini_image_delta_x_acc_M_=[]; end; na=na+1;
if (nargin<1+na); ini_image_delta_y_acc_M_=[]; end; na=na+1;
if (nargin<1+na); a_k_Y_base_yk_=[]; end; na=na+1;
if (nargin<1+na); delta_sigma_base=[]; end; na=na+1;

if isempty(parameter); parameter = struct('type','parameter'); end;%if isempty(parameter);
%%%%%%%%;
if (~isfield(parameter,'fname_pre')); disp(sprintf(' %% Warning, fname_pre not set in %s',str_thisfunction)); end; %<-- parameter_bookmark. ;
fname_pre = parameter.fname_pre;
if (~isfield(parameter,'flag_verbose')); parameter.flag_verbose = 0; end; %<-- parameter_bookmark. ;
flag_verbose = parameter.flag_verbose;
if (~isfield(parameter,'tolerance_master')); parameter.tolerance_master = 1e-2; end; %<-- parameter_bookmark. ;
tolerance_master = parameter.tolerance_master;
if (~isfield(parameter,'flag_gpu')); parameter.flag_gpu = 0; end; %<-- parameter_bookmark. ;
flag_gpu=parameter.flag_gpu;
if (~isfield(parameter,'flag_rank_vs_tolerance')); parameter.flag_rank_vs_tolerance = 0; end; %<-- parameter_bookmark. ;
flag_rank_vs_tolerance = parameter.flag_rank_vs_tolerance;
if (~isfield(parameter,'flag_clump_vs_cluster')); parameter.flag_clump_vs_cluster = parameter.flag_rank_vs_tolerance; end; %<-- parameter_bookmark. ;
parameter.flag_clump_vs_cluster = parameter.flag_rank_vs_tolerance; flag_clump_vs_cluster = parameter.flag_clump_vs_cluster; %<-- force;
if (~isfield(parameter,'tolerance_cluster')); parameter.tolerance_cluster = parameter.tolerance_master; end; %<-- parameter_bookmark. ;
tolerance_cluster = parameter.tolerance_cluster;
if (~isfield(parameter,'tolerance_pm')); parameter.tolerance_pm = parameter.tolerance_master; end; %<-- parameter_bookmark. ;
tolerance_pm = parameter.tolerance_pm;
if (~isfield(parameter,'rank_pm')); parameter.rank_pm = 10; end; %<-- parameter_bookmark. ;
rank_pm = parameter.rank_pm;
if (~isfield(parameter,'rank_CTF'));
SCTF_ = svd(CTF_k_p_wkC__(:,1+index_nCTF_from_nM_(1:n_M)));
rank_CTF = 1+max(efind(SCTF_/max(1e-12,SCTF_)>parameter.tolerance_master));
parameter.rank_CTF = rank_CTF; %<-- parameter_bookmark. ;
end;%if (~isfield(parameter,'rank_CTF')); 
rank_CTF = parameter.rank_CTF;
if (~isfield(parameter,'rseed')); parameter.rseed = 0; end; %<-- parameter_bookmark. ;
rseed = parameter.rseed;
if (~isfield(parameter,'delta_r_max')); parameter.delta_r_max = 0.1; end; %<-- parameter_bookmark. ;
delta_r_max = parameter.delta_r_max;
if (~isfield(parameter,'n_iteration')); parameter.n_iteration = 32; end; %<-- parameter_bookmark. ;
n_iteration = parameter.n_iteration;
if (~isfield(parameter,'flag_alternate_MS_vs_SM')); parameter.flag_alternate_MS_vs_SM = 1; end; %<-- parameter_bookmark. ;
flag_alternate_MS_vs_SM = parameter.flag_alternate_MS_vs_SM;
if (~isfield(parameter,'flag_save_stage')); parameter.flag_save_stage = 0; end; %<-- parameter_bookmark. ;
flag_save_stage = parameter.flag_save_stage;
%%%%%%%%;

if (flag_verbose>0); disp(sprintf(' %% [entering %s]',str_thisfunction)); end;

%%%%%%%%;
% index bounds. ;
%%%%%%%%;
n_w_ = n_w_(1:n_k_p_r); n_w_sum = sum(n_w_); n_w_max = max(n_w_); n_w_csum_ = cumsum([0;n_w_]);
if (std(diff(n_w_csum_),1)>1e-6); disp(sprintf(' %% Warning, flag_uniform_over_n_k_p_r==1 expected in %s',str_thisfunction)); end;
n_w_max = n_w_csum_(1+1);
if mod(n_w_max,2)~=0; disp(sprintf(' %% Warning, n_w_max %d in %s',n_w_max,str_thisfunction)); end;
assert(n_w_sum==n_w_max*n_k_p_r);
l_max_max = max(l_max_);
n_y_ = (l_max_+1).^2;
n_y_max = max(n_y_);
n_y_sum = sum(n_y_);
n_y_csum_ = cumsum([0;n_y_]);

%%%%%%%%;
if ( isfield(parameter,'fname_pre'));
fname_mat = sprintf('%s_stage_0.mat',parameter.fname_pre);
disp(sprintf(' %% writing %s',fname_mat));
save(fname_mat ...
,'flag_verbose' ...
,'tolerance_master' ...
,'flag_gpu' ...
,'flag_rank_vs_tolerance' ...
,'flag_clump_vs_cluster' ...
,'tolerance_cluster' ...
,'tolerance_pm' ...
,'rank_pm' ...
,'rank_CTF' ...
,'rseed' ...
,'delta_r_max' ...
,'n_iteration' ...
,'flag_alternate_MS_vs_SM' ...
,'n_w_' ...
,'n_w_sum' ...
,'n_w_max' ...
,'n_w_csum_' ...
,'l_max_max' ...
,'n_y_' ...
,'n_y_max' ...
,'n_y_sum' ...
,'n_y_csum_' ...
);
end;%if ( isfield(parameter,'fname_pre'));
%%%%%%%%;

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%;
if (flag_clump_vs_cluster==0);
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%;

%%%%%%%%;
% Find clusters. ;
%%%%%%%%;
tmp_t=tic();
CTF_k_p_r_kC__ = reshape(mean(reshape(CTF_k_p_wkC__,[n_w_max,n_k_p_r,n_CTF]),1+0),[n_k_p_r,n_CTF]);
[ ...
 parameter ...
,index_ncluster_from_nCTF_ ...
] = ...
knn_cluster_CTF_k_p_r_kC__1( ...
 parameter ...
,n_k_p_r ...
,k_p_r_ ...
,weight_2d_k_p_r_ ...
,n_CTF ...
,CTF_k_p_r_kC__ ...
);
%%%%%%%%;
n_cluster = 1+max(index_ncluster_from_nCTF_);
index_ncluster_from_nM_ = index_ncluster_from_nCTF_(1+index_nCTF_from_nM_);
index_nM_from_ncluster__ = cell(n_cluster,1);
n_index_nM_from_ncluster_ = zeros(n_cluster,1);
for ncluster=0:n_cluster-1;
index_nM_from_ncluster__{1+ncluster} = efind(index_ncluster_from_nM_==ncluster);
n_index_nM_from_ncluster_(1+ncluster) = numel(index_nM_from_ncluster__{1+ncluster});
end;%for ncluster=0:n_cluster-1;
tmp_t = toc(tmp_t); if (flag_verbose>1); disp(sprintf(' %% knn_cluster_CTF_k_p_r_kC__1: time %0.2fs',tmp_t)); end;
parameter = parameter_timing_update(parameter,sprintf('%s: knn_cluster_CTF_k_p_r_kC__1',str_thisfunction),tmp_t);

%%%%%%%%;
if flag_save_stage;
if ( isfield(parameter,'fname_pre'));
fname_mat = sprintf('%s_stage_1.mat',parameter.fname_pre);
disp(sprintf(' %% writing %s',fname_mat));
save(fname_mat ...
,'index_ncluster_from_nCTF_' ...
,'n_k_p_r' ...
,'k_p_r_' ...
,'weight_2d_k_p_r_' ...
,'n_CTF' ...
,'CTF_k_p_r_kC__' ...
,'index_nM_from_ncluster__' ...
,'n_index_nM_from_ncluster_' ...
);
end;%if ( isfield(parameter,'fname_pre'));
end;%if flag_save_stage;
%%%%%%%%;

%%%%%%%%;
% Now determine the principal-modes for each cluster. ;
%%%%%%%%;
if  isempty(a_k_Y_base_yk_);
tmp_t=tic();
X_2d_Memp_d1_kkc___ = zeros(n_k_p_r,n_k_p_r,n_cluster);
X_2d_Memp_d1_weight_rc__ = zeros(n_k_p_r,n_cluster);
for ncluster=0:n_cluster-1;
index_nM_from_ncluster_ = index_nM_from_ncluster__{1+ncluster};
n_index_nM_from_ncluster = n_index_nM_from_ncluster_(1+ncluster);
assert(n_index_nM_from_ncluster==numel(index_nM_from_ncluster_));
[ ...
 X_2d_Memp_d1_kk__ ...
,X_2d_Memp_d1_weight_r_ ...
] = ...
principled_marching_empirical_cost_matrix_2( ...
 n_k_p_r ...
,k_p_r_ ...
,weight_2d_k_p_r_ ...
,n_w_ ...
,n_index_nM_from_ncluster ...
,M_k_p_wkM__(:,1+index_nM_from_ncluster_) ...
);
X_2d_Memp_d1_kkc___(:,:,1+ncluster) = X_2d_Memp_d1_kk__;
X_2d_Memp_d1_weight_rc__(:,1+ncluster) = X_2d_Memp_d1_weight_r_;
clear X_2d_Memp_d1_kk__ X_2d_Memp_d1_weight_r_ ;
end;%for ncluster=0:n_cluster-1;
pm_X_kkc___ = X_2d_Memp_d1_kkc___;
pm_X_weight_rc__ = X_2d_Memp_d1_weight_rc__;
clear X_2d_Memp_d1_kkc___ X_2d_Memp_d1_weight_rc__ ;
tmp_t = toc(tmp_t); if (flag_verbose>1); disp(sprintf(' %% principled_marching_empirical_cost_matrix_2: time %0.2fs',tmp_t)); end;
parameter = parameter_timing_update(parameter,sprintf('%s: principled_marching_empirical_cost_matrix_2',str_thisfunction),tmp_t);
end;%if  isempty(a_k_Y_base_yk_);
%%%%%%%%;
if ~isempty(a_k_Y_base_yk_);
if isempty(delta_sigma_base); delta_sigma_base = 0.0; end; %<-- no translation as default. ;
X_2d_xavg_dx_kkc___ = zeros(n_k_p_r,n_k_p_r,n_cluster);
X_2d_xavg_dx_weight_rc__ = zeros(n_k_p_r,n_cluster);
for ncluster=0:n_cluster-1;
index_nM_from_ncluster_ = index_nM_from_ncluster__{1+ncluster};
n_index_nM_from_ncluster = n_index_nM_from_ncluster_(1+ncluster);
assert(n_index_nM_from_ncluster==numel(index_nM_from_ncluster_));
tmp_CTF_k_p_r_xavg_k_ = mean(CTF_k_p_r_kC__(:,1+index_nCTF_from_nM_(1+index_nM_from_ncluster_)),1+1);
tmp_CTF_k_p_r_xavg_kk__ = tmp_CTF_k_p_r_xavg_k_*transpose(tmp_CTF_k_p_r_xavg_k_);
tmp_t=tic();
[ ...
 X_2d_xavg_dx_kk__ ...
,X_2d_xavg_dx_weight_r_ ...
] = ...
principled_marching_cost_matrix_7( ...
 n_k_p_r ...
,k_p_r_ ...
,weight_2d_k_p_r_ ...
,l_max_ ...
,[] ...
,[] ...
,a_k_Y_base_yk_ ...
,tmp_CTF_k_p_r_xavg_kk__ ...
,delta_sigma_base ...
);
tmp_t = toc(tmp_t); if (flag_verbose>1); disp(sprintf(' %% principled_marching_cost_matrix_7: time %0.2fs',tmp_t)); end;
parameter = parameter_timing_update(parameter,sprintf('%s: principled_marching_cost_matrix_7',str_thisfunction),tmp_t);
X_2d_xavg_dx_kkc___(:,:,1+ncluster) = X_2d_xavg_dx_kk__;
X_2d_xavg_dx_weight_rc__(:,1+ncluster) = X_2d_xavg_dx_weight_r_;
clear X_2d_xavg_dx_kk__ X_2d_xavg_dx_weight_r_ ;
end;%for ncluster=0:n_cluster-1;
pm_X_kkc___ = X_2d_xavg_dx_kkc___;
pm_X_weight_rc__ = X_2d_xavg_dx_weight_rc__;
clear X_2d_xavg_dx_kkc___ X_2d_xavg_dx_weight_rc__ ;
end;%if ~isempty(a_k_Y_base_yk_);
%%%%%%%%;
tmp_t = tic();
n_UX_rank = n_k_p_r-1; %<-- just to check dimensions. ;
pm_UX_knc___ = zeros(n_k_p_r,n_UX_rank,n_cluster);
pm_SX_kc__ = zeros(n_UX_rank,n_cluster);
pm_n_UX_rank_c_ = zeros(n_cluster,1);
for ncluster=0:n_cluster-1;
tmp_X_kk__ = pm_X_kkc___(:,:,1+ncluster);
[tmp_UX__,tmp_SX__,tmp_VX__] = svds(tmp_X_kk__,n_UX_rank); tmp_SX_ = diag(tmp_SX__);
pm_n_UX_rank = 1+max(efind(tmp_SX_/max(1e-12,tmp_SX_)> tolerance_pm));
pm_UX_knc___(:,:,1+ncluster) = tmp_UX__(:,1+[0:n_UX_rank-1]);
pm_SX_kc__(:,1+ncluster) = tmp_SX_(1+[0:n_UX_rank-1]);
pm_n_UX_rank_c_(1+ncluster) = pm_n_UX_rank;
if (flag_verbose>1); disp(sprintf(' %% ncluster %.2d/%.2d: pm_n_UX_rank %d/%d',ncluster,n_cluster,pm_n_UX_rank,n_UX_rank)); end;
end;%for ncluster=0:n_cluster-1;
tmp_t = toc(tmp_t); if (flag_verbose>1); disp(sprintf(' %% pm_UX_knc___: %0.3fs',tmp_t)); end;
parameter = parameter_timing_update(parameter,sprintf('%s: tmp_X_kk__',str_thisfunction),tmp_t);

%%%%%%%%;
if flag_save_stage;
if ( isfield(parameter,'fname_pre'));
fname_mat = sprintf('%s_stage_2.mat',parameter.fname_pre);
disp(sprintf(' %% writing %s',fname_mat));
save(fname_mat ...
,'n_UX_rank' ...
,'pm_UX_knc___' ...
,'pm_SX_kc__' ...
,'pm_n_UX_rank_c_' ...
);
end;%if ( isfield(parameter,'fname_pre'));
end;%if flag_save_stage;
%%%%%%%%;

%%%%%%%%;
if ( isfield(parameter,'fname_pre'));
fname_fig = sprintf('%s_UX_FIGA',parameter.fname_pre);
if (~exist(sprintf('%s.jpg',fname_fig),'file'));
disp(sprintf(' %% %s not found, creating',fname_fig));
figure(1);clf;figbig;figbeach();
ns=0;
%%%%;
subplot(2,3,1+ns);ns=ns+1;
[tmp_UCTF__,tmp_SCTF__,tmp_VCTF__] = svds(CTF_k_p_r_kC__,min(n_CTF,min(n_k_p_r,2)));
tmp_VSCTF__ = tmp_VCTF__*tmp_SCTF__;
c_beach__ = colormap_beach(); n_c_beach = size(c_beach__,1);
markersize_use = 16;
str_symbol_ = {'o','^','s','p','h'};
hold on;
for nCTF=0:n_CTF-1;
ncluster = index_ncluster_from_nCTF_(1+nCTF);
nc_beach = max(0,min(n_c_beach,floor(n_c_beach*ncluster/max(1,n_cluster))));
str_symbol = str_symbol_{1+mod(ncluster,5)};
plot(tmp_VSCTF__(1+nCTF,1),tmp_VSCTF__(1+nCTF,min(2,size(tmp_VSCTF__,2))),str_symbol,'MarkerSize',markersize_use,'MarkerFaceColor',c_beach__(1+nc_beach,:),'MarkerEdgeColor',0.85*[1,1,1]);
end;%for nCTF=0:n_CTF-1;
hold off;
axis equal;
xlabel('pc0');ylabel('pc1');
title('CTF-space colored by cluster');
%%%%;
for nl=0:min(5,n_cluster)-1;
ncluster = nl;
pm_n_UX_rank = pm_n_UX_rank_c_(1+ncluster);
subplot(2,3,1+ns);ns=ns+1;
tmp_X_ = diag(pm_X_kkc___(:,:,1+ncluster));
tmp_X_ = tmp_X_/max(1e-12,fnorm(tmp_X_));
tmp_X_U__ = [ tmp_X_ , pm_UX_knc___(:,1:pm_n_UX_rank,1+ncluster) ];
tmp_lim_ = 1.5*std(tmp_X_U__,1,'all')*[-1,+1];
imagesc(tmp_X_U__,tmp_lim_);
xlabel('mode'); set(gca,'XTick',1:size(tmp_X_U__,2),'XTickLabel',{'X',1:pm_n_UX_rank});
ylabel('k');
title(sprintf('ncluster %d/%d',ncluster,n_cluster));
end;%for nl=0:min(5,n_cluster)-1;
%%%%;
sgtitle(fname_fig,'Interpreter','none');
disp(sprintf(' %% writing %s',fname_fig));
print('-djpeg',sprintf('%s.jpg',fname_fig));
print('-depsc',sprintf('%s.eps',fname_fig));
close(gcf);
%%%%;
end;%if (~exist(sprintf('%s.jpg',fname_fig),'file'));
if ( exist(sprintf('%s.jpg',fname_fig),'file'));
disp(sprintf(' %% %s found, not creating',fname_fig));
end;%if ( exist(sprintf('%s.jpg',fname_fig),'file'));
%%%%;
end;%if ( isfield(parameter,'fname_pre'));
%%%%%%%%;

%%%%%%%%;
% Now run tfpmut_6. ;
%%%%%%%%;
a_k_Y_reco_yki__ = [];
FTK=[];
rng(rseed);
if ~isempty(ini_euler_polar_a_M_); euler_polar_a_M_ = ini_euler_polar_a_M_; else euler_polar_a_M_= 1*pi*rand(n_M,1); end;
if ~isempty(ini_euler_azimu_b_M_); euler_azimu_b_M_ = ini_euler_azimu_b_M_; else euler_azimu_b_M_= 2*pi*rand(n_M,1); end;
if ~isempty(ini_euler_gamma_z_M_); euler_gamma_z_M_ = ini_euler_gamma_z_M_; else euler_gamma_z_M_= 2*pi*rand(n_M,1); end;
if ~isempty(ini_image_delta_x_acc_M_); image_delta_x_acc_M_ = ini_image_delta_x_acc_M_; else image_delta_x_acc_M_= zeros(n_M,1); end;
if ~isempty(ini_image_delta_y_acc_M_); image_delta_y_acc_M_ = ini_image_delta_y_acc_M_; else image_delta_y_acc_M_= zeros(n_M,1); end;
image_delta_x_upd_M_ = [];
image_delta_y_upd_M_ = [];
flag_image_delta_upd_M_ = [];
image_I_value_M_ = [];
%%%%%%%%;
if flag_save_stage;
if ( isfield(parameter,'fname_pre'));
fname_mat = sprintf('%s_stage_3.mat',parameter.fname_pre);
disp(sprintf(' %% writing %s',fname_mat));
save(fname_mat ...
,'n_k_p_r' ...
,'k_p_r_' ...
,'k_p_r_max' ...
,'weight_3d_k_p_r_' ...
,'weight_2d_k_p_r_' ...
,'n_w_' ...
,'weight_2d_k_p_wk_' ...
,'l_max_' ...
,'n_CTF' ...
,'CTF_k_p_wkC__' ...
,'index_nCTF_from_nM_' ...
,'n_M' ...
,'M_k_p_wkM__' ...
,'n_cluster' ...
,'index_ncluster_from_nCTF_' ...
,'pm_n_UX_rank_c_' ...
,'pm_UX_knc___' ...
,'pm_X_weight_rc__' ...
,'euler_polar_a_M_' ...
,'euler_azimu_b_M_' ...
,'euler_gamma_z_M_' ...
,'image_delta_x_acc_M_' ...
,'image_delta_y_acc_M_' ...
);
end;%if ( isfield(parameter,'fname_pre'));
end;%if flag_save_stage;
%%%%%%%%;
%%%%;
tmp_t = tic;
[ ...
 parameter ...
,a_k_Y_reco_yki__ ...
,euler_polar_a_Mi__ ...
,euler_azimu_b_Mi__ ...
,euler_gamma_z_Mi__ ...
,image_delta_x_acc_Mi__ ...
,image_delta_y_acc_Mi__ ...
,image_delta_x_upd_Mi__ ...
,image_delta_y_upd_Mi__ ...
,flag_image_delta_upd_Mi__ ...
,image_I_value_Mi__ ...
,image_X_value_Mi__ ...
,image_S_index_Mi__ ...
] = ...
tfpmut_6( ...
 parameter ...
,n_k_p_r ...
,k_p_r_ ...
,k_p_r_max ...
,weight_3d_k_p_r_ ...
,weight_2d_k_p_r_ ...
,n_w_ ...
,weight_2d_k_p_wk_ ...
,l_max_ ...
,n_CTF ...
,CTF_k_p_wkC__ ...
,index_nCTF_from_nM_ ...
,n_M ...
,M_k_p_wkM__ ...
,n_cluster ...
,index_ncluster_from_nCTF_ ...
,pm_n_UX_rank_c_ ...
,pm_UX_knc___ ...
,pm_X_weight_rc__ ...
,FTK ...
,euler_polar_a_M_ ...
,euler_azimu_b_M_ ...
,euler_gamma_z_M_ ...
,image_delta_x_acc_M_ ...
,image_delta_y_acc_M_ ...
,image_delta_x_upd_M_ ...
,image_delta_y_upd_M_ ...
,flag_image_delta_upd_M_ ...
,image_I_value_M_ ...
);
tmp_t = toc(tmp_t); if (flag_verbose>1); disp(sprintf(' %% tfpmut_6: time %0.2fs',tmp_t)); end;
parameter = parameter_timing_update(parameter,sprintf('%s: tfpmut_6',str_thisfunction),tmp_t);
%%%%%%%%;

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%;
end;%if (flag_clump_vs_cluster==0);
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%;

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%;
if (flag_clump_vs_cluster==1);
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%;
disp(sprintf(' %% Warning, flag_clump_vs_cluster==%d not implemented in %s',flag_clump_vs_cluster,str_thisfunction));
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%;
end;%if (flag_clump_vs_cluster==1);
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%;

%%%%%%%%;
if ( isfield(parameter,'fname_pre'));
fname_mat = sprintf('%s.mat',parameter.fname_pre);
disp(sprintf(' %% writing %s',fname_mat));
save(fname_mat ...
,'parameter' ...
,'a_k_Y_reco_yki__' ...
,'euler_polar_a_Mi__' ...
,'euler_azimu_b_Mi__' ...
,'euler_gamma_z_Mi__' ...
,'image_delta_x_acc_Mi__' ...
,'image_delta_y_acc_Mi__' ...
,'image_delta_x_upd_Mi__' ...
,'image_delta_y_upd_Mi__' ...
,'flag_image_delta_upd_Mi__' ...
,'image_I_value_Mi__' ...
,'image_X_value_Mi__' ...
,'image_S_index_Mi__' ...
);
end;%if ( isfield(parameter,'fname_pre'));
%%%%%%%%;

if (flag_verbose>0); disp(sprintf(' %% [finished %s]',str_thisfunction)); end;
