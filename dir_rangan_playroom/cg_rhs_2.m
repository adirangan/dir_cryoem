function ...
[ ...
 k_p_polar_a_wM__ ...
,k_p_azimu_b_wM__ ...
,k_c_0_wM__ ...
,k_c_1_wM__ ...
,k_c_2_wM__ ...
,k_p_r01_wM__ ...
,dtau_k_p_polar_a_wM3___ ...
,dtau_k_p_azimu_b_wM3___ ...
,dtau_k_c_0_wM3___ ...
,dtau_k_c_1_wM3___ ...
,dtau_k_c_2_wM3___ ...
,dtau_k_p_r01_wM3___ ...
,dtau_dtau_k_p_polar_a_wM33____ ...
,dtau_dtau_k_p_azimu_b_wM33____ ...
,dtau_dtau_k_c_0_wM33____ ...
,dtau_dtau_k_c_1_wM33____ ...
,dtau_dtau_k_c_2_wM33____ ...
,dtau_dtau_k_p_r01_wM33____ ...
] = ...
cg_rhs_2( ...
 n_M ...
,n_w ...
,viewing_polar_a_M_ ...
,viewing_azimu_b_M_ ...
,viewing_gamma_z_M_ ...
);
%%%%%%%%;
% returns right-hand-side for a least-squares problem, ;
% comprising the values of M_k_p_wM__, along with their locations (in k_p_polar_a and k_p_azimu_b_). ;
% In this context, M_k_p_wM__ refers to a complex array of size n_w-by-n_M. ;
% M_k_p_wM__(1+nw,1+nM) contains the (complex) value of image-ring nM at angle gamma_z_(1+nw) = 2*pi*nw/n_w. ;
%%%%;
% Inputs: ;
% n_M = integer number of image-rings (each image is a single ring). ;
% n_w = integer number of gamma_z values for each image-ring. ;
%       We assume gamma_z_ = linspace(0,2*pi,n_w+1); gamma_z_ = gamma_z(1:end-1);
% viewing_polar_a_M_ = double array of size n_M. viewing_polar_a_M_(1+nM) contains the viewing_polar_a for image-ring nM. ;
% viewing_azimu_b_M_ = double array of size n_M. viewing_azimu_b_M_(1+nM) contains the viewing_azimu_b for image-ring nM. ;
% viewing_gamma_z_M_ = double array of size n_M. viewing_gamma_z_M_(1+nM) contains the viewing_gamma_z for image-ring nM. ;
%%%%;
% Outputs: ;
% k_p_polar_a_wM__ = double array of size n_w-by-n_M. k_p_polar_a_wM__(1+nw,1+nM) lists the k_p_polar_a for point nw of image-ring nM. ;
% k_p_azimu_b_wM__ = double array of size n_w-by-n_M. k_p_azimu_b_wM__(1+nw,1+nM) lists the k_p_azimu_b for point nw of image-ring nM. ;
% k_c_0_wM__ = double array of size n_w-by-n_M. k_c_0_wM__(1+nw,1+nM) lists the k_c_0 for point nw of image-ring nM. ;
% k_c_1_wM__ = double array of size n_w-by-n_M. k_c_0_wM__(1+nw,1+nM) lists the k_c_1 for point nw of image-ring nM. ;
% k_c_2_wM__ = double array of size n_w-by-n_M. k_c_0_wM__(1+nw,1+nM) lists the k_c_2 for point nw of image-ring nM. ;
% ;
% first-derivates (e.g., dtau_k_c_0_wM3___) are organized such that: ;
% dtau_k_c_0_wM3___(:,:,1+0) is the derivative w.r.t. viewing_polar_a. ;
% dtau_k_c_0_wM3___(:,:,1+1) is the derivative w.r.t. viewing_azimu_b. ;
% dtau_k_c_0_wM3___(:,:,1+2) is the derivative w.r.t. viewing_gamma_z. ;
% ;
% second-derivates (e.g., dtau_dtau_k_c_0_wM33____) are organized such that: ;
% dtau_dtau_k_c_0_wM33____(:,:,1+0,1+0) is the derivative w.r.t. viewing_polar_a and viewing_polar_a. ;
% dtau_dtau_k_c_0_wM33____(:,:,1+0,1+1) is the derivative w.r.t. viewing_polar_a and viewing_azimu_b. ;
% dtau_dtau_k_c_0_wM33____(:,:,1+0,1+2) is the derivative w.r.t. viewing_polar_a and viewing_gamma_z. ;
% dtau_dtau_k_c_0_wM33____(:,:,1+1,1+0) is the derivative w.r.t. viewing_azimu_b and viewing_polar_a. ;
% dtau_dtau_k_c_0_wM33____(:,:,1+1,1+1) is the derivative w.r.t. viewing_azimu_b and viewing_azimu_b. ;
% dtau_dtau_k_c_0_wM33____(:,:,1+1,1+2) is the derivative w.r.t. viewing_azimu_b and viewing_gamma_z. ;
% dtau_dtau_k_c_0_wM33____(:,:,1+2,1+0) is the derivative w.r.t. viewing_gamma_z and viewing_polar_a. ;
% dtau_dtau_k_c_0_wM33____(:,:,1+2,1+1) is the derivative w.r.t. viewing_gamma_z and viewing_azimu_b. ;
% dtau_dtau_k_c_0_wM33____(:,:,1+2,1+2) is the derivative w.r.t. viewing_gamma_z and viewing_gamma_z. ;
%%%%;
% For this calculation we use the same assumptions made in get_template_0.m: ;
% The general formula used here is as follows. ;
% let sa and ca be sin(viewing_polar_a) and cos(viewing_polar_a), respectively. ;
% let sb and cb be sin(viewing_azimu_b) and cos(viewing_azimu_b), respectively. ;
% let sc and cc be sin(inplane_gamma_z) and cos(inplane_gamma_z), respectively. ;
% And rotation by viewing_azimu_b about the +z-axis is represented as: ;
% Rz(viewing_azimu_b) = ;
% [ +cb -sb 0 ] ;
% [ +sb +cb 0 ] ;
% [  0   0  1 ] ;
% And rotation by viewing_polar_a about the +y-axis is represented as: ;
% Ry(viewing_polar_a) = ;
% [ +ca 0 +sa ] ;
% [  0  1  0  ] ;
% [ -sa 0 +ca ] ;
% And rotation by inplane_gamma_z about the +z-axis is represented as: ;
% Rz(inplane_gamma_z) = ;
% [ +cc -sc 0 ] ;
% [ +sc +cc 0 ] ;
% [  0   0  1 ] ;
% Which, collectively, implies that under the transform: ;
% Rz(viewing_azimu_b) * Ry(viewing_polar_a) * Rz(inplane_gamma_z), ;
% Which is the same as: ;
% [ +cb -sb 0 ] [ +ca*cc -ca*sc +sa ]   [ +cb*ca*cc - sb*sc , -cb*ca*sc -sb*cc , +cb*sa ];
% [ +sb +cb 0 ] [ +sc    +cc    0   ] = [ +sb*ca*cc + cb*sc , -sb*ca*sc +cb*cc , +sb*sa ];
% [  0   0  1 ] [ -sa*cc +sa*sc +ca ]   [ -sa*cc            , +sa*sc           , +ca    ];
% the point [1;0;0] is mapped to: ;
% [ template_k_c_0 ; template_k_c_1 ; template_k_c_2 ] = [ +cb*ca*cc - sb*sc ; +sb*ca*cc + cb*sc ; -sa*cc ];
%%%%;
% In other words: 
% the point M_k_p_w_(1+nw)==M_k_p_wM__(1+nw,1+nM), ;
% corresponding to the nw-th point on the nM-th image-ring, ;
% is generated using inplane_gamma_z = 2*pi*nw/n_w, ;
% as well as viewing_polar_a and viewing_azimu_b. ;
% Thus, the k_c_ location for that point (in 3d) is: ;
% k_c_ = [ +cb*ca*cc - sb*sc ; +sb*ca*cc + cb*sc ; -sa*cc ]. ;
% Correspondingly, the k_p_r01, k_p_polar_a and k_p_azimu_b for that point can be calculated as: ;
% k_p_r01 = sqrt(k_c_(1+0)^2 + k_c_(1+1)^2) = ;
% k_p_polar_a = atan2(k_p_r01,k_c_(1+2));
% k_p_azimu_b = atan2(k_c_(1+1),k_c_(1+0));
%%%%;
% Here we adopt the convention that the input viewing_gamma_z for each image-ring ;
% should be applied as an inplane rotation of the image-ring itself before calculating k_c_. ;
% Thus, the viewing_gamma_z is simply subtracted from the inplane_gamma_z associated with each point nw in that image-ring. ;
%%%%;
% Note that: ;
% cos(template_polar_a) = -sa*cc ;
% template_azimu_b = atan2( +sb*ca*cc + cb*sc , *cb*ca*cc - sb*sc );
% implying that: ;
% \partial_{viewing_polar_a} cos(template_polar_a) = -ca*cc ;
% \partial_{viewing_azimu_b} cos(template_polar_a) = 0 ;
% \partial_{viewing_gamma_z} cos(template_polar_a) = +sa*sc ;
% and since \partial_{y/x} atan(y/x) = 1/(1+(y/x)^2) = x^2/(x^2+y^2) ;
% and \partial_{z} y(z)/x(z) = (y'x-yx')/x^2, ;
% \partial_{viewing_polar_a} template_azimu_b = (\partial_{viewing_polar_a} y * x - y * \partial_{viewing_polar_a} x ) / (x^2 + y^2) ;
% \partial_{viewing_azimu_b} template_azimu_b = (\partial_{viewing_azimu_b} y * x - y * \partial_{viewing_azimu_b} x ) / (x^2 + y^2) ;
% \partial_{viewing_gamma_z} template_azimu_b = (\partial_{viewing_gamma_z} y * x - y * \partial_{viewing_gamma_z} x ) / (x^2 + y^2) ;
% where:
% \partial_{viewing_polar_a} x = -cb*sa*cc ;
% \partial_{viewing_polar_a} y = -sb*sa*cc ;
% \partial_{viewing_azimu_b} x = -sb*ca*cc - cb*sc ;
% \partial_{viewing_azimu_b} y = +cb*ca*cc - sb*sc ;
% \partial_{viewing_gamma_z} x = -cb*ca*sc - sb*cc ;
% \partial_{viewing_gamma_z} y = -sb*ca*sc + cb*cc ;
%%%%%%%%;

str_thisfunction = 'cg_rhs_2';
flag_verbose=0;

if nargin<1;
flag_verbose=1; flag_disp=0; nf=0;
if (flag_verbose>0); disp(sprintf(' %% testing %s',str_thisfunction)); end;
n_M = 4;
rng(0);
n_w = 1024;
viewing_polar_a_M_ = 1*pi*rand(n_M,1);
viewing_azimu_b_M_ = 2*pi*rand(n_M,1);
viewing_gamma_z_M_ = 2*pi*rand(n_M,1);
[ ...
 k_p_polar_a_wM__ ...
,k_p_azimu_b_wM__ ...
,k_c_0_wM__ ...
,k_c_1_wM__ ...
,k_c_2_wM__ ...
] = ...
cg_rhs_2( ...
 n_M ...
,n_w ...
,viewing_polar_a_M_ ...
,viewing_azimu_b_M_ ...
,viewing_gamma_z_M_ ...
);
%%%%;
if flag_disp;
figure(1+nf);nf=nf+1;clf;figsml;
markersize_use = 12;
c_use__ = colormap_beach(); n_c_use = size(c_use__,1);
plot_sphere_grid_0;
hold on;
for nM=0:n_M-1;
nc_use = max(0,min(n_c_use-1,floor(n_c_use*nM/n_M)));
viewing_polar_a = viewing_polar_a_M_(1+nM);
viewing_azimu_b = viewing_azimu_b_M_(1+nM);
viewing_gamma_z = viewing_gamma_z_M_(1+nM);
viewing_k_c_0 = sin(viewing_polar_a)*cos(viewing_azimu_b);
viewing_k_c_1 = sin(viewing_polar_a)*sin(viewing_azimu_b);
viewing_k_c_2 = cos(viewing_polar_a);
plot3(k_c_0_wM__(:,1+nM),k_c_1_wM__(:,1+nM),k_c_2_wM__(:,1+nM),'.','MarkerSize',markersize_use,'Color',c_use__(1+nc_use,:));
plot3(viewing_k_c_0,viewing_k_c_1,viewing_k_c_2,'ko','MarkerSize',markersize_use,'MarkerFaceColor',c_use__(1+nc_use,:));
end;%for nM=0:n_M-1;
hold off;
axisnotick3d; axis vis3d;
end;%if flag_disp;
%%%%;
if (flag_verbose>0); disp(sprintf(' %% Now testing first-derivative')); end;
da = 1e-4; db = 1e-3; dc = 2e-4;
[ ...
 k_p_polar_a_mid_x_wM__ ...
,k_p_azimu_b_mid_x_wM__ ...
,k_c_0_mid_x_wM__ ...
,k_c_1_mid_x_wM__ ...
,k_c_2_mid_x_wM__ ...
,k_p_r01_mid_x_wM__ ...
,dtau_k_p_polar_a_mid_wM3___ ...
,dtau_k_p_azimu_b_mid_wM3___ ...
,dtau_k_c_0_mid_wM3___ ...
,dtau_k_c_1_mid_wM3___ ...
,dtau_k_c_2_mid_wM3___ ...
,dtau_k_p_r01_mid_wM3___ ...
,dtau_dtau_k_p_polar_a_mid_wM33____ ...
,dtau_dtau_k_p_azimu_b_mid_wM33____ ...
,dtau_dtau_k_c_0_mid_wM33____ ...
,dtau_dtau_k_c_1_mid_wM33____ ...
,dtau_dtau_k_c_2_mid_wM33____ ...
,dtau_dtau_k_p_r01_mid_wM33____ ...
] = ...
cg_rhs_2( ...
 n_M ...
,n_w ...
,viewing_polar_a_M_ + 0*da...
,viewing_azimu_b_M_ + 0*db ...
,viewing_gamma_z_M_ + 0*dc ...
);
%%;
[ ...
 k_p_polar_a_pos_a_wM__ ...
,k_p_azimu_b_pos_a_wM__ ...
,k_c_0_pos_a_wM__ ...
,k_c_1_pos_a_wM__ ...
,k_c_2_pos_a_wM__ ...
,k_p_r01_pos_a_wM__ ...
] = ...
cg_rhs_2( ...
 n_M ...
,n_w ...
,viewing_polar_a_M_ + 1*da...
,viewing_azimu_b_M_ + 0*db ...
,viewing_gamma_z_M_ + 0*dc ...
);
[ ...
 k_p_polar_a_neg_a_wM__ ...
,k_p_azimu_b_neg_a_wM__ ...
,k_c_0_neg_a_wM__ ...
,k_c_1_neg_a_wM__ ...
,k_c_2_neg_a_wM__ ...
,k_p_r01_neg_a_wM__ ...
] = ...
cg_rhs_2( ...
 n_M ...
,n_w ...
,viewing_polar_a_M_ - 1*da...
,viewing_azimu_b_M_ + 0*db ...
,viewing_gamma_z_M_ + 0*dc ...
);
da_k_p_polar_a_mid_wM__ = dtau_k_p_polar_a_mid_wM3___(:,:,1+0);
da_k_p_polar_a_dif_wM__ = (k_p_polar_a_pos_a_wM__ - k_p_polar_a_neg_a_wM__)./max(1e-12,2*da);
disp_error(flag_verbose,'da_k_p_polar_a_dif_wM__',da_k_p_polar_a_dif_wM__,'da_k_p_polar_a_mid_wM__',da_k_p_polar_a_mid_wM__);
da_k_p_azimu_b_mid_wM__ = dtau_k_p_azimu_b_mid_wM3___(:,:,1+0);
da_k_p_azimu_b_dif_wM__ = (k_p_azimu_b_pos_a_wM__ - k_p_azimu_b_neg_a_wM__)./max(1e-12,2*da);
disp_error(flag_verbose,'da_k_p_azimu_b_dif_wM__',da_k_p_azimu_b_dif_wM__,'da_k_p_azimu_b_mid_wM__',da_k_p_azimu_b_mid_wM__);
da_k_c_0_mid_wM__ = dtau_k_c_0_mid_wM3___(:,:,1+0);
da_k_c_0_dif_wM__ = (k_c_0_pos_a_wM__ - k_c_0_neg_a_wM__)./max(1e-12,2*da);
disp_error(flag_verbose,'da_k_c_0_dif_wM__',da_k_c_0_dif_wM__,'da_k_c_0_mid_wM__',da_k_c_0_mid_wM__);
da_k_c_1_mid_wM__ = dtau_k_c_1_mid_wM3___(:,:,1+0);
da_k_c_1_dif_wM__ = (k_c_1_pos_a_wM__ - k_c_1_neg_a_wM__)./max(1e-12,2*da);
disp_error(flag_verbose,'da_k_c_1_dif_wM__',da_k_c_1_dif_wM__,'da_k_c_1_mid_wM__',da_k_c_1_mid_wM__);
da_k_c_2_mid_wM__ = dtau_k_c_2_mid_wM3___(:,:,1+0);
da_k_c_2_dif_wM__ = (k_c_2_pos_a_wM__ - k_c_2_neg_a_wM__)./max(1e-12,2*da);
disp_error(flag_verbose,'da_k_c_2_dif_wM__',da_k_c_2_dif_wM__,'da_k_c_2_mid_wM__',da_k_c_2_mid_wM__);
da_k_p_r01_mid_wM__ = dtau_k_p_r01_mid_wM3___(:,:,1+0);
da_k_p_r01_dif_wM__ = (k_p_r01_pos_a_wM__ - k_p_r01_neg_a_wM__)./max(1e-12,2*da);
disp_error(flag_verbose,'da_k_p_r01_dif_wM__',da_k_p_r01_dif_wM__,'da_k_p_r01_mid_wM__',da_k_p_r01_mid_wM__);
%%;
[ ...
 k_p_polar_a_pos_b_wM__ ...
,k_p_azimu_b_pos_b_wM__ ...
,k_c_0_pos_b_wM__ ...
,k_c_1_pos_b_wM__ ...
,k_c_2_pos_b_wM__ ...
,k_p_r01_pos_b_wM__ ...
] = ...
cg_rhs_2( ...
 n_M ...
,n_w ...
,viewing_polar_a_M_ + 0*da...
,viewing_azimu_b_M_ + 1*db ...
,viewing_gamma_z_M_ + 0*dc ...
);
[ ...
 k_p_polar_a_neg_b_wM__ ...
,k_p_azimu_b_neg_b_wM__ ...
,k_c_0_neg_b_wM__ ...
,k_c_1_neg_b_wM__ ...
,k_c_2_neg_b_wM__ ...
,k_p_r01_neg_b_wM__ ...
] = ...
cg_rhs_2( ...
 n_M ...
,n_w ...
,viewing_polar_a_M_ + 0*da...
,viewing_azimu_b_M_ - 1*db ...
,viewing_gamma_z_M_ + 0*dc ...
);
db_k_p_polar_a_mid_wM__ = dtau_k_p_polar_a_mid_wM3___(:,:,1+1);
db_k_p_polar_a_dif_wM__ = (k_p_polar_a_pos_b_wM__ - k_p_polar_a_neg_b_wM__)./max(1e-12,2*db);
disp_error(flag_verbose,'db_k_p_polar_a_dif_wM__',db_k_p_polar_a_dif_wM__,'db_k_p_polar_a_mid_wM__',db_k_p_polar_a_mid_wM__);
db_k_p_azimu_b_mid_wM__ = dtau_k_p_azimu_b_mid_wM3___(:,:,1+1);
db_k_p_azimu_b_dif_wM__ = (k_p_azimu_b_pos_b_wM__ - k_p_azimu_b_neg_b_wM__)./max(1e-12,2*db);
disp_error(flag_verbose,'db_k_p_azimu_b_dif_wM__',db_k_p_azimu_b_dif_wM__,'db_k_p_azimu_b_mid_wM__',db_k_p_azimu_b_mid_wM__);
db_k_c_0_mid_wM__ = dtau_k_c_0_mid_wM3___(:,:,1+1);
db_k_c_0_dif_wM__ = (k_c_0_pos_b_wM__ - k_c_0_neg_b_wM__)./max(1e-12,2*db);
disp_error(flag_verbose,'db_k_c_0_dif_wM__',db_k_c_0_dif_wM__,'db_k_c_0_mid_wM__',db_k_c_0_mid_wM__);
db_k_c_1_mid_wM__ = dtau_k_c_1_mid_wM3___(:,:,1+1);
db_k_c_1_dif_wM__ = (k_c_1_pos_b_wM__ - k_c_1_neg_b_wM__)./max(1e-12,2*db);
disp_error(flag_verbose,'db_k_c_1_dif_wM__',db_k_c_1_dif_wM__,'db_k_c_1_mid_wM__',db_k_c_1_mid_wM__);
db_k_c_2_mid_wM__ = dtau_k_c_2_mid_wM3___(:,:,1+1);
db_k_c_2_dif_wM__ = (k_c_2_pos_b_wM__ - k_c_2_neg_b_wM__)./max(1e-12,2*db);
disp_error(flag_verbose,'db_k_c_2_dif_wM__',db_k_c_2_dif_wM__,'db_k_c_2_mid_wM__',db_k_c_2_mid_wM__);
db_k_p_r01_mid_wM__ = dtau_k_p_r01_mid_wM3___(:,:,1+1);
db_k_p_r01_dif_wM__ = (k_p_r01_pos_b_wM__ - k_p_r01_neg_b_wM__)./max(1e-12,2*db);
disp_error(flag_verbose,'db_k_p_r01_dif_wM__',db_k_p_r01_dif_wM__,'db_k_p_r01_mid_wM__',db_k_p_r01_mid_wM__);
%%;
[ ...
 k_p_polar_a_pos_c_wM__ ...
,k_p_azimu_b_pos_c_wM__ ...
,k_c_0_pos_c_wM__ ...
,k_c_1_pos_c_wM__ ...
,k_c_2_pos_c_wM__ ...
,k_p_r01_pos_c_wM__ ...
] = ...
cg_rhs_2( ...
 n_M ...
,n_w ...
,viewing_polar_a_M_ + 0*da...
,viewing_azimu_b_M_ + 0*db ...
,viewing_gamma_z_M_ + 1*dc ...
);
[ ...
 k_p_polar_a_neg_c_wM__ ...
,k_p_azimu_b_neg_c_wM__ ...
,k_c_0_neg_c_wM__ ...
,k_c_1_neg_c_wM__ ...
,k_c_2_neg_c_wM__ ...
,k_p_r01_neg_c_wM__ ...
] = ...
cg_rhs_2( ...
 n_M ...
,n_w ...
,viewing_polar_a_M_ + 0*da...
,viewing_azimu_b_M_ + 0*db ...
,viewing_gamma_z_M_ - 1*dc ...
);
dc_k_p_polar_a_mid_wM__ = dtau_k_p_polar_a_mid_wM3___(:,:,1+2);
dc_k_p_polar_a_dif_wM__ = (k_p_polar_a_pos_c_wM__ - k_p_polar_a_neg_c_wM__)./max(1e-12,2*dc);
disp_error(flag_verbose,'dc_k_p_polar_a_dif_wM__',dc_k_p_polar_a_dif_wM__,'dc_k_p_polar_a_mid_wM__',dc_k_p_polar_a_mid_wM__);
dc_k_p_azimu_b_mid_wM__ = dtau_k_p_azimu_b_mid_wM3___(:,:,1+2);
dc_k_p_azimu_b_dif_wM__ = (k_p_azimu_b_pos_c_wM__ - k_p_azimu_b_neg_c_wM__)./max(1e-12,2*dc);
disp_error(flag_verbose,'dc_k_p_azimu_b_dif_wM__',dc_k_p_azimu_b_dif_wM__,'dc_k_p_azimu_b_mid_wM__',dc_k_p_azimu_b_mid_wM__);
dc_k_c_0_mid_wM__ = dtau_k_c_0_mid_wM3___(:,:,1+2);
dc_k_c_0_dif_wM__ = (k_c_0_pos_c_wM__ - k_c_0_neg_c_wM__)./max(1e-12,2*dc);
disp_error(flag_verbose,'dc_k_c_0_dif_wM__',dc_k_c_0_dif_wM__,'dc_k_c_0_mid_wM__',dc_k_c_0_mid_wM__);
dc_k_c_1_mid_wM__ = dtau_k_c_1_mid_wM3___(:,:,1+2);
dc_k_c_1_dif_wM__ = (k_c_1_pos_c_wM__ - k_c_1_neg_c_wM__)./max(1e-12,2*dc);
disp_error(flag_verbose,'dc_k_c_1_dif_wM__',dc_k_c_1_dif_wM__,'dc_k_c_1_mid_wM__',dc_k_c_1_mid_wM__);
dc_k_c_2_mid_wM__ = dtau_k_c_2_mid_wM3___(:,:,1+2);
dc_k_c_2_dif_wM__ = (k_c_2_pos_c_wM__ - k_c_2_neg_c_wM__)./max(1e-12,2*dc);
disp_error(flag_verbose,'dc_k_c_2_dif_wM__',dc_k_c_2_dif_wM__,'dc_k_c_2_mid_wM__',dc_k_c_2_mid_wM__);
dc_k_p_r01_mid_wM__ = dtau_k_p_r01_mid_wM3___(:,:,1+2);
dc_k_p_r01_dif_wM__ = (k_p_r01_pos_c_wM__ - k_p_r01_neg_c_wM__)./max(1e-12,2*dc);
disp_error(flag_verbose,'dc_k_p_r01_dif_wM__',dc_k_p_r01_dif_wM__,'dc_k_p_r01_mid_wM__',dc_k_p_r01_mid_wM__);
%%%%;
if (flag_verbose>0); disp(sprintf(' %% Now testing second-derivative')); end;
da_da_k_p_polar_a_dif_wM__ = (k_p_polar_a_pos_a_wM__ - 2*k_p_polar_a_mid_x_wM__ + k_p_polar_a_neg_a_wM__)./max(1e-12,da.^2);
da_da_k_p_polar_a_mid_wM__ = dtau_dtau_k_p_polar_a_mid_wM33____(:,:,1+0,1+0);
disp_error(flag_verbose,'da_da_k_p_polar_a_dif_wM__',da_da_k_p_polar_a_dif_wM__,'da_da_k_p_polar_a_mid_wM__',da_da_k_p_polar_a_mid_wM__);
db_db_k_p_polar_a_dif_wM__ = (k_p_polar_a_pos_b_wM__ - 2*k_p_polar_a_mid_x_wM__ + k_p_polar_a_neg_b_wM__)./max(1e-12,db.^2);
db_db_k_p_polar_a_mid_wM__ = dtau_dtau_k_p_polar_a_mid_wM33____(:,:,1+1,1+1);
disp_error(flag_verbose,'db_db_k_p_polar_a_dif_wM__',db_db_k_p_polar_a_dif_wM__,'db_db_k_p_polar_a_mid_wM__',db_db_k_p_polar_a_mid_wM__);
dc_dc_k_p_polar_a_dif_wM__ = (k_p_polar_a_pos_c_wM__ - 2*k_p_polar_a_mid_x_wM__ + k_p_polar_a_neg_c_wM__)./max(1e-12,dc.^2);
dc_dc_k_p_polar_a_mid_wM__ = dtau_dtau_k_p_polar_a_mid_wM33____(:,:,1+2,1+2);
disp_error(flag_verbose,'dc_dc_k_p_polar_a_dif_wM__',dc_dc_k_p_polar_a_dif_wM__,'dc_dc_k_p_polar_a_mid_wM__',dc_dc_k_p_polar_a_mid_wM__);
%%;
da_da_k_p_azimu_b_dif_wM__ = (k_p_azimu_b_pos_a_wM__ - 2*k_p_azimu_b_mid_x_wM__ + k_p_azimu_b_neg_a_wM__)./max(1e-12,da.^2);
da_da_k_p_azimu_b_mid_wM__ = dtau_dtau_k_p_azimu_b_mid_wM33____(:,:,1+0,1+0);
disp_error(flag_verbose,'da_da_k_p_azimu_b_dif_wM__',da_da_k_p_azimu_b_dif_wM__,'da_da_k_p_azimu_b_mid_wM__',da_da_k_p_azimu_b_mid_wM__);
db_db_k_p_azimu_b_dif_wM__ = (k_p_azimu_b_pos_b_wM__ - 2*k_p_azimu_b_mid_x_wM__ + k_p_azimu_b_neg_b_wM__)./max(1e-12,db.^2);
db_db_k_p_azimu_b_mid_wM__ = dtau_dtau_k_p_azimu_b_mid_wM33____(:,:,1+1,1+1);
disp_error(flag_verbose,'db_db_k_p_azimu_b_dif_wM__',db_db_k_p_azimu_b_dif_wM__,'db_db_k_p_azimu_b_mid_wM__',db_db_k_p_azimu_b_mid_wM__);
dc_dc_k_p_azimu_b_dif_wM__ = (k_p_azimu_b_pos_c_wM__ - 2*k_p_azimu_b_mid_x_wM__ + k_p_azimu_b_neg_c_wM__)./max(1e-12,dc.^2);
dc_dc_k_p_azimu_b_mid_wM__ = dtau_dtau_k_p_azimu_b_mid_wM33____(:,:,1+2,1+2);
disp_error(flag_verbose,'dc_dc_k_p_azimu_b_dif_wM__',dc_dc_k_p_azimu_b_dif_wM__,'dc_dc_k_p_azimu_b_mid_wM__',dc_dc_k_p_azimu_b_mid_wM__);
%%;
da_da_k_c_0_dif_wM__ = (k_c_0_pos_a_wM__ - 2*k_c_0_mid_x_wM__ + k_c_0_neg_a_wM__)./max(1e-12,da.^2);
da_da_k_c_0_mid_wM__ = dtau_dtau_k_c_0_mid_wM33____(:,:,1+0,1+0);
disp_error(flag_verbose,'da_da_k_c_0_dif_wM__',da_da_k_c_0_dif_wM__,'da_da_k_c_0_mid_wM__',da_da_k_c_0_mid_wM__);
db_db_k_c_0_dif_wM__ = (k_c_0_pos_b_wM__ - 2*k_c_0_mid_x_wM__ + k_c_0_neg_b_wM__)./max(1e-12,db.^2);
db_db_k_c_0_mid_wM__ = dtau_dtau_k_c_0_mid_wM33____(:,:,1+1,1+1);
disp_error(flag_verbose,'db_db_k_c_0_dif_wM__',db_db_k_c_0_dif_wM__,'db_db_k_c_0_mid_wM__',db_db_k_c_0_mid_wM__);
dc_dc_k_c_0_dif_wM__ = (k_c_0_pos_c_wM__ - 2*k_c_0_mid_x_wM__ + k_c_0_neg_c_wM__)./max(1e-12,dc.^2);
dc_dc_k_c_0_mid_wM__ = dtau_dtau_k_c_0_mid_wM33____(:,:,1+2,1+2);
disp_error(flag_verbose,'dc_dc_k_c_0_dif_wM__',dc_dc_k_c_0_dif_wM__,'dc_dc_k_c_0_mid_wM__',dc_dc_k_c_0_mid_wM__);
%%;
da_da_k_c_1_dif_wM__ = (k_c_1_pos_a_wM__ - 2*k_c_1_mid_x_wM__ + k_c_1_neg_a_wM__)./max(1e-12,da.^2);
da_da_k_c_1_mid_wM__ = dtau_dtau_k_c_1_mid_wM33____(:,:,1+0,1+0);
disp_error(flag_verbose,'da_da_k_c_1_dif_wM__',da_da_k_c_1_dif_wM__,'da_da_k_c_1_mid_wM__',da_da_k_c_1_mid_wM__);
db_db_k_c_1_dif_wM__ = (k_c_1_pos_b_wM__ - 2*k_c_1_mid_x_wM__ + k_c_1_neg_b_wM__)./max(1e-12,db.^2);
db_db_k_c_1_mid_wM__ = dtau_dtau_k_c_1_mid_wM33____(:,:,1+1,1+1);
disp_error(flag_verbose,'db_db_k_c_1_dif_wM__',db_db_k_c_1_dif_wM__,'db_db_k_c_1_mid_wM__',db_db_k_c_1_mid_wM__);
dc_dc_k_c_1_dif_wM__ = (k_c_1_pos_c_wM__ - 2*k_c_1_mid_x_wM__ + k_c_1_neg_c_wM__)./max(1e-12,dc.^2);
dc_dc_k_c_1_mid_wM__ = dtau_dtau_k_c_1_mid_wM33____(:,:,1+2,1+2);
disp_error(flag_verbose,'dc_dc_k_c_1_dif_wM__',dc_dc_k_c_1_dif_wM__,'dc_dc_k_c_1_mid_wM__',dc_dc_k_c_1_mid_wM__);
%%;
da_da_k_c_2_dif_wM__ = (k_c_2_pos_a_wM__ - 2*k_c_2_mid_x_wM__ + k_c_2_neg_a_wM__)./max(1e-12,da.^2);
da_da_k_c_2_mid_wM__ = dtau_dtau_k_c_2_mid_wM33____(:,:,1+0,1+0);
disp_error(flag_verbose,'da_da_k_c_2_dif_wM__',da_da_k_c_2_dif_wM__,'da_da_k_c_2_mid_wM__',da_da_k_c_2_mid_wM__);
db_db_k_c_2_dif_wM__ = (k_c_2_pos_b_wM__ - 2*k_c_2_mid_x_wM__ + k_c_2_neg_b_wM__)./max(1e-12,db.^2);
db_db_k_c_2_mid_wM__ = dtau_dtau_k_c_2_mid_wM33____(:,:,1+1,1+1);
disp_error(flag_verbose,'db_db_k_c_2_dif_wM__',db_db_k_c_2_dif_wM__,'db_db_k_c_2_mid_wM__',db_db_k_c_2_mid_wM__);
dc_dc_k_c_2_dif_wM__ = (k_c_2_pos_c_wM__ - 2*k_c_2_mid_x_wM__ + k_c_2_neg_c_wM__)./max(1e-12,dc.^2);
dc_dc_k_c_2_mid_wM__ = dtau_dtau_k_c_2_mid_wM33____(:,:,1+2,1+2);
disp_error(flag_verbose,'dc_dc_k_c_2_dif_wM__',dc_dc_k_c_2_dif_wM__,'dc_dc_k_c_2_mid_wM__',dc_dc_k_c_2_mid_wM__);
%%;
da_da_k_p_r01_dif_wM__ = (k_p_r01_pos_a_wM__ - 2*k_p_r01_mid_x_wM__ + k_p_r01_neg_a_wM__)./max(1e-12,da.^2);
da_da_k_p_r01_mid_wM__ = dtau_dtau_k_p_r01_mid_wM33____(:,:,1+0,1+0);
disp_error(flag_verbose,'da_da_k_p_r01_dif_wM__',da_da_k_p_r01_dif_wM__,'da_da_k_p_r01_mid_wM__',da_da_k_p_r01_mid_wM__);
db_db_k_p_r01_dif_wM__ = (k_p_r01_pos_b_wM__ - 2*k_p_r01_mid_x_wM__ + k_p_r01_neg_b_wM__)./max(1e-12,db.^2);
db_db_k_p_r01_mid_wM__ = dtau_dtau_k_p_r01_mid_wM33____(:,:,1+1,1+1);
disp_error(flag_verbose,'db_db_k_p_r01_dif_wM__',db_db_k_p_r01_dif_wM__,'db_db_k_p_r01_mid_wM__',db_db_k_p_r01_mid_wM__);
dc_dc_k_p_r01_dif_wM__ = (k_p_r01_pos_c_wM__ - 2*k_p_r01_mid_x_wM__ + k_p_r01_neg_c_wM__)./max(1e-12,dc.^2);
dc_dc_k_p_r01_mid_wM__ = dtau_dtau_k_p_r01_mid_wM33____(:,:,1+2,1+2);
disp_error(flag_verbose,'dc_dc_k_p_r01_dif_wM__',dc_dc_k_p_r01_dif_wM__,'dc_dc_k_p_r01_mid_wM__',dc_dc_k_p_r01_mid_wM__);
%%;
if (flag_verbose>0); disp(sprintf(' %% Now testing second-derivative mixed-partials (a,b)')); end;
[ ...
 k_p_polar_a_pos_a_pos_b_wM__ ...
,k_p_azimu_b_pos_a_pos_b_wM__ ...
,k_c_0_pos_a_pos_b_wM__ ...
,k_c_1_pos_a_pos_b_wM__ ...
,k_c_2_pos_a_pos_b_wM__ ...
,k_p_r01_pos_a_pos_b_wM__ ...
] = ...
cg_rhs_2( ...
 n_M ...
,n_w ...
,viewing_polar_a_M_ + 1*da...
,viewing_azimu_b_M_ + 1*db ...
,viewing_gamma_z_M_ + 0*dc ...
);
[ ...
 k_p_polar_a_pos_a_neg_b_wM__ ...
,k_p_azimu_b_pos_a_neg_b_wM__ ...
,k_c_0_pos_a_neg_b_wM__ ...
,k_c_1_pos_a_neg_b_wM__ ...
,k_c_2_pos_a_neg_b_wM__ ...
,k_p_r01_pos_a_neg_b_wM__ ...
] = ...
cg_rhs_2( ...
 n_M ...
,n_w ...
,viewing_polar_a_M_ + 1*da...
,viewing_azimu_b_M_ - 1*db ...
,viewing_gamma_z_M_ + 0*dc ...
);
[ ...
 k_p_polar_a_neg_a_pos_b_wM__ ...
,k_p_azimu_b_neg_a_pos_b_wM__ ...
,k_c_0_neg_a_pos_b_wM__ ...
,k_c_1_neg_a_pos_b_wM__ ...
,k_c_2_neg_a_pos_b_wM__ ...
,k_p_r01_neg_a_pos_b_wM__ ...
] = ...
cg_rhs_2( ...
 n_M ...
,n_w ...
,viewing_polar_a_M_ - 1*da...
,viewing_azimu_b_M_ + 1*db ...
,viewing_gamma_z_M_ + 0*dc ...
);
[ ...
 k_p_polar_a_neg_a_neg_b_wM__ ...
,k_p_azimu_b_neg_a_neg_b_wM__ ...
,k_c_0_neg_a_neg_b_wM__ ...
,k_c_1_neg_a_neg_b_wM__ ...
,k_c_2_neg_a_neg_b_wM__ ...
,k_p_r01_neg_a_neg_b_wM__ ...
] = ...
cg_rhs_2( ...
 n_M ...
,n_w ...
,viewing_polar_a_M_ - 1*da...
,viewing_azimu_b_M_ - 1*db ...
,viewing_gamma_z_M_ + 0*dc ...
);
da_db_k_p_polar_a_dif_wM__ = ( + k_p_polar_a_pos_a_pos_b_wM__ + k_p_polar_a_neg_a_neg_b_wM__ - k_p_polar_a_pos_a_neg_b_wM__ - k_p_polar_a_neg_a_pos_b_wM__ )/max(1e-12,4*da*db) ;
da_db_k_p_polar_a_mid_wM__ = dtau_dtau_k_p_polar_a_mid_wM33____(:,:,1+0,1+1);
disp_error(flag_verbose,'da_db_k_p_polar_a_dif_wM__',da_db_k_p_polar_a_dif_wM__,'da_db_k_p_polar_a_mid_wM__',da_db_k_p_polar_a_mid_wM__);
da_db_k_p_azimu_b_dif_wM__ = ( + k_p_azimu_b_pos_a_pos_b_wM__ + k_p_azimu_b_neg_a_neg_b_wM__ - k_p_azimu_b_pos_a_neg_b_wM__ - k_p_azimu_b_neg_a_pos_b_wM__ )/max(1e-12,4*da*db) ;
da_db_k_p_azimu_b_mid_wM__ = dtau_dtau_k_p_azimu_b_mid_wM33____(:,:,1+0,1+1);
disp_error(flag_verbose,'da_db_k_p_azimu_b_dif_wM__',da_db_k_p_azimu_b_dif_wM__,'da_db_k_p_azimu_b_mid_wM__',da_db_k_p_azimu_b_mid_wM__);
da_db_k_c_0_dif_wM__ = ( + k_c_0_pos_a_pos_b_wM__ + k_c_0_neg_a_neg_b_wM__ - k_c_0_pos_a_neg_b_wM__ - k_c_0_neg_a_pos_b_wM__ )/max(1e-12,4*da*db) ;
da_db_k_c_0_mid_wM__ = dtau_dtau_k_c_0_mid_wM33____(:,:,1+0,1+1);
disp_error(flag_verbose,'da_db_k_c_0_dif_wM__',da_db_k_c_0_dif_wM__,'da_db_k_c_0_mid_wM__',da_db_k_c_0_mid_wM__);
da_db_k_c_1_dif_wM__ = ( + k_c_1_pos_a_pos_b_wM__ + k_c_1_neg_a_neg_b_wM__ - k_c_1_pos_a_neg_b_wM__ - k_c_1_neg_a_pos_b_wM__ )/max(1e-12,4*da*db) ;
da_db_k_c_1_mid_wM__ = dtau_dtau_k_c_1_mid_wM33____(:,:,1+0,1+1);
disp_error(flag_verbose,'da_db_k_c_1_dif_wM__',da_db_k_c_1_dif_wM__,'da_db_k_c_1_mid_wM__',da_db_k_c_1_mid_wM__);
da_db_k_c_2_dif_wM__ = ( + k_c_2_pos_a_pos_b_wM__ + k_c_2_neg_a_neg_b_wM__ - k_c_2_pos_a_neg_b_wM__ - k_c_2_neg_a_pos_b_wM__ )/max(1e-12,4*da*db) ;
da_db_k_c_2_mid_wM__ = dtau_dtau_k_c_2_mid_wM33____(:,:,1+0,1+1);
disp_error(flag_verbose,'da_db_k_c_2_dif_wM__',da_db_k_c_2_dif_wM__,'da_db_k_c_2_mid_wM__',da_db_k_c_2_mid_wM__);
da_db_k_p_r01_dif_wM__ = ( + k_p_r01_pos_a_pos_b_wM__ + k_p_r01_neg_a_neg_b_wM__ - k_p_r01_pos_a_neg_b_wM__ - k_p_r01_neg_a_pos_b_wM__ )/max(1e-12,4*da*db) ;
da_db_k_p_r01_mid_wM__ = dtau_dtau_k_p_r01_mid_wM33____(:,:,1+0,1+1);
disp_error(flag_verbose,'da_db_k_p_r01_dif_wM__',da_db_k_p_r01_dif_wM__,'da_db_k_p_r01_mid_wM__',da_db_k_p_r01_mid_wM__);
db_da_k_p_polar_a_dif_wM__ = ( + k_p_polar_a_pos_a_pos_b_wM__ + k_p_polar_a_neg_a_neg_b_wM__ - k_p_polar_a_pos_a_neg_b_wM__ - k_p_polar_a_neg_a_pos_b_wM__ )/max(1e-12,4*da*db) ;
db_da_k_p_polar_a_mid_wM__ = dtau_dtau_k_p_polar_a_mid_wM33____(:,:,1+1,1+0);
disp_error(flag_verbose,'db_da_k_p_polar_a_dif_wM__',db_da_k_p_polar_a_dif_wM__,'db_da_k_p_polar_a_mid_wM__',db_da_k_p_polar_a_mid_wM__);
db_da_k_p_azimu_b_dif_wM__ = ( + k_p_azimu_b_pos_a_pos_b_wM__ + k_p_azimu_b_neg_a_neg_b_wM__ - k_p_azimu_b_pos_a_neg_b_wM__ - k_p_azimu_b_neg_a_pos_b_wM__ )/max(1e-12,4*da*db) ;
db_da_k_p_azimu_b_mid_wM__ = dtau_dtau_k_p_azimu_b_mid_wM33____(:,:,1+1,1+0);
disp_error(flag_verbose,'db_da_k_p_azimu_b_dif_wM__',db_da_k_p_azimu_b_dif_wM__,'db_da_k_p_azimu_b_mid_wM__',db_da_k_p_azimu_b_mid_wM__);
db_da_k_c_0_dif_wM__ = ( + k_c_0_pos_a_pos_b_wM__ + k_c_0_neg_a_neg_b_wM__ - k_c_0_pos_a_neg_b_wM__ - k_c_0_neg_a_pos_b_wM__ )/max(1e-12,4*da*db) ;
db_da_k_c_0_mid_wM__ = dtau_dtau_k_c_0_mid_wM33____(:,:,1+1,1+0);
disp_error(flag_verbose,'db_da_k_c_0_dif_wM__',db_da_k_c_0_dif_wM__,'db_da_k_c_0_mid_wM__',db_da_k_c_0_mid_wM__);
db_da_k_c_1_dif_wM__ = ( + k_c_1_pos_a_pos_b_wM__ + k_c_1_neg_a_neg_b_wM__ - k_c_1_pos_a_neg_b_wM__ - k_c_1_neg_a_pos_b_wM__ )/max(1e-12,4*da*db) ;
db_da_k_c_1_mid_wM__ = dtau_dtau_k_c_1_mid_wM33____(:,:,1+1,1+0);
disp_error(flag_verbose,'db_da_k_c_1_dif_wM__',db_da_k_c_1_dif_wM__,'db_da_k_c_1_mid_wM__',db_da_k_c_1_mid_wM__);
db_da_k_c_2_dif_wM__ = ( + k_c_2_pos_a_pos_b_wM__ + k_c_2_neg_a_neg_b_wM__ - k_c_2_pos_a_neg_b_wM__ - k_c_2_neg_a_pos_b_wM__ )/max(1e-12,4*da*db) ;
db_da_k_c_2_mid_wM__ = dtau_dtau_k_c_2_mid_wM33____(:,:,1+1,1+0);
disp_error(flag_verbose,'db_da_k_c_2_dif_wM__',db_da_k_c_2_dif_wM__,'db_da_k_c_2_mid_wM__',db_da_k_c_2_mid_wM__);
db_da_k_p_r01_dif_wM__ = ( + k_p_r01_pos_a_pos_b_wM__ + k_p_r01_neg_a_neg_b_wM__ - k_p_r01_pos_a_neg_b_wM__ - k_p_r01_neg_a_pos_b_wM__ )/max(1e-12,4*da*db) ;
db_da_k_p_r01_mid_wM__ = dtau_dtau_k_p_r01_mid_wM33____(:,:,1+1,1+0);
disp_error(flag_verbose,'db_da_k_p_r01_dif_wM__',db_da_k_p_r01_dif_wM__,'db_da_k_p_r01_mid_wM__',db_da_k_p_r01_mid_wM__);
%%;
if (flag_verbose>0); disp(sprintf(' %% Now testing second-derivative mixed-partials (a,c)')); end;
[ ...
 k_p_polar_a_pos_a_pos_c_wM__ ...
,k_p_azimu_b_pos_a_pos_c_wM__ ...
,k_c_0_pos_a_pos_c_wM__ ...
,k_c_1_pos_a_pos_c_wM__ ...
,k_c_2_pos_a_pos_c_wM__ ...
,k_p_r01_pos_a_pos_c_wM__ ...
] = ...
cg_rhs_2( ...
 n_M ...
,n_w ...
,viewing_polar_a_M_ + 1*da...
,viewing_azimu_b_M_ + 0*db ...
,viewing_gamma_z_M_ + 1*dc ...
);
[ ...
 k_p_polar_a_pos_a_neg_c_wM__ ...
,k_p_azimu_b_pos_a_neg_c_wM__ ...
,k_c_0_pos_a_neg_c_wM__ ...
,k_c_1_pos_a_neg_c_wM__ ...
,k_c_2_pos_a_neg_c_wM__ ...
,k_p_r01_pos_a_neg_c_wM__ ...
] = ...
cg_rhs_2( ...
 n_M ...
,n_w ...
,viewing_polar_a_M_ + 1*da...
,viewing_azimu_b_M_ + 0*db ...
,viewing_gamma_z_M_ - 1*dc ...
);
[ ...
 k_p_polar_a_neg_a_pos_c_wM__ ...
,k_p_azimu_b_neg_a_pos_c_wM__ ...
,k_c_0_neg_a_pos_c_wM__ ...
,k_c_1_neg_a_pos_c_wM__ ...
,k_c_2_neg_a_pos_c_wM__ ...
,k_p_r01_neg_a_pos_c_wM__ ...
] = ...
cg_rhs_2( ...
 n_M ...
,n_w ...
,viewing_polar_a_M_ - 1*da...
,viewing_azimu_b_M_ + 0*db ...
,viewing_gamma_z_M_ + 1*dc ...
);
[ ...
 k_p_polar_a_neg_a_neg_c_wM__ ...
,k_p_azimu_b_neg_a_neg_c_wM__ ...
,k_c_0_neg_a_neg_c_wM__ ...
,k_c_1_neg_a_neg_c_wM__ ...
,k_c_2_neg_a_neg_c_wM__ ...
,k_p_r01_neg_a_neg_c_wM__ ...
] = ...
cg_rhs_2( ...
 n_M ...
,n_w ...
,viewing_polar_a_M_ - 1*da...
,viewing_azimu_b_M_ + 0*db ...
,viewing_gamma_z_M_ - 1*dc ...
);
da_dc_k_p_polar_a_dif_wM__ = ( + k_p_polar_a_pos_a_pos_c_wM__ + k_p_polar_a_neg_a_neg_c_wM__ - k_p_polar_a_pos_a_neg_c_wM__ - k_p_polar_a_neg_a_pos_c_wM__ )/max(1e-12,4*da*dc) ;
da_dc_k_p_polar_a_mid_wM__ = dtau_dtau_k_p_polar_a_mid_wM33____(:,:,1+0,1+2);
disp_error(flag_verbose,'da_dc_k_p_polar_a_dif_wM__',da_dc_k_p_polar_a_dif_wM__,'da_dc_k_p_polar_a_mid_wM__',da_dc_k_p_polar_a_mid_wM__);
da_dc_k_p_azimu_b_dif_wM__ = ( + k_p_azimu_b_pos_a_pos_c_wM__ + k_p_azimu_b_neg_a_neg_c_wM__ - k_p_azimu_b_pos_a_neg_c_wM__ - k_p_azimu_b_neg_a_pos_c_wM__ )/max(1e-12,4*da*dc) ;
da_dc_k_p_azimu_b_mid_wM__ = dtau_dtau_k_p_azimu_b_mid_wM33____(:,:,1+0,1+2);
disp_error(flag_verbose,'da_dc_k_p_azimu_b_dif_wM__',da_dc_k_p_azimu_b_dif_wM__,'da_dc_k_p_azimu_b_mid_wM__',da_dc_k_p_azimu_b_mid_wM__);
da_dc_k_c_0_dif_wM__ = ( + k_c_0_pos_a_pos_c_wM__ + k_c_0_neg_a_neg_c_wM__ - k_c_0_pos_a_neg_c_wM__ - k_c_0_neg_a_pos_c_wM__ )/max(1e-12,4*da*dc) ;
da_dc_k_c_0_mid_wM__ = dtau_dtau_k_c_0_mid_wM33____(:,:,1+0,1+2);
disp_error(flag_verbose,'da_dc_k_c_0_dif_wM__',da_dc_k_c_0_dif_wM__,'da_dc_k_c_0_mid_wM__',da_dc_k_c_0_mid_wM__);
da_dc_k_c_1_dif_wM__ = ( + k_c_1_pos_a_pos_c_wM__ + k_c_1_neg_a_neg_c_wM__ - k_c_1_pos_a_neg_c_wM__ - k_c_1_neg_a_pos_c_wM__ )/max(1e-12,4*da*dc) ;
da_dc_k_c_1_mid_wM__ = dtau_dtau_k_c_1_mid_wM33____(:,:,1+0,1+2);
disp_error(flag_verbose,'da_dc_k_c_1_dif_wM__',da_dc_k_c_1_dif_wM__,'da_dc_k_c_1_mid_wM__',da_dc_k_c_1_mid_wM__);
da_dc_k_c_2_dif_wM__ = ( + k_c_2_pos_a_pos_c_wM__ + k_c_2_neg_a_neg_c_wM__ - k_c_2_pos_a_neg_c_wM__ - k_c_2_neg_a_pos_c_wM__ )/max(1e-12,4*da*dc) ;
da_dc_k_c_2_mid_wM__ = dtau_dtau_k_c_2_mid_wM33____(:,:,1+0,1+2);
disp_error(flag_verbose,'da_dc_k_c_2_dif_wM__',da_dc_k_c_2_dif_wM__,'da_dc_k_c_2_mid_wM__',da_dc_k_c_2_mid_wM__);
da_dc_k_p_r01_dif_wM__ = ( + k_p_r01_pos_a_pos_c_wM__ + k_p_r01_neg_a_neg_c_wM__ - k_p_r01_pos_a_neg_c_wM__ - k_p_r01_neg_a_pos_c_wM__ )/max(1e-12,4*da*dc) ;
da_dc_k_p_r01_mid_wM__ = dtau_dtau_k_p_r01_mid_wM33____(:,:,1+0,1+2);
disp_error(flag_verbose,'da_dc_k_p_r01_dif_wM__',da_dc_k_p_r01_dif_wM__,'da_dc_k_p_r01_mid_wM__',da_dc_k_p_r01_mid_wM__);
dc_da_k_p_polar_a_dif_wM__ = ( + k_p_polar_a_pos_a_pos_c_wM__ + k_p_polar_a_neg_a_neg_c_wM__ - k_p_polar_a_pos_a_neg_c_wM__ - k_p_polar_a_neg_a_pos_c_wM__ )/max(1e-12,4*da*dc) ;
dc_da_k_p_polar_a_mid_wM__ = dtau_dtau_k_p_polar_a_mid_wM33____(:,:,1+2,1+0);
disp_error(flag_verbose,'dc_da_k_p_polar_a_dif_wM__',dc_da_k_p_polar_a_dif_wM__,'dc_da_k_p_polar_a_mid_wM__',dc_da_k_p_polar_a_mid_wM__);
dc_da_k_p_azimu_b_dif_wM__ = ( + k_p_azimu_b_pos_a_pos_c_wM__ + k_p_azimu_b_neg_a_neg_c_wM__ - k_p_azimu_b_pos_a_neg_c_wM__ - k_p_azimu_b_neg_a_pos_c_wM__ )/max(1e-12,4*da*dc) ;
dc_da_k_p_azimu_b_mid_wM__ = dtau_dtau_k_p_azimu_b_mid_wM33____(:,:,1+2,1+0);
disp_error(flag_verbose,'dc_da_k_p_azimu_b_dif_wM__',dc_da_k_p_azimu_b_dif_wM__,'dc_da_k_p_azimu_b_mid_wM__',dc_da_k_p_azimu_b_mid_wM__);
dc_da_k_c_0_dif_wM__ = ( + k_c_0_pos_a_pos_c_wM__ + k_c_0_neg_a_neg_c_wM__ - k_c_0_pos_a_neg_c_wM__ - k_c_0_neg_a_pos_c_wM__ )/max(1e-12,4*da*dc) ;
dc_da_k_c_0_mid_wM__ = dtau_dtau_k_c_0_mid_wM33____(:,:,1+2,1+0);
disp_error(flag_verbose,'dc_da_k_c_0_dif_wM__',dc_da_k_c_0_dif_wM__,'dc_da_k_c_0_mid_wM__',dc_da_k_c_0_mid_wM__);
dc_da_k_c_1_dif_wM__ = ( + k_c_1_pos_a_pos_c_wM__ + k_c_1_neg_a_neg_c_wM__ - k_c_1_pos_a_neg_c_wM__ - k_c_1_neg_a_pos_c_wM__ )/max(1e-12,4*da*dc) ;
dc_da_k_c_1_mid_wM__ = dtau_dtau_k_c_1_mid_wM33____(:,:,1+2,1+0);
disp_error(flag_verbose,'dc_da_k_c_1_dif_wM__',dc_da_k_c_1_dif_wM__,'dc_da_k_c_1_mid_wM__',dc_da_k_c_1_mid_wM__);
dc_da_k_c_2_dif_wM__ = ( + k_c_2_pos_a_pos_c_wM__ + k_c_2_neg_a_neg_c_wM__ - k_c_2_pos_a_neg_c_wM__ - k_c_2_neg_a_pos_c_wM__ )/max(1e-12,4*da*dc) ;
dc_da_k_c_2_mid_wM__ = dtau_dtau_k_c_2_mid_wM33____(:,:,1+2,1+0);
disp_error(flag_verbose,'dc_da_k_c_2_dif_wM__',dc_da_k_c_2_dif_wM__,'dc_da_k_c_2_mid_wM__',dc_da_k_c_2_mid_wM__);
dc_da_k_p_r01_dif_wM__ = ( + k_p_r01_pos_a_pos_c_wM__ + k_p_r01_neg_a_neg_c_wM__ - k_p_r01_pos_a_neg_c_wM__ - k_p_r01_neg_a_pos_c_wM__ )/max(1e-12,4*da*dc) ;
dc_da_k_p_r01_mid_wM__ = dtau_dtau_k_p_r01_mid_wM33____(:,:,1+2,1+0);
disp_error(flag_verbose,'dc_da_k_p_r01_dif_wM__',dc_da_k_p_r01_dif_wM__,'dc_da_k_p_r01_mid_wM__',dc_da_k_p_r01_mid_wM__);
%%;
if (flag_verbose>0); disp(sprintf(' %% Now testing second-derivative mixed-partials (b,c)')); end;
[ ...
 k_p_polar_a_pos_b_pos_c_wM__ ...
,k_p_azimu_b_pos_b_pos_c_wM__ ...
,k_c_0_pos_b_pos_c_wM__ ...
,k_c_1_pos_b_pos_c_wM__ ...
,k_c_2_pos_b_pos_c_wM__ ...
,k_p_r01_pos_b_pos_c_wM__ ...
] = ...
cg_rhs_2( ...
 n_M ...
,n_w ...
,viewing_polar_a_M_ + 0*da...
,viewing_azimu_b_M_ + 1*db ...
,viewing_gamma_z_M_ + 1*dc ...
);
[ ...
 k_p_polar_a_pos_b_neg_c_wM__ ...
,k_p_azimu_b_pos_b_neg_c_wM__ ...
,k_c_0_pos_b_neg_c_wM__ ...
,k_c_1_pos_b_neg_c_wM__ ...
,k_c_2_pos_b_neg_c_wM__ ...
,k_p_r01_pos_b_neg_c_wM__ ...
] = ...
cg_rhs_2( ...
 n_M ...
,n_w ...
,viewing_polar_a_M_ + 0*da...
,viewing_azimu_b_M_ + 1*db ...
,viewing_gamma_z_M_ - 1*dc ...
);
[ ...
 k_p_polar_a_neg_b_pos_c_wM__ ...
,k_p_azimu_b_neg_b_pos_c_wM__ ...
,k_c_0_neg_b_pos_c_wM__ ...
,k_c_1_neg_b_pos_c_wM__ ...
,k_c_2_neg_b_pos_c_wM__ ...
,k_p_r01_neg_b_pos_c_wM__ ...
] = ...
cg_rhs_2( ...
 n_M ...
,n_w ...
,viewing_polar_a_M_ + 0*da...
,viewing_azimu_b_M_ - 1*db ...
,viewing_gamma_z_M_ + 1*dc ...
);
[ ...
 k_p_polar_a_neg_b_neg_c_wM__ ...
,k_p_azimu_b_neg_b_neg_c_wM__ ...
,k_c_0_neg_b_neg_c_wM__ ...
,k_c_1_neg_b_neg_c_wM__ ...
,k_c_2_neg_b_neg_c_wM__ ...
,k_p_r01_neg_b_neg_c_wM__ ...
] = ...
cg_rhs_2( ...
 n_M ...
,n_w ...
,viewing_polar_a_M_ + 0*da...
,viewing_azimu_b_M_ - 1*db ...
,viewing_gamma_z_M_ - 1*dc ...
);
db_dc_k_p_polar_a_dif_wM__ = ( + k_p_polar_a_pos_b_pos_c_wM__ + k_p_polar_a_neg_b_neg_c_wM__ - k_p_polar_a_pos_b_neg_c_wM__ - k_p_polar_a_neg_b_pos_c_wM__ )/max(1e-12,4*db*dc) ;
db_dc_k_p_polar_a_mid_wM__ = dtau_dtau_k_p_polar_a_mid_wM33____(:,:,1+1,1+2);
disp_error(flag_verbose,'db_dc_k_p_polar_a_dif_wM__',db_dc_k_p_polar_a_dif_wM__,'db_dc_k_p_polar_a_mid_wM__',db_dc_k_p_polar_a_mid_wM__);
db_dc_k_p_azimu_b_dif_wM__ = ( + k_p_azimu_b_pos_b_pos_c_wM__ + k_p_azimu_b_neg_b_neg_c_wM__ - k_p_azimu_b_pos_b_neg_c_wM__ - k_p_azimu_b_neg_b_pos_c_wM__ )/max(1e-12,4*db*dc) ;
db_dc_k_p_azimu_b_mid_wM__ = dtau_dtau_k_p_azimu_b_mid_wM33____(:,:,1+1,1+2);
disp_error(flag_verbose,'db_dc_k_p_azimu_b_dif_wM__',db_dc_k_p_azimu_b_dif_wM__,'db_dc_k_p_azimu_b_mid_wM__',db_dc_k_p_azimu_b_mid_wM__);
db_dc_k_c_0_dif_wM__ = ( + k_c_0_pos_b_pos_c_wM__ + k_c_0_neg_b_neg_c_wM__ - k_c_0_pos_b_neg_c_wM__ - k_c_0_neg_b_pos_c_wM__ )/max(1e-12,4*db*dc) ;
db_dc_k_c_0_mid_wM__ = dtau_dtau_k_c_0_mid_wM33____(:,:,1+1,1+2);
disp_error(flag_verbose,'db_dc_k_c_0_dif_wM__',db_dc_k_c_0_dif_wM__,'db_dc_k_c_0_mid_wM__',db_dc_k_c_0_mid_wM__);
db_dc_k_c_1_dif_wM__ = ( + k_c_1_pos_b_pos_c_wM__ + k_c_1_neg_b_neg_c_wM__ - k_c_1_pos_b_neg_c_wM__ - k_c_1_neg_b_pos_c_wM__ )/max(1e-12,4*db*dc) ;
db_dc_k_c_1_mid_wM__ = dtau_dtau_k_c_1_mid_wM33____(:,:,1+1,1+2);
disp_error(flag_verbose,'db_dc_k_c_1_dif_wM__',db_dc_k_c_1_dif_wM__,'db_dc_k_c_1_mid_wM__',db_dc_k_c_1_mid_wM__);
db_dc_k_c_2_dif_wM__ = ( + k_c_2_pos_b_pos_c_wM__ + k_c_2_neg_b_neg_c_wM__ - k_c_2_pos_b_neg_c_wM__ - k_c_2_neg_b_pos_c_wM__ )/max(1e-12,4*db*dc) ;
db_dc_k_c_2_mid_wM__ = dtau_dtau_k_c_2_mid_wM33____(:,:,1+1,1+2);
disp_error(flag_verbose,'db_dc_k_c_2_dif_wM__',db_dc_k_c_2_dif_wM__,'db_dc_k_c_2_mid_wM__',db_dc_k_c_2_mid_wM__);
db_dc_k_p_r01_dif_wM__ = ( + k_p_r01_pos_b_pos_c_wM__ + k_p_r01_neg_b_neg_c_wM__ - k_p_r01_pos_b_neg_c_wM__ - k_p_r01_neg_b_pos_c_wM__ )/max(1e-12,4*db*dc) ;
db_dc_k_p_r01_mid_wM__ = dtau_dtau_k_p_r01_mid_wM33____(:,:,1+1,1+2);
disp_error(flag_verbose,'db_dc_k_p_r01_dif_wM__',db_dc_k_p_r01_dif_wM__,'db_dc_k_p_r01_mid_wM__',db_dc_k_p_r01_mid_wM__);
dc_db_k_p_polar_a_dif_wM__ = ( + k_p_polar_a_pos_b_pos_c_wM__ + k_p_polar_a_neg_b_neg_c_wM__ - k_p_polar_a_pos_b_neg_c_wM__ - k_p_polar_a_neg_b_pos_c_wM__ )/max(1e-12,4*db*dc) ;
dc_db_k_p_polar_a_mid_wM__ = dtau_dtau_k_p_polar_a_mid_wM33____(:,:,1+2,1+1);
disp_error(flag_verbose,'dc_db_k_p_polar_a_dif_wM__',dc_db_k_p_polar_a_dif_wM__,'dc_db_k_p_polar_a_mid_wM__',dc_db_k_p_polar_a_mid_wM__);
dc_db_k_p_azimu_b_dif_wM__ = ( + k_p_azimu_b_pos_b_pos_c_wM__ + k_p_azimu_b_neg_b_neg_c_wM__ - k_p_azimu_b_pos_b_neg_c_wM__ - k_p_azimu_b_neg_b_pos_c_wM__ )/max(1e-12,4*db*dc) ;
dc_db_k_p_azimu_b_mid_wM__ = dtau_dtau_k_p_azimu_b_mid_wM33____(:,:,1+2,1+1);
disp_error(flag_verbose,'dc_db_k_p_azimu_b_dif_wM__',dc_db_k_p_azimu_b_dif_wM__,'dc_db_k_p_azimu_b_mid_wM__',dc_db_k_p_azimu_b_mid_wM__);
dc_db_k_c_0_dif_wM__ = ( + k_c_0_pos_b_pos_c_wM__ + k_c_0_neg_b_neg_c_wM__ - k_c_0_pos_b_neg_c_wM__ - k_c_0_neg_b_pos_c_wM__ )/max(1e-12,4*db*dc) ;
dc_db_k_c_0_mid_wM__ = dtau_dtau_k_c_0_mid_wM33____(:,:,1+2,1+1);
disp_error(flag_verbose,'dc_db_k_c_0_dif_wM__',dc_db_k_c_0_dif_wM__,'dc_db_k_c_0_mid_wM__',dc_db_k_c_0_mid_wM__);
dc_db_k_c_1_dif_wM__ = ( + k_c_1_pos_b_pos_c_wM__ + k_c_1_neg_b_neg_c_wM__ - k_c_1_pos_b_neg_c_wM__ - k_c_1_neg_b_pos_c_wM__ )/max(1e-12,4*db*dc) ;
dc_db_k_c_1_mid_wM__ = dtau_dtau_k_c_1_mid_wM33____(:,:,1+2,1+1);
disp_error(flag_verbose,'dc_db_k_c_1_dif_wM__',dc_db_k_c_1_dif_wM__,'dc_db_k_c_1_mid_wM__',dc_db_k_c_1_mid_wM__);
dc_db_k_c_2_dif_wM__ = ( + k_c_2_pos_b_pos_c_wM__ + k_c_2_neg_b_neg_c_wM__ - k_c_2_pos_b_neg_c_wM__ - k_c_2_neg_b_pos_c_wM__ )/max(1e-12,4*db*dc) ;
dc_db_k_c_2_mid_wM__ = dtau_dtau_k_c_2_mid_wM33____(:,:,1+2,1+1);
disp_error(flag_verbose,'dc_db_k_c_2_dif_wM__',dc_db_k_c_2_dif_wM__,'dc_db_k_c_2_mid_wM__',dc_db_k_c_2_mid_wM__);
dc_db_k_p_r01_dif_wM__ = ( + k_p_r01_pos_b_pos_c_wM__ + k_p_r01_neg_b_neg_c_wM__ - k_p_r01_pos_b_neg_c_wM__ - k_p_r01_neg_b_pos_c_wM__ )/max(1e-12,4*db*dc) ;
dc_db_k_p_r01_mid_wM__ = dtau_dtau_k_p_r01_mid_wM33____(:,:,1+2,1+1);
disp_error(flag_verbose,'dc_db_k_p_r01_dif_wM__',dc_db_k_p_r01_dif_wM__,'dc_db_k_p_r01_mid_wM__',dc_db_k_p_r01_mid_wM__);
%%%%;
disp('returning'); return;
end;%if nargin<1;

if (flag_verbose>0); disp(sprintf(' %% [entering %s]',str_thisfunction)); end;

flag_d0 = 1;
flag_d1 = (nargout>=1+1*6) ;
flag_d2 = (nargout>=1+2*6) ;

%%%%%%%%;
if flag_d0;
%%%%;
sa_wM__ = repmat(reshape(sin(viewing_polar_a_M_),[1,n_M]),[n_w,1]); ca_wM__ = repmat(reshape(cos(viewing_polar_a_M_),[1,n_M]),[n_w,1]);
sb_wM__ = repmat(reshape(sin(viewing_azimu_b_M_),[1,n_M]),[n_w,1]); cb_wM__ = repmat(reshape(cos(viewing_azimu_b_M_),[1,n_M]),[n_w,1]);
viewing_gamma_z_M_ = reshape(viewing_gamma_z_M_,[1,n_M]); inplane_gamma_z_w_ = reshape(2*pi*[0:n_w-1]/n_w,[n_w,1]);
combine_gamma_z_wM__ = repmat(inplane_gamma_z_w_,[1,n_M]) - repmat(viewing_gamma_z_M_,[n_w,1]);
sc_wM__ = sin(combine_gamma_z_wM__); cc_wM__ = cos(combine_gamma_z_wM__);
k_c_0_wM__ = +cb_wM__.*ca_wM__.*cc_wM__ - sb_wM__.*sc_wM__ ; 
k_c_1_wM__ = +sb_wM__.*ca_wM__.*cc_wM__ + cb_wM__.*sc_wM__ ; 
k_c_2_wM__ = -sa_wM__.*cc_wM__ ;
k_p_r01_wM__ = sqrt(k_c_0_wM__.^2 + k_c_1_wM__.^2);
k_p_polar_a_wM__ = atan2(k_p_r01_wM__,k_c_2_wM__);
k_p_azimu_b_wM__ = atan2(k_c_1_wM__,k_c_0_wM__);
%%%%;
end;%if flag_d0;
%%%%%%%%;

%%%%%%%%;
if flag_d1;
%%%%;
r01 = @(r0,r1) sqrt(r0.^2 + r1.^2) ;
d0_r01 = @(r0,r1) r0./r01(r0,r1);
d1_r01 = @(r0,r1) r1./r01(r0,r1);
z = @(y,x) y./x ;
dx_z = @(y,x) -y./x.^2 ;
dy_z = @(y,x) +1./x ;
dz_atan2 = @(y,x) x.^2 ./ (x.^2 + y.^2) ;
dx_atan2 = @(y,x) dz_atan2(y,x).*dx_z(y,x) ;
dy_atan2 = @(y,x) dz_atan2(y,x).*dy_z(y,x) ;
da_sa_wM__ = repmat(reshape(+cos(viewing_polar_a_M_),[1,n_M]),[n_w,1]); da_ca_wM__ = repmat(reshape(-sin(viewing_polar_a_M_),[1,n_M]),[n_w,1]);
db_sb_wM__ = repmat(reshape(+cos(viewing_azimu_b_M_),[1,n_M]),[n_w,1]); db_cb_wM__ = repmat(reshape(-sin(viewing_azimu_b_M_),[1,n_M]),[n_w,1]);
dc_sc_wM__ = -cos(combine_gamma_z_wM__); dc_cc_wM__ = +sin(combine_gamma_z_wM__); %<-- note sign switch. ;
da_k_c_0_wM__ = +cb_wM__.*da_ca_wM__.*cc_wM__ ;
db_k_c_0_wM__ = +db_cb_wM__.*ca_wM__.*cc_wM__ - db_sb_wM__.*sc_wM__ ; 
dc_k_c_0_wM__ = +cb_wM__.*ca_wM__.*dc_cc_wM__ - sb_wM__.*dc_sc_wM__ ;
da_k_c_1_wM__ = +sb_wM__.*da_ca_wM__.*cc_wM__ ;
db_k_c_1_wM__ = +db_sb_wM__.*ca_wM__.*cc_wM__ + db_cb_wM__.*sc_wM__ ; 
dc_k_c_1_wM__ = +sb_wM__.*ca_wM__.*dc_cc_wM__ + cb_wM__.*dc_sc_wM__ ; 
da_k_c_2_wM__ = -da_sa_wM__.*cc_wM__ ;
db_k_c_2_wM__ = zeros(n_w,n_M);
dc_k_c_2_wM__ = -sa_wM__.*dc_cc_wM__ ;
%da_k_p_r01_wM__ = (k_c_0_wM__.*da_k_c_0_wM__ + k_c_1_wM__.*da_k_c_1_wM__)./k_p_r01_wM__;
%db_k_p_r01_wM__ = (k_c_0_wM__.*db_k_c_0_wM__ + k_c_1_wM__.*db_k_c_1_wM__)./k_p_r01_wM__;
%dc_k_p_r01_wM__ = (k_c_0_wM__.*dc_k_c_0_wM__ + k_c_1_wM__.*dc_k_c_1_wM__)./k_p_r01_wM__;
da_k_p_r01_wM__ = d0_r01(k_c_0_wM__,k_c_1_wM__).*da_k_c_0_wM__ + d1_r01(k_c_0_wM__,k_c_1_wM__).*da_k_c_1_wM__ ;
db_k_p_r01_wM__ = d0_r01(k_c_0_wM__,k_c_1_wM__).*db_k_c_0_wM__ + d1_r01(k_c_0_wM__,k_c_1_wM__).*db_k_c_1_wM__ ;
dc_k_p_r01_wM__ = d0_r01(k_c_0_wM__,k_c_1_wM__).*dc_k_c_0_wM__ + d1_r01(k_c_0_wM__,k_c_1_wM__).*dc_k_c_1_wM__ ;
da_k_p_polar_a_wM__ = dy_atan2(k_p_r01_wM__,k_c_2_wM__).*da_k_p_r01_wM__ + dx_atan2(k_p_r01_wM__,k_c_2_wM__).*da_k_c_2_wM__;
db_k_p_polar_a_wM__ = dy_atan2(k_p_r01_wM__,k_c_2_wM__).*db_k_p_r01_wM__ + dx_atan2(k_p_r01_wM__,k_c_2_wM__).*db_k_c_2_wM__;
dc_k_p_polar_a_wM__ = dy_atan2(k_p_r01_wM__,k_c_2_wM__).*dc_k_p_r01_wM__ + dx_atan2(k_p_r01_wM__,k_c_2_wM__).*dc_k_c_2_wM__;
da_k_p_azimu_b_wM__ = dy_atan2(k_c_1_wM__,k_c_0_wM__).*da_k_c_1_wM__ + dx_atan2(k_c_1_wM__,k_c_0_wM__).*da_k_c_0_wM__;
db_k_p_azimu_b_wM__ = dy_atan2(k_c_1_wM__,k_c_0_wM__).*db_k_c_1_wM__ + dx_atan2(k_c_1_wM__,k_c_0_wM__).*db_k_c_0_wM__;
dc_k_p_azimu_b_wM__ = dy_atan2(k_c_1_wM__,k_c_0_wM__).*dc_k_c_1_wM__ + dx_atan2(k_c_1_wM__,k_c_0_wM__).*dc_k_c_0_wM__;
dtau_k_c_0_wM3___(:,:,1+0) = da_k_c_0_wM__;
dtau_k_c_0_wM3___(:,:,1+1) = db_k_c_0_wM__;
dtau_k_c_0_wM3___(:,:,1+2) = dc_k_c_0_wM__;
dtau_k_c_1_wM3___(:,:,1+0) = da_k_c_1_wM__;
dtau_k_c_1_wM3___(:,:,1+1) = db_k_c_1_wM__;
dtau_k_c_1_wM3___(:,:,1+2) = dc_k_c_1_wM__;
dtau_k_c_2_wM3___(:,:,1+0) = da_k_c_2_wM__;
dtau_k_c_2_wM3___(:,:,1+1) = db_k_c_2_wM__;
dtau_k_c_2_wM3___(:,:,1+2) = dc_k_c_2_wM__;
dtau_k_p_r01_wM3___(:,:,1+0) = da_k_p_r01_wM__;
dtau_k_p_r01_wM3___(:,:,1+1) = db_k_p_r01_wM__;
dtau_k_p_r01_wM3___(:,:,1+2) = dc_k_p_r01_wM__;
dtau_k_p_polar_a_wM3___(:,:,1+0) = da_k_p_polar_a_wM__;
dtau_k_p_polar_a_wM3___(:,:,1+1) = db_k_p_polar_a_wM__;
dtau_k_p_polar_a_wM3___(:,:,1+2) = dc_k_p_polar_a_wM__;
dtau_k_p_azimu_b_wM3___(:,:,1+0) = da_k_p_azimu_b_wM__;
dtau_k_p_azimu_b_wM3___(:,:,1+1) = db_k_p_azimu_b_wM__;
dtau_k_p_azimu_b_wM3___(:,:,1+2) = dc_k_p_azimu_b_wM__;
%%%%;
end;%if flag_d1;
%%%%%%%%;

%%%%%%%%;
if flag_d2;
%%%%;
r01 = @(r0,r1) sqrt(r0.^2 + r1.^2) ;
d0_d0_r01 = @(r0,r1) 1./r01(r0,r1) - r0.^2./r01(r0,r1).^3 ;
d1_d0_r01 = @(r0,r1) - (r0.*r1)./r01(r0,r1).^3 ;
d0_d1_r01 = @(r0,r1) - (r1.*r0)./r01(r0,r1).^3 ;
d1_d1_r01 = @(r0,r1) 1./r01(r0,r1) - r1.^2./r01(r0,r1).^3 ;
dx_dx_z = @(y,x) +2*y./x.^3 ;
dy_dx_z = @(y,x) -1./x.^2 ;
dx_dy_z = @(y,x) -1./x.^2 ;
dy_dy_z = @(y,x) zeros(size(y));
dz_dz_atan2 = @(y,x) -2*(x.^3.*y) ./ (x.^2 + y.^2).^2 ;
dx_dx_atan2 = @(y,x) dz_dz_atan2(y,x).*dx_z(y,x).*dx_z(y,x) + dz_atan2(y,x).*dx_dx_z(y,x) ;
dy_dx_atan2 = @(y,x) dz_dz_atan2(y,x).*dy_z(y,x).*dx_z(y,x) + dz_atan2(y,x).*dy_dx_z(y,x) ;
dx_dy_atan2 = @(y,x) dz_dz_atan2(y,x).*dx_z(y,x).*dy_z(y,x) + dz_atan2(y,x).*dx_dy_z(y,x) ;
dy_dy_atan2 = @(y,x) dz_dz_atan2(y,x).*dy_z(y,x).*dy_z(y,x) + dz_atan2(y,x).*dy_dy_z(y,x) ;
%%;
flag_check=0;
if flag_check;
n_test = 8;
for ntest=0:n_test-1;
tmp_y = 2*rand()-1;
tmp_x = 2*rand()-1;
dy = 1e-3;
dx = 2e-4;
tmp_dy_atan2_pos_y = dy_atan2(tmp_y+1*dy,tmp_x+0*dx);
tmp_dy_atan2_neg_y = dy_atan2(tmp_y-1*dy,tmp_x+0*dx);
tmp_dy_dy_atan2_dif = (tmp_dy_atan2_pos_y-tmp_dy_atan2_neg_y)/max(1e-12,2*dy);
tmp_dy_dy_atan2_mid = dy_dy_atan2(tmp_y,tmp_x);
disp(sprintf(' %% ntest %.2d: tmp_dy_dy_atan2_dif %+9.5f, tmp_dy_dy_atan2_mid %+9.5f, tmp_dy_dy_atan2_dif vs tmp_dy_dy_atan2_mid: %0.16f',ntest,tmp_dy_dy_atan2_dif,tmp_dy_dy_atan2_mid,fnorm(tmp_dy_dy_atan2_dif-tmp_dy_dy_atan2_mid)/max(1e-12,fnorm(tmp_dy_dy_atan2_dif))));
tmp_dy_atan2_pos_x = dy_atan2(tmp_y+0*dy,tmp_x+1*dx);
tmp_dy_atan2_neg_x = dy_atan2(tmp_y+0*dy,tmp_x-1*dx);
tmp_dx_dy_atan2_dif = (tmp_dy_atan2_pos_x-tmp_dy_atan2_neg_x)/max(1e-12,2*dx);
tmp_dx_dy_atan2_mid = dx_dy_atan2(tmp_y,tmp_x);
disp(sprintf(' %% ntest %.2d: tmp_dx_dy_atan2_dif %+9.5f, tmp_dx_dy_atan2_mid %+9.5f, tmp_dx_dy_atan2_dif vs tmp_dx_dy_atan2_mid: %0.16f',ntest,tmp_dx_dy_atan2_dif,tmp_dx_dy_atan2_mid,fnorm(tmp_dx_dy_atan2_dif-tmp_dx_dy_atan2_mid)/max(1e-12,fnorm(tmp_dx_dy_atan2_dif))));
tmp_dx_atan2_pos_y = dx_atan2(tmp_y+1*dy,tmp_x+0*dx);
tmp_dx_atan2_neg_y = dx_atan2(tmp_y-1*dy,tmp_x+0*dx);
tmp_dy_dx_atan2_dif = (tmp_dx_atan2_pos_y-tmp_dx_atan2_neg_y)/max(1e-12,2*dy);
tmp_dy_dx_atan2_mid = dy_dx_atan2(tmp_y,tmp_x);
disp(sprintf(' %% ntest %.2d: tmp_dy_dx_atan2_dif %+9.5f, tmp_dy_dx_atan2_mid %+9.5f, tmp_dy_dx_atan2_dif vs tmp_dy_dx_atan2_mid: %0.16f',ntest,tmp_dy_dx_atan2_dif,tmp_dy_dx_atan2_mid,fnorm(tmp_dy_dx_atan2_dif-tmp_dy_dx_atan2_mid)/max(1e-12,fnorm(tmp_dy_dx_atan2_dif))));
tmp_dx_atan2_pos_x = dx_atan2(tmp_y+0*dy,tmp_x+1*dx);
tmp_dx_atan2_neg_x = dx_atan2(tmp_y+0*dy,tmp_x-1*dx);
tmp_dx_dx_atan2_dif = (tmp_dx_atan2_pos_x-tmp_dx_atan2_neg_x)/max(1e-12,2*dx);
tmp_dx_dx_atan2_mid = dx_dx_atan2(tmp_y,tmp_x);
disp(sprintf(' %% ntest %.2d: tmp_dx_dx_atan2_dif %+9.5f, tmp_dx_dx_atan2_mid %+9.5f, tmp_dx_dx_atan2_dif vs tmp_dx_dx_atan2_mid: %0.16f',ntest,tmp_dx_dx_atan2_dif,tmp_dx_dx_atan2_mid,fnorm(tmp_dx_dx_atan2_dif-tmp_dx_dx_atan2_mid)/max(1e-12,fnorm(tmp_dx_dx_atan2_dif))));
end;%for ntest=0:n_test-1;
disp('returning'); return;
end;%if flag_check;
%%;
da_da_sa_wM__ = repmat(reshape(-sin(viewing_polar_a_M_),[1,n_M]),[n_w,1]);
da_da_ca_wM__ = repmat(reshape(-cos(viewing_polar_a_M_),[1,n_M]),[n_w,1]);
db_db_sb_wM__ = repmat(reshape(-sin(viewing_azimu_b_M_),[1,n_M]),[n_w,1]);
db_db_cb_wM__ = repmat(reshape(-cos(viewing_azimu_b_M_),[1,n_M]),[n_w,1]);
dc_dc_sc_wM__ = -sin(combine_gamma_z_wM__); %<-- note sign switch. ;
dc_dc_cc_wM__ = -cos(combine_gamma_z_wM__); %<-- note sign switch. ;
da_da_k_c_0_wM__ = +cb_wM__.*da_da_ca_wM__.*cc_wM__ ;
db_da_k_c_0_wM__ = +db_cb_wM__.*da_ca_wM__.*cc_wM__ ;
dc_da_k_c_0_wM__ = +cb_wM__.*da_ca_wM__.*dc_cc_wM__ ;
da_db_k_c_0_wM__ = +db_cb_wM__.*da_ca_wM__.*cc_wM__ ;
db_db_k_c_0_wM__ = +db_db_cb_wM__.*ca_wM__.*cc_wM__ - db_db_sb_wM__.*sc_wM__ ; 
dc_db_k_c_0_wM__ = +db_cb_wM__.*ca_wM__.*dc_cc_wM__ - db_sb_wM__.*dc_sc_wM__ ; 
da_dc_k_c_0_wM__ = +cb_wM__.*da_ca_wM__.*dc_cc_wM__ ;
db_dc_k_c_0_wM__ = +db_cb_wM__.*ca_wM__.*dc_cc_wM__ - db_sb_wM__.*dc_sc_wM__ ;
dc_dc_k_c_0_wM__ = +cb_wM__.*ca_wM__.*dc_dc_cc_wM__ - sb_wM__.*dc_dc_sc_wM__ ;
da_da_k_c_1_wM__ = +sb_wM__.*da_da_ca_wM__.*cc_wM__ ;
db_da_k_c_1_wM__ = +db_sb_wM__.*da_ca_wM__.*cc_wM__ ;
dc_da_k_c_1_wM__ = +sb_wM__.*da_ca_wM__.*dc_cc_wM__ ;
da_db_k_c_1_wM__ = +db_sb_wM__.*da_ca_wM__.*cc_wM__ ;
db_db_k_c_1_wM__ = +db_db_sb_wM__.*ca_wM__.*cc_wM__ + db_db_cb_wM__.*sc_wM__ ; 
dc_db_k_c_1_wM__ = +db_sb_wM__.*ca_wM__.*dc_cc_wM__ + db_cb_wM__.*dc_sc_wM__ ; 
da_dc_k_c_1_wM__ = +sb_wM__.*da_ca_wM__.*dc_cc_wM__ ;
db_dc_k_c_1_wM__ = +db_sb_wM__.*ca_wM__.*dc_cc_wM__ + db_cb_wM__.*dc_sc_wM__ ; 
dc_dc_k_c_1_wM__ = +sb_wM__.*ca_wM__.*dc_dc_cc_wM__ + cb_wM__.*dc_dc_sc_wM__ ; 
da_da_k_c_2_wM__ = -da_da_sa_wM__.*cc_wM__ ;
db_da_k_c_2_wM__ = zeros(n_w,n_M);
dc_da_k_c_2_wM__ = -da_sa_wM__.*dc_cc_wM__ ;
da_db_k_c_2_wM__ = zeros(n_w,n_M);
db_db_k_c_2_wM__ = zeros(n_w,n_M);
dc_db_k_c_2_wM__ = zeros(n_w,n_M);
da_dc_k_c_2_wM__ = -da_sa_wM__.*dc_cc_wM__ ;
db_dc_k_c_2_wM__ = zeros(n_w,n_M);
dc_dc_k_c_2_wM__ = -sa_wM__.*dc_dc_cc_wM__ ;
%%;
da_da_k_p_r01_wM__ = ...
+ d0_d0_r01(k_c_0_wM__,k_c_1_wM__).*da_k_c_0_wM__.*da_k_c_0_wM__ ...
+ d1_d0_r01(k_c_0_wM__,k_c_1_wM__).*da_k_c_1_wM__.*da_k_c_0_wM__ ...
+ d0_r01(k_c_0_wM__,k_c_1_wM__).*da_da_k_c_0_wM__ ...
+ d0_d1_r01(k_c_0_wM__,k_c_1_wM__).*da_k_c_0_wM__.*da_k_c_1_wM__ ...
+ d1_d1_r01(k_c_0_wM__,k_c_1_wM__).*da_k_c_1_wM__.*da_k_c_1_wM__ ...
+ d1_r01(k_c_0_wM__,k_c_1_wM__).*da_da_k_c_1_wM__ ...
;
db_da_k_p_r01_wM__ = ...
+ d0_d0_r01(k_c_0_wM__,k_c_1_wM__).*db_k_c_0_wM__.*da_k_c_0_wM__ ...
+ d1_d0_r01(k_c_0_wM__,k_c_1_wM__).*db_k_c_1_wM__.*da_k_c_0_wM__ ...
+ d0_r01(k_c_0_wM__,k_c_1_wM__).*db_da_k_c_0_wM__ ...
+ d0_d1_r01(k_c_0_wM__,k_c_1_wM__).*db_k_c_0_wM__.*da_k_c_1_wM__ ...
+ d1_d1_r01(k_c_0_wM__,k_c_1_wM__).*db_k_c_1_wM__.*da_k_c_1_wM__ ...
+ d1_r01(k_c_0_wM__,k_c_1_wM__).*db_da_k_c_1_wM__ ...
;
dc_da_k_p_r01_wM__ = ...
+ d0_d0_r01(k_c_0_wM__,k_c_1_wM__).*dc_k_c_0_wM__.*da_k_c_0_wM__ ...
+ d1_d0_r01(k_c_0_wM__,k_c_1_wM__).*dc_k_c_1_wM__.*da_k_c_0_wM__ ...
+ d0_r01(k_c_0_wM__,k_c_1_wM__).*dc_da_k_c_0_wM__ ...
+ d0_d1_r01(k_c_0_wM__,k_c_1_wM__).*dc_k_c_0_wM__.*da_k_c_1_wM__ ...
+ d1_d1_r01(k_c_0_wM__,k_c_1_wM__).*dc_k_c_1_wM__.*da_k_c_1_wM__ ...
+ d1_r01(k_c_0_wM__,k_c_1_wM__).*dc_da_k_c_1_wM__ ...
;
%%;
da_db_k_p_r01_wM__ =  ...
+ d0_d0_r01(k_c_0_wM__,k_c_1_wM__).*da_k_c_0_wM__.*db_k_c_0_wM__ ...
+ d1_d0_r01(k_c_0_wM__,k_c_1_wM__).*da_k_c_1_wM__.*db_k_c_0_wM__ ...
+ d0_r01(k_c_0_wM__,k_c_1_wM__).*da_db_k_c_0_wM__ ...
+ d0_d1_r01(k_c_0_wM__,k_c_1_wM__).*da_k_c_0_wM__.*db_k_c_1_wM__ ...
+ d1_d1_r01(k_c_0_wM__,k_c_1_wM__).*da_k_c_1_wM__.*db_k_c_1_wM__ ...
+ d1_r01(k_c_0_wM__,k_c_1_wM__).*da_db_k_c_1_wM__ ...
;
db_db_k_p_r01_wM__ =  ...
+ d0_d0_r01(k_c_0_wM__,k_c_1_wM__).*db_k_c_0_wM__.*db_k_c_0_wM__ ...
+ d1_d0_r01(k_c_0_wM__,k_c_1_wM__).*db_k_c_1_wM__.*db_k_c_0_wM__ ...
+ d0_r01(k_c_0_wM__,k_c_1_wM__).*db_db_k_c_0_wM__ ...
+ d0_d1_r01(k_c_0_wM__,k_c_1_wM__).*db_k_c_0_wM__.*db_k_c_1_wM__ ...
+ d1_d1_r01(k_c_0_wM__,k_c_1_wM__).*db_k_c_1_wM__.*db_k_c_1_wM__ ...
+ d1_r01(k_c_0_wM__,k_c_1_wM__).*db_db_k_c_1_wM__ ...
;
dc_db_k_p_r01_wM__ =  ...
+ d0_d0_r01(k_c_0_wM__,k_c_1_wM__).*dc_k_c_0_wM__.*db_k_c_0_wM__ ...
+ d1_d0_r01(k_c_0_wM__,k_c_1_wM__).*dc_k_c_1_wM__.*db_k_c_0_wM__ ...
+ d0_r01(k_c_0_wM__,k_c_1_wM__).*dc_db_k_c_0_wM__ ...
+ d0_d1_r01(k_c_0_wM__,k_c_1_wM__).*dc_k_c_0_wM__.*db_k_c_1_wM__ ...
+ d1_d1_r01(k_c_0_wM__,k_c_1_wM__).*dc_k_c_1_wM__.*db_k_c_1_wM__ ...
+ d1_r01(k_c_0_wM__,k_c_1_wM__).*dc_db_k_c_1_wM__ ...
;
%%;
da_dc_k_p_r01_wM__ = ...
+ d0_d0_r01(k_c_0_wM__,k_c_1_wM__).*da_k_c_0_wM__.*dc_k_c_0_wM__ ...
+ d1_d0_r01(k_c_0_wM__,k_c_1_wM__).*da_k_c_1_wM__.*dc_k_c_0_wM__ ...
+ d0_r01(k_c_0_wM__,k_c_1_wM__).*da_dc_k_c_0_wM__ ...
+ d0_d1_r01(k_c_0_wM__,k_c_1_wM__).*da_k_c_0_wM__.*dc_k_c_1_wM__ ...
+ d1_d1_r01(k_c_0_wM__,k_c_1_wM__).*da_k_c_1_wM__.*dc_k_c_1_wM__ ...
+ d1_r01(k_c_0_wM__,k_c_1_wM__).*da_dc_k_c_1_wM__ ...
;
db_dc_k_p_r01_wM__ = ...
+ d0_d0_r01(k_c_0_wM__,k_c_1_wM__).*db_k_c_0_wM__.*dc_k_c_0_wM__ ...
+ d1_d0_r01(k_c_0_wM__,k_c_1_wM__).*db_k_c_1_wM__.*dc_k_c_0_wM__ ...
+ d0_r01(k_c_0_wM__,k_c_1_wM__).*db_dc_k_c_0_wM__ ...
+ d0_d1_r01(k_c_0_wM__,k_c_1_wM__).*db_k_c_0_wM__.*dc_k_c_1_wM__ ...
+ d1_d1_r01(k_c_0_wM__,k_c_1_wM__).*db_k_c_1_wM__.*dc_k_c_1_wM__ ...
+ d1_r01(k_c_0_wM__,k_c_1_wM__).*db_dc_k_c_1_wM__ ...
;
dc_dc_k_p_r01_wM__ = ...
+ d0_d0_r01(k_c_0_wM__,k_c_1_wM__).*dc_k_c_0_wM__.*dc_k_c_0_wM__ ...
+ d1_d0_r01(k_c_0_wM__,k_c_1_wM__).*dc_k_c_1_wM__.*dc_k_c_0_wM__ ...
+ d0_r01(k_c_0_wM__,k_c_1_wM__).*dc_dc_k_c_0_wM__ ...
+ d0_d1_r01(k_c_0_wM__,k_c_1_wM__).*dc_k_c_0_wM__.*dc_k_c_1_wM__ ...
+ d1_d1_r01(k_c_0_wM__,k_c_1_wM__).*dc_k_c_1_wM__.*dc_k_c_1_wM__ ...
+ d1_r01(k_c_0_wM__,k_c_1_wM__).*dc_dc_k_c_1_wM__ ...
;
%%;
da_da_k_p_polar_a_wM__ = ...
  + dy_dy_atan2(k_p_r01_wM__,k_c_2_wM__).*da_k_p_r01_wM__.*da_k_p_r01_wM__ ...
  + dx_dy_atan2(k_p_r01_wM__,k_c_2_wM__).*da_k_c_2_wM__.*da_k_p_r01_wM__ ...
  + dy_atan2(k_p_r01_wM__,k_c_2_wM__).*da_da_k_p_r01_wM__ ...
  + dy_dx_atan2(k_p_r01_wM__,k_c_2_wM__).*da_k_p_r01_wM__.*da_k_c_2_wM__ ...
  + dx_dx_atan2(k_p_r01_wM__,k_c_2_wM__).*da_k_c_2_wM__.*da_k_c_2_wM__ ...
  + dx_atan2(k_p_r01_wM__,k_c_2_wM__).*da_da_k_c_2_wM__ ...
  ;
db_da_k_p_polar_a_wM__ = ...
  + dy_dy_atan2(k_p_r01_wM__,k_c_2_wM__).*db_k_p_r01_wM__.*da_k_p_r01_wM__ ...
  + dx_dy_atan2(k_p_r01_wM__,k_c_2_wM__).*db_k_c_2_wM__.*da_k_p_r01_wM__ ...
  + dy_atan2(k_p_r01_wM__,k_c_2_wM__).*db_da_k_p_r01_wM__ ...
  + dy_dx_atan2(k_p_r01_wM__,k_c_2_wM__).*db_k_p_r01_wM__.*da_k_c_2_wM__ ...
  + dx_dx_atan2(k_p_r01_wM__,k_c_2_wM__).*db_k_c_2_wM__.*da_k_c_2_wM__ ...
  + dx_atan2(k_p_r01_wM__,k_c_2_wM__).*db_da_k_c_2_wM__ ...
  ;
dc_da_k_p_polar_a_wM__ = ...
  + dy_dy_atan2(k_p_r01_wM__,k_c_2_wM__).*dc_k_p_r01_wM__.*da_k_p_r01_wM__ ...
  + dx_dy_atan2(k_p_r01_wM__,k_c_2_wM__).*dc_k_c_2_wM__.*da_k_p_r01_wM__ ...
  + dy_atan2(k_p_r01_wM__,k_c_2_wM__).*dc_da_k_p_r01_wM__ ...
  + dy_dx_atan2(k_p_r01_wM__,k_c_2_wM__).*dc_k_p_r01_wM__.*da_k_c_2_wM__ ...
  + dx_dx_atan2(k_p_r01_wM__,k_c_2_wM__).*dc_k_c_2_wM__.*da_k_c_2_wM__ ...
  + dx_atan2(k_p_r01_wM__,k_c_2_wM__).*dc_da_k_c_2_wM__ ...
  ;
da_db_k_p_polar_a_wM__ = ...
  + dy_dy_atan2(k_p_r01_wM__,k_c_2_wM__).*da_k_p_r01_wM__.*db_k_p_r01_wM__ ...
  + dx_dy_atan2(k_p_r01_wM__,k_c_2_wM__).*da_k_c_2_wM__.*db_k_p_r01_wM__ ...
  + dy_atan2(k_p_r01_wM__,k_c_2_wM__).*da_db_k_p_r01_wM__ ...
  + dy_dx_atan2(k_p_r01_wM__,k_c_2_wM__).*da_k_p_r01_wM__.*db_k_c_2_wM__ ...
  + dx_dx_atan2(k_p_r01_wM__,k_c_2_wM__).*da_k_c_2_wM__.*db_k_c_2_wM__ ...
  + dx_atan2(k_p_r01_wM__,k_c_2_wM__).*da_db_k_c_2_wM__ ...
  ;
db_db_k_p_polar_a_wM__ = ...
  + dy_dy_atan2(k_p_r01_wM__,k_c_2_wM__).*db_k_p_r01_wM__.*db_k_p_r01_wM__ ...
  + dx_dy_atan2(k_p_r01_wM__,k_c_2_wM__).*db_k_c_2_wM__.*db_k_p_r01_wM__ ...
  + dy_atan2(k_p_r01_wM__,k_c_2_wM__).*db_db_k_p_r01_wM__ ...
  + dy_dx_atan2(k_p_r01_wM__,k_c_2_wM__).*db_k_p_r01_wM__.*db_k_c_2_wM__ ...
  + dx_dx_atan2(k_p_r01_wM__,k_c_2_wM__).*db_k_c_2_wM__.*db_k_c_2_wM__ ...
  + dx_atan2(k_p_r01_wM__,k_c_2_wM__).*db_db_k_c_2_wM__ ...
  ;
dc_db_k_p_polar_a_wM__ = ...
  + dy_dy_atan2(k_p_r01_wM__,k_c_2_wM__).*dc_k_p_r01_wM__.*db_k_p_r01_wM__ ...
  + dx_dy_atan2(k_p_r01_wM__,k_c_2_wM__).*dc_k_c_2_wM__.*db_k_p_r01_wM__ ...
  + dy_atan2(k_p_r01_wM__,k_c_2_wM__).*dc_db_k_p_r01_wM__ ...
  + dy_dx_atan2(k_p_r01_wM__,k_c_2_wM__).*dc_k_p_r01_wM__.*db_k_c_2_wM__ ...
  + dx_dx_atan2(k_p_r01_wM__,k_c_2_wM__).*dc_k_c_2_wM__.*db_k_c_2_wM__ ...
  + dx_atan2(k_p_r01_wM__,k_c_2_wM__).*dc_db_k_c_2_wM__ ...
  ;
da_dc_k_p_polar_a_wM__ = ...
  + dy_dy_atan2(k_p_r01_wM__,k_c_2_wM__).*da_k_p_r01_wM__.*dc_k_p_r01_wM__ ...
  + dx_dy_atan2(k_p_r01_wM__,k_c_2_wM__).*da_k_c_2_wM__.*dc_k_p_r01_wM__ ...
  + dy_atan2(k_p_r01_wM__,k_c_2_wM__).*da_dc_k_p_r01_wM__ ...
  + dy_dx_atan2(k_p_r01_wM__,k_c_2_wM__).*da_k_p_r01_wM__.*dc_k_c_2_wM__ ...
  + dx_dx_atan2(k_p_r01_wM__,k_c_2_wM__).*da_k_c_2_wM__.*dc_k_c_2_wM__ ...
  + dx_atan2(k_p_r01_wM__,k_c_2_wM__).*da_dc_k_c_2_wM__ ...
  ;
db_dc_k_p_polar_a_wM__ = ...
  + dy_dy_atan2(k_p_r01_wM__,k_c_2_wM__).*db_k_p_r01_wM__.*dc_k_p_r01_wM__ ...
  + dx_dy_atan2(k_p_r01_wM__,k_c_2_wM__).*db_k_c_2_wM__.*dc_k_p_r01_wM__ ...
  + dy_atan2(k_p_r01_wM__,k_c_2_wM__).*db_dc_k_p_r01_wM__ ...
  + dy_dx_atan2(k_p_r01_wM__,k_c_2_wM__).*db_k_p_r01_wM__.*dc_k_c_2_wM__ ...
  + dx_dx_atan2(k_p_r01_wM__,k_c_2_wM__).*db_k_c_2_wM__.*dc_k_c_2_wM__ ...
  + dx_atan2(k_p_r01_wM__,k_c_2_wM__).*db_dc_k_c_2_wM__ ...
  ;
dc_dc_k_p_polar_a_wM__ = ...
  + dy_dy_atan2(k_p_r01_wM__,k_c_2_wM__).*dc_k_p_r01_wM__.*dc_k_p_r01_wM__ ...
  + dx_dy_atan2(k_p_r01_wM__,k_c_2_wM__).*dc_k_c_2_wM__.*dc_k_p_r01_wM__ ...
  + dy_atan2(k_p_r01_wM__,k_c_2_wM__).*dc_dc_k_p_r01_wM__ ...
  + dy_dx_atan2(k_p_r01_wM__,k_c_2_wM__).*dc_k_p_r01_wM__.*dc_k_c_2_wM__ ...
  + dx_dx_atan2(k_p_r01_wM__,k_c_2_wM__).*dc_k_c_2_wM__.*dc_k_c_2_wM__ ...
  + dx_atan2(k_p_r01_wM__,k_c_2_wM__).*dc_dc_k_c_2_wM__ ...
  ;
%%;
da_da_k_p_azimu_b_wM__ = ...
  + dy_dy_atan2(k_c_1_wM__,k_c_0_wM__).*da_k_c_1_wM__.*da_k_c_1_wM__ ...
  + dx_dy_atan2(k_c_1_wM__,k_c_0_wM__).*da_k_c_0_wM__.*da_k_c_1_wM__ ...
  + dy_atan2(k_c_1_wM__,k_c_0_wM__).*da_da_k_c_1_wM__ ...
  + dy_dx_atan2(k_c_1_wM__,k_c_0_wM__).*da_k_c_1_wM__.*da_k_c_0_wM__ ...
  + dx_dx_atan2(k_c_1_wM__,k_c_0_wM__).*da_k_c_0_wM__.*da_k_c_0_wM__ ...
  + dx_atan2(k_c_1_wM__,k_c_0_wM__).*da_da_k_c_0_wM__ ...
  ;
db_da_k_p_azimu_b_wM__ = ...
  + dy_dy_atan2(k_c_1_wM__,k_c_0_wM__).*db_k_c_1_wM__.*da_k_c_1_wM__ ...
  + dx_dy_atan2(k_c_1_wM__,k_c_0_wM__).*db_k_c_0_wM__.*da_k_c_1_wM__ ...
  + dy_atan2(k_c_1_wM__,k_c_0_wM__).*db_da_k_c_1_wM__ ...
  + dy_dx_atan2(k_c_1_wM__,k_c_0_wM__).*db_k_c_1_wM__.*da_k_c_0_wM__ ...
  + dx_dx_atan2(k_c_1_wM__,k_c_0_wM__).*db_k_c_0_wM__.*da_k_c_0_wM__ ...
  + dx_atan2(k_c_1_wM__,k_c_0_wM__).*db_da_k_c_0_wM__ ...
  ;
dc_da_k_p_azimu_b_wM__ = ...
  + dy_dy_atan2(k_c_1_wM__,k_c_0_wM__).*dc_k_c_1_wM__.*da_k_c_1_wM__ ...
  + dx_dy_atan2(k_c_1_wM__,k_c_0_wM__).*dc_k_c_0_wM__.*da_k_c_1_wM__ ...
  + dy_atan2(k_c_1_wM__,k_c_0_wM__).*dc_da_k_c_1_wM__ ...
  + dy_dx_atan2(k_c_1_wM__,k_c_0_wM__).*dc_k_c_1_wM__.*da_k_c_0_wM__ ...
  + dx_dx_atan2(k_c_1_wM__,k_c_0_wM__).*dc_k_c_0_wM__.*da_k_c_0_wM__ ...
  + dx_atan2(k_c_1_wM__,k_c_0_wM__).*dc_da_k_c_0_wM__ ...
  ;
da_db_k_p_azimu_b_wM__ = ...
  + dy_dy_atan2(k_c_1_wM__,k_c_0_wM__).*da_k_c_1_wM__.*db_k_c_1_wM__ ...
  + dx_dy_atan2(k_c_1_wM__,k_c_0_wM__).*da_k_c_0_wM__.*db_k_c_1_wM__ ...
  + dy_atan2(k_c_1_wM__,k_c_0_wM__).*da_db_k_c_1_wM__ ...
  + dy_dx_atan2(k_c_1_wM__,k_c_0_wM__).*da_k_c_1_wM__.*db_k_c_0_wM__ ...
  + dx_dx_atan2(k_c_1_wM__,k_c_0_wM__).*da_k_c_0_wM__.*db_k_c_0_wM__ ...
  + dx_atan2(k_c_1_wM__,k_c_0_wM__).*da_db_k_c_0_wM__ ...
  ;
db_db_k_p_azimu_b_wM__ = ...
  + dy_dy_atan2(k_c_1_wM__,k_c_0_wM__).*db_k_c_1_wM__.*db_k_c_1_wM__ ...
  + dx_dy_atan2(k_c_1_wM__,k_c_0_wM__).*db_k_c_0_wM__.*db_k_c_1_wM__ ...
  + dy_atan2(k_c_1_wM__,k_c_0_wM__).*db_db_k_c_1_wM__ ...
  + dy_dx_atan2(k_c_1_wM__,k_c_0_wM__).*db_k_c_1_wM__.*db_k_c_0_wM__ ...
  + dx_dx_atan2(k_c_1_wM__,k_c_0_wM__).*db_k_c_0_wM__.*db_k_c_0_wM__ ...
  + dx_atan2(k_c_1_wM__,k_c_0_wM__).*db_db_k_c_0_wM__ ...
  ;
dc_db_k_p_azimu_b_wM__ = ...
  + dy_dy_atan2(k_c_1_wM__,k_c_0_wM__).*dc_k_c_1_wM__.*db_k_c_1_wM__ ...
  + dx_dy_atan2(k_c_1_wM__,k_c_0_wM__).*dc_k_c_0_wM__.*db_k_c_1_wM__ ...
  + dy_atan2(k_c_1_wM__,k_c_0_wM__).*dc_db_k_c_1_wM__ ...
  + dy_dx_atan2(k_c_1_wM__,k_c_0_wM__).*dc_k_c_1_wM__.*db_k_c_0_wM__ ...
  + dx_dx_atan2(k_c_1_wM__,k_c_0_wM__).*dc_k_c_0_wM__.*db_k_c_0_wM__ ...
  + dx_atan2(k_c_1_wM__,k_c_0_wM__).*dc_db_k_c_0_wM__ ...
  ;
da_dc_k_p_azimu_b_wM__ = ...
  + dy_dy_atan2(k_c_1_wM__,k_c_0_wM__).*da_k_c_1_wM__.*dc_k_c_1_wM__ ...
  + dx_dy_atan2(k_c_1_wM__,k_c_0_wM__).*da_k_c_0_wM__.*dc_k_c_1_wM__ ...
  + dy_atan2(k_c_1_wM__,k_c_0_wM__).*da_dc_k_c_1_wM__ ...
  + dy_dx_atan2(k_c_1_wM__,k_c_0_wM__).*da_k_c_1_wM__.*dc_k_c_0_wM__ ...
  + dx_dx_atan2(k_c_1_wM__,k_c_0_wM__).*da_k_c_0_wM__.*dc_k_c_0_wM__ ...
  + dx_atan2(k_c_1_wM__,k_c_0_wM__).*da_dc_k_c_0_wM__ ...
  ;
db_dc_k_p_azimu_b_wM__ = ...
  + dy_dy_atan2(k_c_1_wM__,k_c_0_wM__).*db_k_c_1_wM__.*dc_k_c_1_wM__ ...
  + dx_dy_atan2(k_c_1_wM__,k_c_0_wM__).*db_k_c_0_wM__.*dc_k_c_1_wM__ ...
  + dy_atan2(k_c_1_wM__,k_c_0_wM__).*db_dc_k_c_1_wM__ ...
  + dy_dx_atan2(k_c_1_wM__,k_c_0_wM__).*db_k_c_1_wM__.*dc_k_c_0_wM__ ...
  + dx_dx_atan2(k_c_1_wM__,k_c_0_wM__).*db_k_c_0_wM__.*dc_k_c_0_wM__ ...
  + dx_atan2(k_c_1_wM__,k_c_0_wM__).*db_dc_k_c_0_wM__ ...
  ;
dc_dc_k_p_azimu_b_wM__ = ...
  + dy_dy_atan2(k_c_1_wM__,k_c_0_wM__).*dc_k_c_1_wM__.*dc_k_c_1_wM__ ...
  + dx_dy_atan2(k_c_1_wM__,k_c_0_wM__).*dc_k_c_0_wM__.*dc_k_c_1_wM__ ...
  + dy_atan2(k_c_1_wM__,k_c_0_wM__).*dc_dc_k_c_1_wM__ ...
  + dy_dx_atan2(k_c_1_wM__,k_c_0_wM__).*dc_k_c_1_wM__.*dc_k_c_0_wM__ ...
  + dx_dx_atan2(k_c_1_wM__,k_c_0_wM__).*dc_k_c_0_wM__.*dc_k_c_0_wM__ ...
  + dx_atan2(k_c_1_wM__,k_c_0_wM__).*dc_dc_k_c_0_wM__ ...
  ;
%%;
dtau_dtau_k_c_0_wM33____(:,:,1+0,1+0) = da_da_k_c_0_wM__;
dtau_dtau_k_c_0_wM33____(:,:,1+0,1+1) = db_da_k_c_0_wM__;
dtau_dtau_k_c_0_wM33____(:,:,1+0,1+2) = dc_da_k_c_0_wM__;
dtau_dtau_k_c_0_wM33____(:,:,1+1,1+0) = da_db_k_c_0_wM__;
dtau_dtau_k_c_0_wM33____(:,:,1+1,1+1) = db_db_k_c_0_wM__;
dtau_dtau_k_c_0_wM33____(:,:,1+1,1+2) = dc_db_k_c_0_wM__;
dtau_dtau_k_c_0_wM33____(:,:,1+2,1+0) = da_dc_k_c_0_wM__;
dtau_dtau_k_c_0_wM33____(:,:,1+2,1+1) = db_dc_k_c_0_wM__;
dtau_dtau_k_c_0_wM33____(:,:,1+2,1+2) = dc_dc_k_c_0_wM__;
dtau_dtau_k_c_1_wM33____(:,:,1+0,1+0) = da_da_k_c_1_wM__;
dtau_dtau_k_c_1_wM33____(:,:,1+0,1+1) = db_da_k_c_1_wM__;
dtau_dtau_k_c_1_wM33____(:,:,1+0,1+2) = dc_da_k_c_1_wM__;
dtau_dtau_k_c_1_wM33____(:,:,1+1,1+0) = da_db_k_c_1_wM__;
dtau_dtau_k_c_1_wM33____(:,:,1+1,1+1) = db_db_k_c_1_wM__;
dtau_dtau_k_c_1_wM33____(:,:,1+1,1+2) = dc_db_k_c_1_wM__;
dtau_dtau_k_c_1_wM33____(:,:,1+2,1+0) = da_dc_k_c_1_wM__;
dtau_dtau_k_c_1_wM33____(:,:,1+2,1+1) = db_dc_k_c_1_wM__;
dtau_dtau_k_c_1_wM33____(:,:,1+2,1+2) = dc_dc_k_c_1_wM__;
dtau_dtau_k_c_2_wM33____(:,:,1+0,1+0) = da_da_k_c_2_wM__;
dtau_dtau_k_c_2_wM33____(:,:,1+0,1+1) = db_da_k_c_2_wM__;
dtau_dtau_k_c_2_wM33____(:,:,1+0,1+2) = dc_da_k_c_2_wM__;
dtau_dtau_k_c_2_wM33____(:,:,1+1,1+0) = da_db_k_c_2_wM__;
dtau_dtau_k_c_2_wM33____(:,:,1+1,1+1) = db_db_k_c_2_wM__;
dtau_dtau_k_c_2_wM33____(:,:,1+1,1+2) = dc_db_k_c_2_wM__;
dtau_dtau_k_c_2_wM33____(:,:,1+2,1+0) = da_dc_k_c_2_wM__;
dtau_dtau_k_c_2_wM33____(:,:,1+2,1+1) = db_dc_k_c_2_wM__;
dtau_dtau_k_c_2_wM33____(:,:,1+2,1+2) = dc_dc_k_c_2_wM__;
%%;
dtau_dtau_k_p_r01_wM33____(:,:,1+0,1+0) = da_da_k_p_r01_wM__;
dtau_dtau_k_p_r01_wM33____(:,:,1+0,1+1) = db_da_k_p_r01_wM__;
dtau_dtau_k_p_r01_wM33____(:,:,1+0,1+2) = dc_da_k_p_r01_wM__;
dtau_dtau_k_p_r01_wM33____(:,:,1+1,1+0) = da_db_k_p_r01_wM__;
dtau_dtau_k_p_r01_wM33____(:,:,1+1,1+1) = db_db_k_p_r01_wM__;
dtau_dtau_k_p_r01_wM33____(:,:,1+1,1+2) = dc_db_k_p_r01_wM__;
dtau_dtau_k_p_r01_wM33____(:,:,1+2,1+0) = da_dc_k_p_r01_wM__;
dtau_dtau_k_p_r01_wM33____(:,:,1+2,1+1) = db_dc_k_p_r01_wM__;
dtau_dtau_k_p_r01_wM33____(:,:,1+2,1+2) = dc_dc_k_p_r01_wM__;
%%;
dtau_dtau_k_p_polar_a_wM33____(:,:,1+0,1+0) = da_da_k_p_polar_a_wM__;
dtau_dtau_k_p_polar_a_wM33____(:,:,1+0,1+1) = db_da_k_p_polar_a_wM__;
dtau_dtau_k_p_polar_a_wM33____(:,:,1+0,1+2) = dc_da_k_p_polar_a_wM__;
dtau_dtau_k_p_polar_a_wM33____(:,:,1+1,1+0) = da_db_k_p_polar_a_wM__;
dtau_dtau_k_p_polar_a_wM33____(:,:,1+1,1+1) = db_db_k_p_polar_a_wM__;
dtau_dtau_k_p_polar_a_wM33____(:,:,1+1,1+2) = dc_db_k_p_polar_a_wM__;
dtau_dtau_k_p_polar_a_wM33____(:,:,1+2,1+0) = da_dc_k_p_polar_a_wM__;
dtau_dtau_k_p_polar_a_wM33____(:,:,1+2,1+1) = db_dc_k_p_polar_a_wM__;
dtau_dtau_k_p_polar_a_wM33____(:,:,1+2,1+2) = dc_dc_k_p_polar_a_wM__;
dtau_dtau_k_p_azimu_b_wM33____(:,:,1+0,1+0) = da_da_k_p_azimu_b_wM__;
dtau_dtau_k_p_azimu_b_wM33____(:,:,1+0,1+1) = db_da_k_p_azimu_b_wM__;
dtau_dtau_k_p_azimu_b_wM33____(:,:,1+0,1+2) = dc_da_k_p_azimu_b_wM__;
dtau_dtau_k_p_azimu_b_wM33____(:,:,1+1,1+0) = da_db_k_p_azimu_b_wM__;
dtau_dtau_k_p_azimu_b_wM33____(:,:,1+1,1+1) = db_db_k_p_azimu_b_wM__;
dtau_dtau_k_p_azimu_b_wM33____(:,:,1+1,1+2) = dc_db_k_p_azimu_b_wM__;
dtau_dtau_k_p_azimu_b_wM33____(:,:,1+2,1+0) = da_dc_k_p_azimu_b_wM__;
dtau_dtau_k_p_azimu_b_wM33____(:,:,1+2,1+1) = db_dc_k_p_azimu_b_wM__;
dtau_dtau_k_p_azimu_b_wM33____(:,:,1+2,1+2) = dc_dc_k_p_azimu_b_wM__;
%%%%;
end;%if flag_d2;
%%%%%%%%;

if (flag_verbose>0); disp(sprintf(' %% [finished %s]',str_thisfunction)); end;

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%;

function disp_error(flag_verbose,str_0_,d_0_,str_1_,d_1_);
if (flag_verbose>0);
f_numerator = fnorm(d_0_-d_1_);
f_denomator = min(fnorm(d_0_),fnorm(d_1_));
r_error = f_numerator/max(1e-12,f_denomator);
n_header = 64;
str_prefix = sprintf(' %% %s vs %s: ',str_0_,str_1_);
str_header = strcat(str_prefix,' '*ones(1,n_header-numel(str_prefix)));
disp(sprintf('%snumerator %16.8f denomator %16.8f (r_error %16.8f)',str_header,f_numerator,f_denomator,r_error));
end;%if (flag_verbose>0);
