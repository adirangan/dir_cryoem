function ...
[ ...
 parameter ...
,d_mmlb____ ...
,d_mmzb____ ...
,X_best ...
,flag_flip ...
,polar_a_best ...
,azimu_b_best ...
,gamma_z_best ...
,delta_best_ ...
,b_k_Y_best_ ...
,viewing_euler_polar_a_pos_ ...
,viewing_euler_azimu_b_pos_ ...
,viewing_euler_gamma_z_pos_ ...
] = ...
register_spharm_to_spharm_3_stripped_wrap_0( ...
 parameter ...
,n_k_p_r ...
,k_p_r_ ...
,k_p_r_max ...
,weight_3d_k_p_r_ ...
,N_wavelength ...
,l_max_ ...
,n_UZ_rank ...
,U_lz__ ...
,d_mmlb____ ...
,d_mmzb____ ...
,a_k_Y_ ...
,b_k_Y_ ...
,viewing_euler_polar_a_pre_ ...
,viewing_euler_azimu_b_pre_ ...
,viewing_euler_gamma_z_pre_ ...
);

str_thisfunction = 'register_spharm_to_spharm_3_stripped_wrap_0';

na=0;
if (nargin<1+na); parameter=[]; end; na=na+1;
if (nargin<1+na); n_k_p_r=[]; end; na=na+1;
if (nargin<1+na); k_p_r_=[]; end; na=na+1;
if (nargin<1+na); k_p_r_max=[]; end; na=na+1;
if (nargin<1+na); weight_3d_k_p_r_=[]; end; na=na+1;
if (nargin<1+na); N_wavelength=[]; end; na=na+1;
if (nargin<1+na); l_max_=[]; end; na=na+1;
if (nargin<1+na); n_UZ_rank=[]; end; na=na+1;
if (nargin<1+na); U_lz__=[]; end; na=na+1;
if (nargin<1+na); d_mmlb____=[]; end; na=na+1;
if (nargin<1+na); d_mmzb____=[]; end; na=na+1;
if (nargin<1+na); a_k_Y_=[]; end; na=na+1;
if (nargin<1+na); b_k_Y_=[]; end; na=na+1;
if (nargin<1+na); viewing_euler_polar_a_pre_=[]; end; na=na+1;
if (nargin<1+na); viewing_euler_azimu_b_pre_=[]; end; na=na+1;
if (nargin<1+na); viewing_euler_gamma_z_pre_=[]; end; na=na+1;

if isempty(parameter); parameter = struct('type','parameter'); end;
if ~isfield(parameter,'flag_verbose'); parameter.flag_verbose = 0; end;
flag_verbose = parameter.flag_verbose;

if isempty(N_wavelength); N_wavelength = 0; end;
if N_wavelength~=0; disp(sprintf(' %% Warning, N_wavelength~=0 in %s, returning',str_thisfunction)); return; end;

if (flag_verbose); disp(sprintf(' %% [entering %s]',str_thisfunction)); end;

l_max_max = max(l_max_);
n_l_max = 1+l_max_max;
n_m_max = 1+2*l_max_max;
n_polar_a = n_m_max; polar_a_ = transpose(linspace(-1*pi,+1*pi,n_polar_a+1)); polar_a_ = polar_a_(1:end-1);
n_azimu_b = n_m_max; azimu_b_ = transpose(linspace( 0*pi,+2*pi,n_azimu_b+1)); azimu_b_ = azimu_b_(1:end-1);
n_gamma_z = n_m_max; gamma_z_ = transpose(linspace( 0*pi,+2*pi,n_gamma_z+1)); gamma_z_ = gamma_z_(1:end-1);
if isempty(n_UZ_rank); n_UZ_rank = 0; end;
if isempty(U_lz__); U_lz__ = zeros(n_l_max,n_UZ_rank); end;
if isempty(d_mmlb____);
t_0in = tic;
d_mmlb____ = zeros(n_m_max,n_m_max,n_l_max,n_polar_a);
d_mmzb____ = zeros(n_m_max,n_m_max,n_UZ_rank,n_polar_a);
for npolar_a=0:n_polar_a-1;
if (flag_verbose); if (mod(npolar_a,16)==0); disp(sprintf(' %% npolar_a %d/%d',npolar_a,n_polar_a)); end; end;
polar_a = polar_a_(1+npolar_a);
W_ = wignerd_b(l_max_max,-polar_a);
n_W_ = zeros(1,1+l_max_max); for (l_val=0:l_max_max); n_W_(1+l_val) = numel(W_{1+l_val}); end;
d_mml___ = zeros(n_m_max,n_m_max,1+l_max_max);
for l_val=0:l_max_max;
d_mml___(1+l_max_max + [-l_val:+l_val],1+l_max_max + [-l_val:+l_val],1+l_val) = W_{1+l_val};
end;%for l_val=0:l_max_max;
d_mmz___ = reshape(reshape(d_mml___,[n_m_max*n_m_max,n_l_max])*UZ__,[n_m_max,n_m_max,n_UZ_rank]);
d_mmlb____(:,:,:,1+npolar_a) = d_mml___;
d_mmzb____(:,:,:,1+npolar_a) = d_mmz___;
end;%for npolar_a=0:n_polar_a-1;
t_out = toc(t_0in); if (flag_verbose); disp(sprintf(' %% calculate d_: t %0.6f',t_out)); end;
end;%if isempty(d_mmlb____);

t_0in = tic;
a_k_Y_yk_ = spharm_normalize_2(n_k_p_r,k_p_r_,weight_3d_k_p_r_,l_max_,a_k_Y_);
a_k_Y_mlk___ = convert_spharm_to_spharm___0(n_k_p_r,l_max_,a_k_Y_yk_);
a_k_Y_mkl___ = permute(a_k_Y_mlk___,[1,3,2]);
b_k_Y_orig_yk_ = spharm_normalize_2(n_k_p_r,k_p_r_,weight_3d_k_p_r_,l_max_,b_k_Y_);
b_k_Y_orig_mlk___ = convert_spharm_to_spharm___0(n_k_p_r,l_max_,b_k_Y_orig_yk_);
b_k_Y_orig_mkl___ = permute(b_k_Y_orig_mlk___,[1,3,2]);
b_k_Y_flip_yk_ = spharm_normalize_2(n_k_p_r,k_p_r_,weight_3d_k_p_r_,l_max_,flipY(n_k_p_r,l_max_,b_k_Y_));
b_k_Y_flip_mlk___ = convert_spharm_to_spharm___0(n_k_p_r,l_max_,b_k_Y_flip_yk_);
b_k_Y_flip_mkl___ = permute(b_k_Y_flip_mlk___,[1,3,2]);
t_out = toc(t_0in); if (flag_verbose); disp(sprintf(' %% prepare arrays: t %0.6f',t_out)); end;

%%%%%%%%;
t_0in = tic;
if (n_UZ_rank<=0);
[ ...
 X_orig_mmb___ ...
] = ...
register_spharm_to_spharm_single_beta_3_stripped_0( ...
 max(0,flag_verbose-1) ...
,n_m_max ...
,n_k_p_r ...
,n_l_max ...
,weight_3d_k_p_r_ ...
,a_k_Y_mkl___ ...
,b_k_Y_orig_mkl___ ...
,[] ...
,[] ...
,n_polar_a ...
,d_mmlb____ ...
);
end;%if (n_UZ_rank<=0);
if (n_UZ_rank> 0);
[ ...
 X_orig_mmb___ ...
] = ...
register_spharm_to_spharm_single_beta_3_stripped_0( ...
 max(0,flag_verbose-1) ...
,n_m_max ...
,n_UZ_rank ...
,n_l_max ...
,[] ...
,a_k_Y_mkl___ ...
,b_k_Y_orig_mkl___ ...
,n_UZ_rank ...
,U_lz__ ...
,n_polar_a ...
,d_mmzb____ ...
);
end;%if (n_UZ_rank> 0);
[X_best_orig,ij_X_orig] = max(X_orig_mmb___(:)); [ij_azimu_b_orig,ij_gamma_z_orig,ij_polar_a_orig] = ind2sub([n_m_max,n_m_max,n_polar_a],ij_X_orig);
polar_a_orig = polar_a_(ij_polar_a_orig);
azimu_b_orig = azimu_b_(ij_azimu_b_orig);
gamma_z_orig = gamma_z_(ij_gamma_z_orig);
t_out = toc(t_0in); if (flag_verbose); disp(sprintf(' %% calculate X_: t %0.6f',t_out)); end;
%%%%%%%%;
t_0in = tic;
if (n_UZ_rank<=0);
[ ...
 X_flip_mmb___ ...
] = ...
register_spharm_to_spharm_single_beta_3_stripped_0( ...
 max(0,flag_verbose-1) ...
,n_m_max ...
,n_k_p_r ...
,n_l_max ...
,weight_3d_k_p_r_ ...
,a_k_Y_mkl___ ...
,b_k_Y_flip_mkl___ ...
,[] ...
,[] ...
,n_polar_a ...
,d_mmlb____ ...
);
end;%if (n_UZ_rank<=0);
if (n_UZ_rank> 0);
[ ...
 X_flip_mmb___ ...
] = ...
register_spharm_to_spharm_single_beta_3_stripped_0( ...
 max(0,flag_verbose-1) ...
,n_m_max ...
,n_UZ_rank ...
,n_l_max ...
,[] ...
,a_k_Y_mkl___ ...
,b_k_Y_flip_mkl___ ...
,n_UZ_rank ...
,U_lz__ ...
,n_polar_a ...
,d_mmzb____ ...
);
end;%if (n_UZ_rank> 0);
[X_best_flip,ij_X_flip] = max(X_flip_mmb___(:)); [ij_azimu_b_flip,ij_gamma_z_flip,ij_polar_a_flip] = ind2sub([n_m_max,n_m_max,n_polar_a],ij_X_flip);
polar_a_flip = polar_a_(ij_polar_a_flip);
azimu_b_flip = azimu_b_(ij_azimu_b_flip);
gamma_z_flip = gamma_z_(ij_gamma_z_flip);
t_out = toc(t_0in); if (flag_verbose); disp(sprintf(' %% calculate X_: t %0.6f',t_out)); end;
%%%%%%%%;
if (X_best_orig>=X_best_flip);
flag_flip = 0;
X_best = X_best_orig;
polar_a_best = polar_a_orig;
azimu_b_best = azimu_b_orig;
gamma_z_best = gamma_z_orig;
end;%if (X_orig>=X_flip);
%%%%%%%%;
if (X_best_orig< X_best_flip);
flag_flip = 1;
X_best = X_best_flip;
polar_a_best = polar_a_flip;
azimu_b_best = azimu_b_flip;
gamma_z_best = gamma_z_flip;
end;%if (X_orig>=X_flip);
%%%%%%%%;
[ ... 
 b_k_Y_best_ ...
] = ...
spharm_register_and_rotate_2( ...
 n_k_p_r ...
,k_p_r_ ...
,k_p_r_max ...
,weight_3d_k_p_r_ ...
,l_max_ ...
,[] ...
,b_k_Y_orig_yk_ ...
,N_wavelength ...
,X_best ...
,flag_flip ...
,polar_a_best ...
,azimu_b_best ...
,gamma_z_best ...
);
%%%%%%%%;
delta_best_ = zeros(3,1);
%%%%%%%%;
viewing_euler_polar_a_pos_ = viewing_euler_polar_a_pre_;
viewing_euler_azimu_b_pos_ = viewing_euler_azimu_b_pre_;
viewing_euler_gamma_z_pos_ = viewing_euler_gamma_z_pre_;
if ( ~isempty( viewing_euler_polar_a_pre_ ) & ~isempty( viewing_euler_azimu_b_pre_ ) & ~isempty( viewing_euler_gamma_z_pre_ ) );
if flag_flip;
[ ...
 viewing_euler_gamma_z_pos_ ...
] = ...
rotate_viewing_angles_from_invert_spharm_0( ...
 max(0,flag_verbose-1) ...
,viewing_euler_gamma_z_pos_ ...
);
end;%if flag_flip;
[ ...
 ~ ...
,viewing_euler_polar_a_pos_ ...
,viewing_euler_azimu_b_pos_ ...
,viewing_euler_gamma_z_pos_ ...
] = ...
rotate_viewing_angles_from_rotate_spharm_to_spharm_0( ...
 max(0,flag_verbose-1) ...
,polar_a_best ...
,azimu_b_best ...
,gamma_z_best ...
,viewing_euler_polar_a_pos_ ...
,viewing_euler_azimu_b_pos_ ...
,viewing_euler_gamma_z_pos_ ...
);
end;%if ( ~isempty( viewing_euler_polar_a_pre_ ) & ~isempty( viewing_euler_azimu_b_pre_ ) & ~isempty( viewing_euler_gamma_z_pre_ ) );
%%%%%%%%;

if (flag_verbose); disp(sprintf(' %% [finished %s]',str_thisfunction)); end;
