function ...
[ ...
 a_k_Y_norm_ ...
,a_avg ...
,a_std ...
,u_k_Y_ ...
] = ...
spharm_normalize_1( ...
 n_k_p_r ...
,k_p_r_ ...
,weight_3d_k_p_r_ ...
,l_max_ ...
,a_k_Y_ ...
);
% Normalizes the spherical-harmonic expansion to have norm 1, but does not center. ;
n_y_ = (l_max_+1).^2;
n_y_sum = sum(n_y_);
n_y_csum_ = cumsum([0;n_y_]);
l_max_max = max(l_max_);
m_max_ = -l_max_max : +l_max_max;
n_m_max = numel(m_max_);
weight_Y_val_ = zeros(n_y_sum,1);
e_k_Y_ = zeros(n_y_sum,1);
na=0;
for nk_p_r=0:n_k_p_r-1;
n_y = n_y_(1+nk_p_r);
tmp_index_ = na + [0:n_y-1];
weight_Y_val_(1+tmp_index_) = weight_3d_k_p_r_(1+nk_p_r);
e_k_Y_(1+na) = 1;
na=na+n_y;
end;%for nk_p_r=0:n_k_p_r-1;
e_avg = ctranspose(e_k_Y_)*(weight_Y_val_.*e_k_Y_);
u_k_Y_ = e_k_Y_./max(1e-12,sqrt(e_avg));
a_avg = ctranspose(u_k_Y_)*(weight_Y_val_.*a_k_Y_);
a_k_Y_norm_ = (a_k_Y_ - 0.0d0*a_avg*u_k_Y_); %<-- do not center. ;
a_std = sqrt(ctranspose(a_k_Y_norm_)*(weight_Y_val_.*a_k_Y_norm_));
a_k_Y_norm_ = a_k_Y_norm_./max(1e-12,a_std);
