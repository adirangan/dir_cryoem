function ...
a_k_Y_0qbp_yn_ ...
= ...
get_loading_qbp_Ai( ...
 n_k_p_r ...
,n_w_ ...
,n_M ...
,P_k_p_wnM__ ...
,CTF_wMn__ ...
,CTF2_qn__ ...
,quad_from_data_qwM__ ...
,Ylm_w_yq__ ...
);

n_w = max(n_w_); assert(min(n_w_)==n_w);
n_lm_sum = n_k_p_r*size(Ylm_w_yq__,1);
a_k_Y_0qbp_yn_ = zeros(n_lm_sum,1);
P_wMn___ = permute(reshape(P_k_p_wnM__,[n_w,n_k_p_r,n_M]),[1,3,2]);
P_CTF_wMn___ = bsxfun(@times,P_wMn___,reshape(CTF_wMn__,[n_w,n_M,n_k_p_r]));
quad_from_data_P_CTF_normalized_qn__ = (quad_from_data_qwM__*reshape(P_CTF_wMn___,[n_w*n_M,n_k_p_r]))./max(1e-12,CTF2_qn__);
a_k_Y_0qbp_yn_ = reshape(conj(Ylm_w_yq__)*quad_from_data_P_CTF_normalized_qn__,[n_lm_sum,1]);
