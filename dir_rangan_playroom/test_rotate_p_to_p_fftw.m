flag_verbose=1; flag_disp=0;nf=0;
disp(sprintf(' %% testing rotate_p_to_p_fftw'));
k_p_r_max = 48/(2*pi); k_eq_d = 1.0/(2*pi); str_L = 'L';
[ ...
 n_k_p_r ...
,k_p_r_ ...
,weight_3d_k_p_r_ ...
] = ...
get_weight_3d_1( ...
 0*flag_verbose ...
,k_p_r_max ...
,k_eq_d ...
,str_L ...
);
%%%%;
n_w_int = 1;
l_max_upb = round(2*pi*k_p_r_max);
l_max_max = min(l_max_upb,1+ceil(2*pi*k_p_r_(end)));
n_w_max = n_w_int*2*(l_max_max+1); n_w_0in_ = n_w_max*ones(n_k_p_r,1);
[ ...
 n_w_ ...
,weight_2d_k_p_r_ ...
,weight_2d_k_p_wk_ ...
,k_p_r_wk_ ...
,k_p_w_wk_ ...
,k_c_0_wk_ ...
,k_c_1_wk_ ...
] = ...
get_weight_2d_2( ...
 0*flag_verbose ...
,n_k_p_r ...
,k_p_r_ ...
,k_p_r_max ...
,-1 ...
,n_w_0in_ ...
,weight_3d_k_p_r_ ...
);
n_w_sum = sum(n_w_); n_w_csum_ = cumsum([0;n_w_]);
%%%%;
n_M = 4; n_2 = 2;
delta_2M__ = reshape(linspace(-0.05,+0.05,n_2*n_M),[n_2,n_M]);
M_k_p_wkM__ = zeros(n_w_sum,n_M);
for nM=0:n_M-1;
delta_0 = delta_2M__(1+0,1+nM); delta_1 = delta_2M__(1+1,1+nM);
M_k_p_wkM__(:,1+nM) = exp(+i*2*pi*(k_c_0_wk_*delta_0 + k_c_1_wk_*delta_1));
end;%for nM=0:n_M-1;
%%%%;
gamma_z_M_ = transpose(linspace(0,pi,n_M));
delta_x_M_ = transpose(linspace(-0.1,+0.1,n_M));
delta_y_M_ = transpose(linspace(-0.2,+0.2,n_M));
T0_k_p_wkM__ = zeros(n_w_sum,n_M);
T0_k_p_wkM__ = reshape(transf_p_to_p(n_k_p_r,k_p_r_,n_w_,n_w_sum,rotate_p_to_p_fftw(n_k_p_r,n_w_,n_w_sum,M_k_p_wkM__,gamma_z_M_),-delta_x_M_,-delta_y_M_),[n_w_sum,n_M]);
T0_k_q_wkM__ = reshape(interp_p_to_q(n_k_p_r,n_w_,n_w_sum,T0_k_p_wkM__),[n_w_sum,n_M]);
%%%%;

% compare to ../dir_rangan_python/dir_ascii/.ascii. ;
%%%%;
dir_ascii = '../dir_rangan_python/dir_ascii';
n_d = 2;
for nd=0:n_d-1;
na=0;
if nd==na; tmp_str_ascii = 'T_k_p_wkM__'; tmp_local = T0_k_p_wkM__; tab_p=1; end; na=na+1;
if nd==na; tmp_str_ascii = 'T_k_q_wkM__'; tmp_local = T0_k_q_wkM__; tab_p=1; end; na=na+1;
fname_ascii = sprintf('%s/%s.ascii',dir_ascii,tmp_str_ascii);
if ~exist(fname_ascii,'file'); disp(sprintf(' %% Warning, %s not found',fname_ascii)); end;
if  exist(fname_ascii,'file');
if (flag_verbose>1); disp(sprintf(' %% %s found, loading',fname_ascii)); end;
fid = fopen(fname_ascii,'r');
if tab_p==0; tmp_ascii = reshape(cell2mat(textscan(fid,'%f')),size(tmp_local)); end;
if tab_p==1; tmp_ascii = reshape(cell2mat(textscan(fid,'(%f)')),size(tmp_local)); end;
fclose(fid);
fnorm_disp(flag_verbose,tmp_str_ascii,tmp_local,'ascii',tmp_ascii,' %% <-- should be <1e-6');
na=0;
if nd==na; T1_k_p_wkM__ = reshape(tmp_ascii,size(T0_k_p_wkM__)); end; na=na+1;
if nd==na; T1_k_q_wkM__ = reshape(tmp_ascii,size(T0_k_q_wkM__)); end; na=na+1;
end;%if  exist(fname_ascii,'file');
end;%for nd=0:n_d-1;
%%%%;


