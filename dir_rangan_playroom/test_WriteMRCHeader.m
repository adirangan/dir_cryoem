test_principled_marching_rib80sc_2;
%%%%%%%%;
fname_image_mda = sprintf('%s/images_mda',dir_data);
M_x_c___ = MDA_read_r8(fname_image_mda);
n_image_sub = min(n_image_sub,size(M_x_c___,3));
M_x_c___ = M_x_c___(:,:,1:n_image_sub);
%%%%%%%%;
fname_mscope_params = sprintf('%s/mscope_params',dir_data);
mscope_params = textread(fname_mscope_params);
Voltage = mscope_params(1);
SphericalAberration = mscope_params(2);
PixelSize = mscope_params(3);
%%%%%%%%;
fp = WriteMRCHeader(M_x_c___,PixelSize,'test_pm_rib80sc_2.mrcs'); fwrite(fp,M_x_c___,'float32'); fclose(fp);
%%%%%%%%;
tmp_mrcs_list_ = cell(n_image_sub,1);
tmp_Voltage_list_ = cell(n_image_sub,1);
tmp_SphericalAberration_list_ = cell(n_image_sub,1);
tmp_PixelSize_list_ = cell(n_image_sub,1);
for nimage_sub=0:n_image_sub-1;
tmp_mrcs_list_{1+nimage_sub} = sprintf("%d@test_pm_rib80sc_2.mrcs",1+nimage_sub);
tmp_PixelSize_list_{1+nimage_sub} = sprintf("%0.16f",PixelSize);
tmp_Voltage_list_{1+nimage_sub} = sprintf("%0.16f",Voltage);
tmp_SphericalAberration_list_{1+nimage_sub} = sprintf("%0.16f",SphericalAberration);
end;%for nimage_sub=0:n_image_sub-1;
tmp_s = struct('rlnImageName',{tmp_mrcs_list_},'rlnPixelSize',{tmp_PixelSize_list_},'rlnVoltage',{tmp_Voltage_list_},'rlnSphericalAberration',{tmp_SphericalAberration_list_});
%%%%%%%%;
WriteStarFileStruct(tmp_s,"images","test_pm_rib80sc_2.star");
system('scp -p test_pm_rib80sc_2.* rangan@access1.cims.nyu.edu:/data/rangan/dir_cryoem/dir_relion;');
