%{
mv tpmutameux_2d_xcor_d0196_ut0120le5v064_M_k_p___n1024r001.mat tpmutameux_2d_xcor_d0196_bkp_ut0120le5v064_M_k_p___n1024r001.mat ;
mv tpmutameux_2d_xcor_d0196_ut0120le5v064_n1024_MS_nUX000rng000.mat tpmutameux_2d_xcor_d0196_bkp_ut0120le5v064_n1024_MS_nUX000rng000.mat ;
mv tpmutameux_2d_xcor_d0196_ut0120le5v064_n1024_SM_nUX000rng000.mat tpmutameux_2d_xcor_d0196_bkp_ut0120le5v064_n1024_SM_nUX000rng000.mat ;
mv tpmutameux_2d_xcor_d0196_ut0120le5v064_n1024_MS_nUX000rng001.mat tpmutameux_2d_xcor_d0196_bkp_ut0120le5v064_n1024_MS_nUX000rng001.mat ;
mv tpmutameux_2d_xcor_d0196_ut0120le5v064_n1024_SM_nUX000rng001.mat tpmutameux_2d_xcor_d0196_bkp_ut0120le5v064_n1024_SM_nUX000rng001.mat ;
mv tpmutameux_2d_xcor_d0196_ut0120le5v064_n1024_MS_nUX000rng002.mat tpmutameux_2d_xcor_d0196_bkp_ut0120le5v064_n1024_MS_nUX000rng002.mat ;
mv tpmutameux_2d_xcor_d0196_ut0120le5v064_n1024_SM_nUX000rng002.mat tpmutameux_2d_xcor_d0196_bkp_ut0120le5v064_n1024_SM_nUX000rng002.mat ;
 %}

str_cost = '2d_xcor_d0196_bkp';
dat_n_iteration = 4;
n_delta_r_max_factor = 1;
dat_n_UX_rank = 1;

%%%%%%%%;
% Now check to see if the translations discovered correlate with the true translations. ;
%%%%%%%%;
for ndelta_r_max_factor=0:n_delta_r_max_factor-1;
delta_r_max_factor = delta_r_max_factor_(1+ndelta_r_max_factor);
delta_r_max_use = delta_r_max_factor * delta_sigma_use*sqrt(log(20^2));
delta_r_max_upb = 2.0 * delta_sigma_use*sqrt(log(20^2));
if (delta_r_max_factor<=0); n_delta_v_requested=1; end;
if (delta_r_max_factor> 0) & (delta_r_max_factor<=1); n_delta_v_requested=64; end;
if (delta_r_max_factor> 1) & (delta_r_max_factor<=2); n_delta_v_requested=128; end;
str_delta = sprintf('ut%.4dle%dv%.3d',floor(1000*delta_r_max_use),round(-log(svd_eps)),n_delta_v_requested);
dat_infix = sprintf('%s_%s',str_cost,str_delta);
tmp_dir_jpg = sprintf('%s_jpg/dir_tpmutameux_%s',dir_trunk,dat_infix);
if (~exist(tmp_dir_jpg,'dir')); disp(sprintf(' %% %s not found, creating',tmp_dir_jpg)); mkdir(tmp_dir_jpg); end;
for ndat_rseed=0:n_dat_rseed-1;
dat_rseed = dat_rseed_(1+ndat_rseed);
for dat_nUX_rank=0:dat_n_UX_rank-1;
fname_fig = sprintf('%s/tpmutameux_%s_nUX%.3drng%.3d_FIGd',tmp_dir_jpg,dat_infix,dat_nUX_rank,dat_rseed);
if (flag_replot | ~exist(sprintf('%s.jpg',fname_fig),'file'));
disp(sprintf(' %% %s not found, creating',fname_fig)); 
fname_0 = sprintf('%s_mat/tpmutameux_%s_n%.3d',dir_trunk,dat_infix,dat_n_M);
fname_2 = sprintf('nUX%.3drng%.3d',dat_nUX_rank,dat_rseed);
MS_fname_pre = sprintf('%s_MS_%s',fname_0,fname_2);
MS_fname_mat = sprintf('%s.mat',MS_fname_pre);
SM_fname_pre = sprintf('%s_SM_%s',fname_0,fname_2);
SM_fname_mat = sprintf('%s.mat',SM_fname_pre);
figure(1);clf;
c_ = colormap_beach(); n_c = size(c_,1); markersize_use = 16;
%%%%%%%%;
subplot(3,4,2);
c2d__ = colormap_gaussian_2d(delta_read_x_,delta_read_y_,delta_sigma,0.35);
hold on;
patch([-1;+1;+1;-1],[-1;-1;+1;+1],'k');
scatter(delta_read_x_(1:n_image_sub),delta_read_y_(1:n_image_sub),markersize_use,c2d__(1:n_image_sub,:),'filled');
hold off;
axisnotick;
axis([-1,+1,-1,+1]); axis square; xlabel('dx'); ylabel('dy'); title('true delta');
%%%%%%%%;
nc = max(0,min(n_c-1,floor(n_c*(ndat_rseed + dat_nUX_rank*n_dat_rseed)/(n_dat_rseed*dat_n_UX_rank))));
%%%%%%%%;
if ( exist(MS_fname_mat,'file'));
tmp_MS_ = load(MS_fname_mat);
subplot(3,4,1);
hold on;
plot((0:dat_n_iteration-1) + 0*dat_n_iteration,tmp_MS_.X_best_MS_,'o-','Color',c_(1+nc,:),'LineWidth',2);
xlim([0,2*dat_n_iteration-1]);
ylim([-0.2,1.0]); grid on;
xlabel('iteration'); ylabel('correlation');
hold off;
for niteration=0:dat_n_iteration-1;
subplot(3,4,3+niteration);
hold on;
patch([-1;+1;+1;-1],[-1;-1;+1;+1],'k');
scatter(tmp_MS_.image_delta_x_MS__(:,1+niteration),tmp_MS_.image_delta_y_MS__(:,1+niteration),markersize_use,c2d__(1:n_image_sub,:),'filled');
hold off;
axisnotick;
tmp_delta_true__ = [delta_read_x_(1:dat_n_M),delta_read_y_(1:dat_n_M)];
tmp_delta_MS00__ = [tmp_MS_.image_delta_x_MS__(:,1+niteration),tmp_MS_.image_delta_y_MS__(:,1+niteration)];
tmp_error_ = sqrt(sum((tmp_delta_true__ - tmp_delta_MS00__).^2,2));
axis([-1,+1,-1,+1]); axis square; xlabel('dx'); ylabel('dy'); title(sprintf('MS %d e %0.4f',niteration,mean(tmp_error_)));
end;%for niteration=0:dat_n_iteration-1;
clear tmp_MS_;
end;%if ( exist(MS_fname_mat,'file'));
%%%%%%%%;
if ( exist(SM_fname_mat,'file'));
tmp_SM_ = load(SM_fname_mat);
subplot(3,4,1);
hold on;
plot((0:dat_n_iteration-1) + 1*dat_n_iteration,tmp_SM_.X_best_SM_,'o-','Color',c_(1+nc,:),'LineWidth',2);
xlim([0,2*dat_n_iteration-1]);
ylim([-0.2,1.0]); grid on;
xlabel('iteration'); ylabel('correlation');
hold off;
for niteration=0:dat_n_iteration-1;
subplot(3,4,3+dat_n_iteration+niteration);
hold on;
patch([-1;+1;+1;-1],[-1;-1;+1;+1],'k');
scatter(tmp_SM_.image_delta_x_SM__(:,1+niteration),tmp_SM_.image_delta_y_SM__(:,1+niteration),markersize_use,c2d__(1:n_image_sub,:),'filled');
hold off;
axisnotick;
tmp_delta_true__ = [delta_read_x_(1:dat_n_M),delta_read_y_(1:dat_n_M)];
tmp_delta_SM00__ = [tmp_SM_.image_delta_x_SM__(:,1+niteration),tmp_SM_.image_delta_y_SM__(:,1+niteration)];
tmp_error_ = sqrt(sum((tmp_delta_true__ - tmp_delta_SM00__).^2,2));
axis([-1,+1,-1,+1]); axis square; xlabel('dx'); ylabel('dy'); title(sprintf('SM %d e %0.4f',niteration,mean(tmp_error_)));
end;%for niteration=0:dat_n_iteration-1;
clear tmp_SM_;
end;%if ( exist(SM_fname_mat,'file'));
%%%%%%%%;
figbig;
disp(sprintf(' %% writing %s',fname_fig));
print('-djpeg',sprintf('%s.jpg',fname_fig));
print('-depsc',sprintf('%s.eps',fname_fig));
close(gcf);
end;%if (~exist(sprintf('%s.jpg',fname_fig),'file')); 
if ( exist(sprintf('%s.jpg',fname_fig),'file'));
disp(sprintf(' %% %s found, not creating',fname_fig));
end;%if ( exist(sprintf('%s.jpg',fname_fig),'file'));
end;%for dat_nUX_rank=0:dat_n_UX_rank-1;
end;%for ndat_rseed=0:n_dat_rseed-1;
end;%for ndelta_r_max_factor=0:n_delta_r_max_factor-1;
%%%%%%%%;
