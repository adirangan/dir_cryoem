%%%%%%%%;
% indices. ;
%%%%%%%%;
n_k_all = ampm_.n_k_all;
n_k_all_csum_ = ampm_.n_k_all_csum_;
k_p_r_all_ = ampm_.k_p_r_all_;
k_p_azimu_b_all_ = ampm_.k_p_azimu_b_all_;
k_p_polar_a_all_ = ampm_.k_p_polar_a_all_;
weight_3d_k_all_ = ampm_.weight_3d_k_all_;
weight_shell_k_ = ampm_.weight_shell_k_;
n_k_p_r = ampm_.n_k_p_r;
k_p_r_ = ampm_.k_p_r_;
weight_3d_k_p_r_ = ampm_.weight_3d_k_p_r_;
l_max_ = ampm_.l_max_;
%%%%%%%%;
n_k_all = ampm_.n_k_all;
weight_3d_k_all_ = ampm_.weight_3d_k_all_;
k_c_0_all_ = ampm_.k_c_0_all_;
k_c_1_all_ = ampm_.k_c_1_all_;
k_c_2_all_ = ampm_.k_c_2_all_;
k_p_r_max = ampm_.k_p_r_max;
n_xxx_u = ampm_.n_xxx_u;
xxx_u_weight_ = ampm_.xxx_u_weight_;
x_u_0___ = ampm_.x_u_0___;
x_u_1___ = ampm_.x_u_1___;
x_u_2___ = ampm_.x_u_2___;
x_p_r_max = ampm_.x_p_r_max;
%%%%%%%%;
n_lm_ = ampm_.n_lm_;
n_lm_max = ampm_.n_lm_max;
n_lm_sum = ampm_.n_lm_sum;
n_lm_csum_ = ampm_.n_lm_csum_;
l_max_max = ampm_.l_max_max;
m_max_ = ampm_.m_max_;
n_m_max = ampm_.n_m_max;
%%%%%%%%;

%%%%%%%%;
% reconstruct a_k_Y_ampm_alig_ by rotating a_k_Y_ampm_. ;
%%%%%%%%;
a_k_Y_ampm_ = ampm_.a_k_Y_ampm_yka__(:,1+na);
[ ... 
 a_k_Y_ampm_alig_ ...
,corr_a_k_Y_quad_vs_a_k_Y_ampm_alig ...
] = ...
spharm_register_and_rotate_2( ...
 ampm_.n_k_p_r ...
,ampm_.k_p_r_ ...
,ampm_.k_p_r_max ...
,ampm_.weight_3d_k_p_r_ ...
,ampm_.l_max_ ...
,ampm_.a_k_Y_quad_ ...
,ampm_.a_k_Y_ampm_yka__(:,1+na) ...
,0 ...
,ampm_.X_best_ampm_ia__(end,1+na) ...
,ampm_.X_best_flag_flip_ampm_ia__(end,1+na) ...
,ampm_.polar_a_best_ampm_ia__(end,1+na) ...
,ampm_.azimu_b_best_ampm_ia__(end,1+na) ...
,ampm_.gamma_z_best_ampm_ia__(end,1+na) ...
,ampm_.delta_best_ampm_dia__(1+0,end,1+na) ...
,ampm_.delta_best_ampm_dia__(1+1,end,1+na) ...
,ampm_.delta_best_ampm_dia__(1+2,end,1+na) ...
);
%%%%%%%%;
tmp_viewing_euler_gamma_z_ = ampm_.euler_gamma_z_ampm_Ma__(:,1+na);
if (ampm_.X_best_flag_flip_ampm_ia__(end,1+na));
[ ...
 tmp_viewing_euler_gamma_z_ ...
] = ...
rotate_viewing_angles_from_invert_spharm_0( ...
 flag_verbose ...
,tmp_viewing_euler_gamma_z_ ...
);
end;%if (ampm_.X_best_flag_flip_ampm_ia__(end,1+na));
%%%%;
[ ...
 ~ ...
,tmp_viewing_euler_polar_a_ ...
,tmp_viewing_euler_azimu_b_ ...
,tmp_viewing_euler_gamma_z_ ...
] = ...
rotate_viewing_angles_from_rotate_spharm_to_spharm_0( ...
 max(0,flag_verbose-1) ...
,ampm_.polar_a_best_ampm_ia__(end,1+na) ...
,ampm_.azimu_b_best_ampm_ia__(end,1+na) ...
,ampm_.gamma_z_best_ampm_ia__(end,1+na) ...
,ampm_.euler_polar_a_ampm_Ma__(:,1+na) ...
,ampm_.euler_azimu_b_ampm_Ma__(:,1+na) ...
,tmp_viewing_euler_gamma_z_ ...
);
%%%%%%%%;

%%%%%%%%;
% convert a_k_Y_ampm_alig_ to a_k_p_ampm_alig_. ;
%%%%%%%%;
if ~exist('Ylm_klma___','var'); Ylm_klma___ = []; end;
tmp_t = tic();
[ ...
 a_k_p_ampm_alig_  ...
,Ylm_klma___ ...
] =  ...
convert_spharm_to_k_p_3( ...
 0*flag_verbose ...
,n_k_all ...
,n_k_all_csum_ ...
,k_p_r_all_ ...
,k_p_azimu_b_all_ ...
,k_p_polar_a_all_ ...
,weight_3d_k_all_ ...
,weight_shell_k_ ...
,n_k_p_r ...
,k_p_r_ ...
,weight_3d_k_p_r_ ...
,l_max_ ...
,a_k_Y_ampm_alig_ ...
,Ylm_klma___ ...
);
tmp_t = toc(tmp_t); disp(sprintf(' %% convert_spharm_to_k_p_3: %0.6fs',tmp_t));
%%%%%%%%;
% Then to a_x_u_ampm_alig_. ;
%%%%%%%%;
tmp_t = tic(); 
[ ...
 a_x_u_ampm_alig_ ...
] = ...
convert_k_p_to_x_c_1( ...
 0*flag_verbose ...
,n_k_all ...
,weight_3d_k_all_ ...
,k_c_0_all_ ...
,k_c_1_all_ ...
,k_c_2_all_ ...
,k_p_r_max ...
,n_xxx_u ...
,xxx_u_weight_ ...
,x_u_0___ ...
,x_u_1___ ...
,x_u_2___ ...
,x_p_r_max ...
,a_k_p_ampm_alig_ ...
);
tmp_t = toc(tmp_t); disp(sprintf(' %% convert_k_p_to_x_c_1: %0.6fs',tmp_t));
%%%%%%%%;

%%%%%%%%;
% Now construct a_x_u_reco_stab_alig_. ;
%%%%%%%%;
a_k_Y_reco_stab_alig_ = ampm_.a_k_Y_reco_stab_alig_;
if ~exist('Ylm_klma___','var'); Ylm_klma___ = []; end;
tmp_t = tic();
[ ...
 a_k_p_reco_stab_alig_  ...
,Ylm_klma___ ...
] =  ...
convert_spharm_to_k_p_3( ...
 0*flag_verbose ...
,n_k_all ...
,n_k_all_csum_ ...
,k_p_r_all_ ...
,k_p_azimu_b_all_ ...
,k_p_polar_a_all_ ...
,weight_3d_k_all_ ...
,weight_shell_k_ ...
,n_k_p_r ...
,k_p_r_ ...
,weight_3d_k_p_r_ ...
,l_max_ ...
,a_k_Y_reco_stab_alig_ ...
,Ylm_klma___ ...
);
tmp_t = toc(tmp_t); disp(sprintf(' %% convert_spharm_to_k_p_3: %0.6fs',tmp_t));
%%%%%%%%;
% Then to a_x_u_reco_stab_alig_. ;
%%%%%%%%;
tmp_t = tic(); 
[ ...
 a_x_u_reco_stab_alig_ ...
] = ...
convert_k_p_to_x_c_1( ...
 0*flag_verbose ...
,n_k_all ...
,weight_3d_k_all_ ...
,k_c_0_all_ ...
,k_c_1_all_ ...
,k_c_2_all_ ...
,k_p_r_max ...
,n_xxx_u ...
,xxx_u_weight_ ...
,x_u_0___ ...
,x_u_1___ ...
,x_u_2___ ...
,x_p_r_max ...
,a_k_p_reco_stab_alig_ ...
);
tmp_t = toc(tmp_t); disp(sprintf(' %% convert_k_p_to_x_c_1: %0.6fs',tmp_t));
%%%%%%%%;

%%%%%%%%;
% Now construct a_x_u_sher_from_quad_unst_alig_. ;
%%%%%%%%;
a_k_Y_sher_from_quad_unst_alig_ = ampm_.sher_from_quad_.a_k_Y_sher_alig_yks__(:,find(ampm_.sher_from_quad_.nls_sher_==25));
if numel(a_k_Y_sher_from_quad_unst_alig_)==n_lm_sum;
if ~exist('Ylm_klma___','var'); Ylm_klma___ = []; end;
tmp_t = tic();
[ ...
 a_k_p_sher_from_quad_unst_alig_  ...
,Ylm_klma___ ...
] =  ...
convert_spharm_to_k_p_3( ...
 0*flag_verbose ...
,n_k_all ...
,n_k_all_csum_ ...
,k_p_r_all_ ...
,k_p_azimu_b_all_ ...
,k_p_polar_a_all_ ...
,weight_3d_k_all_ ...
,weight_shell_k_ ...
,n_k_p_r ...
,k_p_r_ ...
,weight_3d_k_p_r_ ...
,l_max_ ...
,a_k_Y_sher_from_quad_unst_alig_ ...
,Ylm_klma___ ...
);
tmp_t = toc(tmp_t); disp(sprintf(' %% convert_spharm_to_k_p_3: %0.6fs',tmp_t));
%%%%%%%%;
% Then to a_x_u_sher_from_quad_unst_alig_. ;
%%%%%%%%;
tmp_t = tic(); 
[ ...
 a_x_u_sher_from_quad_unst_alig_ ...
] = ...
convert_k_p_to_x_c_1( ...
 0*flag_verbose ...
,n_k_all ...
,weight_3d_k_all_ ...
,k_c_0_all_ ...
,k_c_1_all_ ...
,k_c_2_all_ ...
,k_p_r_max ...
,n_xxx_u ...
,xxx_u_weight_ ...
,x_u_0___ ...
,x_u_1___ ...
,x_u_2___ ...
,x_p_r_max ...
,a_k_p_sher_from_quad_unst_alig_ ...
);
tmp_t = toc(tmp_t); disp(sprintf(' %% convert_k_p_to_x_c_1: %0.6fs',tmp_t));
%%%%%%%%;
end;%if numel(a_k_Y_sher_from_quad_unst_alig_)==n_lm_sum;

%%%%%%%%;
% Now construct a_x_u_sher_from_quad_stab_alig_. ;
%%%%%%%%;
a_k_Y_sher_from_quad_stab_alig_ = ampm_.sher_from_quad_.a_k_Y_sher_stab_yk_;
if numel(a_k_Y_sher_from_quad_stab_alig_)==n_lm_sum;
if ~exist('Ylm_klma___','var'); Ylm_klma___ = []; end;
tmp_t = tic();
[ ...
 a_k_p_sher_from_quad_stab_alig_  ...
,Ylm_klma___ ...
] =  ...
convert_spharm_to_k_p_3( ...
 0*flag_verbose ...
,n_k_all ...
,n_k_all_csum_ ...
,k_p_r_all_ ...
,k_p_azimu_b_all_ ...
,k_p_polar_a_all_ ...
,weight_3d_k_all_ ...
,weight_shell_k_ ...
,n_k_p_r ...
,k_p_r_ ...
,weight_3d_k_p_r_ ...
,l_max_ ...
,a_k_Y_sher_from_quad_stab_alig_ ...
,Ylm_klma___ ...
);
tmp_t = toc(tmp_t); disp(sprintf(' %% convert_spharm_to_k_p_3: %0.6fs',tmp_t));
%%%%%%%%;
% Then to a_x_u_sher_from_quad_stab_alig_. ;
%%%%%%%%;
tmp_t = tic(); 
[ ...
 a_x_u_sher_from_quad_stab_alig_ ...
] = ...
convert_k_p_to_x_c_1( ...
 0*flag_verbose ...
,n_k_all ...
,weight_3d_k_all_ ...
,k_c_0_all_ ...
,k_c_1_all_ ...
,k_c_2_all_ ...
,k_p_r_max ...
,n_xxx_u ...
,xxx_u_weight_ ...
,x_u_0___ ...
,x_u_1___ ...
,x_u_2___ ...
,x_p_r_max ...
,a_k_p_sher_from_quad_stab_alig_ ...
);
tmp_t = toc(tmp_t); disp(sprintf(' %% convert_k_p_to_x_c_1: %0.6fs',tmp_t));
%%%%%%%%;
end;%if numel(a_k_Y_sher_from_quad_stab_alig_)==n_lm_sum;

%%%%%%%%;
% Now construct a_x_u_zero_from_quad_stab_alig_. ;
%%%%%%%%;
a_k_Y_zero_from_quad_stab_alig_ = ampm_.sher_from_quad_.a_k_Y_zero_stab_yk_;
if numel(a_k_Y_zero_from_quad_stab_alig_)==n_lm_sum;
if ~exist('Ylm_klma___','var'); Ylm_klma___ = []; end;
tmp_t = tic();
[ ...
 a_k_p_zero_from_quad_stab_alig_  ...
,Ylm_klma___ ...
] =  ...
convert_spharm_to_k_p_3( ...
 0*flag_verbose ...
,n_k_all ...
,n_k_all_csum_ ...
,k_p_r_all_ ...
,k_p_azimu_b_all_ ...
,k_p_polar_a_all_ ...
,weight_3d_k_all_ ...
,weight_shell_k_ ...
,n_k_p_r ...
,k_p_r_ ...
,weight_3d_k_p_r_ ...
,l_max_ ...
,a_k_Y_zero_from_quad_stab_alig_ ...
,Ylm_klma___ ...
);
tmp_t = toc(tmp_t); disp(sprintf(' %% convert_spharm_to_k_p_3: %0.6fs',tmp_t));
%%%%%%%%;
% Then to a_x_u_zero_from_quad_stab_alig_. ;
%%%%%%%%;
tmp_t = tic(); 
[ ...
 a_x_u_zero_from_quad_stab_alig_ ...
] = ...
convert_k_p_to_x_c_1( ...
 0*flag_verbose ...
,n_k_all ...
,weight_3d_k_all_ ...
,k_c_0_all_ ...
,k_c_1_all_ ...
,k_c_2_all_ ...
,k_p_r_max ...
,n_xxx_u ...
,xxx_u_weight_ ...
,x_u_0___ ...
,x_u_1___ ...
,x_u_2___ ...
,x_p_r_max ...
,a_k_p_zero_from_quad_stab_alig_ ...
);
tmp_t = toc(tmp_t); disp(sprintf(' %% convert_k_p_to_x_c_1: %0.6fs',tmp_t));
%%%%%%%%;
end;%if numel(a_k_Y_zero_from_quad_stab_alig_)==n_lm_sum;

%%%%%%%%;
% Now construct a_x_u_0qbp_from_quad_stab_alig_. ;
%%%%%%%%;
a_k_Y_0qbp_from_quad_stab_alig_ = ampm_.sher_from_quad_.a_k_Y_0qbp_stab_yk_;
if numel(a_k_Y_0qbp_from_quad_stab_alig_)==n_lm_sum;
if ~exist('Ylm_klma___','var'); Ylm_klma___ = []; end;
tmp_t = tic();
[ ...
 a_k_p_0qbp_from_quad_stab_alig_  ...
,Ylm_klma___ ...
] =  ...
convert_spharm_to_k_p_3( ...
 0*flag_verbose ...
,n_k_all ...
,n_k_all_csum_ ...
,k_p_r_all_ ...
,k_p_azimu_b_all_ ...
,k_p_polar_a_all_ ...
,weight_3d_k_all_ ...
,weight_shell_k_ ...
,n_k_p_r ...
,k_p_r_ ...
,weight_3d_k_p_r_ ...
,l_max_ ...
,a_k_Y_0qbp_from_quad_stab_alig_ ...
,Ylm_klma___ ...
);
tmp_t = toc(tmp_t); disp(sprintf(' %% convert_spharm_to_k_p_3: %0.6fs',tmp_t));
%%%%%%%%;
% Then to a_x_u_0qbp_from_quad_stab_alig_. ;
%%%%%%%%;
tmp_t = tic(); 
[ ...
 a_x_u_0qbp_from_quad_stab_alig_ ...
] = ...
convert_k_p_to_x_c_1( ...
 0*flag_verbose ...
,n_k_all ...
,weight_3d_k_all_ ...
,k_c_0_all_ ...
,k_c_1_all_ ...
,k_c_2_all_ ...
,k_p_r_max ...
,n_xxx_u ...
,xxx_u_weight_ ...
,x_u_0___ ...
,x_u_1___ ...
,x_u_2___ ...
,x_p_r_max ...
,a_k_p_0qbp_from_quad_stab_alig_ ...
);
tmp_t = toc(tmp_t); disp(sprintf(' %% convert_k_p_to_x_c_1: %0.6fs',tmp_t));
%%%%%%%%;
end;%if numel(a_k_Y_0qbp_from_quad_stab_alig_)==n_lm_sum;
