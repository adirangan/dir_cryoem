flag_disp=1;nf=0;
%%%%%%%%;
% testing lanczos method ;
% for finding smallest eigenvalue of ;
% symmetric-positive-definite matrix. ;
%%%%%%%%;
n_x = 64;
r_ = transpose([0:n_x-1])/max(1,n_x-1);
eta = 0.75; %<-- width of spectrum. ;
sigma = 0.25;
S_ = (1-eta) + (eta)*exp(-r_.^2 / (2*sigma^2));
S_ = S_ + (1-eta)*(sin(2*pi*r_) + 0.5*sin(4*pi*r_) + 0.25*sin(8*pi*r_));
S_ = sort(S_ - min(S_) + (1-eta),'descend');
[U__,~] = qr(rand(n_x,n_x));
H__ = U__*diag(S_)*transpose(U__);
A = @(x_) H__*x_ ; %<-- matrix function. ;
b_ = zeros(n_x,1);
%%%%;

%%%%%%%%;
% testing lanczos method ;
% for finding extreme eigenvalues of ;
% symmetric-positive-definite matrix. ;
%%%%%%%%;
n_iteration = n_x;
v_xi__ = zeros(n_x,n_iteration);
w_xi__ = zeros(n_x,n_iteration);
alph_i_ = zeros(n_iteration,1);
beta_i_ = zeros(n_iteration,1);
lambda_xi__ = zeros(n_x,n_iteration);
niteration=0;
v0_ = ones(n_x,1)/max(1,sqrt(n_x));
v_xi__(:,1+niteration) = v0_;
w0_ = A(v0_);
alph0 = ctranspose(w0_)*v0_;
w0_ = w0_ - alph0*v0_;
w_xi__(:,1+niteration) = w0_;
alph_i_(1+niteration) = alph0;
for niteration=0:n_iteration-1;
v0_ = v_xi__(:,1+niteration+0);
w0_ = w_xi__(:,1+niteration+0);
beta1 = sqrt(ctranspose(w0_)*w0_);
if beta1> 1e-12; v1_ = w0_/beta1; end;
if beta1<=1e-12; disp(sprintf(' %% Warning, small beta1')); end;
w1_ = A(v1_);
alph1 = ctranspose(w1_)*v1_;
w1_ = w1_ - alph1*v1_ - beta1*v0_;
v_xi__(:,1+niteration+1) = v1_;
w_xi__(:,1+niteration+1) = w1_;
alph_i_(1+niteration+1) = alph1;
beta_i_(1+niteration+1) = beta1;
%%%%;
alph_sub_i_ = alph_i_(1:1+niteration);
beta_sub_i_ = beta_i_(1:1+niteration);
T_sub__ = spdiags([circshift(beta_sub_i_,-1),alph_sub_i_,beta_sub_i_],[-1,0,+1],1+niteration,1+niteration);
lambda_sub_ = eigs(T_sub__,1+niteration);
lambda_xi__(1:1+niteration,1+niteration) = sort(lambda_sub_,'ascend');
%%%%;
end;%for niteration=0:n_iteration-1;
%%%%%%%%;
T__ = spdiags([circshift(beta_i_,-1),alph_i_,beta_i_],[-1,0,+1],1+n_iteration,1+n_iteration);
[UT__,ST__] = eigs(T__,1+n_iteration); ST_ = diag(ST__);
vUT__ = v_xi__*UT__;
UtvUT__ = ctranspose(U__)*vUT__;
%%%%;

%%%%%%%%;
% compare. ;
%%%%%%%%;
if flag_disp;
figure(1+nf);nf=nf+1;clf;figmed;fig81s;
markersize_use = 8;
linewidth_sml = 0.5;
linewidth_big = 2;
p_row = 1; p_col = 5;
%%%%;
subplot(p_row,p_col,[1:3]);
hold on;
plot(repmat([0;n_iteration],[1,n_x]),repmat(reshape(S_,[1,n_x]),[2,1]),'-','Color',0.85*[1,1,1],'LineWidth',linewidth_sml);
ni_xi__ = repmat([1:n_iteration],[n_x,1]);
tmp_index_ = efind(lambda_xi__>0);
plot(ni_xi__(1+tmp_index_),lambda_xi__(1+tmp_index_),'r.','MarkerSize',markersize_use);
xlabel('iteration'); ylabel('sigma');
xlim([0,1+n_iteration]);
ylim([min(S_)-0.25,max(S_)+0.25]);
%%%%;
subplot(p_row,p_col,[4:5]);
imagesc(abs(UtvUT__)); axis image; axisnotick;
xlabel('iteration'); ylabel('loading');
title('abs(UtvUT__): lanczos','Interpreter','none'); colorbar;
%%%%%%%%;
end;%if flag_disp;
