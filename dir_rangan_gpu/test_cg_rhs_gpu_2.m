str_thisfunction = 'test_cg_rhs_gpu_2';

platform = 'rusty';
if (exist('platform.type','file')); fp=fopen('platform.type'); platform = fscanf(fp,'%s'); fclose(fp); end;
if (strcmp(platform,'access1')); setup_access1; string_root = 'data'; end;
if (strcmp(platform,'OptiPlex')); setup_OptiPlex; string_root = 'home'; end;
if (strcmp(platform,'eval1')); setup_eval1; string_root = 'home'; end;
if (strcmp(platform,'rusty')); setup_rusty; string_root = 'mnt/home'; end;

flag_verbose = 1; %<-- verbosity level. ;
flag_disp=1; nf=0; %<-- display level. ;

dir_base = sprintf('/%s/rangan/dir_cryoem/dir_rangan_gpu',string_root);
dir_jpg = sprintf('%s/dir_jpg',dir_base);
if (~exist(dir_jpg,'dir')); disp(sprintf(' %% mkdir %s',dir_jpg)); mkdir(dir_jpg); end;

n_M = 512;
rng(0);
n_w = 1024;
viewing_polar_a_M_ = 1*pi*rand(n_M,1);
viewing_azimu_b_M_ = 2*pi*rand(n_M,1);
viewing_gamma_z_M_ = 2*pi*rand(n_M,1);
%%%%%%%%;
tmp_t = tic();
[ ...
 k_p_polar_a_cpu_x_wM__ ...
,k_p_azimu_b_cpu_x_wM__ ...
,k_c_0_cpu_x_wM__ ...
,k_c_1_cpu_x_wM__ ...
,k_c_2_cpu_x_wM__ ...
,k_p_r01_cpu_x_wM__ ...
,dtau_k_p_polar_a_cpu_wM3___ ...
,dtau_k_p_azimu_b_cpu_wM3___ ...
,dtau_k_c_0_cpu_wM3___ ...
,dtau_k_c_1_cpu_wM3___ ...
,dtau_k_c_2_cpu_wM3___ ...
,dtau_k_p_r01_cpu_wM3___ ...
,dtau_dtau_k_p_polar_a_cpu_wM33____ ...
,dtau_dtau_k_p_azimu_b_cpu_wM33____ ...
,dtau_dtau_k_c_0_cpu_wM33____ ...
,dtau_dtau_k_c_1_cpu_wM33____ ...
,dtau_dtau_k_c_2_cpu_wM33____ ...
,dtau_dtau_k_p_r01_cpu_wM33____ ...
] = ...
cg_rhs_2( ...
 n_M ...
,n_w ...
,viewing_polar_a_M_ ...
,viewing_azimu_b_M_ ...
,viewing_gamma_z_M_ ...
);
tmp_t = toc(tmp_t); if (flag_verbose>0); disp(sprintf(' %% cg_rhs_2 time %0.6fs',tmp_t)); end;
%%%%%%%%;
tmp_t = tic();
[ ...
 k_p_polar_a_gpu_x_wM__ ...
,k_p_azimu_b_gpu_x_wM__ ...
,k_c_0_gpu_x_wM__ ...
,k_c_1_gpu_x_wM__ ...
,k_c_2_gpu_x_wM__ ...
,k_p_r01_gpu_x_wM__ ...
,dtau_k_p_polar_a_gpu_wM3___ ...
,dtau_k_p_azimu_b_gpu_wM3___ ...
,dtau_k_c_0_gpu_wM3___ ...
,dtau_k_c_1_gpu_wM3___ ...
,dtau_k_c_2_gpu_wM3___ ...
,dtau_k_p_r01_gpu_wM3___ ...
,dtau_dtau_k_p_polar_a_gpu_wM33____ ...
,dtau_dtau_k_p_azimu_b_gpu_wM33____ ...
,dtau_dtau_k_c_0_gpu_wM33____ ...
,dtau_dtau_k_c_1_gpu_wM33____ ...
,dtau_dtau_k_c_2_gpu_wM33____ ...
,dtau_dtau_k_p_r01_gpu_wM33____ ...
] = ...
cg_rhs_gpu_2( ...
 n_M ...
,n_w ...
,viewing_polar_a_M_ ...
,viewing_azimu_b_M_ ...
,viewing_gamma_z_M_ ...
);
tmp_t = toc(tmp_t); if (flag_verbose>0); disp(sprintf(' %% cg_rhs_gpu_2 time %0.6fs',tmp_t)); end;
%%%%%%%%;
fnorm_disp(flag_verbose,'k_p_polar_a_cpu_x_wM__',k_p_polar_a_cpu_x_wM__,'k_p_polar_a_gpu_x_wM__',k_p_polar_a_gpu_x_wM__);
fnorm_disp(flag_verbose,'k_p_azimu_b_cpu_x_wM__',k_p_azimu_b_cpu_x_wM__,'k_p_azimu_b_gpu_x_wM__',k_p_azimu_b_gpu_x_wM__);
fnorm_disp(flag_verbose,'k_c_0_cpu_x_wM__',k_c_0_cpu_x_wM__,'k_c_0_gpu_x_wM__',k_c_0_gpu_x_wM__);
fnorm_disp(flag_verbose,'k_c_1_cpu_x_wM__',k_c_1_cpu_x_wM__,'k_c_1_gpu_x_wM__',k_c_1_gpu_x_wM__);
fnorm_disp(flag_verbose,'k_c_2_cpu_x_wM__',k_c_2_cpu_x_wM__,'k_c_2_gpu_x_wM__',k_c_2_gpu_x_wM__);
fnorm_disp(flag_verbose,'k_p_r01_cpu_x_wM__',k_p_r01_cpu_x_wM__,'k_p_r01_gpu_x_wM__',k_p_r01_gpu_x_wM__);
fnorm_disp(flag_verbose,'dtau_k_p_polar_a_cpu_wM3___',dtau_k_p_polar_a_cpu_wM3___,'dtau_k_p_polar_a_gpu_wM3___',dtau_k_p_polar_a_gpu_wM3___);
fnorm_disp(flag_verbose,'dtau_k_p_azimu_b_cpu_wM3___',dtau_k_p_azimu_b_cpu_wM3___,'dtau_k_p_azimu_b_gpu_wM3___',dtau_k_p_azimu_b_gpu_wM3___);
fnorm_disp(flag_verbose,'dtau_k_c_0_cpu_wM3___',dtau_k_c_0_cpu_wM3___,'dtau_k_c_0_gpu_wM3___',dtau_k_c_0_gpu_wM3___);
fnorm_disp(flag_verbose,'dtau_k_c_1_cpu_wM3___',dtau_k_c_1_cpu_wM3___,'dtau_k_c_1_gpu_wM3___',dtau_k_c_1_gpu_wM3___);
fnorm_disp(flag_verbose,'dtau_k_c_2_cpu_wM3___',dtau_k_c_2_cpu_wM3___,'dtau_k_c_2_gpu_wM3___',dtau_k_c_2_gpu_wM3___);
fnorm_disp(flag_verbose,'dtau_k_p_r01_cpu_wM3___',dtau_k_p_r01_cpu_wM3___,'dtau_k_p_r01_gpu_wM3___',dtau_k_p_r01_gpu_wM3___);
fnorm_disp(flag_verbose,'dtau_dtau_k_p_polar_a_cpu_wM33____',dtau_dtau_k_p_polar_a_cpu_wM33____,'dtau_dtau_k_p_polar_a_gpu_wM33____',dtau_dtau_k_p_polar_a_gpu_wM33____);
fnorm_disp(flag_verbose,'dtau_dtau_k_p_azimu_b_cpu_wM33____',dtau_dtau_k_p_azimu_b_cpu_wM33____,'dtau_dtau_k_p_azimu_b_gpu_wM33____',dtau_dtau_k_p_azimu_b_gpu_wM33____);
fnorm_disp(flag_verbose,'dtau_dtau_k_c_0_cpu_wM33____',dtau_dtau_k_c_0_cpu_wM33____,'dtau_dtau_k_c_0_gpu_wM33____',dtau_dtau_k_c_0_gpu_wM33____);
fnorm_disp(flag_verbose,'dtau_dtau_k_c_1_cpu_wM33____',dtau_dtau_k_c_1_cpu_wM33____,'dtau_dtau_k_c_1_gpu_wM33____',dtau_dtau_k_c_1_gpu_wM33____);
fnorm_disp(flag_verbose,'dtau_dtau_k_c_2_cpu_wM33____',dtau_dtau_k_c_2_cpu_wM33____,'dtau_dtau_k_c_2_gpu_wM33____',dtau_dtau_k_c_2_gpu_wM33____);
fnorm_disp(flag_verbose,'dtau_dtau_k_p_r01_cpu_wM33____',dtau_dtau_k_p_r01_cpu_wM33____,'dtau_dtau_k_p_r01_gpu_wM33____',dtau_dtau_k_p_r01_gpu_wM33____);
%%%%%%%%;

disp('returning'); return;
