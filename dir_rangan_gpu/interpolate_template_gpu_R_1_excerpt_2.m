if (flag_verbose>0); disp(sprintf(' %% Note: compare R_use__*LHS_rot_gpu_012012__*transpose(R_use__) to LHS_ori_gpu_012012__.')); end;
if (flag_verbose>0); disp(sprintf(' %% Copying second-derivatives to ddtemplatedaa_rec_gpu_wkT__.')); end;
if (flag_verbose>0); disp(sprintf(' %% Also creating ddtemplatedabcabc_rec_gpu__.')); end;
tmp_t = tic();
ddtemplatedaa_rec_gpu_wkT__ = gpuArray( zeros(n_w_sum,n_T) );
ddtemplatedab_rec_gpu_wkT__ = gpuArray( zeros(n_w_sum,n_T) );
ddtemplatedac_rec_gpu_wkT__ = gpuArray( zeros(n_w_sum,n_T) );
ddtemplatedbb_rec_gpu_wkT__ = gpuArray( zeros(n_w_sum,n_T) );
ddtemplatedbc_rec_gpu_wkT__ = gpuArray( zeros(n_w_sum,n_T) );
ddtemplatedcc_rec_gpu_wkT__ = gpuArray( zeros(n_w_sum,n_T) );
for nw=0:n_w_max-1;
for nT=0:n_T-1;
%%%%;
J_ori_gpu_abc012__ = J_ori_gpu_abc012wT____(:,:,1+nw,1+nT);
pinv_J_ori_gpu_abc012__ = pinv_J_ori_gpu_abc012wT____(:,:,1+nw,1+nT);
H_ori_gpu_abcabc012__ = [ ...
; dtau_dtau_k_c_0_gpu_wTabcabc____(1+nw,1+nT,1+tab_a,1+tab_a) , dtau_dtau_k_c_1_gpu_wTabcabc____(1+nw,1+nT,1+tab_a,1+tab_a) , dtau_dtau_k_c_2_gpu_wTabcabc____(1+nw,1+nT,1+tab_a,1+tab_a) ...
; dtau_dtau_k_c_0_gpu_wTabcabc____(1+nw,1+nT,1+tab_a,1+tab_b) , dtau_dtau_k_c_1_gpu_wTabcabc____(1+nw,1+nT,1+tab_a,1+tab_b) , dtau_dtau_k_c_2_gpu_wTabcabc____(1+nw,1+nT,1+tab_a,1+tab_b) ...
; dtau_dtau_k_c_0_gpu_wTabcabc____(1+nw,1+nT,1+tab_a,1+tab_c) , dtau_dtau_k_c_1_gpu_wTabcabc____(1+nw,1+nT,1+tab_a,1+tab_c) , dtau_dtau_k_c_2_gpu_wTabcabc____(1+nw,1+nT,1+tab_a,1+tab_c) ...
; dtau_dtau_k_c_0_gpu_wTabcabc____(1+nw,1+nT,1+tab_b,1+tab_a) , dtau_dtau_k_c_1_gpu_wTabcabc____(1+nw,1+nT,1+tab_b,1+tab_a) , dtau_dtau_k_c_2_gpu_wTabcabc____(1+nw,1+nT,1+tab_b,1+tab_a) ...
; dtau_dtau_k_c_0_gpu_wTabcabc____(1+nw,1+nT,1+tab_b,1+tab_b) , dtau_dtau_k_c_1_gpu_wTabcabc____(1+nw,1+nT,1+tab_b,1+tab_b) , dtau_dtau_k_c_2_gpu_wTabcabc____(1+nw,1+nT,1+tab_b,1+tab_b) ...
; dtau_dtau_k_c_0_gpu_wTabcabc____(1+nw,1+nT,1+tab_b,1+tab_c) , dtau_dtau_k_c_1_gpu_wTabcabc____(1+nw,1+nT,1+tab_b,1+tab_c) , dtau_dtau_k_c_2_gpu_wTabcabc____(1+nw,1+nT,1+tab_b,1+tab_c) ...
; dtau_dtau_k_c_0_gpu_wTabcabc____(1+nw,1+nT,1+tab_c,1+tab_a) , dtau_dtau_k_c_1_gpu_wTabcabc____(1+nw,1+nT,1+tab_c,1+tab_a) , dtau_dtau_k_c_2_gpu_wTabcabc____(1+nw,1+nT,1+tab_c,1+tab_a) ...
; dtau_dtau_k_c_0_gpu_wTabcabc____(1+nw,1+nT,1+tab_c,1+tab_b) , dtau_dtau_k_c_1_gpu_wTabcabc____(1+nw,1+nT,1+tab_c,1+tab_b) , dtau_dtau_k_c_2_gpu_wTabcabc____(1+nw,1+nT,1+tab_c,1+tab_b) ...
; dtau_dtau_k_c_0_gpu_wTabcabc____(1+nw,1+nT,1+tab_c,1+tab_c) , dtau_dtau_k_c_1_gpu_wTabcabc____(1+nw,1+nT,1+tab_c,1+tab_c) , dtau_dtau_k_c_2_gpu_wTabcabc____(1+nw,1+nT,1+tab_c,1+tab_c) ...
];
H_ori_gpu_abcabc012012__ = reshape(bsxfun(@times,reshape(J_ori_gpu_abc012__,[n_3,n_1,n_3,n_1]),reshape(J_ori_gpu_abc012__,[n_1,n_3,n_1,n_3])),[n_9,n_9]);
pinv_H_ori_gpu_abcabc012012__ = pinv(H_ori_gpu_abcabc012012__,tolerance_pinv);
%%%%;
J_rot_gpu_abc012__ = J_rot_gpu_abc012wT____(:,:,1+nw,1+nT);
pinv_J_rot_gpu_abc012__ = pinv_J_rot_gpu_abc012wT____(:,:,1+nw,1+nT);
H_rot_gpu_abcabc012__ = [ ...
; dtau_dtau_R_k_c_0_gpu_wTabcabc____(1+nw,1+nT,1+tab_a,1+tab_a) , dtau_dtau_R_k_c_1_gpu_wTabcabc____(1+nw,1+nT,1+tab_a,1+tab_a) , dtau_dtau_R_k_c_2_gpu_wTabcabc____(1+nw,1+nT,1+tab_a,1+tab_a) ...
; dtau_dtau_R_k_c_0_gpu_wTabcabc____(1+nw,1+nT,1+tab_a,1+tab_b) , dtau_dtau_R_k_c_1_gpu_wTabcabc____(1+nw,1+nT,1+tab_a,1+tab_b) , dtau_dtau_R_k_c_2_gpu_wTabcabc____(1+nw,1+nT,1+tab_a,1+tab_b) ...
; dtau_dtau_R_k_c_0_gpu_wTabcabc____(1+nw,1+nT,1+tab_a,1+tab_c) , dtau_dtau_R_k_c_1_gpu_wTabcabc____(1+nw,1+nT,1+tab_a,1+tab_c) , dtau_dtau_R_k_c_2_gpu_wTabcabc____(1+nw,1+nT,1+tab_a,1+tab_c) ...
; dtau_dtau_R_k_c_0_gpu_wTabcabc____(1+nw,1+nT,1+tab_b,1+tab_a) , dtau_dtau_R_k_c_1_gpu_wTabcabc____(1+nw,1+nT,1+tab_b,1+tab_a) , dtau_dtau_R_k_c_2_gpu_wTabcabc____(1+nw,1+nT,1+tab_b,1+tab_a) ...
; dtau_dtau_R_k_c_0_gpu_wTabcabc____(1+nw,1+nT,1+tab_b,1+tab_b) , dtau_dtau_R_k_c_1_gpu_wTabcabc____(1+nw,1+nT,1+tab_b,1+tab_b) , dtau_dtau_R_k_c_2_gpu_wTabcabc____(1+nw,1+nT,1+tab_b,1+tab_b) ...
; dtau_dtau_R_k_c_0_gpu_wTabcabc____(1+nw,1+nT,1+tab_b,1+tab_c) , dtau_dtau_R_k_c_1_gpu_wTabcabc____(1+nw,1+nT,1+tab_b,1+tab_c) , dtau_dtau_R_k_c_2_gpu_wTabcabc____(1+nw,1+nT,1+tab_b,1+tab_c) ...
; dtau_dtau_R_k_c_0_gpu_wTabcabc____(1+nw,1+nT,1+tab_c,1+tab_a) , dtau_dtau_R_k_c_1_gpu_wTabcabc____(1+nw,1+nT,1+tab_c,1+tab_a) , dtau_dtau_R_k_c_2_gpu_wTabcabc____(1+nw,1+nT,1+tab_c,1+tab_a) ...
; dtau_dtau_R_k_c_0_gpu_wTabcabc____(1+nw,1+nT,1+tab_c,1+tab_b) , dtau_dtau_R_k_c_1_gpu_wTabcabc____(1+nw,1+nT,1+tab_c,1+tab_b) , dtau_dtau_R_k_c_2_gpu_wTabcabc____(1+nw,1+nT,1+tab_c,1+tab_b) ...
; dtau_dtau_R_k_c_0_gpu_wTabcabc____(1+nw,1+nT,1+tab_c,1+tab_c) , dtau_dtau_R_k_c_1_gpu_wTabcabc____(1+nw,1+nT,1+tab_c,1+tab_c) , dtau_dtau_R_k_c_2_gpu_wTabcabc____(1+nw,1+nT,1+tab_c,1+tab_c) ...
];
H_rot_gpu_abcabc012012__ = reshape(bsxfun(@times,reshape(J_rot_gpu_abc012__,[n_3,n_1,n_3,n_1]),reshape(J_rot_gpu_abc012__,[n_1,n_3,n_1,n_3])),[n_9,n_9]);
pinv_H_rot_gpu_abcabc012012__ = pinv(H_rot_gpu_abcabc012012__,tolerance_pinv);
%%%%;
for nk_p_r=0:n_k_p_r-1;
nwk = nw + nk_p_r*n_w_max;
%%;
dtemplated012_ori_gpu_ = [ ...
; dtemplated0_ori_gpu_wkT__(1+nwk,1+nT) ...
; dtemplated1_ori_gpu_wkT__(1+nwk,1+nT) ...
; dtemplated2_ori_gpu_wkT__(1+nwk,1+nT) ...
];
ddtemplatedabcabc_ori_ = [ ...
; ddtemplatedaa_ori_gpu_wkT__(1+nwk,1+nT) ...
; ddtemplatedab_ori_gpu_wkT__(1+nwk,1+nT) ...
; ddtemplatedac_ori_gpu_wkT__(1+nwk,1+nT) ...
; ddtemplatedba_ori_gpu_wkT__(1+nwk,1+nT) ...
; ddtemplatedbb_ori_gpu_wkT__(1+nwk,1+nT) ...
; ddtemplatedbc_ori_gpu_wkT__(1+nwk,1+nT) ...
; ddtemplatedca_ori_gpu_wkT__(1+nwk,1+nT) ...
; ddtemplatedcb_ori_gpu_wkT__(1+nwk,1+nT) ...
; ddtemplatedcc_ori_gpu_wkT__(1+nwk,1+nT) ...
];
RHS_ori_gpu_abcabc_ = ddtemplatedabcabc_ori_ - H_ori_gpu_abcabc012__*dtemplated012_ori_gpu_ ;
LHS_ori_gpu_012012_ = pinv_H_ori_gpu_abcabc012012__ * RHS_ori_gpu_abcabc_ ;
LHS_ori_gpu_012012__ = reshape(LHS_ori_gpu_012012_,[n_3,n_3]);
%%;
dtemplated012_rot_gpu_ = [ ...
; dtemplated0_rot_gpu_wkT__(1+nwk,1+nT) ...
; dtemplated1_rot_gpu_wkT__(1+nwk,1+nT) ...
; dtemplated2_rot_gpu_wkT__(1+nwk,1+nT) ...
];
ddtemplatedabcabc_rot_ = [ ...
; ddtemplatedaa_rot_gpu_wkT__(1+nwk,1+nT) ...
; ddtemplatedab_rot_gpu_wkT__(1+nwk,1+nT) ...
; ddtemplatedac_rot_gpu_wkT__(1+nwk,1+nT) ...
; ddtemplatedba_rot_gpu_wkT__(1+nwk,1+nT) ...
; ddtemplatedbb_rot_gpu_wkT__(1+nwk,1+nT) ...
; ddtemplatedbc_rot_gpu_wkT__(1+nwk,1+nT) ...
; ddtemplatedca_rot_gpu_wkT__(1+nwk,1+nT) ...
; ddtemplatedcb_rot_gpu_wkT__(1+nwk,1+nT) ...
; ddtemplatedcc_rot_gpu_wkT__(1+nwk,1+nT) ...
];
RHS_rot_gpu_abcabc_ = ddtemplatedabcabc_rot_ - H_rot_gpu_abcabc012__*dtemplated012_rot_gpu_ ;
LHS_rot_gpu_012012_ = pinv_H_rot_gpu_abcabc012012__ * RHS_rot_gpu_abcabc_ ;
LHS_rot_gpu_012012__ = reshape(LHS_rot_gpu_012012_,[n_3,n_3]);
%%;
if flag_verbose>2;
fnorm_disp(flag_verbose,'R_use__*LHS_rot_gpu_012012__*transpose(R_use__)',R_use__*LHS_rot_gpu_012012__*transpose(R_use__),'LHS_ori_gpu_012012__',LHS_ori_gpu_012012__);
end;%if flag_verbose>2;
%%;
dtemplated012_rec_gpu_ = [ ...
; dtemplated0_rec_gpu_wkT__(1+nwk,1+nT) ...
; dtemplated1_rec_gpu_wkT__(1+nwk,1+nT) ...
; dtemplated2_rec_gpu_wkT__(1+nwk,1+nT) ...
];
LHS_rec_gpu_012012__ = R_use__*LHS_rot_gpu_012012__*transpose(R_use__) ;
LHS_rec_gpu_012012_ = reshape(LHS_rec_gpu_012012__,[n_9,1]);
ddtemplatedabcabc_rec_ = H_ori_gpu_abcabc012__ * dtemplated012_rec_gpu_ + H_ori_gpu_abcabc012012__ * LHS_rec_gpu_012012_ ;
%%;
ddtemplatedabcabc_rec_gpu__ = reshape(ddtemplatedabcabc_rec_,[n_3,n_3]);
ddtemplatedabcabc_rec_gpu__ = 0.5*(ddtemplatedabcabc_rec_gpu__ + transpose(ddtemplatedabcabc_rec_gpu__));
%%;
ddtemplatedaa_rec_gpu_wkT__(1+nwk,1+nT) = ddtemplatedabcabc_rec_gpu__(1+tab_a,1+tab_a);
ddtemplatedab_rec_gpu_wkT__(1+nwk,1+nT) = ddtemplatedabcabc_rec_gpu__(1+tab_a,1+tab_b);
ddtemplatedac_rec_gpu_wkT__(1+nwk,1+nT) = ddtemplatedabcabc_rec_gpu__(1+tab_a,1+tab_c);
ddtemplatedbb_rec_gpu_wkT__(1+nwk,1+nT) = ddtemplatedabcabc_rec_gpu__(1+tab_b,1+tab_b);
ddtemplatedbc_rec_gpu_wkT__(1+nwk,1+nT) = ddtemplatedabcabc_rec_gpu__(1+tab_b,1+tab_c);
ddtemplatedcc_rec_gpu_wkT__(1+nwk,1+nT) = ddtemplatedabcabc_rec_gpu__(1+tab_c,1+tab_c);
end;%for nk_p_r=0:n_k_p_r-1;
end;%for nT=0:n_T-1;
end;%for nw=0:n_w_max-1;
tmp_t = toc(tmp_t); if (flag_verbose>0); disp(sprintf(' %% ddtemplatedxx_rec_gpu_wkT__: time %0.6fs',tmp_t)); end;
%%%%%%%%;
